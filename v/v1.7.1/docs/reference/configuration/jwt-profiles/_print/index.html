<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.88.1" /><link rel="canonical" type="text/html" href="/v/v1.7.1/docs/reference/configuration/jwt-profiles/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/v/v1.7.1/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/v1.7.1/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/v1.7.1/favicons/android-192x192.png" sizes="192x192">

<title>JWT profiles support | INDIGO IAM</title><meta property="og:title" content="JWT profiles support" />
<meta property="og:description" content="The INDIGO Identity and Access Management (IAM) Service" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/v1.7.1/docs/reference/configuration/jwt-profiles/" /><meta property="og:site_name" content="INDIGO IAM" />

<meta itemprop="name" content="JWT profiles support">
<meta itemprop="description" content="The INDIGO Identity and Access Management (IAM) Service"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JWT profiles support"/>
<meta name="twitter:description" content="The INDIGO Identity and Access Management (IAM) Service"/>







<link rel="preload" href="/v/v1.7.1/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" as="style">
<link href="/v/v1.7.1/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/v/v1.7.1/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">INDIGO IAM</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/v/v1.7.1/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/v/v1.7.1/blog/" ><span>Blog</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.1">v1.7.1</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/docs/v/current/">older releases</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v/v1.7.1/offline-search-index.3e0e3249392b4ee3ecc11f65b3fac681.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/v/v1.7.1/docs/reference/configuration/jwt-profiles/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">JWT profiles support</h1>





    <ul>
    
  
  
  
  

  

    </ul>


<div class="content">
      <p>Starting with version 1.6.0, IAM introduces support for JWT <em>profiles</em>.</p>
<p>A JWT profile is a named set of rules that defines which information is
included in access tokens, id tokens,  userinfo and introspection responses
issued by IAM in an OAuth/OIDC message exchanges.</p>
<p>IAM allows to define a default profile that is used for all clients that are
not explicitly bound to one. This allows to use the same profile across
all clients in an organization.</p>
<p>It&rsquo;s also possible to define the profile to be used at client level, using
scopes, i.e. adding among the scope allowed for the client the name of the
profile the client should use. The scope, in this context, does not identify a
set of permissions but an encoding of authentication/authorization informations
in tokens and responses issued by IAM.</p>
<p>This mechanism enables integration of the same IAM instance with resources
relying on different profiles.</p>
<p>IAM currently supports three JWT profiles:</p>
<ul>
<li>the <code>iam</code> profile</li>
<li>the <code>wlcg</code> WLCG profile</li>
<li>the <code>aarc</code> profile</li>
</ul>
<h2 id="setting-the-default-profile">Setting the default profile</h2>
<p>The IAM JWT default profile is set using the <code>IAM_JWT_DEFAULT_PROFILE</code>
environment variable, e.g.:</p>
<pre tabindex="0"><code>IAM_JWT_DEFAULT_PROFILE=iam
</code></pre><p>The default profile will be used for all clients that do not explicitly and
correctly request the use of a profile using scopes.</p>
<h2 id="using-scopes-to-select-the-jwt-profile-for-a-client">Using scopes to select the JWT profile for a client</h2>
<p>To select the profile used by a client, include one of the following scopes
in the list of scopes authorized for a client:</p>
<ul>
<li><code>iam</code>, for the IAM profile</li>
<li><code>wlcg</code>, for the WLCG profile</li>
<li><code>aarc</code> profile, for the AARC profile</li>
</ul>
<p>Clients should only link to one profile. When multiple profiles are linked to a
client, IAM falls back to the default profile configured for the IAM instance.</p>
<h2 id="using-system-scopes-to-control-profile-selection">Using system scopes to control profile selection</h2>
<p>MitreID <strong>System Scopes</strong> can be used to control access to profile selection.</p>
<p>For example, by setting a profile scope as <code>restricted</code>, such scope will not be
available to dynamically registered clients and can only be assigned to clients
by IAM administrators.</p>
<h2 id="supported-jwt-profiles">Supported JWT profiles</h2>
<h3 id="the-iam-profile">The IAM profile</h3>
<p>This is the default profile for IAM.</p>
<p>With this profile:</p>
<ul>
<li>
<p>groups are enconded in the <code>groups</code> claim; all the groups the user is member
of are included in the groups claim;</p>
</li>
<li>
<p>authentication information (username, email, groups) is not by default
included in access tokens; this behaviour can be changed by setting the
<code>IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO=true</code> environment variable;</p>
</li>
<li>
<p>scope information is not by default included in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_SCOPE=true</code>
environment variable;</p>
</li>
<li>
<p>the <code>nbf</code> (not before) claim is not set in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_NBF=true</code>
environment variable;</p>
</li>
</ul>
<p>This profile is assigned to clients using the <code>iam</code>  scope.</p>
<h3 id="the-wlcg-profile">The WLCG profile</h3>
<p>This profile implements the <a href="https://zenodo.org/record/3460258">Common JWT Token profile</a>.</p>
<p>In particular:</p>
<ul>
<li>the <code>scope</code> claim is always included in access tokens;</li>
<li>groups are not included by default in access and ID tokens;</li>
</ul>
<p>This profile is assigned to clients using the <code>wlcg</code> scope.</p>
<h4 id="requesting-groups-with-the-wlcg-profile">Requesting groups with the WLCG profile</h4>
<p>When the WLCG profile is used, groups are not automatically included in access
tokens and ID tokens, but can be requested using the <code>wlcg.groups</code> scope,
following the rules described in the <a href="https://github.com/WLCG-AuthZ-WG/CommonJWTProfile/blob/master/profile.md#scope-based-group-selection">WLCG
profile</a>.</p>
<h4 id="optional-groups">Optional groups</h4>
<p>Optional groups are groups whose membership is only asserted in tokens on
explicit request coming from a user.</p>
<p>In order to configure a IAM group as an optional group, add the
<code>wlcg.optional-group</code> label to the group.</p>
<h3 id="the-aarc-profile">The AARC profile</h3>
<p>This profile encodes group membership information following the rules defined
by the <a href="https://aarc-project.eu/guidelines/aarc-g002/">AARC G002</a> profile document.</p>
<p>In particular:</p>
<ul>
<li>groups and organisation name are not included by default in access and ID tokens;</li>
<li>organisation name can be requested using the <code>eduperson_scoped_affiliation</code> scope and it&rsquo;s encoded in the <code>eduperson_scoped_affiliation</code> claim;</li>
<li>groups can be requested using the <code>eduperson_entitlement</code> scope and they&rsquo;re encoded as URN in the <code>eduperson_entitlement</code> claim;</li>
</ul>
<p>All the mapping rules are described in the <a href="https://docs.google.com/document/d/1b-Mlet3Lq7qKLEf1BnHJ4nL1fq-vMe7fzpXyrq2wp08/edit">White Paper for implementation mappings between SAML 2.0 and OpenID Connect in Research and Education</a>.</p>
<p>This profile is assigned to clients using the <code>aarc</code> scope.</p>

</div>
</div>


  
  
  
  

  
  

  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/indigo-iam/iam">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://indigo-iam.slack.com">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 INFN All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/v/v1.7.1/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>




  </body>
</html>
