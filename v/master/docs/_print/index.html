<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.86.0" /><link rel="canonical" type="text/html" href="/v/master/docs/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/v/master/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/master/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/master/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/master/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/master/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/master/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/master/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/master/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/master/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/master/favicons/android-192x192.png" sizes="192x192">

<title>Documentation | INDIGO IAM</title><meta property="og:title" content="Documentation" />
<meta property="og:description" content="The INDIGO Identity and Access Management (IAM) Service" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/master/docs/" /><meta property="og:site_name" content="INDIGO IAM" />

<meta itemprop="name" content="Documentation">
<meta itemprop="description" content="The INDIGO Identity and Access Management (IAM) Service"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Documentation"/>
<meta name="twitter:description" content="The INDIGO Identity and Access Management (IAM) Service"/>







<link rel="preload" href="/v/master/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" as="style">
<link href="/v/master/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/v/master/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">INDIGO IAM</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/v/master/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/v/master/blog/" ><span>Blog</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/main">main</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v/master/offline-search-index.fefb40fbea53ce2455ccf6b2fc7ac834.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/v/master/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Documentation</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6557438925ac398717df86f494c6abb8">Overview</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-17b09a9dc5200475d8a306f18e63a0f9">Getting Started</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-42f041991d0b1099049789121a1a0e30">NGINX configuration</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-980bb6b8f4caf192ab4ad321d15c254c">Database configuration</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-fdf064a7010ecbaa1fbf4241d74375cb">JSON Web Keys configuration</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-d4954573f74248cc2cf402a430af4a23">Deployment with Docker</a></li>


    
  
    
    
	
<li>2.5: <a href="#pg-e6965747ca75cbeed664615ee54c8647">Deployment with packages</a></li>


    
  
    
    
	
<li>2.6: <a href="#pg-be6d46da99ec93fad0e93382c3763c05">Basic IAM setup</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-dd948255948d6b59b32c471abcb62997">Concepts</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-b00a88a07ceb21b1a83e5822e0c86c1d">Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-6daa71035bbf2489d120742c0452575f">APIs</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1.1: <a href="#pg-86d47510999bc2977fb7970cadcf54cc">AUP management API</a></li>


    
  
    
    
	
<li>4.1.2: <a href="#pg-5f98ef65599be38eb06ad3a9f70307f1">Group requests API</a></li>


    
  
    
    
	
<li>4.1.3: <a href="#pg-6bac9b32bfac99dba534d199b6900374">Health checks</a></li>


    
  
    
    
	
<li>4.1.4: <a href="#pg-ae2dfdac8f1e824e219096bb20fbe4dd">IAM Token management API</a></li>


    
  
    
    
	
<li>4.1.5: <a href="#pg-79982fb90b690ba4430ec5123ea2927a">OAuth token exchange API</a></li>


    
  
    
    
	
<li>4.1.6: <a href="#pg-167ff098c8b010fb17614df7ba73694d">OAuth token introspection API</a></li>


    
  
    
    
	
<li>4.1.7: <a href="#pg-e9e5ebcd88b6ff930c7d37a637080e40">OpenID Connect client management API</a></li>


    
  
    
    
	
<li>4.1.8: <a href="#pg-49efb320846282f9e6c68fa2debefad5">OpenID Connect client registration API</a></li>


    
  
    
    
	
<li>4.1.9: <a href="#pg-ff5f4511d04c6e9b13f1c49c32e2c50d">SCIM API</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4.2: <a href="#pg-546d6976fff9de02db89bd2588e84da3">Configuration</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.2.1: <a href="#pg-5cb2c17061941e1c1c672862bc22824c">JWT profiles support</a></li>


    
  
    
    
	
<li>4.2.2: <a href="#pg-e0f442387d8fc56f35f4b7d4d89f3ce8">Membership lifecycle</a></li>


    
  
    
    
	
<li>4.2.3: <a href="#pg-e78a0c48975ae96adce928da21191be8">Registration &amp; Enrollment</a></li>


    
  
    
    
	
<li>4.2.4: <a href="#pg-08aa2036fbc5e84f4da3870adf6049ec">Local authentication</a></li>


    
  
    
    
	
<li>4.2.5: <a href="#pg-359104377f9341d4c326d45fb209b4c2">External authentication</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.2.5.1: <a href="#pg-cee8377dbff27d67a12761bb25f74def">OpenID-Connect authentication</a></li>


    
  
    
    
	
<li>4.2.5.2: <a href="#pg-5bf3dce2c99e5619768b49664c510ead">SAML authentication</a></li>


    
  
    
    
	
<li>4.2.5.3: <a href="#pg-e6e021be71af3761af40968d69e6df70">X.509 authentication</a></li>


    
  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-f8918f697450c2009b75913f9e9317a5">Tasks</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-18193143b4ee08bf7ab15851bbaded55">IAM organization administration</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1.1: <a href="#pg-2c051a32f27ba9097cfdeda817a84e30">User management</a></li>


    
  
    
    
	
<li>5.1.2: <a href="#pg-ff12c9bf3d6558e0104e7c891e85c453">Group Management</a></li>


    
  
    
    
	
<li>5.1.3: <a href="#pg-0af4d8b64c334906ff63d946a0432cb3">Acceptable Usage Policy (AUP) management</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5.2: <a href="#pg-0d446af92e463090d9e1b94f286038c9">IAM service deployment</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.2.1: <a href="#pg-5d089d6d346a3d6d95efe8ed3f4f3b59">Backup &amp; Restore</a></li>


    
  
    
    
	
<li>5.2.2: <a href="#pg-72263be5cb6d3466ca85fd5f75107c79">Audit log</a></li>


    
  
    
    
	
<li>5.2.3: <a href="#pg-80f57e3c8e02d141aae66942670e5535">Upgrade</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5.3: <a href="#pg-dbcc046a6c208e0a089e20aecc2dbaec">User</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.3.1: <a href="#pg-7d8a8f8d5b0f979b1c8c82a81bf939a4">Joining an IAM-managed organization</a></li>


    
  
    
    
	
<li>5.3.2: <a href="#pg-3f5cbf21bf0cdcf7173175718d59c4c1">Obtaining an IAM access token from a CLI</a></li>


    
  
    
    
	
<li>5.3.3: <a href="#pg-01f88f6873f44e2e7cfcdffdd6fb2816">Registering a client</a></li>


    
  
    
    
	
<li>5.3.4: <a href="#pg-a22a3b0b99e400fc5ef266bb68b93233">Change account information</a></li>


    
  
    
    
	
<li>5.3.5: <a href="#pg-0fcad7ff414ad3eacd9acb70a4d8bd64">Changing the account password</a></li>


    
  
    
    
	
<li>5.3.6: <a href="#pg-bbf139877831b082e901ece0d36cbb3b">Linking an external account</a></li>


    
  
    
    
	
<li>5.3.7: <a href="#pg-8c7bd1453e2b38a50c4a591032b21ba0">Linking an X.509 certificate</a></li>


    
  
    
    
	
<li>5.3.8: <a href="#pg-b5e9e2b1e5b01a59c3094d6a322de40e">Managing active tokens</a></li>


    
  
    
    
	
<li>5.3.9: <a href="#pg-b5f411892927a1d85e8ded48cb778eb1">Managing approved sites</a></li>


    
  
    
    
	
<li>5.3.10: <a href="#pg-18d43a62d9d80a6d77ca13d5f9613c6a">Reset an account password</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-a7c9e10a31abdecaec5a338462a220a8">Developer guide</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-63fc23311c2c31b8d70578804ff3e9bf">IAM as a service</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>for IAM v1.7.0</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6557438925ac398717df86f494c6abb8">1 - Overview</h1>
    <div class="lead">A brief overview of the INDIGO IAM service</div>
	<p>The INDIGO Identity and Access Management (IAM) Service provides a layer where
identities, enrollment, group membership and other attributes and authorization
policies on distributed resources can be managed in an homogeneous way,
supporting identity federations and other authentication mechanisms (X.509
certificates and social logins).</p>
<p>IAM implements the Virtual Organization (VO) concept, and is the developed by
the same team behind <a href="https://italiangrid.github.io/voms">VOMS</a>.</p>
<p>IAM is the AAI solution chosen to power the next generation <a href="https://wlcg.web.cern.ch/">WLCG</a>
Authentication and Authorization infrastructure.</p>
<h2 id="functions">Functions</h2>
<ul>
<li><strong>Flexible authentication</strong>: The IAM supports user authentication via local
username and password credentials as well as SAML Identity Federations,
OpenID Connect providers and X.509.</li>
<li><strong>Enrollment</strong>: The IAM provides VO enrollment and registration functionalities,
so that users can join groups/collaborations according to well-defined flows.</li>
<li><strong>Attribute and identity management</strong>: The IAM provides services to manage
group membership, attributes assignment and account linking functionality.</li>
<li><strong>User provisioning</strong>: the IAM provides endpoints to provision information
about users identities to other services, so that consistent local account
provisioning, for example, can be implemented.</li>
</ul>
<h2 id="integrations">Integrations</h2>
<p>The IAM service has been succesfully integrated with many off-the-shelf
components like Openstack, Kubernetes, Atlassian JIRA and Confluence, Grafana
and with key Grid computing middleware services (e.g., <a href="https://rucio.cern.ch/">RUCIO</a>,
<a href="https://fts.web.cern.ch/fts/">FTS</a>, <a href="https://www.dcache.org/">dCache</a>, <a href="https://italiangrid.github.io/storm">StoRM</a>, <a href="https://xrootd.slac.stanford.edu/index.html">XRootD</a>,
<a href="https://research.cs.wisc.edu/htcondor/">HTCondor</a>).</p>
<h2 id="service-access-options">Service access options</h2>
<h3 id="iam-as-a-service">IAM as a service</h3>
<p>INFN provides IAM as a service to partner research communities. In this
scenario, a dedicated IAM instance is deployed on the INFN infrastructure and
configured according to the community needs. INFN takes care of keeping the
service operational and up-to-date, while administrative control on the IAM
instance is granted to the community.</p>
<p>For more information on how to access IAM as a service, click
<a href="/docs/iam-aas/">here</a>.</p>
<h3 id="on-premise-deployment">On-premise deployment</h3>
<p>IAM is an Apache-licensed identity solution, for which we provide a Docker
image on dockerhub and RPM and Debian packages.</p>
<p>IAM can be deployed on-premises following the advice in the <a href="/docs/administrator-guide/">Deployment and
administration guide</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-17b09a9dc5200475d8a306f18e63a0f9">2 - Getting Started</h1>
    <div class="lead">A quick howto on how to deploy IAM</div>
	<p>This section provides insight on how to deploy and configure an IAM service
instance.</p>
<p>IAM is a <a href="https://spring.io/projects/spring-boot">spring boot application</a> designed to run behind an <a href="https://www.nginx.com/">NGINX</a>
reverse proxy, which is used for TLS termination and possibly load balancing.
The IAM service instances keep all state in a MariaDB/MySQL database, as shown
in the following picture:</p>
<p><img src="images/iam-deployment.png" alt="IAM deployment overview"></p>
<h2 id="prerequisites">Prerequisites</h2>
<p>At the bare minimum, to run a production instance of the instance of the IAM
you will need:</p>
<ul>
<li>An X.509 certificate, used for SSL termination at the NGINX reverse proxy;
you can get one for free from <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>;</li>
<li>An NGINX server configured to act as a reverse proxy for the IAM web
application; more details on this in the <a href="nginx">NGINX section</a>;</li>
<li>A MariaDB/MySQL database instance; more on this in the <a href="mariadb">database
configuration</a>
section;</li>
<li>A JSON keystore holding the keys used to sign JSON Web Tokens; more on this
in the <a href="json_web_key">JWK section</a>;</li>
</ul>
<p>You will also need to choose whether you want to deploy you service as a
<a href="docker-install">docker container</a> (recommended) or install from
<a href="package-install">packages</a>.</p>
<p>In case you chose to install from <a href="packages.md">packages</a> you can have a look
at the <a href="puppet-module">IAM puppet module to deploy and configure the service</a>.</p>
<p>And finally, you will have to setup a minimal IAM configuration and change the
administrator password for the newly configured IAM service; more on this
<a href="basic_conf">in the basic configuration section</a>.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-42f041991d0b1099049789121a1a0e30">2.1 - NGINX configuration</h1>
    
	<p>IAM relies on NGINX for TLS termination and load balancing.</p>
<p>The example configuration below provides the minimal configuration needed to
have NGINX working as a reverse proxy for the IAM web application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#204a87;font-weight:bold">server</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">listen</span>        <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">ssl</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">server_name</span>   <span style="color:#4e9a06">YOUR_HOSTNAME_HERE</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">access_log</span>   <span style="color:#4e9a06">/var/log/nginx/iam.access.log</span>  <span style="color:#4e9a06">combined</span><span style="color:#000;font-weight:bold">;</span>

  <span style="color:#204a87;font-weight:bold">ssl</span> <span style="color:#000">on</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_protocols</span> <span style="color:#4e9a06">TLSv1</span> <span style="color:#4e9a06">TLSv1.1</span> <span style="color:#4e9a06">TLSv1.2</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_certificate</span>      <span style="color:#4e9a06">/path/to/your/ssl/cert.pem</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_certificate_key</span>  <span style="color:#4e9a06">/path/to/your/ssl/key.pem</span><span style="color:#000;font-weight:bold">;</span>

  <span style="color:#204a87;font-weight:bold">location</span> <span style="color:#4e9a06">/</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">proxy_pass</span>              <span style="color:#4e9a06">THE_IAM_APP_HOSTNAME_HERE:8080</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Real-IP</span> <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-For</span> <span style="color:#000">$proxy_add_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-Proto</span> <span style="color:#4e9a06">https</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">Host</span> <span style="color:#000">$http_host</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="x509-client-authentication">X.509 client authentication</h2>
<p>IAM supports X.509 client certificate authentication. To enable X.509 client
certificate authentication use a configuration similar to the
<a href="https://github.com/indigo-iam/iam/blob/master/docker/nginx/iam.conf">one</a> used
in the IAM development environment.</p>
<p>In particular, set the <code>ssl_verify_client=Optional</code> option and configure the <code>proxy_set_header</code>
directory as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Cert</span> <span style="color:#000">$ssl_client_cert</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-I-Dn</span> <span style="color:#000">$ssl_client_i_dn</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-S-Dn</span> <span style="color:#000">$ssl_client_s_dn</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Serial</span> <span style="color:#000">$ssl_client_serial</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-Start</span> <span style="color:#000">$ssl_client_v_start</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-End</span>   <span style="color:#000">$ssl_client_v_end</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Verify</span>  <span style="color:#000">$ssl_client_verify</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Protocol</span> <span style="color:#000">$ssl_protocol</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Server-Name</span> <span style="color:#000">$ssl_server_name</span><span style="color:#000;font-weight:bold">;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-980bb6b8f4caf192ab4ad321d15c254c">2.2 - Database configuration</h1>
    
	<p>IAM keeps state in a MariaDB/MySQL database, and will need its own schema and a
user that has read/write/schema change privileges on such database.</p>
<p>IAM has been tested successfully against:</p>
<ul>
<li>MySQL v. 5.5.5</li>
<li>MariaDB v. 10.1.22</li>
</ul>
<p>For more instructions on how to create a database schema and a user with
administrator privileges on it, see the <a href="https://mariadb.com/kb/en/">MariaDB documentation</a>.</p>
<p>Assuming the organization that IAM will manage is called <code>test</code>, the following
commands can be used  to create a database and a user for the IAM application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">DATABASE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">CHARACTER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">SET</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">COLLATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1_swedish_ci</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">GRANT</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">ALL</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">PRIVILEGES</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">to</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;iam_test&#39;</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#4e9a06">&#39;%&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">identified</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">by</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;some_super_secure_password&#39;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>You may want to restrict the set of hosts from which a mysql client can connect
to the database with the above credentials according to your deployment needs.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fdf064a7010ecbaa1fbf4241d74375cb">2.3 - JSON Web Keys configuration</h1>
    
	<p>JSON web keys are used by the IAM to sign and verify token signatures.</p>
<p>To generate a JSON web key for your IAM deployment, you can use the
<a href="https://github.com/mitreid-connect/json-web-key-generator">json-web-key-generator</a> tool provided by MitreID connect.</p>
<p>The following command clones the <code>json-web-key-generator</code> Git repository to a
local directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.com/mitreid-connect/json-web-key-generator
</code></pre></div><p>Build the code with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mvn package
</code></pre></div><p>You can then generate a key with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">java -jar target/json-web-key-generator-0.4-SNAPSHOT-jar-with-dependencies.jar <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t RSA -s <span style="color:#0000cf;font-weight:bold">1024</span> -S -i rsa1


Full key:
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;keys&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;p&#34;</span>: <span style="color:#4e9a06">&#34;3oh7ex6zgdmJh5NBD0IplmBDDGC2ECu2A1vcp8e8DqE7OSSpAc1T9tTjJioCGqkNM51JK_MtgCJz1CiysVDOQQ&#34;</span>,
      <span style="color:#4e9a06">&#34;kty&#34;</span>: <span style="color:#4e9a06">&#34;RSA&#34;</span>,
      <span style="color:#4e9a06">&#34;q&#34;</span>: <span style="color:#4e9a06">&#34;nRmBm5tQ2wmOtd1XUYDRH2qWai6eElt-1cvO5tnTdWZkFaAeaHQ3_xf_PFOjyAv5Y5rNLgf_Xbu9UCo_mSrDMQ&#34;</span>,
      <span style="color:#4e9a06">&#34;d&#34;</span>: <span style="color:#4e9a06">&#34;BGHRhQP6ADqqSrM8_mI0YhjGStj1aW9rLi7wXQMJ122kegPxIT7dfP-5UScxykD_BrCCHQVPxdJl5wXy-giZnhaL9wtDkOXb8D8RCi1n02cs3Z1T23xONi_AG47QPBZjM5GcX-oOGCENByuEIdkU_Bn6vvqM3oyVlj5sio7tNAE&#34;</span>,
      <span style="color:#4e9a06">&#34;e&#34;</span>: <span style="color:#4e9a06">&#34;AQAB&#34;</span>,
      <span style="color:#4e9a06">&#34;kid&#34;</span>: <span style="color:#4e9a06">&#34;rsa1&#34;</span>,
      <span style="color:#4e9a06">&#34;qi&#34;</span>: <span style="color:#4e9a06">&#34;RarXtTFCE3hk5ZanLWEapDnn7SLSxAvDcBTmG5SpCI9Eix7cfTigaK6N7OQIN0uGO1GJ-KVWL2v8dyI1jMoU6g&#34;</span>,
      <span style="color:#4e9a06">&#34;dp&#34;</span>: <span style="color:#4e9a06">&#34;MtBtieavzMXUzr2ETKyp_GmMxeXLjRO-IzQ1xaYpPhn5AQprATtWofVozQ0on9fcaN3QmJWV3T2Av4BvlWfDQQ&#34;</span>,
      <span style="color:#4e9a06">&#34;dq&#34;</span>: <span style="color:#4e9a06">&#34;CWJ7rpsBooQYpV6al8DVPUY1xBQS10_l7MmnC31Zt3qtYelVx7GhoriBQ85PS2UDueKGfUh3BddwQLi1YeX_EQ&#34;</span>,
      <span style="color:#4e9a06">&#34;n&#34;</span>: <span style="color:#4e9a06">&#34;iI_fuJq4z_9VQY5EH41sQWOAYUsjtxAFjRnAc1P5-GPOx3Izg9V7yKNmudLUt-jIkv6D5h-AzrhEV6DOdBRoiN4el1mCZ95jiJkjU2kpVOmutDysZkrn667zPd43w7E6IqHnahmMrVUjUyx6pie1SqJHLUXghz8Gle-1yi08_XE&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Save the output of the above command (minus the <code>Full key:</code> initial text) in a
file, e.g. <code>iam-keystore.jwks</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d4954573f74248cc2cf402a430af4a23">2.4 - Deployment with Docker</h1>
    
	<p>The IAM service is provided on the following DockerHub repositories:</p>
<ul>
<li><a href="https://hub.docker.com/r/indigoiam/iam-login-service/">indigoiam/iam-login-service</a></li>
</ul>
<p>The docker image tag corresponding to this version of the documentation is:</p>


<div class="pageinfo pageinfo-primary">
<p>indigoiam/iam-login-service:v1.7.0</p>

</div>

<h3 id="configuration-and-run">Configuration and run</h3>
<p>Prepare an environment file that will contain the environment variables
settings for the IAM service container. See <a href="/docs/reference/configuration">the configuration
reference</a> for a description of the variables.</p>
<p>The IAM service is run starting the docker container with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.7.0
</code></pre></div><p>Check the logs with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker logs -f iam-login-service
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e6965747ca75cbeed664615ee54c8647">2.5 - Deployment with packages</h1>
    
	<p>IAM can be deployed from packages on the CentOS 7 platform.
Packages and repo files are hosted on the <a href="https://indigo-iam.github.io/repo">INDIGO IAM package repository</a>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    We no longer maintain packages for the Ubuntu platform.

</div>

<h2 id="centos-7">CENTOS 7</h2>
<ol>
<li>Install the INDIGO IAM release key:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo rpm --import https://indigo-iam.github.io/repo/gpgkeys/indigo-iam-release.pub.gpg
</code></pre></div><ol start="2">
<li>Install the repo files:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum-config-manager --add-repo https://indigo-iam.github.io/repo/repofiles/rhel/indigoiam-stable-el7.repo
</code></pre></div><ol start="3">
<li>Install packages:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum makecache
$ sudo yum install -y iam-login-service
</code></pre></div><h2 id="iam-service-configuration">IAM service configuration</h2>
<p>The IAM service is configured via a configuration file named <code>iam-login-service</code>
which holds the settings for the environment variables that drive its
configuration (as described in the <a href="/docs/reference/configuration">configuration reference
section</a>).</p>
<p>The file is located in the following path:</p>
<pre><code>/etc/sysconfig/iam-login-service
</code></pre><h2 id="run-the-service">Run the service</h2>
<p>The IAM login service is managed by <code>systemd</code>.</p>
<p>To enable the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl <span style="color:#204a87">enable</span> iam-login-service
</code></pre></div><p>To start the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl start iam-login-service
</code></pre></div><p>To access the service logs, use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo journalctl -fu iam-login-service
</code></pre></div><h2 id="automated-provisioning-with-puppet">Automated provisioning with Puppet</h2>
<p>The IAM login service Puppet module can be  found <a href="https://github.com/indigo-iam/puppet-indigo-iam">here</a>.
The module configures the IAM Login Service packages installation,
configuration and the automatic generation of the JWK keystore.</p>
<p>The setup of the MySQL database used by the service as well as the setup of the
reverse proxy are <strong>not covered</strong> by this module.</p>
<p>However, the module provides an example of setup of both the Login Service and
NginX as reverse proxy, using the official NginX Puppet module.</p>
<p>For more detailed information about the Indigo IAM Puppet module usage, see the
documentation in the <a href="https://github.com/indigo-iam/puppet-indigo-iam">Github repository</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-be6d46da99ec93fad0e93382c3763c05">2.6 - Basic IAM setup</h1>
    
	<p>Most configurable aspects of the IAM are configured via environment variables
and Spring profile directives. For a detailed reference of all the options, see
<a href="/docs/reference/configuration">the configuration reference</a>.</p>
<p>At the bare minimum you should enable the registration service to let users
register at your organisation (but you can leave it disabled and add users
manually to the organisation using the IAM dashboard if you prefer).</p>
<p>A minimal example configuration is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">IAM_JAVA_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span>-Dspring.profiles.active<span style="color:#ce5c00;font-weight:bold">=</span>prod,registration -Djava.security.egd<span style="color:#ce5c00;font-weight:bold">=</span>file:/dev/./urandom
<span style="color:#000">IAM_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>iam.local.io
<span style="color:#000">IAM_BASE_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
<span style="color:#000">IAM_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
<span style="color:#000">IAM_USE_FORWARDED_HEADERS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:/iam-keystore.jwks
<span style="color:#000">IAM_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>db
<span style="color:#000">IAM_DB_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
<span style="color:#000">IAM_DB_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
<span style="color:#000">IAM_DB_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>***********
<span style="color:#000">IAM_NOTIFICATION_FROM</span><span style="color:#ce5c00;font-weight:bold">=</span>iam@iam.local.io 
<span style="color:#000">IAM_NOTIFICATION_ADMIN_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>iam-administrators@mail.example
<span style="color:#000">IAM_MAIL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>smtp.mail.example
</code></pre></div><p>and has the following meaning:</p>
<ul>
<li><code>IAM_JAVA_OPTS</code> is used to select active profiles (prod, registration) and
tell the JVM to use /dev/urandom as the random number generator;</li>
<li><code>IAM_HOST</code> is the host where the IAM will listen for request; this is the
hostname of the machine exposed to the internet;</li>
<li><code>IAM_BASE_URL</code> is the base URL where the IAM web application will live; the
value for this is typically <code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_ISSUER</code> is the OpenID-connect issuer for the tokens issued by the IAM;
we recommend using the same setting as <code>IAM_BASE_URL</code>, i.e.
<code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_USE_FORWARDED_HEADERS</code> tells the IAM that whether it lives behind a reverse
proxy (i.e., NGINX); in production the value is typically <code>true</code>;</li>
<li><code>IAM_KEY_STORE_LOCATION</code> is the location of the JSON Web keystore generated
as explained <a href="docs/getting-started/jwk">here</a>;</li>
<li><code>IAM_DB_*</code> are variables used to set the database endpoint and provide
database access credentials;</li>
<li><code>IAM_NOTIFICATION_FROM</code> sets the sender of administrative notification sent
by the IAM;</li>
<li><code>IAM_NOTIFICATION_ADMIN_ADDRESS</code> sets the email address that will receive
administrative notifications from the IAM;</li>
<li><code>IAM_MAIL_HOST</code> is the SMTP server that IAM will use to deliver
notifications.</li>
</ul>
<p>For a detailed reference of all available configuration options, see <a href="/docs/reference/configuration">the
configuration reference</a>.</p>
<p>Deploying and starting the IAM service with the above configuration will give
you an empty service with just one user registered, the <code>admin</code> user.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>As a first thing you should login in the IAM with the following credentials:</p>
<ul>
<li>username: <code>admin</code></li>
<li>password: <code>password</code></li>
</ul>


</div>

<p>and change the password for the admin user, clicking on the <strong>Change password</strong>
button from the admin home page, as shown in the following picture:</p>
<p><img src="../images/admin-change-password.png" alt="Admin change password"></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dd948255948d6b59b32c471abcb62997">3 - Concepts</h1>
    <div class="lead">What does your user need to understand about your project in order to use it - or potentially contribute to it?</div>
	

<div class="pageinfo pageinfo-primary">
<p>This is a placeholder page that shows you how to use this template site.</p>

</div>

<p>For many projects, users may not need much information beyond the information in the <a href="/docs/overview/">Overview</a>, so this section is <strong>optional</strong>. However if there are areas where your users will need a more detailed understanding of a given term or feature in order to do anything useful with your project (or to not make mistakes when using it) put that information in this section. For example, you may want to add some conceptual pages if you have a large project with many components and a complex architecture.</p>
<p>Remember to focus on what the user needs to know, not just what you think is interesting about your project! If they don’t need to understand your original design decisions to use or contribute to the project, don’t put them in, or include your design docs in your repo and link to them. Similarly, most users will probably need to know more about how features work when in use rather than how they are implemented. Consider a separate architecture page for more detailed implementation and system design information that potential project contributors can consult.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b00a88a07ceb21b1a83e5822e0c86c1d">4 - Reference</h1>
    <div class="lead">IAM API &amp; configuration reference documentation</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6daa71035bbf2489d120742c0452575f">4.1 - APIs</h1>
    <div class="lead">IAM APIs</div>
	<p>IAM provides a set of APIs that can be used for authentication, authorization
and IAM administration purposes.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-86d47510999bc2977fb7970cadcf54cc">4.1.1 - AUP management API</h1>
    
	<p>IAM provides a RESTful API that can be used to manage the IAM
Acceptable Usage Policy (AUP) configuration.</p>
<h3 id="get-iamaup">GET /iam/aup</h3>
<p>Returns a JSON representation of the Acceptable Usage Policy (AUP) for the
organization.</p>
<p><strong>Authentication required</strong>: no</p>
<h4 id="success-response">Success response</h4>
<p><strong>Condition</strong>: The AUP is defined for the organization</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content</strong>: A JSON representation of the AUP</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;text&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;This is my AUP text&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Note: <code>text</code> is returned for backward compatible calls.</p>
<h4 id="error-response">Error response</h4>
<p><strong>Condition</strong>: The AUP is not defined for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;AUP is not defined for this organization&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="post-iamaup">POST /iam/aup</h3>
<p>Creates the AUP for the organization</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the AUP to be created</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">not</span> <span style="color:#a40000">blank</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">128</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">integer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Data example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-1">Success response</h4>
<p><strong>Condition</strong>: The AUP is created for the organization</p>
<p><strong>Code</strong>: <code>201 CREATED</code></p>
<h4 id="error-responses">Error responses</h4>
<p><strong>Condition</strong>: The AUP already exists</p>
<p><strong>Code</strong>: <code>409 CONFLICT</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AUP already exists&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Missing or invalid fields in the AUP representation</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="patch-iamaup">PATCH /iam/aup</h3>
<p>Updates the AUP for the organization</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the AUP to be patched</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">not</span> <span style="color:#a40000">blank</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">128</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">integer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Data example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-2">Success response</h4>
<p><strong>Condition</strong>: The AUP is modified for the organization</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content example</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T19:51:39.083+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T19:53:49.557+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="error-responses-1">Error responses</h4>
<p><strong>Condition</strong>: Missing or invalid fields in the AUP representation</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="delete-iamaup">DELETE /iam/aup</h3>
<p>Deletes the AUP for the organization.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<h4 id="success-response-3">Success response</h4>
<p><strong>Condition</strong>: The AUP is defined for the organization</p>
<p><strong>Code</strong>: <code>204 NO CONTENT</code></p>
<h4 id="error-responses-2">Error responses</h4>
<p><strong>Condition</strong>: The AUP is not defined for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AUP is not defined for this organization&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5f98ef65599be38eb06ad3a9f70307f1">4.1.2 - Group requests API</h1>
    
	<p>IAM Login Service provides a RESTful API to create and manage group membership requests.</p>
<h2 id="post-iamgroup_requests">POST /iam/group_requests</h2>
<p>Create a new group membership request.
The body of the request must contain a JSON with the group name and a motivation
of the submitted request.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response">Success response</h3>
<p><strong>Conditions</strong>:</p>
<ul>
<li>The user is authenticated;</li>
<li>the user is not already member of the requested group;</li>
<li>a request from the user for such group does not exist.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: A JSON representation of the new request.</p>
<h3 id="error-response">Error response</h3>
<p><strong>Condition</strong>: The user is not authenticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>: A JSON with the error description.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Condition</strong>: The request already exists.</p>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with the error description.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group membership request already exist for [test, Test-001]&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">POST</span> <span style="color:#000">/iam/group_requests</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>

<span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Test API&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011676</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamgroup_requests">GET /iam/group_requests</h2>
<p>Returns a paginated list of group requests.
The list can be filtered by username, group name or request status.
Users with administrative privileges can list all requests;
other users only the requests they submitted.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-1">Success response</h3>
<p><strong>Condition</strong>: The user is authenticated.</p>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: A JSON representation of the request list.</p>
<h3 id="error-response-1">Error response</h3>
<p><strong>Condition</strong>: The user is not autheticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-1">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">GET</span> <span style="color:#000">/iam/group_requests/?groupName=Test-001&amp;status=PENDING</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>

</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233012000</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;b28790d4-90d4-471f-8b85-79d5fd761b8c&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test_100&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamgroup_requestsuuid">GET /iam/group_requests/{uuid}</h2>
<p>Returns the details about a group request.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-2">Success response</h3>
<p><strong>Condition</strong>: The user is authenticated and can access the request
(privileged users can access all request, other users only the requests they submitted).</p>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the group membership request.</p>
<h3 id="error-response-2">Error response</h3>
<p><strong>Condition</strong>: The user is not authenticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Condition</strong>: User is not authorized to access the group request.</p>
<p><strong>Code</strong>: <code>403 Forbidden</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a40000">Access is denied
</span></code></pre></div><p><strong>Condition</strong>: A request linked to the given id does not exist.</p>
<p><strong>Code</strong>: <code>400 Bad request</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [d5b652b2-4bb5-401a] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-2">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">GET</span> <span style="color:#000">/iam/group_requests/d5b652b2-4bb5-401a-bfb9-a795353798b3</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233012000</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="delete-iamgroup_requestsuuid">DELETE /iam/group_requests/{uuid}</h2>
<p>Deletes a group request.
Administrators can delete any request, users can only delete the <code>PENDING</code> requests
they previously submitted.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-3">Success response</h3>
<p><strong>Condition</strong>: A request linked to the given id exists.</p>
<p><strong>Code</strong>: <code>204 No Content</code></p>
<p><strong>Content</strong>: Empty body</p>
<h3 id="error-response-3">Error response</h3>
<p><strong>Condition</strong>: A request linked to the given id does not exist.</p>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [b28790d4-90d4-471f-8b85-79d5fd761b8c] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-3">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">DELETE</span> <span style="color:#000">/iam/group_requests/b28790d4-90d4-471f-8b85-79d5fd761b8c</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><h2 id="post-iamgroup_requestsuuidapprove">POST /iam/group_requests/{uuid}/approve</h2>
<p>Approves a group request.
Only administrators can approve requests.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-4">Success response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The user is authenticated and has administrative privileges;</li>
<li>the request is in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the updated group membership request.</p>
<h3 id="error-response-4">Error response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The request doesn&rsquo;t exist;</li>
<li>The request isn&rsquo;t in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [b28790d4-90d4-471f-8b85-79d5fd761b8c] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Invalid group request transition: APPROVED -&gt; APPROVED&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-4">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">POST</span> <span style="color:#000">/iam/group_requests/d5b652b2-4bb5-401a-bfb9-a795353798b3/approve</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;APPROVED&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524238898590</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="post-iamgroup_requestsuuidreject">POST /iam/group_requests/{uuid}/reject</h2>
<p>Rejects a group request.
A <code>motivation</code> parameter is required.
Only administrators can reject requests.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-5">Success response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The user is authenticated and has administrative privileges;</li>
<li>the request is in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the updated group membership request.</p>
<h3 id="error-response-5">Error response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The request doesn&rsquo;t exist;</li>
<li>The request isn&rsquo;t in <code>PENDING</code> status;</li>
<li>The motivation required request parameter is missing.</li>
</ul>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Invalid group request transition: APPROVED -&gt; REJECTED&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [d5b652b2-4bb5-401a-bfb9-a79535379b3] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-5">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a40000">POST /iam/group_requests/b28790d4-90d4-471f-8b85-79d5fd761b8c/reject?motivation=Test API HTTP/1.1
</span><span style="color:#a40000">Host: iam.local.io
</span><span style="color:#a40000">Content-Type: application/json
</span><span style="color:#a40000">Cache-Control: no-cache
</span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;b28790d4-90d4-471f-8b85-79d5fd761b8c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test_100&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;REJECTED&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;motivation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524238811254</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6bac9b32bfac99dba534d199b6900374">4.1.3 - Health checks</h1>
    
	<p>The IAM Login Service exposes a set of health endpoints that can be used to
monitor the status of the service.</p>
<p>Health endpoints expose a different set of information depending on the user
privileges; users with administrator privileges will see more details, while
anonymous requests typically receive only a summary of the health status.</p>
<p>The health endpoints return:</p>
<ul>
<li>HTTP status code 200 if everything is ok;</li>
<li>HTTP status code 500 if any health check fails.</li>
</ul>
<h2 id="health"><code>/health</code></h2>
<p>This is a general application health check endpoint which composes disk space
and database health checks.</p>
<p>Examples.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/health | jq
{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre><p>Sending basic authentication, the endpoint returns a response with more details:</p>
<pre><code class="language-console" data-lang="console">$ curl -s -u $ADMINUSER:$ADMINPASSWORD https://iam.local.io/health | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;diskSpace&quot;: {
    &quot;status&quot;: &quot;UP&quot;,
    &quot;total&quot;: 10725883904,
    &quot;free&quot;: 9872744448,
    &quot;threshold&quot;: 10485760
  },
  &quot;db&quot;: {
    &quot;status&quot;: &quot;UP&quot;,
    &quot;database&quot;: &quot;MySQL&quot;,
    &quot;hello&quot;: 1
  }
}
</code></pre><h2 id="healthmail"><code>/health/mail</code></h2>
<p>This endpoint monitors the connection to the SMTP server configured for the
IAM Notification Service.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/health/mail | jq
{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre><p>With an authenticated request, the SMTP server details are returned:</p>
<pre><code class="language-console" data-lang="console">$ curl -u $ADMINUSER:$ADMINPASSWORD https://iam.local.io/health/mail | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;mail&quot;: {
    &quot;status&quot;: &quot;UP&quot;,
    &quot;location&quot;: &quot;smtp.local.io:25&quot;
  }
}
</code></pre><h2 id="healthexternal"><code>/health/external</code></h2>
<p>This endpoint checks service connectivity to the Internet. By default, the
endpoint triggers a check on the connectivity to Google.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/health/external | jq
{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre><p>With an authenticated request, the external service URL is shown in the details.</p>
<pre><code class="language-console" data-lang="console">$ curl -s -u $ADMINUSER:$ADMINPASSWORD https://iam.local.io/health/external | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;google&quot;: {
    &quot;status&quot;: &quot;UP&quot;,
    &quot;location&quot;: &quot;http://www.google.it&quot;
  }
}
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ae2dfdac8f1e824e219096bb20fbe4dd">4.1.4 - IAM Token management API</h1>
    
	<p>The IAM server has a RESTful API used to list and revoke active access and
refresh tokens.</p>
<p>Access to the API is limited to users with administrator privileges (either
authenticated via a web session or through OAuth). All examples assume
authorization via OAuth2 bearer token; e.g.</p>
<pre><code>GET /access-tokens/13 HTTP/1.1
Host: example.com
Authorization: Bearer h480djs93hd8
</code></pre><p>These are the tokens REST API endpoints:</p>
<p><strong>Accessing tokens</strong>:</p>
<ul>
<li><a href="#get-access-tokens">GET /access-tokens</a></li>
<li><a href="#get-access-tokensid">GET /access-tokens/:id</a></li>
<li><a href="#get-refresh-tokens">GET /refresh-tokens</a></li>
<li><a href="#get-refresh-tokensid">GET /refresh-tokens/:id</a></li>
</ul>
<p><strong>Deleting tokens</strong>:</p>
<ul>
<li><a href="#delete-access-tokensid">DELETE /access-tokens/:id</a></li>
<li><a href="#delete-refresh-tokensid">DELETE /refresh-tokens/:id</a></li>
</ul>
<h2 id="get-access-tokens">GET /access-tokens</h2>
<p>Retrieves the paginated list of all the active access tokens. Returns results in <em>application/json</em>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>count</code><br/><strong>integer</strong></td>
<td>Specifies the desired maximum number of query results per page.</td>
</tr>
<tr>
<td style="text-align:center"><code>startIndex</code><br/><strong>integer</strong></td>
<td>The 1-based index of the first query result.</td>
</tr>
<tr>
<td style="text-align:center"><code>userId</code><br/><strong>string</strong></td>
<td>Filters by userId.</td>
</tr>
<tr>
<td style="text-align:center"><code>clientId</code><br/><strong>string</strong></td>
<td>Filters by clientId.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre><code>GET http://example.com:8080/access-tokens
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MDEzMTQ1MjksImF1ZCI6WyJhOGFmNzUzYy1mMzI0LTRlNDAtYTE3Ny04N2RmYzA2MjQ5YjciXSwiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjgwODBcL29wZW5pZC1jb25uZWN0LXNlcnZlci13ZWJhcHBcLyIsImp0aSI6Ijg4ZjM4OGE4LTk1NzctNGQyMC1hZTZjLWMyMDMxOGQ1OWJjNiIsImlhdCI6MTQwMTMxMDkyOX0.HYnNxRvGRdKFykVChL-hdxszcFBvygkeUmc8_iv2Jl4MU-jPJVzMnTwKJbCMWBjeBp8hrb0Dgd9XbnHUDyXxwj8MDrWQEH3QnwYJGRW9JFWjHMGfKDQDFY6Ffl3OFERVbyoB2ObiGTUgbw4Nkl1L1ihuMpMAc5nKi0rk3QXcS1M&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;profile&#34;</span>
      <span style="color:#000;font-weight:bold">],</span>
      <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
          <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
        <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;idToken&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/access-tokens/5&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-access-tokensid">GET /access-tokens/:id</h2>
<p>Retrieves all the information about the access token identified by <strong>id</strong> and returns results in <em>application/json</em>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<pre><code>GET http://example.com:8080/access-tokens/6
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MDEzMTQ1MjksImF1ZCI6WyJhOGFmNzUzYy1mMzI0LTRlNDAtYTE3Ny04N2RmYzA2MjQ5YjciXSwiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjgwODBcL29wZW5pZC1jb25uZWN0LXNlcnZlci13ZWJhcHBcLyIsImp0aSI6Ijg4ZjM4OGE4LTk1NzctNGQyMC1hZTZjLWMyMDMxOGQ1OWJjNiIsImlhdCI6MTQwMTMxMDkyOX0.HYnNxRvGRdKFykVChL-hdxszcFBvygkeUmc8_iv2Jl4MU-jPJVzMnTwKJbCMWBjeBp8hrb0Dgd9XbnHUDyXxwj8MDrWQEH3QnwYJGRW9JFWjHMGfKDQDFY6Ffl3OFERVbyoB2ObiGTUgbw4Nkl1L1ihuMpMAc5nKi0rk3QXcS1M&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;profile&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;idToken&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/access-tokens/5&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-refresh-tokens">GET /refresh-tokens</h2>
<p>Retrieves the paginated list of all the active refresh tokens. Returns results in <em>application/json</em>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>count</code><br/><strong>integer</strong></td>
<td>Specifies the desired maximum number of query results per page.</td>
</tr>
<tr>
<td style="text-align:center"><code>startIndex</code><br/><strong>integer</strong></td>
<td>The 1-based index of the first query result.</td>
</tr>
<tr>
<td style="text-align:center"><code>userId</code><br/><strong>string</strong></td>
<td>Filters by userId.</td>
</tr>
<tr>
<td style="text-align:center"><code>clientId</code><br/><strong>string</strong></td>
<td>Filters by clientId.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre><code>GET http://example.com:8080/refresh-tokens
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
  	 <span style="color:#000;font-weight:bold">{</span>
	  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1083</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJub25lIn0.eyJqdGkiOiIxMTdmMWRkOS1iOWViLTQ5MjctYThkMS1hYzQ4NjIwYWQzOWYifQ.&#34;</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
	    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;profile&#34;</span>
	  <span style="color:#000;font-weight:bold">],</span>
	  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
	      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
	    <span style="color:#000;font-weight:bold">],</span>
	    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
	  <span style="color:#000;font-weight:bold">},</span>
	  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
	  <span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-refresh-tokensid">GET /refresh-tokens/:id</h2>
<p>Retrieves all the information about the refresh token identified by <strong>id</strong> and returns results in <em>application/json</em>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<pre><code>GET http://example.com:8080/refresh-tokens/1083
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1083</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJub25lIn0.eyJqdGkiOiIxMTdmMWRkOS1iOWViLTQ5MjctYThkMS1hYzQ4NjIwYWQzOWYifQ.&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;profile&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="delete-access-tokensid">DELETE /access-tokens/:id</h2>
<p>Revoke the access token identified by <strong>id</strong>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<pre><code>DELETE http://example.com:8080/access-tokens/6
</code></pre><pre><code>204  AccessToken revoked
</code></pre><h2 id="delete-refresh-tokensid">DELETE /refresh-tokens/:id</h2>
<p>Revoke the access token identified by <strong>id</strong>.</p>
<p>Requires <strong>ROLE_ADMIN</strong>.</p>
<pre><code>DELETE http://example.com:8080/refresh-tokens/1083
</code></pre><pre><code>204  RefreshToken revoked
</code></pre><p>More details can be read at the <a href="tokens_api/index.html">complete API Reference</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-79982fb90b690ba4430ec5123ea2927a">4.1.5 - OAuth token exchange API</h1>
    
	<p>The current release of the INDIGO IAM implements part of the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange
OAuth
specification</a>.
The Token Exchange OAuth specification defines &ldquo;a lightweigth protocol that
enables clients to request and obtain security tokens from authorization
servers&rdquo;.</p>
<p>OAuth 2.0 was designed to solve the problem of a delegated access to resources
across services, mediated by an authorization server, as shown in the following
picture:</p>
<img src="/images/oauth-delegation-1.png" alt="OAuth delegation">
<p>In the picture above we have the usual OAuth roles:</p>
<ul>
<li>The user (or <em>resource owner</em>, in OAuth terminology);</li>
<li>A resource server, ie. a service hosting user resources, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li>A client: this is an agent that has received a permission from the user to
act on his behalf on his resources hosted on a resource server;</li>
<li>An authorization server: a service that issues access token to clients after
having authenticated the user and obtained an authorization from the user
that the client is entitled to act on user&rsquo;s resources</li>
</ul>
<p>There are scenarios when a resource server, in order to satisfy a client
request, needs to access resources hosted by other downstream services on
behalf of the user, like in the following picture:</p>
<img src="/images/oauth-token-exchange-1.png" alt="OAuth delegation" height="200">
<p>In OAuth, access tokens are bearer tokens, so the first resource server could
simply use the access token received from the client to interact, on behalf
of the user, with the downstream resource server.</p>
<p>There are, however, situations in which just using the received access token
against the downstream service is not possible, like for instance if the token
audience was scoped to be valid only on the first resource server.</p>
<p>Moreover, the resource server could need the ability to act on behalf of the
user for an unbounded amount of time (e.g., to implement long-running
computations), not limited by the validity of the received access token.</p>
<p>The token exchange specification was designed to provide a protocol in support
of these scenarios, where a client can exchange an access token received from
antoher client with a new token (or a set of tokens, as we will see) by
interacting with a trusted OAuth authorization server.</p>
<h2 id="impersonation-vs-delegation">Impersonation vs delegation</h2>
<p>As specified in the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange OAuth
specification</a>,
when a subject A impersonates B, A has all the rights of B and it is
indistinguishable from B. So, when A interacts within any other entity, A is B.</p>
<p>With delegation A still has its own identity, separate from B. So when A
interacts within another entity, it is explicit that A is representing B,
because B has delegated some of its rights to A.</p>
<p>More details about the difference from this two semantics can be found in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05#section-1.1">this section of the specification</a>.</p>
<p>The INDIGO IAM token exchange implementation currently supports only
impersonation semantics.</p>
<h2 id="client-configuration-requirements">Client configuration requirements</h2>
<p>In order to request a token exchange, a client must be configured with the
<code>urn:ietf:params:oauth:grant-type:token-exchange</code> grant type enabled. The token
exchange grant type is <strong>disabled</strong> by default for dynamically registered
clients, and can be enabled only by users with administrative privileges.</p>
<h2 id="the-token-exchange-request">The token exchange request</h2>
<p>A client who wants to exchange an access token with a new one (or a couple of
new tokens, in case a refresh token is requested), must send an authenticated
request to the IAM <code>/token</code> endpoint, specifying the following properties:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><code>urn:ietf:params:oauth:grant-type:token-exchange</code></td>
</tr>
<tr>
<td>subject_token</td>
<td>The subject access token that the client wants to exchange</td>
</tr>
<tr>
<td>scope</td>
<td>The set of scopes requested for the new access token</td>
</tr>
<tr>
<td>audience</td>
<td>Optional. A space-separated list of resource identifiers that will be used to limit the audience of the issued token</td>
</tr>
</tbody>
</table>
<h3 id="scopes-in-exchanged-tokens">Scopes in exchanged tokens</h3>
<p>A client, when requesting a token exchange, can request any of the scopes
enabled by its client configuration. IAM system scopes are however handled in a
special way. These scopes, in order to be &ldquo;exchanged&rdquo; across clients, need to
be</p>
<ul>
<li>enabled for the client requesting the token exchange</li>
<li>linked to the subject token presented for the token exchange</li>
</ul>
<p>The list of system scopes currently defined in the IAM can be obtained by
registered users by issuing a request to the IAM system scopes API:</p>
<pre><code>curl -H &quot;Authorization: Bearer ...&quot; https://iam.example/api/scopes
</code></pre><h3 id="token-exchange-example">Token Exchange example</h3>
<p>This section describes a token exchange flow.</p>
<p>We start with a normal OAuth flow where a client, <code>token-exchange-subject</code>,
requests an access token from the IAM using the resource owner password
credential flow. The <code>token-exchange-subject</code> client is configured to use HTTP
basic authentication against the IAM token endpoint, and in this example acts
on behalf of the <code>test</code> user. We use the resource owner password credentials
flow for convenience, but any other OAuth or OpenID connect flow that involves
a user identity would be fine (i.e., authorization code).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">export</span> <span style="color:#000">IAM_TOKEN_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io/token
$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>token-exchange-subject
$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
$ <span style="color:#204a87">export</span> <span style="color:#000">USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>...

$ curl -s -u <span style="color:#000">$SUBJECT_ID</span>:<span style="color:#000">$SUBJECT_SECRET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$USERNAME</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$PASSWORD</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>password <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</code></pre></div><p>Note that the only scopes requested in this first request are <code>openid</code> and
<code>profile</code>, i.e. the scopes required to access user identity information. IAM
token endpoint returns a JSON containing an access token and other info:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJpc3MiOiJodHRwczpcL1wvaWFtLmxvY2FsLmlvXC8iLCJleHAiOjE0NzY5NTcxMDIsImlhdCI6MTQ3Njk1MzUwMiwianRpIjoiMjBiZThlNjYtNmNmOS00YzE0LWI4ZDEtZjJmZTc0NDk0YjAxIn0.kqAhZ2MNmBLYIA_-xW9356kD-ndqJ7jKUZRPb7ox_4iXbjcnV6oZYAHZzTH_uBTXA2WsVIJJ-Qicm5JQ0ydb2ewgECAmGkKfL3X4qnnRq2_GgZZof3zlM_rIz3QrDB3v1eIt42YeMdUgODUYGKeDwntT5a7wPDtxe-GM2uL5fik&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;id_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJhdWQiOiIzMmMzMTUyOS05YmM2LTQ1ZWQtYjU0YS0wNGEyNThiMDRmYmYiLCJraWQiOiJyc2ExIiwiaXNzIjoiaHR0cHM6XC9cL2lhbS5sb2NhbC5pb1wvIiwiZXhwIjoxNDc2OTU0MTAyLCJpYXQiOjE0NzY5NTM1MDIsImp0aSI6IjhhMzk1OTM5LTM1N2QtNGY5My04MmEzLTJkMTBkM2ZhMzgzZCJ9.DtNR-ob8kMIUMa2x6TW7krSYMt78tfr5fnTK4aeoIY-wmEWcjPRx1_vT6_lesjMr9w0B_OCALXfOoDBfbF7DhmV7vpbotirkMxvowFBzgppmtBTZNAzLc_Wiwr4IAiGydwjy_UbYrxx6qlWJAKRwzSbDDd3oDVpU-KM8gtLIEa8&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>We put this access token in an environment variable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> $ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>cat /tmp/response <span style="color:#000;font-weight:bold">|</span> jq -r .access_token<span style="color:#204a87;font-weight:bold">)</span>
</code></pre></div><p>We use this access token to access the <code>app</code> API, which only requires access to
user identity to grant access:</p>
<pre><code>curl -H &quot;Authorization: Bearer $SUBJECT_TOKEN&quot; https://app.example.org/api
</code></pre><p>Suppose now that the <code>app</code> API needs, to properly answer the request from the
client, to interact with another downstream service, <a href="https://tasks.example.org">https://tasks.example.org</a>,
on behalf of the user. Unfortunately the set of scopes linked to the access
token received are not sufficient to do this, and so <code>app</code> decides to exchange
the token received with another one granting enough privileges.</p>
<p>In Token Exchange terms, here <code>app</code> is the <code>actor</code>, the subject identity linked
to the token is the <code>test</code> user, and the audience for the new token being
requested would be the <code>https://tasks.app.example.org/api</code> API.</p>
<p>So <code>app</code> would do a request like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>https://app.example.org/api
$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
$ <span style="color:#204a87">export</span> <span style="color:#000">AUDIENCE</span><span style="color:#ce5c00;font-weight:bold">=</span>https://tasks.example.org/api

$ curl -s -u <span style="color:#000">$ACTOR_ID</span>:<span style="color:#000">$ACTOR_SECRET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:ietf:params:oauth:grant-type:token-exchange <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">audience</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$AUDIENCE</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">subject_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$SUBJECT_TOKEN</span> <span style="color:#4e9a06">\ </span><span style="color:#8f5902;font-style:italic"># This token was received from the initial client </span>
    -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq


</code></pre></div><p>Note that <code>app</code> requests an additional scope, <code>read-tasks</code>, to interact with
the downstream service.</p>
<p>Since <code>app</code> is a trusted client for token exchange, the IAM responds with the
following JSON:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJra...&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;issued_token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:ietf:params:oauth:token-type:jwt&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>And <code>app</code> can use the newly issued access token to invoke services on
<a href="https://task-app.example.org/api">https://task-app.example.org/api</a> on behalf of user <code>test</code>:</p>
<pre><code>$ curl -H &quot;Authorization: Bearer eyJra...&quot; http://tasks.example.org/api

</code></pre><h3 id="trust">Trust</h3>
<p>Clients that have the token exchange grant enabled are considered trusted
clients i.e., no explicit grant from the user is needed to grant access to
client scopes. For IAM system scopes, however, these can be &ldquo;exchanged&rdquo; only if
linked to the original subject token.</p>
<h3 id="limitation-and-known-issues">Limitation and known issues</h3>
<p>The current implementation of Token Exchange in Indigo IAM has the following limitations:</p>
<ul>
<li>Delegation is not yet supported: if <code>actor_token</code> or the <code>want_composite</code>
parameters are specified within the request, an error response is returned by
the authorization server;</li>
<li>The <code>resource</code> field is ignored.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-167ff098c8b010fb17614df7ba73694d">4.1.6 - OAuth token introspection API</h1>
    
	<p>IAM, through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>,
supports the <a href="https://tools.ietf.org/html/rfc7662">OAuth token introspection API</a> API at
the <code>/introspect</code> endpoint.</p>
<p>The <code>/introspect</code> endpoint <strong>requires</strong> client authentication.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e9e5ebcd88b6ff930c7d37a637080e40">4.1.7 - OpenID Connect client management API</h1>
    
	<p>IAM, through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>,
provides an OAuth/OpenID connect client management API at the <code>/api/clients</code>
endpoint.</p>
<p>Documentation for this API can be found on the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki/API">MitreID connect
wiki</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-49efb320846282f9e6c68fa2debefad5">4.1.8 - OpenID Connect client registration API</h1>
    
	<p>IAM, through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>,
supports the <a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration
API</a> API at the <code>/register</code> endpoint.</p>
<p>Client registration does not require authentication.</p>
<h2 id="example-registering-and-deleting-a-client-from-the-command-line">Example: registering and deleting a client from the command line</h2>
<p>With the following template JSON you can easily register a client in the IAM:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;redirect_uris&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;https://another.client.example/oidc&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;client_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;another-example-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;test@iam.test&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_endpoint_auth_method&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;client_secret_basic&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;address phone openid email profile offline_access&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;grant_types&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;refresh_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;authorization_code&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;response_types&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;code&#34;</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Save the above JSON into a file (after changing the relevant fields, like
contact, rediret_uris, etc&hellip;). We will use the <code>client-req.json</code> file name for
this example. You can then use <a href="https://httpie.org/">httpie</a> as  follows to generate the
client on the IAM</p>
<pre><code>http https://iam.local.io/register &lt; client-req.json &gt; client.json
</code></pre><p>If the command terminates correctly, you will have the client configuration
saved in the <code>client.json</code> file. You can use <a href="https://stedolan.github.io/jq/">jq</a> to display in a pretty
way its contents:</p>
<pre><code>$ jq . client.json
{
  &quot;client_id&quot;: &quot;4b2556d7-65c5-4a15-81c0-7b80c604940e&quot;,
  &quot;client_secret&quot;: &quot;R4u3v-SUqKX1XTFQbGGr-S5qcOAA8JrLT0xAOHYZl1Up65ChHYNsl-8y6gv7qJLaxVI5Z6UXBmSkwSDZLtAAWw&quot;,
  &quot;client_secret_expires_at&quot;: 0,
  &quot;client_id_issued_at&quot;: 1507223860,
  &quot;registration_access_token&quot;: &quot;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJhdWQiOiI0YjI1NTZkNy02NWM1LTRhMTUtODFjMC03YjgwYzYwNDk0MGUiLCJpc3MiOiJodHRwczpcL1wvaWFtLmxvY2FsLmlvXC8iLCJpYXQiOjE1MDcyMjM4NjAsImp0aSI6IjRmNTQ2YmEyLWE3ZWEtNDA4ZC1iYWI1LTdlZGMyNDZlOWJhMiJ9.Iyr7fwKy3OSl3wVjaw5HVVxBFl62A-vDlrKJpJA2W2t1GmPMcz5ZZOhp9PStd2RbMpuu6WwVhhDMN706IOzk03dGD3wPy_ag2MaiJfdT0-AT2nMviuPNylgU4bK0wFs9r9cwxBI0PpJ5pkkQE__z_lfWHylKMf9mLrZp81WUvt8&quot;,
  &quot;registration_client_uri&quot;: &quot;https://iam.local.io/register/4b2556d7-65c5-4a15-81c0-7b80c604940e&quot;,
  &quot;redirect_uris&quot;: [
    &quot;https://another.client.example/oidc&quot;
  ],
  &quot;client_name&quot;: &quot;another-example-client&quot;,
  &quot;contacts&quot;: [
    &quot;test@iam.test&quot;
  ],
  &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;,
  &quot;scope&quot;: &quot;address phone openid email profile offline_access&quot;,
  &quot;grant_types&quot;: [
    &quot;refresh_token&quot;,
    &quot;authorization_code&quot;
  ],
  &quot;response_types&quot;: [
    &quot;code&quot;
  ]
}
</code></pre><p>and also to extract information from it conveniently from the command line.
For example, you can extract the <code>client_id</code> and <code>registration_access_token</code>
with the following commands:</p>
<pre><code>$ export CID=$(jq -r .client_id client.json)
$ export RAT=$(jq -r .registration_access_token client.json)
</code></pre><p>and use them to delete the client:</p>
<pre><code>$ http DELETE https://iam.local.io/register/${CID} Authorization:&quot;Bearer ${RAT}&quot;
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Connection: keep-alive
Content-Language: en-US
Date: Thu, 05 Oct 2017 17:10:42 GMT
Expires: 0
Pragma: no-cache
Server: nginx/1.13.1
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
X-Application-Context: INDIGO IAM:mysql,google,registration,saml,mysql-test:8080
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ff5f4511d04c6e9b13f1c49c32e2c50d">4.1.9 - SCIM API</h1>
    
	<p>The IAM server provides a RESTful API, based on the <a href="http://www.simplecloud.info/">System for Cross-domain
Identity Management (SCIM) standard</a>, that
can be used to manage users, change their personal information, manage their
group membership, etc.</p>
<p>Access to the API is restricted to administrator users or OAuth clients that
have access to the <code>scim:read</code> (for read access) or <code>scim:write</code> (for write
access) OAuth scopes.</p>
<p>Examples below assume OAuth authorization via bearer token: e.g.</p>
<pre><code>GET /Users/2819c223-7f76-453a-919d-413861904646 HTTP/1.1
Host: example.com
Authorization: Bearer h480djs93hd8
</code></pre><p>The SCIM protocol specifies well known endpoints and HTTP methods for managing
Resources defined in the <a href="https://tools.ietf.org/html/rfc7643">SCIM core schema specification</a>.</p>
<h2 id="iam-scim-endpoints">IAM SCIM Endpoints</h2>
<p>IAM maps User and Group resource endpoints to the following endpoints:</p>
<ul>
<li><code>/scim/Users</code></li>
<li><code>/scim/Groups</code></li>
</ul>
<p>For each endpoint, the following methods are allowed:</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>Retrieves a complete or partial Resource.</td>
</tr>
<tr>
<td>POST</td>
<td>Create new Resource or bulk modify Resources.</td>
</tr>
<tr>
<td>PUT</td>
<td>Replace completely a Resource.</td>
</tr>
<tr>
<td>PATCH</td>
<td>Modifies a Resource with a set of specified changes (partial update).</td>
</tr>
<tr>
<td>DELETE</td>
<td>Deletes a Resource.</td>
</tr>
</tbody>
</table>
<h2 id="get-scimusersid">GET <code>/scim/Users/{id}</code></h2>
<p>Retrieves all the information about the user identified by <code>id</code> and returns results in application/json.</p>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:read</code>.</p>
<pre><code>GET http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d
</code></pre><pre><code>{
    &quot;id&quot;: &quot;2cb10ac5-5b1a-47a0-8f60-48995999f18d&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-13T18:38:16.314+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-13T18:38:16.314+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d&quot;,
        &quot;resourceType&quot;: &quot;User&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;paul_mccartney&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;Paul&quot;,
        &quot;familyName&quot;: &quot;McCartney&quot;,
        &quot;formatted&quot;: &quot;Paul McCartney&quot;
    },
    &quot;displayName&quot;: &quot;paul_mccartney&quot;,
    &quot;active&quot;: false,
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;paul@beatles.uk&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><h2 id="post-scimusers">POST <code>/scim/Users</code></h2>
<p>Creates a new user, using the info specified within the request body, sent as application/json.</p>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<pre><code>POST http://localhost:8080/scim/Users/
</code></pre><pre><code>{
    &quot;userName&quot;: &quot;paul_mccartney&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;Paul&quot;,
        &quot;familyName&quot;: &quot;McCartney&quot;,
        &quot;formatted&quot;: &quot;Paul McCartney&quot;
    },
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;paul@beatles.uk&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><p>Successful Resource creation is indicated with a <code>201 Created</code> response code.
Upon successful creation, the response body contains the newly created User.</p>
<pre><code>{
    &quot;id&quot;: &quot;2cb10ac5-5b1a-47a0-8f60-48995999f18d&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-13T18:38:16.314+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-13T18:38:16.314+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d&quot;,
        &quot;resourceType&quot;: &quot;User&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;paul_mccartney&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;Paul&quot;,
        &quot;familyName&quot;: &quot;McCartney&quot;,
        &quot;formatted&quot;: &quot;Paul McCartney&quot;
    },
    &quot;displayName&quot;: &quot;paul_mccartney&quot;,
    &quot;active&quot;: false,
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;paul@beatles.uk&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><h2 id="get-scimusers">GET <code>/scim/Users</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:read</code>.</p>
<p>SCIM defines a standard set of operations that can be used to filter, sort, and
paginate response results. The operations are specified by adding query
parameters to the Resource&rsquo;s endpoint.</p>
<p><strong>Pagination</strong> parameters can be used together to &ldquo;page through&rdquo; large numbers
of Resources. Pagination is not session based so clients must never assume
repeatable results.</p>
<p>The following table describes the URL pagination parameters.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>startIndex</td>
<td>The 1-based index of the first search result.</td>
<td>1</td>
</tr>
<tr>
<td>count</td>
<td>Non-negative Integer. Specifies the desired maximum number of search results per page; e.g., 10.</td>
<td>None.</td>
</tr>
</tbody>
</table>
<p>The following table describes the query response pagination attributes.</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>itemsPerPage</td>
<td>Non-negative Integer. Specifies the number of search results returned in a query response page; e.g., 10.</td>
</tr>
<tr>
<td>totalResults</td>
<td>Non-negative Integer. Specifies the total number of results matching the client query; e.g., 1000.</td>
</tr>
<tr>
<td>startIndex</td>
<td>The 1-based index of the first result in the current set of search results; e.g., 1.</td>
</tr>
</tbody>
</table>
<p>The below example returns the first 10 users (implicit startIndex as 1):</p>
<pre><code>GET /scim/Users?count=10
</code></pre><pre><code>{
    &quot;totalResults&quot;: 250,
    &quot;itemsPerPage&quot;: 10,
    &quot;startIndex&quot;: 1,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:ListResponse&quot;
    ],
    &quot;Resources&quot;: [
        {
            &quot;id&quot;: &quot;80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
            &quot;meta&quot;: {
                &quot;created&quot;: &quot;2016-07-14T12:22:46.376+02:00&quot;,
                &quot;lastModified&quot;: &quot;2016-07-14T12:22:46.376+02:00&quot;,
                &quot;location&quot;: &quot;http://localhost:8080/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
                &quot;resourceType&quot;: &quot;User&quot;
            },
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
            ],
            &quot;userName&quot;: &quot;test&quot;,
            &quot;name&quot;: {
                &quot;givenName&quot;: &quot;Test&quot;,
                &quot;familyName&quot;: &quot;User&quot;,
                &quot;formatted&quot;: &quot;Test User&quot;
            },
            &quot;displayName&quot;: &quot;test&quot;,
            &quot;active&quot;: true,
            &quot;emails&quot;: [
                {
                    &quot;type&quot;: &quot;work&quot;,
                    &quot;value&quot;: &quot;test@iam.test&quot;,
                    &quot;primary&quot;: true
                }
            ],
            &quot;groups&quot;: [
                {
                    &quot;display&quot;: &quot;Production&quot;,
                    &quot;value&quot;: &quot;c617d586-54e6-411d-8e38-64967798fa8a&quot;,
                    &quot;$ref&quot;: &quot;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&quot;
                },
                {
                    &quot;display&quot;: &quot;Analysis&quot;,
                    &quot;value&quot;: &quot;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&quot;,
                    &quot;$ref&quot;: &quot;http://localhost:8080/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&quot;
                }
            ],
            &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;: {
                &quot;oidcIds&quot;: [
                    {
                        &quot;issuer&quot;: &quot;https://accounts.google.com&quot;,
                        &quot;subject&quot;: &quot;105440632287425289613&quot;
                    }
                ],
                &quot;samlIds&quot;: [
                    {
                        &quot;idpId&quot;: &quot;https://idptestbed/idp/shibboleth&quot;,
                        &quot;userId&quot;: &quot;andrea.ceccanti@example.org&quot;
                    }
                ]
            }
        },
        [...]
    ]
}
</code></pre><p>The details of the returned users can be reduced/filtered by specifying the
needed attribute(s). The below example returns only the userName for all Users:</p>
<pre><code>GET http://localhost:8080/scim/Users?attributes=userName
</code></pre><pre><code>{
    &quot;totalResults&quot;: 250,
    &quot;itemsPerPage&quot;: 100,
    &quot;startIndex&quot;: 1,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:ListResponse&quot;
    ],
    &quot;Resources&quot;: [
        {
            &quot;id&quot;: &quot;80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
            ],
            &quot;userName&quot;: &quot;test&quot;
        },
        {
            &quot;id&quot;: &quot;73f16d93-2441-4a50-88ff-85360d78c6b5&quot;,
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
            ],
            &quot;userName&quot;: &quot;admin&quot;
        },
        [...]
    ]
}
</code></pre><p>Multiple attributes are also supported:</p>
<pre><code>GET http://localhost:8080/scim/Users?count=2&amp;attributes=userName%2Cemails%2Curn%3Aindigo-dc%3Ascim%3Aschemas%3AIndigoUser
</code></pre><p>Request params:</p>
<ul>
<li><code>count=2</code></li>
<li><code>attributes=userName,emails,urn:indigo-dc:scim:schemas:IndigoUser</code></li>
</ul>
<pre><code>{
    &quot;totalResults&quot;: 250,
    &quot;itemsPerPage&quot;: 2,
    &quot;startIndex&quot;: 1,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:ListResponse&quot;
    ],
    &quot;Resources&quot;: [
        {
            &quot;id&quot;: &quot;80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
            ],
            &quot;userName&quot;: &quot;test&quot;,
            &quot;emails&quot;: [
                {
                    &quot;type&quot;: &quot;work&quot;,
                    &quot;value&quot;: &quot;test@iam.test&quot;,
                    &quot;primary&quot;: true
                }
            ],
            &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;: {
                &quot;oidcIds&quot;: [
                    {
                        &quot;issuer&quot;: &quot;https://accounts.google.com&quot;,
                        &quot;subject&quot;: &quot;105440632287425289613&quot;
                    }
                ],
                &quot;samlIds&quot;: [
                    {
                        &quot;idpId&quot;: &quot;https://idptestbed/idp/shibboleth&quot;,
                        &quot;userId&quot;: &quot;andrea.ceccanti@example.org&quot;
                    }
                ]
            }
        },
        {
            &quot;id&quot;: &quot;73f16d93-2441-4a50-88ff-85360d78c6b5&quot;,
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
            ],
            &quot;userName&quot;: &quot;admin&quot;,
            &quot;emails&quot;: [
                {
                    &quot;type&quot;: &quot;work&quot;,
                    &quot;value&quot;: &quot;admin@iam.test&quot;,
                    &quot;primary&quot;: true
                }
            ],
            &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;: {
                &quot;oidcIds&quot;: [
                    {
                        &quot;issuer&quot;: &quot;https://accounts.google.com&quot;,
                        &quot;subject&quot;: &quot;114132403455520317223&quot;
                    }
                ],
                &quot;samlIds&quot;: [
                    {
                        &quot;idpId&quot;: &quot;https://idptestbed/idp/shibboleth&quot;,
                        &quot;userId&quot;: &quot;ciccio.paglia@example.org&quot;
                    }
                ]
            }
        }
    ]
}
</code></pre><p>SCIM <strong>Filtering</strong> and <strong>sorting</strong> of results are currently not supported.</p>
<h2 id="put-scimusersid">PUT <code>/scim/Users/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>PUT performs a full update. Clients should retrieve the entire resource and
then PUT the desired modifications as the operation overwrites all previously
stored data. A successful PUT operation returns a 200 OK response code and the
entire resource within the response body.</p>
<p>Example of changing the userName from <code>john_lennon</code> to <code>j.lennon</code> and setting <code>active</code> as true:</p>
<pre><code>GET http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe
</code></pre><pre><code>{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;john_lennon&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;John&quot;,
        &quot;familyName&quot;: &quot;Lennon&quot;,
        &quot;formatted&quot;: &quot;John Lennon&quot;
    },
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;lennon@email.test&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><p>Retrieved the user&rsquo;s info, update userName as <code>&quot;userName&quot;: &quot;j.lennon&quot;</code> and add <code>&quot;active&quot;: true</code>:</p>
<pre><code>PUT http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe
</code></pre><pre><code>{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;j.lennon&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;John&quot;,
        &quot;familyName&quot;: &quot;Lennon&quot;,
        &quot;formatted&quot;: &quot;John Lennon&quot;
    },
    &quot;active&quot;: true,
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;lennon@email.test&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><p>The returned answer is:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/scim+json;charset=UTF-8
{
    &quot;id&quot;: &quot;e380b4e3-7b63-47c2-b156-3699be9ebcfe&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T15:42:56.275+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T15:42:56.445+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe&quot;,
        &quot;resourceType&quot;: &quot;User&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;j.lennon&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;John&quot;,
        &quot;familyName&quot;: &quot;Lennon&quot;,
        &quot;formatted&quot;: &quot;John Lennon&quot;
    },
    &quot;displayName&quot;: &quot;j.lennon&quot;,
    &quot;active&quot;: true,
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;lennon@email.test&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre><h2 id="patch-scimusersid">PATCH <code>/scim/Users/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>PATCH enables consumers to send only the attributes requiring modification,
reducing network and processing overhead. Attributes may be deleted, replaced,
merged, or added in a single request. The body of a PATCH request MUST contain
a partial resource with the desired modifications. The server MUST return
either a 200 OK response code and the entire Resource within the response body,
or a 204 No Content response code and the appropriate response headers for a
successful PATCH request.</p>
<p>The following example shows how to replace the userName:</p>
<pre><code>PATCH http://localhost:8080/scim/Users/b6769dd1-3d7d-416d-be6d-020be23ba904
Body:
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;replace&quot;,
            &quot;value&quot;: {
                &quot;userName&quot;: &quot;john_lennon_jr&quot;,
            }
        }
    ]
}
</code></pre><p>The following example shows how to add an OpenID Connect account and a ssh key:</p>
<pre><code>PATCH http://localhost:8080/scim/Users/b6769dd1-3d7d-416d-be6d-020be23ba904
Body:
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;add&quot;,
            &quot;value&quot;: {
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;: {
                    &quot;oidcIds&quot;: [
                        {
                            &quot;issuer&quot;: &quot;test_issuer&quot;,
                            &quot;subject&quot;: &quot;test_subject&quot;
                        }
                    ],
                    &quot;sshKeys&quot;: [
                        {
                            &quot;display&quot;: &quot;Personal&quot;,
                            &quot;primary&quot;: true,
                            &quot;value&quot;: &quot;AAAAB3NzaC1yc2EAAAADAQABAAABAQC4tjz4mfMLvJsM8RXIgdRYPBhH//VXLXbeLbUsJpm5ARIQPY6Gu1befPA3jqKacvdcBrMsYGiMp/DOhpkAwWclSnzMdvYLbYWkrOPwBVrRh7lvFtXFLaQZ6do4uMZHb5zU2ViTFacrJ6zJ/GLltjk4nBea7Z4qHaQdWou3Fk/108oMQGx7jqW44m+TA+HYo6rEbVWbimWVXyyiKchO2LTLKUbK6GBSWJiItezwAWR3KKs3FXKRmbJDiKESh3mDccJidfkjzNLPyDf3JHI2b/C/mcvtJsoAtkIWuVll2BhBBiqkYt3tX2llZCYGtF7rZOYTsqhw+LPnsJtsX+W7e4iN&quot;
                        }
                    ]
                }
            }
        }
    ]
}
</code></pre><h2 id="delete-scimusersid">DELETE <code>/scim/Users/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>Clients request user removal via DELETE.</p>
<pre><code>DELETE /scim/Users/4380e98c-02f2-4d10-85ba-9fbbdb819ed8
</code></pre><pre><code>HTTP/1.1 200 OK
</code></pre><p>Example: Client attempt to retrieve the previously deleted User:</p>
<pre><code>GET /scim/Users/4380e98c-02f2-4d10-85ba-9fbbdb819ed8
{
    &quot;status&quot;: &quot;404&quot;,
    &quot;detail&quot;: &quot;No user mapped to id '4380e98c-02f2-4d10-85ba-9fbbdb819ed8'&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:Error&quot;
    ]
}
</code></pre><h2 id="get-scimgroupsid">GET <code>/scim/Groups/{id}</code></h2>
<p>Retrieves all the information about the group identified by <code>id</code> and returns results in application/json.</p>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:read</code>.</p>
<pre><code>GET /scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a
</code></pre><pre><code>{
    &quot;id&quot;: &quot;c617d586-54e6-411d-8e38-64967798fa8a&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T16:22:05.170+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T16:22:05.170+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&quot;,
        &quot;resourceType&quot;: &quot;Group&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;Production&quot;,
    &quot;members&quot;: [
        {
            &quot;display&quot;: &quot;test&quot;,
            &quot;value&quot;: &quot;80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
            &quot;$ref&quot;: &quot;http://localhost:8080/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;
        },
        {
            &quot;display&quot;: &quot;admin&quot;,
            &quot;value&quot;: &quot;73f16d93-2441-4a50-88ff-85360d78c6b5&quot;,
            &quot;$ref&quot;: &quot;http://localhost:8080/scim/Users/73f16d93-2441-4a50-88ff-85360d78c6b5&quot;
        }
    ]
}
</code></pre><h2 id="post-scimgroups">POST <code>/scim/Groups</code></h2>
<p>Creates a new group, using the info specified within the request body, sent as application/json.</p>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<pre><code>POST http://localhost:8080/scim/Groups/
</code></pre><pre><code>{
    &quot;id&quot;: &quot;7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers&quot;
}
</code></pre><p>Successful Resource creation is indicated with a 201 (&ldquo;Created&rdquo;) response code. Upon successful creation, the response body contains the newly created User.</p>
<pre><code>{
    &quot;id&quot;: &quot;7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T16:24:50.941+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T16:24:50.941+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
        &quot;resourceType&quot;: &quot;Group&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers&quot;
}
</code></pre><h2 id="get-scimgroups">GET <code>/scim/Groups</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:read</code>.</p>
<p>The pagination seen for users can be applied also to groups:</p>
<p>Example: retrieve the 22nd group</p>
<pre><code>GET http://localhost:8080/scim/Groups?startIndex=22&amp;count=1
</code></pre><pre><code>{
    &quot;totalResults&quot;: 22,
    &quot;itemsPerPage&quot;: 1,
    &quot;startIndex&quot;: 22,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:ListResponse&quot;
    ],
    &quot;Resources&quot;: [
        {
            &quot;id&quot;: &quot;c617d586-54e6-411d-8e38-649677980020&quot;,
            &quot;meta&quot;: {
                &quot;created&quot;: &quot;2016-07-14T16:33:20.135+02:00&quot;,
                &quot;lastModified&quot;: &quot;2016-07-14T16:33:20.135+02:00&quot;,
                &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-649677980020&quot;,
                &quot;resourceType&quot;: &quot;Group&quot;
            },
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
            ],
            &quot;displayName&quot;: &quot;Test-020&quot;
        }
    ]
}
</code></pre><h2 id="put-scimgroupsid">PUT <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>PUT performs a full update. Clients should retrieve the entire resource and
then PUT the desired modifications as the operation overwrites all previously
stored data. A successful PUT operation returns a 200 OK response code and the
entire resource within the response body.</p>
<p>Example of replacing group with a different displayName:</p>
<pre><code>PUT http://localhost:8080/scim/Groups/891d042d-fc6e-4408-8a3a-ad9dfdf5db89
{
    &quot;id&quot;: &quot;891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers_updated&quot;
}
</code></pre><pre><code>{
    &quot;id&quot;: &quot;891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T16:37:18.302+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T16:37:18.411+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
        &quot;resourceType&quot;: &quot;Group&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers_updated&quot;
}
</code></pre><h2 id="patch-scimgroupsid">PATCH <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>The following example shows how to add member to a group:</p>
<pre><code>PATCH http://localhost:8080/scim/Groups/4ca7fa98-0875-4eb3-a71f-0f88ce5632cf
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;add&quot;,
            &quot;path&quot;: &quot;members&quot;,
            &quot;value&quot;: [
                {
                    &quot;display&quot;: &quot;john_lennon&quot;,
                    &quot;value&quot;: &quot;e9c8cfca-7158-4a0d-9684-4abdede617cd&quot;,
                    &quot;$ref&quot;: &quot;http://localhost:8080/scim/Users/e9c8cfca-7158-4a0d-9684-4abdede617cd&quot;
                }
            ]
        }
    ]
}
</code></pre><h2 id="delete-scimgroupsid">DELETE <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>ROLE_ADMIN</code> or scope <code>scim:write</code>.</p>
<p>Clients request group removal via DELETE.</p>
<pre><code>DELETE /scim/Groups/5bae2407-08e3-4171-b180-4b4a0196e7b6
</code></pre><pre><code>HTTP/1.1 200 OK
</code></pre><p>Example: Client attempt to retrieve the previously deleted User:</p>
<pre><code>GET /scim/Groups/5bae2407-08e3-4171-b180-4b4a0196e7b6
{
    &quot;status&quot;: &quot;404&quot;,
    &quot;detail&quot;: &quot;No group mapped to id '5bae2407-08e3-4171-b180-4b4a0196e7b6'&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:Error&quot;
    ]
}
</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-546d6976fff9de02db89bd2588e84da3">4.2 - Configuration</h1>
    <div class="lead">IAM service configuration reference</div>
	<p>Most IAM configurable aspects are configured via environment variables and
Spring profile directives.</p>
<h2 id="spring-profiles">Spring profiles</h2>
<p>Spring profiles are used to enable/disable group of IAM functionalities.
Currently the following profiles are defined:</p>
<table>
<thead>
<tr>
<th>Profile name</th>
<th>Active by default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>prod</td>
<td>no</td>
<td>This is the profile you should enable when using IAM</td>
</tr>
<tr>
<td>h2-test</td>
<td>yes</td>
<td>Enables h2 in-memory database, useful for development and testing</td>
</tr>
<tr>
<td>mysql-test</td>
<td>no</td>
<td>Like h2-test, but used to develop against a MySQL database</td>
</tr>
<tr>
<td>google</td>
<td>no</td>
<td>Enables Google authentication</td>
</tr>
<tr>
<td>saml</td>
<td>no</td>
<td>Enables SAML authentication</td>
</tr>
<tr>
<td>registration</td>
<td>yes</td>
<td>Enables user registration and reset password functionalities</td>
</tr>
</tbody>
</table>
<p>Profiles are enabled by setting the <code>spring.profiles.active</code> Java system
property when starting the IAM service. This can be done, using the official
IAM docker image, by setting the IAM_JAVA_OPTS environment variable as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">IAM_JAVA_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;-Dspring.profiles.active=prod,google,saml&#34;</span>
</code></pre></div><h2 id="overriding-default-configuration-templates">Overriding default configuration templates</h2>
<p>Fine-grained control over configuration can be obtained following the rules for
spring boot <a href="https://docs.spring.io/spring-boot/docs/1.3.8.RELEASE/reference/html/boot-features-external-config.html">externalized configuration</a>.
This basically means defining one or more YAML files to override the default
configuration files embedded in the IAM Web Archive (war) package for the Spring profiles
activated for your instance.  The files must be placed in the IAM configuration
directory, which depends on how you deployed IAM:</p>
<table>
<thead>
<tr>
<th>Deployment type</th>
<th>Configuration directory</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker</td>
<td><code>/indigo-iam/config/</code></td>
</tr>
<tr>
<td>Package (RPM)</td>
<td><code>/etc/indigo-iam/config</code></td>
</tr>
</tbody>
</table>
<p><strong>IMPORTANT</strong>: the default configuration should solve most use cases, override
default configuration <strong>only if you know what you are doing</strong>, and for those
scenarios not served by the default templates.</p>
<h2 id="basic-service-configuration">Basic service configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The IAM service will list for requests on this host.</span>
<span style="color:#000">IAM_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>localhost

<span style="color:#8f5902;font-style:italic"># The IAM service webapp will bind on this port.</span>
<span style="color:#000">IAM_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8080</span>

<span style="color:#8f5902;font-style:italic"># The IAM web application base URL</span>
<span style="color:#000">IAM_BASE_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">IAM_HOST</span><span style="color:#4e9a06">}</span>:8080

<span style="color:#8f5902;font-style:italic"># The OpenID Connect issuer configured for this IAM instance.</span>
<span style="color:#8f5902;font-style:italic"># This must be equal to IAM_BASE_URL</span>
<span style="color:#000">IAM_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">IAM_HOST</span><span style="color:#4e9a06">}</span>:8080

<span style="color:#8f5902;font-style:italic"># The path to the JSON keystore that holds the keys IAM will use to sign and</span>
<span style="color:#8f5902;font-style:italic"># verify token signatures</span>
<span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># IAM will look for trust anchors in this directory.  These trust anchors are</span>
<span style="color:#8f5902;font-style:italic"># needed for TLS operations where the IAM acts as a client (i.e., to</span>
<span style="color:#8f5902;font-style:italic"># authenticate to remote SAML Identity providers)</span>
<span style="color:#000">IAM_X509_TRUST_ANCHORS_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/grid-security/certificates

<span style="color:#8f5902;font-style:italic"># How frequently (in seconds) should trust anchors be refreshed</span>
<span style="color:#000">IAM_X509_TRUST_ANCHORS_REFRESH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">14400</span>

<span style="color:#8f5902;font-style:italic"># Use forwarded headers from reverse proxy. Set this to true when deploying the</span>
<span style="color:#8f5902;font-style:italic"># service behind a reverse proxy.</span>
<span style="color:#000">IAM_USE_FORWARDED_HEADERS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic">## Tomcat embedded container settings</span>

<span style="color:#8f5902;font-style:italic"># Enables the tomcat access log</span>
<span style="color:#000">IAM_TOMCAT_ACCESS_LOG_ENABLED</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Directory where the tomcat access log will be written (when enabled)</span>
<span style="color:#000">IAM_TOMCAT_ACCESS_LOG_DIRECTORY</span><span style="color:#ce5c00;font-weight:bold">=</span>/tmp

<span style="color:#8f5902;font-style:italic">## Actuator endpoint settings</span>

<span style="color:#8f5902;font-style:italic"># Sets the username of the user allowed to have privileged access to actuator</span>
<span style="color:#8f5902;font-style:italic"># endpoints</span>
<span style="color:#000">IAM_SUPERUSER_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>whatever

<span style="color:#8f5902;font-style:italic"># Sets the password of the user allowed to have privileged access to actuator</span>
<span style="color:#8f5902;font-style:italic"># endpoints</span>
<span style="color:#000">IAM_SUPERUSER_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>whatever

<span style="color:#8f5902;font-style:italic">## Local resources configuration</span>

<span style="color:#8f5902;font-style:italic"># Enables the serving of resources from the local file system </span>
<span style="color:#000">IAM_LOCAL_RESOURCES_ENABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Sets the directory that contains the local resources that should be exposed</span>
<span style="color:#000">IAM_LOCAL_RESOURCES_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:/indigo-iam/local-resources
</code></pre></div><h2 id="organization-configuration">Organization configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The name of the organization managed by this IAM instance.</span>
<span style="color:#000">IAM_ORGANISATION_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo-dc

<span style="color:#8f5902;font-style:italic"># URL of logo image used in the IAM dashboard (by default the INDIGO-Datacloud</span>
<span style="color:#8f5902;font-style:italic"># project logo image is used)</span>
<span style="color:#000">IAM_LOGO_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>resources/images/indigo-logo.png

<span style="color:#8f5902;font-style:italic"># Size of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_DIMENSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span>

<span style="color:#8f5902;font-style:italic"># Height of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_HEIGTH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">150</span>

<span style="color:#8f5902;font-style:italic"># Width of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_WIDTH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span>

<span style="color:#8f5902;font-style:italic"># String displayed into the brower top bar when accessing the IAM dashboard</span>
<span style="color:#000">IAM_TOPBAR_TITLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;INDIGO IAM for </span><span style="color:#4e9a06">${</span><span style="color:#000">IAM_ORGANISATION_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</code></pre></div><h2 id="access-token-contents-configuration">Access token contents configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">## Token content settings </span>

<span style="color:#8f5902;font-style:italic"># Include authentication claims in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Includes the scope in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_SCOPE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Includes the nbf claim in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_NBF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>
</code></pre></div><h2 id="database-configuration">Database configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The host where the MariaDB/MySQL daemon is running</span>
<span style="color:#000">IAM_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The database port</span>
<span style="color:#000">IAM_DB_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3306</span>

<span style="color:#8f5902;font-style:italic"># The database name</span>
<span style="color:#000">IAM_DB_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam

<span style="color:#8f5902;font-style:italic"># The database username</span>
<span style="color:#000">IAM_DB_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam

<span style="color:#8f5902;font-style:italic"># The database password </span>
<span style="color:#000">IAM_DB_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">pwd</span>

<span style="color:#8f5902;font-style:italic">## Database connection pool options</span>

<span style="color:#8f5902;font-style:italic"># Maximum number of active connections to the database</span>
<span style="color:#000">IAM_DB_MAX_ACTIVE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">50</span>

<span style="color:#8f5902;font-style:italic"># Maximum number of idle connections in the pool </span>
<span style="color:#000">IAM_DB_MAX_IDLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5</span>

<span style="color:#8f5902;font-style:italic"># Initial size of the database connection pool</span>
<span style="color:#000">IAM_DB_INITIAL_SIZE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8</span>

<span style="color:#8f5902;font-style:italic"># Should idle connections in the pool be tested?</span>
<span style="color:#000">IAM_DB_TEST_WHILE_IDLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>

<span style="color:#8f5902;font-style:italic"># Should connections in the pool be tested when borrowed?</span>
<span style="color:#000">IAM_DB_TEST_ON_BORROW</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>

<span style="color:#8f5902;font-style:italic"># Which SQL query should be used to test connections?</span>
<span style="color:#000">IAM_DB_VALIDATION_QUERY</span><span style="color:#ce5c00;font-weight:bold">=</span>SELECT <span style="color:#0000cf;font-weight:bold">1</span>

<span style="color:#8f5902;font-style:italic"># Time between database connection pool eviction runs (in msec)</span>
<span style="color:#000">IAM_DB_TIME_BETWEEN_EVICTION_RUNS_MILLIS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5000</span>

<span style="color:#8f5902;font-style:italic"># The minimum amount of time a connection may be idle in the pool</span>
<span style="color:#8f5902;font-style:italic"># before it is considered for eviction (in msec)</span>
<span style="color:#000">IAM_DB_MIN_EVICTABLE_IDLE_TIME_MILLIS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">60000</span>
</code></pre></div><h2 id="google-authentication-settings">Google authentication settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The Google OAuth client id</span>
<span style="color:#000">IAM_GOOGLE_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The OAuth client secret</span>
<span style="color:#000">IAM_GOOGLE_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>
</code></pre></div><p>For more information and examples, see the <a href="/docs/reference/configuration/external-authentication/oidc">OpenID Connect
Authentication section</a>.</p>
<h2 id="saml-authentication-settings">SAML authentication settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The SAML entity ID for this IAM instance</span>
<span style="color:#000">IAM_SAML_ENTITY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># Text shown in the SAML login button on the IAM login page</span>
<span style="color:#000">IAM_SAML_LOGIN_BUTTON_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>Sign in with SAML

<span style="color:#8f5902;font-style:italic">## SAML keystore settings</span>

<span style="color:#8f5902;font-style:italic"># The keystore holding certificates and keys used for SAML crypto</span>
<span style="color:#000">IAM_SAML_KEYSTORE</span><span style="color:#ce5c00;font-weight:bold">=</span> 

<span style="color:#8f5902;font-style:italic"># The SAML keystore password</span>
<span style="color:#000">IAM_SAML_KEYSTORE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The identifier of the key that should be used to sign requests/assertions</span>
<span style="color:#000">IAM_SAML_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The password of the SAML key that will be used to sign requests/assertions</span>
<span style="color:#000">IAM_SAML_KEY_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## Metadata settings</span>

<span style="color:#8f5902;font-style:italic"># a URL pointing to the SAML federation or IdP metadata</span>
<span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># Metadata refresh period (in seconds)</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">600</span>

<span style="color:#8f5902;font-style:italic"># Should signature validity checks be enforced on metadata?</span>
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Trust only IdPs that have SIRTFI compliance</span>
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_SIRTFI</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Comma-separated IDP entity ID whitelist. When empty</span>
<span style="color:#8f5902;font-style:italic"># all IdPs included in the metadata are whitelisted</span>
<span style="color:#000">IAM_SAML_IDP_ENTITY_ID_WHITELIST</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## Assertion validity settings</span>

<span style="color:#8f5902;font-style:italic"># Maxixum allowed assertion time (in seconds)</span>
<span style="color:#000">IAM_SAML_MAX_ASSERTION_TIME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3000</span>

<span style="color:#8f5902;font-style:italic"># Maximum authentication age (in seconds)</span>
<span style="color:#000">IAM_SAML_MAX_AUTHENTICATION_AGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">86400</span>

<span style="color:#8f5902;font-style:italic">## Other settings</span>

<span style="color:#8f5902;font-style:italic"># List of attribute aliases that are looked up in assertion to identify the </span>
<span style="color:#8f5902;font-style:italic"># user authenticated with SAML</span>
<span style="color:#000">IAM_SAML_ID_RESOLVERS</span><span style="color:#ce5c00;font-weight:bold">=</span>eduPersonUniqueId,eduPersonTargetedId,eduPersonPrincipalName
</code></pre></div><p>For more information and examples, see the <a href="/docs/reference/configuration/external-authentication/saml">SAML Authentication
section</a>.</p>
<h2 id="notification-service-settings">Notification service settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">## SMTP mail server settings </span>

<span style="color:#8f5902;font-style:italic"># SMTP server hostname </span>
<span style="color:#000">IAM_MAIL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>localhost

<span style="color:#8f5902;font-style:italic"># SMTP server port </span>
<span style="color:#000">IAM_MAIL_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">25</span>

<span style="color:#8f5902;font-style:italic"># SMTP server username</span>
<span style="color:#000">IAM_MAIL_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># SMTP server password</span>
<span style="color:#000">IAM_MAIL_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## IAM notification settings</span>

<span style="color:#8f5902;font-style:italic"># Should the notification server be disabled?</span>
<span style="color:#8f5902;font-style:italic"># When set to true, notifications are not sent to the mail server (but</span>
<span style="color:#8f5902;font-style:italic"># printed to the logs)</span>
<span style="color:#000">IAM_NOTIFICATION_DISABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># The email address used as the sender in IAM email notifications</span>
<span style="color:#000">IAM_NOTIFICATION_FROM</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo@localhost

<span style="color:#8f5902;font-style:italic"># The email address used as the recipient in IAM email notifications</span>
<span style="color:#000">IAM_NOTIFICATION_ADMIN_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo-alerts@localhost

<span style="color:#8f5902;font-style:italic"># Time interval, in milliseconds, between two consecutive runs of IAM notification </span>
<span style="color:#8f5902;font-style:italic"># dispatch task </span>
<span style="color:#000">IAM_NOTIFICATION_TASK_DELAY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30000</span>

<span style="color:#8f5902;font-style:italic"># Retention of delivered messages, in days</span>
<span style="color:#000">IAM_NOTIFICATION_CLEANUP_AGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30</span>
</code></pre></div><h2 id="account-linking-settings">Account linking settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Should account linking be disabled? When set to true users cannot</span>
<span style="color:#8f5902;font-style:italic"># link external accounts (Google, SAML) to their local IAM account</span>
<span style="color:#000">IAM_ACCOUNT_LINKING_DISABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> 
</code></pre></div><h2 id="privacy-policy-settings">Privacy policy settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># An URL pointing to a privacy policy document which applies</span>
<span style="color:#8f5902;font-style:italic"># to this IAM instance. When left blank, no privacy policy link </span>
<span style="color:#8f5902;font-style:italic"># is displayed in the login page</span>
<span style="color:#000">IAM_PRIVACY_POLICY_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The text displayed in the login page for the privacy policy URL specified</span>
<span style="color:#8f5902;font-style:italic"># above</span>
<span style="color:#000">IAM_PRIVACY_POLICY_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>Privacy policy
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5cb2c17061941e1c1c672862bc22824c">4.2.1 - JWT profiles support</h1>
    
	<p>Starting with version 1.6.0, IAM introduces support for JWT <em>profiles</em>.</p>
<p>A JWT profile is a named set of rules that defines which information is
included in access tokens, id tokens,  userinfo and introspection responses
issued by IAM in an OAuth/OIDC message exchanges.</p>
<p>IAM allows to define a default profile that is used for all clients that are
not explicitly bound to one. This allows to use the same profile across
all clients in an organization.</p>
<p>It&rsquo;s also possible to define the profile to be used at client level, using
scopes, i.e. adding among the scope allowed for the client the name of the
profile the client should use. The scope, in this context, does not identify a
set of permissions but an encoding of authentication/authorization informations
in tokens and responses issued by IAM.</p>
<p>This mechanism enables integration of the same IAM instance with resources
relying on different profiles.</p>
<p>IAM currently supports three JWT profiles:</p>
<ul>
<li>the <code>iam</code> profile</li>
<li>the <code>wlcg</code> WLCG profile</li>
<li>the <code>aarc</code> profile</li>
</ul>
<h2 id="setting-the-default-profile">Setting the default profile</h2>
<p>The IAM JWT default profile is set using the <code>IAM_JWT_DEFAULT_PROFILE</code>
environment variable, e.g.:</p>
<pre><code>IAM_JWT_DEFAULT_PROFILE=iam
</code></pre><p>The default profile will be used for all clients that do not explicitly and
correctly request the use of a profile using scopes.</p>
<h2 id="using-scopes-to-select-the-jwt-profile-for-a-client">Using scopes to select the JWT profile for a client</h2>
<p>To select the profile used by a client, include one of the following scopes
in the list of scopes authorized for a client:</p>
<ul>
<li><code>iam</code>, for the IAM profile</li>
<li><code>wlcg</code>, for the WLCG profile</li>
<li><code>aarc</code> profile, for the AARC profile</li>
</ul>
<p>Clients should only link to one profile. When multiple profiles are linked to a
client, IAM falls back to the default profile configured for the IAM instance.</p>
<h2 id="using-system-scopes-to-control-profile-selection">Using system scopes to control profile selection</h2>
<p>MitreID <strong>System Scopes</strong> can be used to control access to profile selection.</p>
<p>For example, by setting a profile scope as <code>restricted</code>, such scope will not be
available to dynamically registered clients and can only be assigned to clients
by IAM administrators.</p>
<h2 id="supported-jwt-profiles">Supported JWT profiles</h2>
<h3 id="the-iam-profile">The IAM profile</h3>
<p>This is the default profile for IAM.</p>
<p>With this profile:</p>
<ul>
<li>
<p>groups are enconded in the <code>groups</code> claim; all the groups the user is member
of are included in the groups claim;</p>
</li>
<li>
<p>authentication information (username, email, groups) is not by default
included in access tokens; this behaviour can be changed by setting the
<code>IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO=true</code> environment variable;</p>
</li>
<li>
<p>scope information is not by default included in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_SCOPE=true</code>
environment variable;</p>
</li>
<li>
<p>the <code>nbf</code> (not before) claim is not set in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_NBF=true</code>
environment variable;</p>
</li>
</ul>
<p>This profile is assigned to clients using the <code>iam</code>  scope.</p>
<h3 id="the-wlcg-profile">The WLCG profile</h3>
<p>This profile implements the <a href="https://zenodo.org/record/3460258">Common JWT Token profile</a>.</p>
<p>In particular:</p>
<ul>
<li>the <code>scope</code> claim is always included in access tokens;</li>
<li>groups are not included by default in access and ID tokens;</li>
</ul>
<p>This profile is assigned to clients using the <code>wlcg</code> scope.</p>
<h4 id="requesting-groups-with-the-wlcg-profile">Requesting groups with the WLCG profile</h4>
<p>When the WLCG profile is used, groups are not automatically included in access
tokens and ID tokens, but can be requested using the <code>wlcg.groups</code> scope,
following the rules described in the <a href="https://github.com/WLCG-AuthZ-WG/CommonJWTProfile/blob/master/profile.md#scope-based-group-selection">WLCG
profile</a>.</p>
<h4 id="optional-groups">Optional groups</h4>
<p>Optional groups are groups whose membership is only asserted in tokens on
explicit request coming from a user.</p>
<p>In order to configure a IAM group as an optional group, add the
<code>wlcg.optional-group</code> label to the group.</p>
<h3 id="the-aarc-profile">The AARC profile</h3>
<p>This profile encodes group membership information following the rules defined
by the <a href="https://aarc-project.eu/guidelines/aarc-g002/">AARC G002</a> profile document.</p>
<p>In particular:</p>
<ul>
<li>groups and organisation name are not included by default in access and ID tokens;</li>
<li>organisation name can be requested using the <code>eduperson_scoped_affiliation</code> scope and it&rsquo;s encoded in the <code>eduperson_scoped_affiliation</code> claim;</li>
<li>groups can be requested using the <code>eduperson_entitlement</code> scope and they&rsquo;re encoded as URN in the <code>eduperson_entitlement</code> claim;</li>
</ul>
<p>All the mapping rules are described in the <a href="https://docs.google.com/document/d/1b-Mlet3Lq7qKLEf1BnHJ4nL1fq-vMe7fzpXyrq2wp08/edit">White Paper for implementation mappings between SAML 2.0 and OpenID Connect in Research and Education</a>.</p>
<p>This profile is assigned to clients using the <code>aarc</code> scope.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e0f442387d8fc56f35f4b7d4d89f3ce8">4.2.2 - Membership lifecycle</h1>
    
	<p>Starting with version 1.6.0, IAM introduces support for basic account life
cycle management.</p>
<p>It&rsquo;s now possible to set an expiration time for IAM accounts. Once the account
expires, login for the account is disabled.</p>
<p>IAM can be configured to remove expired accounts after a configurable grace
period.</p>
<h2 id="account-end-time-settings">Account end time settings</h2>
<p>By default, accounts in IAM do not have an end time set, i.e. the lifetime is
unbounded.</p>
<p>A default account validity period (e.g., 12 months) can be configured and will
be set for users at registration time.</p>
<p>The relevant settings are managed  by placing <code>lifecycle</code> directives in a
<a href="/docs/reference/configuration/#overriding-default-configuration-templates">custom configuration
file</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">lifecycle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">account</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">account-lifetime-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">365</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">## 0 means unbounded validity</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">read-only-end-time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">## When true, the end time cannot be changed from IAM APIs and dashboard</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">expired-account-policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">suspension-grace-period-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">## Accounts will be suspended after 7 days since expiration</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">remove-expired-accounts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">## When false, expired accounts are not removed</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">removal-grace-period-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">## Accounts will be removed after 30 days since expiration (if remove-expired-accounts is true)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">expired-accounts-task</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cron-schedule</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">*/5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">## spring cron schedule for the lifecycle task (default setting is every 5 mins)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">## To disable automatic account expiration set this to false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e78a0c48975ae96adce928da21191be8">4.2.3 - Registration &amp; Enrollment</h1>
    
	<p>IAM implements a basic registration service that implements an
administrator-vetted registration flow, where users apply for membership in an
organization and administrators are asked to validate membership requests.</p>
<h2 id="requiring-external-authentication">Requiring external authentication</h2>
<p>Starting with version 1.6.0, IAM allows to request that users are authenticated
from a trusted identity provider (SAML or OIDC) in order to apply for
membership. It&rsquo;s also possible to control how information in authentication
tokens and assertions is mapped to IAM registration fields.</p>
<p>For example, see the following fragment that requires authentication with the
CERN SSO and defines how information from identity tokens issued by CERN SSO is
mapped to IAM membership information</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">registration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">require-external-authentication</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">oidc-issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://auth.cern.ch/auth/realms/cern</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">authentication-type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">oidc</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fields</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># When false, allows user to override what comes from the authentication information</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">given_name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">surname</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">family_name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">email</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">email</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">preferred_username</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="user-editable-fields">User editable fields</h2>
<p>Starting with version 1.6.0, IAM allows to limit which fields of the user profile are editable by users.</p>
<p>The default, backward-compatible settings that allow users to edit all their
profile fields are defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">user-profile</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">editable-fields</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">email</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">picture</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">surname</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>To prevent modifications to any of the fields remove the field name from
<code>editable-fields</code> list.</p>
<p>External configuration can be managed by placing directives as shown above in a
<a href="/docs/reference/configuration/#overriding-default-configuration-templates">custom configuration
file</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-08aa2036fbc5e84f4da3870adf6049ec">4.2.4 - Local authentication</h1>
    
	<p>Starting with version 1.6.0, IAM introduces the ability to limit or disable
authentication with local IAM credentials, so that external, brokered
authentication is required.</p>
<p>It&rsquo;s possible to hide the local login form from the IAM login page and also to
control for which users local authentication is enabled (all users,
VO administrators, no users).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">local-authn</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># possible values for enabled-for: all, vo-admins, none</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">enabled-for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vo-admins </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># possible values: hidden, visible</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">login-page-visibility</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hidden </span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Local authentication settings are configured providing a custom configuration
file, as described
<a href="/docs/reference/configuration/#overriding-default-configuration-templates">here</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-359104377f9341d4c326d45fb209b4c2">4.2.5 - External authentication</h1>
    
	<p>IAM supports brokered authentication via standard OpenID-Connect and SAML
protocols as well as X.509 authentication.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-cee8377dbff27d67a12761bb25f74def">4.2.5.1 - OpenID-Connect authentication</h1>
    
	<p>IAM supports brokered OpenID Connect authentication to external identity
providers (e.g., Google).</p>
<p>When brokered OpenID Connect authentication is turned on a IAM instance, users
can log into the service delegating authentication to one of the supported
OpenID Connect providers (OP).</p>
<p>To enable brokered OpenID Connect authentication on your IAM instance you have to:</p>
<ol>
<li>Obtain client credentials and other configuration details for each of the
external OpenID Connect providers;</li>
<li>Provide the OIDC configuration file defining the configuration of the supported OPs;</li>
<li>Enable the <code>oidc</code> profile.</li>
</ol>
<h2 id="obtain-op-configuration-and-client-credentials">Obtain OP configuration and client credentials</h2>
<p>In order to act as a relying party (RP) for an external OpenID Connect provider (OP), IAM
will need at least:</p>
<ul>
<li>client credentials (a clientId and clientSecret);</li>
<li>an <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig">OpenID Connect provider discovery endpoint URL</a>;</li>
</ul>
<p>As an example, see the the <a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google identity platform OpenID Connect
guide</a> for help on this.</p>
<h2 id="provide-the-oidc-configuration">Provide the OIDC configuration</h2>
<h3 id="google-configuration">Google configuration</h3>
<p>If Google is the only OpenID Connect provider you want to support, the configuration
embedded in the IAM war file already provides what you need, and you just need to:</p>
<ul>
<li>
<p>Enable the <code>oidc</code> profile;</p>
</li>
<li>
<p>Pass the google client credentials to IAM via the following environment
variables:</p>
<ul>
<li><code>IAM_GOOGLE_CLIENT_ID</code></li>
<li><code>IAM_GOOGLE_CLIENT_SECRET</code></li>
</ul>
</li>
</ul>
<h3 id="multiple-providers-configuration">Multiple providers configuration</h3>
<p>To configure multiple providers, or to override the default configuration, you must
provide an <code>application-oidc.yaml</code> configuration file and make it available to IAM.</p>
<p>Trusted OPs are configured for IAM via the <code>application-oidc.yaml</code> configuration file.</p>
<p>This is a Spring Boot configuration file that is activated when the <code>oidc</code> profile is turned on.</p>
<p>The default configuration file, embedded in the IAM war file, supports the
configuration of a single provider, Google, for backward compatibility, and looks
like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">oidc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">providers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://accounts.google.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openid,profile,email,address,phone</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">btn-social btn-google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fa-icon</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>This configuration allows to configure support for Google by:</p>
<ul>
<li>activating the <code>oidc</code> profile;</li>
<li>Setting the <code>IAM_GOOGLE_CLIENT_ID</code> and <code>IAM_GOOGLE_CLIENT_SECRET</code> environment
variables to provide the Google client credentials;</li>
</ul>
<p>To enable multiple providers, you need to override the default oidc configuration.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">oidc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">providers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://accounts.google.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openid,profile,email,address,phone</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">btn-social btn-google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fa-icon</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">egi-checkin</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_ISSUER}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_SCOPE:openid,profile,email}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EGI CheckIn</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Sign in with EGI CheckIn</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://egi.eu/wp-content/uploads/2016/05/cropped-logo_site-1-300x300.png</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">medium</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>The example configuration above shows how to configure support for Google and
the <code>EGI CheckIn</code> provider, with a custom button configuration for the CheckIn
provider.</p>
<p>See the <a href="/docs/reference/configuration/#overriding-default-configuration-templates">configuration reference</a> for instructions on how to override
the default IAM configuration.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5bf3dce2c99e5619768b49664c510ead">4.2.5.2 - SAML authentication</h1>
    
	<p>IAM supports brokered SAML authentication. When SAML authentication is turned
on for an IAM instance, users can log into the service using the home Identity
Provider (IdP) credentials.</p>
<p>To enable SAML authentication for your IAM instance you have to:</p>
<ul>
<li>Choose an <code>entityId</code> for your IAM instance; see the <a href="https://wiki.shibboleth.net/confluence/display/CONCEPT/EntityNaming">Shibboleth
docs</a> for guidance on this</li>
<li>Generate a self-signed certificate for your IAM instance that will be used
for SAML cryptographic operations and include it in a Java keystore;</li>
<li>Obtain SAML metadata from your IdP or identity federation;</li>
<li>If the metadata is signed, import the certificate that must be used to verify
the signature in the Java keystore generated above;</li>
<li>Enable the <code>saml</code> profile for the IAM and configure SAML support via the
appropriate environment variables.</li>
</ul>
<h2 id="generate-a-self-signed-certificate">Generate a Self-signed certificate</h2>
<p>To generate a self-signed certificate that lasts 5 years use the following
openssl command:</p>
<pre><code class="language-console" data-lang="console">openssl req -newkey rsa:2048 -nodes -x509 -days 1825  -keyout self-signed.key.pem \
  -out self-signed.cert.pem
</code></pre><p>The above command will generate a private key and the corresponding certificate
in PEM format. You will be asked to provide a subject for the certificate being
generated.</p>
<p>To import this certificate in a Java keystore we need in in p12 format. Use the
following commands to convert the certificate in p12 format and import it in a
Java keystore:</p>
<pre><code class="language-console" data-lang="console">openssl pkcs12 -export -inkey self-signed.key.pem \
    -name self-signed \
    -in self-signed.cert.pem \
    -out self-signed.p12

keytool -importkeystore -destkeystore self-signed.jks \
    -srckeystore self-signed.p12 \
    -srcstoretype PKCS12
</code></pre><p>During the above process you will be asked to provide a p12 export password and
a keystore password. Use the same password, at least 6 characters long,
otherwise it will not work for the java keystore.</p>
<p>You can list the contents of the keystore with the following command:</p>
<pre><code class="language-console" data-lang="console">keytool -list -keystore self-signed.jks
</code></pre><h2 id="obtain-saml-metadata-for-your-idp-or-identity-federation">Obtain SAML metadata for your IdP or identity federation</h2>
<p>You IdP or identity federation will have a SAML metadata document describing,
in SAML terms, which authentication flows are enabled and providing access to
cryptographic material and other information that make the federated
authentication schemes work reliably and securely. For more information on SAML
metadata, see <a href="https://wiki.shibboleth.net/confluence/display/CONCEPT/Metadata">the Shibboleth metadata documentation</a>.</p>
<h3 id="signed-metadata-advice">Signed metadata advice</h3>
<p>Typically identity federations sign the SAML metadata for security reasons, and
provide a certificate (and linked public key) that can be used to verify
signatures on the metadata at a well-known location (e.g., the federation
website).</p>
<p>To support metadata signature verification you will need to import this
certificate in the Java keystore created above.</p>
<p>Certificates are typically published in PEM format, while to import a
certificate in a Java keystore you will need it in DER format.</p>
<p>The following commands show how to import a PEM certificate into a Java
keystore:</p>
<pre><code class="language-console" data-lang="console">openssl x509 -outform der -in idem_signer_2019.pem -out idem_signer_2019.der
keytool -import -alias idem_signer_2019 -keystore self-signed.jks -file idem_signer_2019.der
</code></pre><h3 id="metadata-configuration">Metadata configuration</h3>
<p>The IdP or federation metadata to be trusted can be specified with the
<code>IAM_SAML_IDP_METADATA</code> environment variable, which contains an URL pointing to
the metadata.</p>
<p>If the metadata is signed, you can enforce signature validation with the
<code>IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</code> variable.</p>
<p>Metadata needs to be periodically refreshed to learn about new entities in the
federation or updated key material. The metadata refresh interval can be
specified with the <code>IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</code>
environment variable, which defines a refresh period in seconds (a reasonable
value is typically refresh metadata every hour).</p>
<p>An example metadata configuration could be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>http://www.garr.it/idem-metadata/idem-metadata-sha256.xml
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3600</span>
</code></pre></div><h2 id="iam-saml-attribute-requirements">IAM SAML attribute requirements</h2>
<p>IAM requires that the IdP used for authentication releases a persistent
identifier attribute that can be used to link the external identity to local
IAM accounts. If the IdP does not release persistent identifier attributes, it
<strong>cannot</strong> be integrated with the IAM.</p>
<p>The attribute used to link the external SAML account is configurable. In the
default configuration, IAM uses the following attributes (in the given order):</p>
<ol>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonUniqueId">EduPersonUniqueId</a></li>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonTargetedID">EduPersonTargetedId</a></li>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonPrincipalName">EduPersonPrincipalName</a></li>
</ol>
<p>The order of these can be changed with the <code>IAM_SAML_ID_RESOLVERS</code> environment variable,
which accepts a list of aliases for the attributes to be searched.</p>
<p>The following tables maps attribute names to the aliases currently supported:</p>
<table>
<thead>
<tr>
<th>SAML attribute</th>
<th>Alias</th>
</tr>
</thead>
<tbody>
<tr>
<td>EduPersonUniqueId</td>
<td>eduPersonUniqueId</td>
</tr>
<tr>
<td>EduPersonTargetedId</td>
<td>eduPersonTargetedId</td>
</tr>
<tr>
<td>EduPersonPrincipalName</td>
<td>eduPersonPrincipalName</td>
</tr>
<tr>
<td>EduPersonOrcid</td>
<td>eduPersonOrcid</td>
</tr>
<tr>
<td>spidCode</td>
<td>spidCode</td>
</tr>
</tbody>
</table>
<p>The default value for IAM_SAML_ID_RESOLVERS is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_ID_RESOLVERS</span><span style="color:#ce5c00;font-weight:bold">=</span>eduPersonUniqueId,eduPersonTargetedId,eduPersonPrincipalName
</code></pre></div><h2 id="checking-saml-assertion-and-authentication-freshness">Checking SAML assertion and authentication freshness</h2>
<p>IAM provides the ability to set a maximum age for SAML assertion and
authentication statements received from IdPs.</p>
<p>The <code>IAM_SAML_MAX_ASSERTION_TIME</code> allows to define an upper bound (in seconds)
on the SAML assertion lifetime, so that assertions that exceed such limit are
considered invalid.</p>
<p>The <code>IAM_SAML_MAX_AUTHENTICATION_AGE</code> allows to define an upper bound (in
seconds) on the authentication age linked to SAML authentication statements, so
that users are forced to reauthenticate when this limit is exceeded.</p>
<h2 id="limiting-authentication-only-to-selected-idps">Limiting authentication only to selected IdPs</h2>
<p>IAM provides the ability to define constraints on which IdPs will be allowed
for authentication. This is useful when you want to limit which IdPs in a large
federation (e.g., <a href="https://edugain.org/">EduGAIN</a>) will be trusted for authentication.</p>
<p>Currently three types of IdPs limiting are supported:</p>
<ul>
<li>entity id whitelist</li>
<li>SIRTFI compliance</li>
<li>Research and Scholarship compliance</li>
</ul>
<h3 id="limiting-by-entity-id">Limiting by entity id</h3>
<p>The <code>IAM_SAML_IDP_ENTITY_ID_WHITELIST</code> environment variable can be used to
define a comma-separated whitelist of IdPs entity IDs that will be trusted for
authentication.</p>
<p>The following example limits trusted IdPs to the INFN IdP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_IDP_ENTITY_ID_WHITELIST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://idp.infn.it/saml2/idp/metadata.php&#34;</span>
</code></pre></div><h3 id="limiting-by-sirtfi-compliance">Limiting by SIRTFI compliance</h3>
<p>To limit authentication only to IdPs that are <a href="https://refeds.org/sirtfi">SIRFTI</a>-compliant, set
the the <code>IAM_SAML_METADATA_REQUIRE_SIRTFI</code> environment variable to true.</p>
<h2 id="customizing-saml-login-button-text">Customizing SAML login button text</h2>
<p>You can customize the SAML login button text shown in the IAM login page with
the <code>IAM_SAML_LOGIN_BUTTON_TEXT</code> environment variable.</p>
<h2 id="minimal-saml-configuration-example">Minimal SAML configuration example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_ENTITY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:example:iam-saml-example
<span style="color:#000">IAM_SAML_KEYSTORE</span><span style="color:#ce5c00;font-weight:bold">=</span>file:///self-signed.jks
<span style="color:#000">IAM_SAML_KEYSTORE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx
<span style="color:#000">IAM_SAML_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>self-signed
<span style="color:#000">IAM_SAML_KEY_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx
<span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>http://www.garr.it/idem-metadata/idem-metadata-sha256.xml
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3600</span>
<span style="color:#000">IAM_SAML_LOGIN_BUTTON_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Sign in with IDEM&#34;</span>
</code></pre></div><h2 id="custom-saml-configuration">Custom SAML configuration</h2>
<p>The configuration based on environment variables relies on a <a href="https://raw.githubusercontent.com/indigo-iam/iam/v1.7.0/iam-login-service/src/main/resources/application-saml.yml">configuration
template</a> that fits most use cases embedded in the IAM war
file.</p>
<p>To have full control on the SAML configuration, provide a custom
<code>application-saml.yml</code> file in the IAM configuration directory.</p>
<p>See the <a href="/docs/reference/configuration">configuration reference</a> for more SAML metadata options and
instructions on how to override the default IAM configuration.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e6e021be71af3761af40968d69e6df70">4.2.5.3 - X.509 authentication</h1>
    
	
</div>



    
	
  

    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f8918f697450c2009b75913f9e9317a5">5 - Tasks</h1>
    <div class="lead">Common administration &amp; usage tasks</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-18193143b4ee08bf7ab15851bbaded55">5.1 - IAM organization administration</h1>
    <div class="lead">IAM administration tasks &amp; useful information</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-2c051a32f27ba9097cfdeda817a84e30">5.1.1 - User management</h1>
    
	<p>IAM provides tools to manage users in an organization.
All the actions described below require administrator privileges.</p>
<h2 id="creating-a-user-account">Creating a user account</h2>
<p>A new user account in the organization can be created from the &ldquo;Users&rdquo;
management panel by clicking on the &ldquo;Add user&rdquo; button at the bottom of the
page:</p>
<p><img src="../images/add-user.png" alt="Add user"></p>
<p>A dialog is shown that allows to set basic user information:</p>
<p><img src="../images/add-user-2.png" alt="Add user 2"></p>
<h2 id="deleting-a-user-account">Deleting a user account</h2>
<p>User accounts can be deleted from the &ldquo;Users management&rdquo; section of the
dashboard by clicking on the delete button for the users that should be
deleted:</p>
<p><img src="../images/delete-users.png" alt="Delete user"></p>
<h2 id="disabling-a-user-account">Disabling a user account</h2>
<p>User accounts can be disabled from the user home page by clicking on the
&ldquo;Disable user&rdquo; button. Disabled users are not allowed to login in the IAM and,
as such, cannot authenticate at any services that rely on the IAM for
authentication and authorization.</p>
<p><img src="../images/disable-user.png" alt="Disable user"></p>
<h2 id="managing-user-account-privileges">Managing user account privileges</h2>
<p>Administrator privileges can be assigned to a user from the user home page by
clickin on the &ldquo;Assign administrator privileges&rdquo; button:</p>
<p><img src="../images/assign-admin-privileges.png" alt="Assign admin privileges"></p>
<h2 id="managing-external-user-account-identities">Managing external user account identities</h2>
<p>Administrators can manually add and remove external accounts and certificates
for a local user account from the user home page:</p>
<p><img src="../images/manage-credentials.png" alt="Manage credentials"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ff12c9bf3d6558e0104e7c891e85c453">5.1.2 - Group Management</h1>
    
	<p>IAM provides a group management system, that can be used by IAM administrators
to create groups, remove existing ones and manage membership in the group.</p>
<p>Groups can be organized in a hierarchical structure, with the following constraints:</p>
<ul>
<li>a group can have only a parent group;</li>
<li>a group can have many childrens.</li>
</ul>
<h1 id="manage-groups-using-the-web-interface">Manage groups using the web interface</h1>
<p>The simplest way to manage groups is using the IAM dashboard.</p>
<h2 id="creating-a-group">Creating a group</h2>
<p>From the home page, open the <em>Groups</em> section and click the <em>Add group</em> button:</p>
<p><img src="../images/IAM-groups-01.png" alt="INDIGO IAM Add Group button"></p>
<p>To create a group, specify a group name. If the created group is a subgroup of
an already existing group, the parent group can be selected via a dialog.</p>
<p>Note that IAM allows for multiple root level groups.</p>
<p><img src="../images/IAM-groups-02.png" alt="INDIGO IAM Parent group creation"></p>
<p><img src="../images/IAM-groups-03.png" alt="INDIGO IAM Child group creation"></p>
<p>A new children group can also be created from the parent group details page.</p>
<p><img src="../images/IAM-groups-04.png" alt="INDIGO IAM Add Subgroup button"></p>
<h2 id="deleting-a-group">Deleting a group</h2>
<p>From the groups list page, click on the corresponding <em>Remove</em> button.
A confirmation window will be opened, so you can confirm or abort the
the delete operation.</p>
<p><img src="../images/IAM-groups-05.png" alt="INDIGO IAM Group removal"></p>
<p><strong>Only empty groups can be removed. If you try to remove a group
with a child group or with user members, the operation fails with an error.</strong></p>
<h2 id="managing-membership-for-a-group">Managing membership for a group</h2>
<p>To add a user to a group open the user details page.
In the <em>Groups</em> section, click on the <em>Add to group</em> button:</p>
<p><img src="../images/IAM-groups-06.png" alt="INDIGO IAM Add group to user button"></p>
<p>Choose one or more groups and confirm the operation:</p>
<p><img src="../images/IAM-groups-07.png" alt="INDIGO IAM Add group membership"></p>
<p>When a user is added as member of a group, he/she does not inherit the
membership in the parent group, i.e. the user must be explicitly associated
with all the groups.</p>
<p>To remove a user from a group, click the <em>Remove</em> button.</p>
<p>Members can also be removed from the group details page, as shown in the
following screenshot:</p>
<p><img src="../images/IAM-groups-08.png" alt="INDIGO IAM Members list"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0af4d8b64c334906ff63d946a0432cb3">5.1.3 - Acceptable Usage Policy (AUP) management</h1>
    
	<p>Starting with version 1.2.0, IAM supports defining an <strong>Acceptable Usage Policy
Document (AUP)</strong> for a managed organization. The AUP is presented to applicants
at registration time or periodically.</p>
<h2 id="managing-the-aup">Managing the AUP</h2>
<p>The AUP can be managed from the &ldquo;AUP&rdquo; section in the IAM dashboard, or via the
<a href="/docs/reference/api/aup-api">AUP management API</a>.</p>
<p>Administrator privileges are required.</p>
<h3 id="creating-the-aup">Creating the AUP</h3>
<p>By default, the AUP is not defined for an organization, i.e. it must be
explicitly defined by an IAM administrator.</p>
<p>The AUP can be created by clicking on the &ldquo;Create AUP&rdquo; button in the AUP
management page (that can be reached clicking the &ldquo;AUP&rdquo; link in the organization
Management navigation bar):</p>
<p><img src="../images/aup0.png" alt="AUP management 0"></p>
<p>A dialog is shown:</p>
<p><img src="../images/aup1.png" alt="AUP management 1"></p>
<p>where the administrator can enter the AUP URL and define how frequently the
AUP should be accepted by users.</p>
<p>If the AUP signature validity is set to 0, a signature on the AUP will be
requested only once (either at registration time or at the first IAM login
after the AUP creation). A zero value means basically that the AUP signature
does not expire.</p>
<p>A positive value in the AUP signature validity means, on the other hand, that
the signature will expire after that number of days. As an example, an
administrator that wants the AUP to signed each year by users should put 365 in
the &ldquo;AUP signature validity&rdquo; field.</p>
<h3 id="editing-and-deleting-the-aup">Editing and deleting the AUP</h3>
<p>The AUP can be edited and deleted from the AUP management page:</p>
<p><img src="../images/aup2.png" alt="AUP management 2"></p>
<p>Since version 1.6.0, the AUP has been converted from text to a URL.
If you have just upgraded to 1.6.0 and you have already defined a text AUP,
you should see the following red message below your AUP:</p>
<p><img src="../images/aup1b.png" alt="AUP management 1b"></p>
<p>By clicking on &ldquo;Edit AUP&rdquo;, admins are prompted to insert a valid URL.</p>
<p><img src="../images/aup5.png" alt="AUP management 5"></p>
<p>As shown in the picture above, editing the AUP will not trigger an AUP signature request.</p>
<h3 id="request-a-signature-from-users">Request a signature from users</h3>
<p>If you want to request a signature from users for the updated AUP,
use the &ldquo;Request AUP signature&rdquo; button in the AUP management page.</p>
<p>A dialog is shown:</p>
<p><img src="../images/aup6.png" alt="AUP management 6"></p>
<p>Confirm by clicking on &ldquo;Request AUP signature&rdquo; and the acceptance of the AUP
will be requested from ALL users at their next login.</p>
<h2 id="signing-the-aup">Signing the AUP</h2>
<p>Once defined the AUP text is shown to users for acceptance either
at registration time:</p>
<img src="../images/aup3.png" width="500">
<p>or at the first login after the AUP creation:</p>
<img src="../images/aup4.png" width="500">

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d446af92e463090d9e1b94f286038c9">5.2 - IAM service deployment</h1>
    <div class="lead">IAM service deployment tasks &amp; information</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-5d089d6d346a3d6d95efe8ed3f4f3b59">5.2.1 - Backup &amp; Restore</h1>
    
	<h2 id="backup">Backup</h2>
<p>The IAM data that needs to saved by a backup is:</p>
<ul>
<li>database data;</li>
<li>service configuration, typically maintained in an environment file: <code>/etc/sysconfig/iam-login-service</code> on CentOS, <code>/etc/default/iam-login-service</code> on Ubuntuu;</li>
<li>the keystore used to sign JWT tokens: <code>/var/lib/indigo/iam-login-service/keystore.jks</code>;</li>
<li>the SAML keystore, used when SAML authentication is enabled: <code>/var/lib/indigo/iam/iam-login-service/example.ks</code>.</li>
</ul>
<p>The above locations apply when installing from packages on CentOS or Ubuntu.</p>
<p>An example of backup script is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">timestamp</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">`</span>date +<span style="color:#4e9a06">&#39;%Y-%m-%d_%H%M%S&#39;</span><span style="color:#4e9a06">`</span>

<span style="color:#000">MYSQL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mydbhost&#34;</span>
<span style="color:#000">MYSQL_USER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginserviceuser&#34;</span>
<span style="color:#000">MYSQL_PWD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicepassword&#34;</span>
<span style="color:#000">MYSQL_DBNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicedb&#34;</span>

<span style="color:#000">MYSQL_DUMP_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;-u </span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_USER</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> -p</span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_PWD</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> --host </span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_HOST</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>

<span style="color:#000">dumpfile</span><span style="color:#ce5c00;font-weight:bold">=</span>iam_dump.sql

mysqldump <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DUMP_OPTS</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DBNAME</span><span style="color:#4e9a06">}</span> &gt; <span style="color:#4e9a06">${</span><span style="color:#000">dumpfile</span><span style="color:#4e9a06">}</span>

tar czf iam_backup.tar.gz <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">${</span><span style="color:#000">dumpfile</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /etc/sysconfig/iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /var/lib/indigo/iam-login-service/keystore.jks <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /var/lib/indigo/iam/iam-login-service/example.ks
</code></pre></div><p>The keystore paths can be customized, so adapt the backup script according your configuration.</p>
<p>If you are deploying IAM with Docker and use a volume to provide configuration
to the service, backup the contents of such volume.</p>
<h2 id="restore">Restore</h2>
<p>From the backup, import the database data from the SQL dump:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mydbhost&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_USER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginserviceuser&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_PWD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicepassword&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_DBNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicedb&#34;</span>

$ mysql --host <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_HOST</span><span style="color:#4e9a06">}</span> -u <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_USER</span><span style="color:#4e9a06">}</span> -p<span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_PWD</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DBNAME</span><span style="color:#4e9a06">}</span> &lt; iam_backup/iam_dump.sql
</code></pre></div><h3 id="deployment-from-packages">Deployment from packages</h3>
<p>To restore the IAM service from scratch, install the package.</p>
<p>On CentOS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y iam-login-service
</code></pre></div><p>Restore the environment file.</p>
<p>On CentOS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/etc/sysconfig/iam-login-service /etc/sysconfig/iam-login-service
</code></pre></div><p>On Ubuntu:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/etc/default/iam-login-service /etc/default/iam-login-service
</code></pre></div><p>Copy the keystores in the correct path, according to your configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/var/lib/indigo/iam-login-service/keystore.jks /var/lib/indigo/iam-login-service/keystore.jks
$ sudo cp iam_backup/var/lib/indigo/iam/iam-login-service/example.ks /var/lib/indigo/iam/iam-login-service/example.ks
</code></pre></div><p>Ensure the keystores have the right ownership:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo chown -R iam:iam /var/lib/indigo/iam-login-service
</code></pre></div><p>Start the IAM Login Service daemon:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl start iam-login-service
</code></pre></div><h3 id="deployment-with-docker">Deployment with Docker</h3>
<p>Copy the files from the backup to the volume location:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cp iam_backup/iam-login-service/env /path/to/iam-login-service/env
$ cp iam_backup/keystore.jks /path/to/keystore.jks
</code></pre></div><p>Start the container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:latest
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-72263be5cb6d3466ca85fd5f75107c79">5.2.2 - Audit log</h1>
    
	<p>IAM Login Service traces interesting, security related events with an audit log.</p>
<p>Audit log messages are marked with the tag <code>AUDIT</code> in the Java class name
field.</p>
<p>An example of audit log message is the following:</p>
<pre><code class="language-console" data-lang="console">2017-09-11 09:58:14.560  INFO 13 --- [o-8080-exec-311] AUDIT : {&quot;@type&quot;:&quot;IamAuthenticationSuccessEvent&quot;,&quot;timestamp&quot;:1505116694560,&quot;category&quot;:&quot;AUTHENTICATION&quot;,&quot;principal&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e&quot;,&quot;message&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e authenticated succesfully&quot;,&quot;sourceEvent&quot;:{&quot;principal&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e&quot;,&quot;type&quot;:&quot;InteractiveAuthenticationSuccessEvent&quot;},&quot;source&quot;:&quot;UsernamePasswordAuthenticationToken&quot;}
</code></pre><p>The IAM login service writes logs to standard output in the default
configuration. When deployed from packages, all logs are collected by the
system journal.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-80f57e3c8e02d141aae66942670e5535">5.2.3 - Upgrade</h1>
    
	<p>This section provides instructions to upgrade the IAM service to the latest
available version.</p>
<h3 id="deployment-from-packages">Deployment from packages</h3>
<p>Stop the service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ systemctl stop iam-login-service
</code></pre></div><p>Update the package:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ yum update -y iam-login-service
</code></pre></div><p>Restart the service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ systemctl start iam-login-service
</code></pre></div><h3 id="deployment-with-docker">Deployment with Docker</h3>
<p>Stop and remove the running container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker stop iam-login-service
$ docker rm iam-login-service
</code></pre></div><p>Pull the latest image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker pull indigoiam/iam-login-service:latest
</code></pre></div><p>Restart the container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:latest
</code></pre></div><p>Otherwise, you can specify the exact tag version. For example, if the latest
tag is <code>v1.1.0-latest</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.1.0-latest
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dbcc046a6c208e0a089e20aecc2dbaec">5.3 - User</h1>
    <div class="lead">Common user tasks</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-7d8a8f8d5b0f979b1c8c82a81bf939a4">5.3.1 - Joining an IAM-managed organization</h1>
    
	<p>IAM provides a registration service that allows to have managed enrollment for
the organization under control. This mean that access to the organization is
only granted after explicit approval by a IAM administrator for the
organization.</p>
<h2 id="submitting-a-registration-request">Submitting a registration request</h2>
<p>Users can submit a registration request from the IAM login page in two ways:</p>
<ul>
<li>By clicking the <em>Register a new account</em> button:</li>
</ul>
<p><img src="../images/IAM-registration-1.png" alt="INDIGO IAM Registration button"></p>
<ul>
<li>By attempting a login with an external authentication provider such as Google
or a configured SAML IdP: in this case if the external authentication
succeeds and the authenticated user is not registered in the IAM the user is
taken to the registration form to confirm the registration requests.</li>
</ul>
<p><img src="../images/IAM-registration-2.png" alt="INDIGO IAM Registration form"></p>
<p>All the fields in the registration form are mandatory. The <em>notes</em> field can
used to include extra information targeted at IAM administrators to clarify the
reasons behind a registration request.</p>
<h2 id="confirming-a-registration-request">Confirming a registration request</h2>
<p>If the submission ends successfully, an email verification link is sent to the
user email address with a request to confirm his registration request.</p>
<p><img src="../images/IAM-registration-3.png" alt="INDIGO IAM Registration validation page"></p>
<p>Once the request is confirmed, IAM administrators are notified with an email.</p>
<h2 id="choosing-a-password">Choosing a password</h2>
<p>Once the submitteed request is approved by an IAM administrator, an email is
sent to the user with a reset password link. This URL points to page where the
user can choose a password for the IAM account.</p>
<p><img src="../images/IAM-registration-5.png" alt="INDIGO IAM Registration change password form"></p>
<p>Once the password is set, users can login to the IAM using the username chosen
at registration time and the password.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3f5cbf21bf0cdcf7173175718d59c4c1">5.3.2 - Obtaining an IAM access token from a CLI</h1>
    
	<p>A token can be obtained from a command-line interface (CLI) in two ways:</p>
<ul>
<li>using <code>oidc-agent</code></li>
<li>using scripts linked to this page, using the resource-owner password
credentials flow or the OAuth device flow</li>
</ul>
<p>In this section we recommend the installations of a set of tools that can help
in managing tokens.</p>
<h2 id="obtaining-a-token-using-oidc-agent">Obtaining a token using <code>oidc-agent</code></h2>
<p><a href="https://github.com/indigo-dc/oidc-agent">oidc-agent</a> is a useful tool to easily get and manage access
tokens for command-line applications.</p>
<h3 id="installing-oidc-agent">Installing oidc-agent</h3>
<p>See <a href="https://indigo-dc.gitbook.io/oidc-agent/installation/install">oidc-agent installation
instructions</a>.</p>
<h4 id="quick-centos7-installation-instructions">Quick CENTOS7 installation instructions</h4>
<p>This recipe shows how to quickly install <code>oidc-agent</code> on CENTOS 7.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yum -y install epel-release
$ yum -y install https://github.com/indigo-dc/oidc-agent/releases/download/v3.3.1/oidc-agent-3.3.1-1.el7.x86_64.rpm
</code></pre></div><h3 id="bootstrapping-oidc-agent">Bootstrapping oidc-agent</h3>
<p>The first thing to do is to start <code>oidc-agent</code>.
This can be done issuing the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">eval</span> <span style="color:#204a87;font-weight:bold">$(</span>oidc-agent<span style="color:#204a87;font-weight:bold">)</span>
Agent pid <span style="color:#0000cf;font-weight:bold">62088</span>
</code></pre></div><h3 id="registering-a-client">Registering a client</h3>
<p>In order to obtain a token out of IAM, a user needs a client registered.
<code>oidc-agent</code> can automate this step and store client credentials securely
on the user machine.</p>
<p>A new client can be registered using the <code>oidc-gen</code> command, as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ oidc-get -w device wlcg
</code></pre></div><p>The <code>-w device</code> instructs <code>oidc-agent</code> to use the device code flow for the
authentication, which is the recommended way with IAM.</p>
<p>oidc-agent will display a list of different providers that can be used for
registration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>1<span style="color:#ce5c00;font-weight:bold">]</span> https://wlcg.cloud.cnaf.infn.it/
<span style="color:#ce5c00;font-weight:bold">[</span>2<span style="color:#ce5c00;font-weight:bold">]</span> https://iam-test.indigo-datacloud.eu/
...
<span style="color:#ce5c00;font-weight:bold">[</span>20<span style="color:#ce5c00;font-weight:bold">]</span> https://oidc.scc.kit.edu/auth/realms/kit/
</code></pre></div><p>Select one of the registered providers, or type a custom issuer (for IAM, the
last character of the issuer string is always a <code>/</code>, e.g.
<code>https://wlcg.cloud.cnaf.infn.it/</code>).</p>
<p>Then oidc-agent asks for the scopes, typing <code>max</code> (without quotes) allows to
get all the allowed scopes.</p>
<p>oidc-agent will register a new client and store the client credentials and a
refresh token locally in encrypted form (the agent will ask for a password from
the user).</p>
<h3 id="getting-tokens">Getting tokens</h3>
<p>Tokens can be obtained using the <code>oidc-token</code> command, as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token wlcg
</code></pre></div><p>This will request a token with all the scopes requested at client registration
time. To limit the scopes included in the token, the <code>-s</code> flag can be used, as
follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token -s storage.read:/ wlcg
</code></pre></div><p>The token audience can be limited using the <code>--aud</code> flag,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token --aud example.audience -s storage.read:/ wlcg
</code></pre></div><h2 id="obtaining-a-token-with-the-password-flow">Obtaining a token with the password flow</h2>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-4.3">password flow</a> allows a user to get a token from the
IAM by using the IAM local credentials (i.e. the username/password credentials
setup at IAM registration time).</p>
<p>In order to use the password flow, a non-privileged user has to:</p>
<ol>
<li>register a client following the instructions given in [the client
registration][client-registration] section</li>
<li>Note down the <code>client_id</code> of the generated client and ask an IAM
administrator to enable the password flow for such client</li>
<li>Wait until the client as the password flow enabled</li>
<li>Use a script similar to the one given <a href="https://gist.github.com/andreaceccanti/7d863db5ce3f43c74123a2cea8b8f9ff">here</a> (or write
your own following the recommendations of the <a href="https://tools.ietf.org/html/rfc6749#section-4.3">RFC</a>) to
obtain a token out of the IAM</li>
</ol>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>While this approach is viable, it is <strong>deprecated</strong> since:</p>
<ul>
<li>it forces the user to request the activation of the password flow for the
client (it is disabled by default for dynamically registered clients)</li>
<li>it forces the user to authenticate with the local IAM credentials (external
authentication mechanisms such as Google or SAML cannot be used)</li>
<li>it exposes the user credentials to the client application</li>
</ul>
<p>The device code flow, described in the next section, does not have these
limitations and should be preferred over the password flow.</p>


</div>

<h2 id="obtaining-a-token-with-the-device-code-flow">Obtaining a token with the device code flow</h2>
<p>The <a href="https://tools.ietf.org/html/draft-ietf-oauth-device-flow-09">device code flow</a> allows a user to get a token
from the IAM from a CLI interface while using an external browser for the
authentication step. This is convenient since:</p>
<ul>
<li>it does not require any authorization from administrators (the device code
flow can be requested by the user at client registration time)</li>
<li>it allows the user to authenticate with any of the authentication mechanisms
supported by the IAM</li>
<li>it <strong>does not</strong> expose the user credentials to the client application</li>
</ul>
<p>For nitty and gritty details on how the flow works, see the
<a href="https://tools.ietf.org/html/draft-ietf-oauth-device-flow-09">RFC</a>.</p>
<p>After having registered a client with the device flow enabled (see <a href="client-registration.md">client
registration section</a>), the device code flow can be
used to obtain a token using a script like the one <a href="https://gist.github.com/andreaceccanti/5b69323b89ce08321e7b5236de503600">here</a>
which does the following:</p>
<ul>
<li>contacts the device flow endpoint to start a device flow authentication and
authorization</li>
<li>prints code information on the terminal</li>
<li>waits for user input to proceed and obtain the token(s)</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-01f88f6873f44e2e7cfcdffdd6fb2816">5.3.3 - Registering a client</h1>
    
	<p>IAM exposes the OpenID Connect/OAuth dynamic client registration functionality
offered by the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect</a> server libraries.</p>
<p>In OAuth terminology, a client is an application or service that can interact
with an authorisation server for authentication/authorization purposes.</p>
<p>A new client can be registered in the IAM in two ways:</p>
<ul>
<li>using the <a href="/docs/reference/api/oidc-client-registration/">dynamic client registration API</a>;</li>
<li>via the IAM dashboard (which simply acts as a client to the API mentioned
above).</li>
</ul>
<h2 id="registering-a-client-using-the-dashboard">Registering a client using the dashboard</h2>
<p>Log into the service and click on the <em>MitreID dashboard</em> link on the left
navigation bar:</p>
<p><img src="../images/mitre-dashboard.png" alt="Mitre dashboard"></p>
<p>From the MitreID dashboard, select <em>Client registration</em>:</p>
<p><img src="../images/mitre-client-reg-0.png" alt="Mitre client reg"></p>
<p>And then click on <em>New client</em>:</p>
<p><img src="../images/mitre-client-reg-1.png" alt="Mitre client reg"></p>
<p>A form will open that enable you to configure your client:</p>
<p><img src="../images/mitre-client-reg-2.png" alt="Mitre client reg"></p>
<p>The minimum information you have to provide is:</p>
<ul>
<li><em>client name</em>: choose a name for your client</li>
<li><em>Redirect URI(s)</em>: one or more redirect URIs for your client; these are
required if you choose to enable the authorization code flow;</li>
</ul>
<p><img src="../images/mitre-client-reg-3.png" alt="Mitre client reg"></p>
<p>Remember to select the <code>offline_access</code> scope from the <strong>Access tab</strong> if you
want to request refresh tokens for the client being created:</p>
<p><img src="../images/mitre-client-reg-4.png" alt="Mitre client reg"></p>
<p>You can then click the &ldquo;Save&rdquo; button at the bottom of the page:</p>
<p><img src="../images/mitre-client-reg-5.png" alt="Mitre client reg"></p>
<p>IAM will then generate client credentials for your client and other information
that will be displayed as follows:</p>
<p><img src="../images/mitre-client-reg-6.png" alt="Mitre client reg"></p>
<p>The JSON tab provides client information in JSON:</p>
<p><img src="../images/mitre-client-reg-8.png" alt="Mitre client reg"></p>
<p>Select the content of the text area and paste it in a local file, for future
reference.</p>
<p>The JSON file contains the client secret and the registration access token,
which can be used later to change the client configuration or to delete the
client.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a22a3b0b99e400fc5ef266bb68b93233">5.3.4 - Change account information</h1>
    
	<p>Once logged in, you can change information in your account (if allowed by the
IAM configuration) by clicking the &ldquo;Edit Details&rdquo; from your home page:</p>
<p><img src="../images/change-details.png" alt="Change details"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0fcad7ff414ad3eacd9acb70a4d8bd64">5.3.5 - Changing the account password</h1>
    
	<p>Once logged in you can change your account password by clicking on the &ldquo;Change
password&rdquo; button in your home page:</p>
<p><img src="../images/change-password.png" alt="Change password"></p>
<p>Note that the &ldquo;Change password&rdquo; functionality is only useful if you remember
your IAM account password. In case you forgot it, logout from the IAM and
follow the instructions in the <a href="../reset-password">Reset account password</a>
section.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bbf139877831b082e901ece0d36cbb3b">5.3.6 - Linking an external account</h1>
    
	<p>A user can link an external account from the IAM dashboard (i.e., the user must
be logged in the IAM service). The following sets of screenshots show the
process followed to link a Google account.</p>
<p><img src="../images/account-linking-google-1.png" alt="IAM link google account"></p>
<p>Clicking on the &ldquo;Link Google account&rdquo; opens a confirmation dialog:</p>
<p><img src="../images/account-linking-google-2.png" alt="IAM link google account"></p>
<p>When the user clicks on the <strong>Link</strong>, button is redirected to Google for
authentication:</p>
<p><img src="../images/account-linking-google-3.png" alt="IAM link google account"></p>
<p>After a succesfull authentication the user is redirected to the IAM page, and a
confirmation dialog shows that the account was linked succesfully:
<img src="../images/account-linking-google-4.png" alt="IAM link google account"></p>
<p>Now the user can logout from the IAM and login using the <strong>Sign in with
Google</strong> button.</p>
<p>A similar process is implemented for SAML external accounts.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8c7bd1453e2b38a50c4a591032b21ba0">5.3.7 - Linking an X.509 certificate</h1>
    
	<p>IAM provides the ability to link X.509 certificates to a user account. X.509
account linking works if:</p>
<ul>
<li>X.509 certificate authentication is enabled for the IAM instance in use; for
more information on this see the <a href="/docs/getting-started/nginx">Getting started guide</a>;</li>
<li>The certificate is correctly installed in the browser used to access the IAM;</li>
<li>The certificate is trusted by the IAM (i.e. is signed by a certificate
authority known and trusted by the IAM)</li>
</ul>
<h2 id="authenticating-with-an-x509-certificate">Authenticating with an X.509 certificate</h2>
<p>If a certificate is correctly configured in the browser, the browser will show
a dialog to select whether to authenticate with the certificate or not as in the
following screenshot:</p>
<p><img src="../images/account-link-x509-1.png" alt="INDIGO IAM Registration button"></p>
<p>Note that this happens when enstabilishing the connection to the IAM. If no
dialog is shown, either:</p>
<ul>
<li>there&rsquo;s no certificate in the browser that is trusted by the IAM (either the
certificate is expired or signed by a CA not trusted by the IAM)</li>
<li>a certificate was selected automatically by the browser when authenticating
to the IAM</li>
</ul>
<p>In case the certificate used for the authentication is linked to an
organization account, the IAM login page will display a &ldquo;Sign in with your
certificate&rdquo; button:</p>
<p><img src="../images/account-link-x509-5.png" alt="Login page with cert recognized"></p>
<h2 id="linking-a-certificate">Linking a certificate</h2>
<p>If a certificate was recognized but is not linked to any membership in the IAM,
the user will have to authenticate with other credentials (local username &amp;
password, or external authentication mechanisms (e.g. Google)).</p>
<p>After having logged in, the user can link a certificate by clickin on the
<strong>Link Certificate</strong> button:</p>
<p><img src="../images/account-link-x509-2.png" alt="INDIGO IAM Registration button"></p>
<p>Note that the <strong>Link certificate</strong> button will be shown in the page <strong>only if a
valid and trusted certificate was detected by the IAM during the TLS handshake</strong>.</p>
<p>Clicking the <strong>Link certificate</strong> button opens a dialog that shows information
about the certificate that should be linked to the account:</p>
<p><img src="../images/account-link-x509-3.png" alt="INDIGO IAM Registration button"></p>
<p>If the linking completes succesfully, the linked certificate information will
be shown in the X.509 certificates panel:</p>
<p><img src="../images/account-link-x509-4.png" alt="INDIGO IAM Registration button"></p>
<p>To check that the linking actually works, the user can logout from the IAM and
login again with the certificate.</p>
<h2 id="unlinking-a-certificate">Unlinking a certificate</h2>
<p>A user can unlink a certificate by clicking on the <strong>Unlink</strong> button shown in
the certificate panel (see the image above).</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b5e9e2b1e5b01a59c3094d6a322de40e">5.3.8 - Managing active tokens</h1>
    
	<p>You can see which access and refresh tokens bound to your identity are
currently active from the MitreID dashboard following the &ldquo;Manage Active
Tokens&rdquo; link:</p>
<p><img src="../images/manage-active-tokens.png" alt="Manage access tokens"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b5f411892927a1d85e8ded48cb778eb1">5.3.9 - Managing approved sites</h1>
    
	<p>You can manage approved sites (i.e. sites and services that you approved when
authenticating at the IAM) from the MitreID dashboard following the &ldquo;Manage Approved Sites&rdquo; link:</p>
<p><img src="../images/manage-approved-sites.png" alt="Manage approved sites"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-18d43a62d9d80a6d77ca13d5f9613c6a">5.3.10 - Reset an account password</h1>
    
	<p>Users can reset their password from the IAM login page by clicking on the
<em>Forgot your password?</em> link, which opens a dialog where users can then enter
their email address, and if the entered email address is linked to a registered
user a reset password link will be sent to such email address.</p>
<p><img src="../images/IAM-forgot-password.png" alt="INDIGO IAM Forgot Password submission form"></p>

</div>



    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a7c9e10a31abdecaec5a338462a220a8">6 - Developer guide</h1>
    
	<h2 id="iam-build-requirements">IAM build requirements</h2>
<p>The IAM is a Spring Boot Java application.</p>
<p>To build it, you will need:</p>
<ul>
<li>Java 8</li>
<li>Maven 3.3.x or greater</li>
<li>Git</li>
</ul>
<h2 id="checking-out-the-iam-code">Checking out the IAM code</h2>
<p>You can check out the IAM code as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  git clone https://github.com/indigo-iam/iam.git
</code></pre></div><h2 id="building-the-iam">Building the IAM</h2>
<p>You can build the IAM packages with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  mvn package
</code></pre></div><h2 id="setting-up-the-docker-based-development-environment">Setting up the docker-based development environment</h2>
<p>You will need:</p>
<ul>
<li>Docker 1.11.1 or greater</li>
<li>Docker compose 1.7 or greater</li>
</ul>
<p>You can start a development/testing environment with the following command:</p>
<pre><code>  docker-compose build
  docker-compose up
</code></pre><p>The docker-compose.yml file requires that you set some environment variables
for it to run properly, mainly to provide OAuth client credentials for external
authentication mechanisms (Google).</p>
<p>The setup also assumes that you have an entry in your DNS server (complex) or
/etc/hosts (simpler) that maps iam.local.io to the machine (or VM) where docker
is running, e.g.:</p>
<pre><code>$ cat /etc/hosts
...

192.168.99.100 iam.local.io
</code></pre><h2 id="how-to-run-tests-against-the-mysql-database">How to run tests against the mysql database</h2>
<p>IAM JUnit integration tests can (and should) be run against mysql database.</p>
<p>To do so, boostrap the database instance with docker-compose:</p>
<pre><code>docker-compose up db
</code></pre><p>And then run the tests with the following command:</p>
<pre><code>mvn -Dspring.profiles.active=mysql-test test
</code></pre><h2 id="building-docker-production-images">Building Docker production images</h2>
<p>To build the docker images for the iam-service and iam-test client,
use the following commands:</p>
<pre><code>sh iam-login-service/docker/build-prod-image.sh
sh iam-test-client/docker/build-prod-image.sh
</code></pre><p>These commands should run <strong>after</strong> war and jar archives have been built, i.e.
after a <code>mvn package</code>.</p>
<p>For more details on the image build scripts see the following folders:</p>
<ul>
<li><a href="iam-login-service/docker">iam-login-service</a></li>
<li><a href="iam-test-client/docker">iam-test-client</a></li>
</ul>
<h2 id="related-projects">Related projects</h2>
<p>This project builds upon the following projects/technologies:</p>
<ul>
<li><a href="http://projects.spring.io/spring-boot/">Spring Boot</a></li>
<li><a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server">MitreID OpenID-Connect client and server libraries</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-63fc23311c2c31b8d70578804ff3e9bf">7 - IAM as a service</h1>
    <div class="lead">INFN offers IAM-as-a-service to partner communities.</div>
	<p>INFN provides IAM as a service to partner research communities. In this
scenario, a dedicated IAM instance is deployed on the INFN infrastructure and
configured according to the community needs.</p>
<p>INFN takes care of keeping the service operational and up-to-date, while
administrative control on the IAM instance is granted to the community.</p>
<p>The following IAM deployments are examples of IAM deployed as a service for
partner communities:</p>
<ul>
<li>
<p><a href="https://dodas-iam.cloud.cnaf.infn.it">DODAS</a>: The Dynamic On-Demand Analysis
Service (DODAS) allows to instantiate on-demand container-based clusters.
Both HTCondor batch systems, and platforms for Big Data analysis based for
example on Spark or Hadoop, can be deployed on any cloud-based
infrastructures with almost zero effort.</p>
</li>
<li>
<p><a href="https://iam.extreme-datacloud.eu/">eXtreme Datacloud project</a>: The eXtreme
DataCloud project (XDC) project aims at developing scalable technologies for
federating storage resources and managing data in highly distributed
computing environments, as required by the most demanding, data intensive
research experiments in Europe and worldwide.</p>
</li>
</ul>
<h2 id="how-to-access-the-service">How to access the service</h2>
<p>To request the deployment of an IAM service instance for your community, write
to our <a href="mailto:iam-support@lists.infn.it">support list</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/indigoiam/iam">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://indigo-iam.slack.com">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 INFN All Rights Reserved</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/v/master/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>




  </body>
</html>
