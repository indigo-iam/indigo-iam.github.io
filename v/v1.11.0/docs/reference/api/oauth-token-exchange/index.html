<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="alternate" type="text/html" href="/v/v1.11.0/docs/reference/api/oauth-token-exchange/_print/">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/v/v1.11.0/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/v1.11.0/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-192x192.png" sizes="192x192">

<title>OAuth token exchange API | INDIGO IAM</title>
<meta name="description" content="The INDIGO Identity and Access Management (IAM) Service">
<meta property="og:title" content="OAuth token exchange API" />
<meta property="og:description" content="The INDIGO Identity and Access Management (IAM) Service" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/v1.11.0/docs/reference/api/oauth-token-exchange/" />

<meta itemprop="name" content="OAuth token exchange API">
<meta itemprop="description" content="The INDIGO Identity and Access Management (IAM) Service"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="OAuth token exchange API"/>
<meta name="twitter:description" content="The INDIGO Identity and Access Management (IAM) Service"/>




<link rel="preload" href="/v/v1.11.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" as="style">
<link href="/v/v1.11.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/v/v1.11.0/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">INDIGO IAM</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/v/v1.11.0/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/v/v1.11.0/blog/"><span>Blog</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Releases</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.11.0">v1.11.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.2">v1.10.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.1">v1.10.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.0">v1.10.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.9.0">v1.9.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.4">v1.8.4</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.3">v1.8.3</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.2">v1.8.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.1">v1.8.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.0">v1.8.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.2">v1.7.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.1">v1.7.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/docs/v/current/">older releases</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/v/v1.11.0/offline-search-index.e9cf505ab3ab72d6fec7724411e59fc6.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/v/v1.11.0/offline-search-index.e9cf505ab3ab72d6fec7724411e59fc6.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-vv1110docs-li">
  <a href="/v/v1.11.0/docs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-vv1110docs"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsoverview-li">
  <a href="/v/v1.11.0/docs/overview/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsoverview"><span class="">Overview</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docsgetting-started-li">
  <a href="/v/v1.11.0/docs/getting-started/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-started"><span class="">Getting Started</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-startednginx-li">
  <a href="/v/v1.11.0/docs/getting-started/nginx/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-startednginx"><span class="">NGINX configuration</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-startedmariadb-li">
  <a href="/v/v1.11.0/docs/getting-started/mariadb/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-startedmariadb"><span class="">Database configuration</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-startedjwk-li">
  <a href="/v/v1.11.0/docs/getting-started/jwk/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-startedjwk"><span class="">JSON Web Keys configuration</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-starteddocker-li">
  <a href="/v/v1.11.0/docs/getting-started/docker/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-starteddocker"><span class="">Deployment with Docker</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-startedpackages-li">
  <a href="/v/v1.11.0/docs/getting-started/packages/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-startedpackages"><span class="">Deployment with packages</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsgetting-startedbasic_setup-li">
  <a href="/v/v1.11.0/docs/getting-started/basic_setup/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsgetting-startedbasic_setup"><span class="">Basic IAM setup</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-vv1110docsreference-li">
  <a href="/v/v1.11.0/docs/reference/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreference"><span class="">Reference</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-vv1110docsreferenceapi-li">
  <a href="/v/v1.11.0/docs/reference/api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapi"><span class="">APIs</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiaup-api-li">
  <a href="/v/v1.11.0/docs/reference/api/aup-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiaup-api"><span class="">AUP management API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiaup-sign-api-li">
  <a href="/v/v1.11.0/docs/reference/api/aup-sign-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiaup-sign-api"><span class="">AUP signature API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiproxycert-api-li">
  <a href="/v/v1.11.0/docs/reference/api/proxycert-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiproxycert-api"><span class="">Proxy certificate API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapigroup-requests-li">
  <a href="/v/v1.11.0/docs/reference/api/group-requests/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapigroup-requests"><span class="">Group requests API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapihealth_endpoints-li">
  <a href="/v/v1.11.0/docs/reference/api/health_endpoints/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapihealth_endpoints"><span class="">Health checks</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiaccount-api-li">
  <a href="/v/v1.11.0/docs/reference/api/account-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiaccount-api"><span class="">IAM account API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapitokens-api-li">
  <a href="/v/v1.11.0/docs/reference/api/tokens-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapitokens-api"><span class="">IAM Token management API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-vv1110docsreferenceapioauth-token-exchange-li">
  <a href="/v/v1.11.0/docs/reference/api/oauth-token-exchange/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapioauth-token-exchange"><span class="td-sidebar-nav-active-item">OAuth token exchange API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapioauth-token-introspection-li">
  <a href="/v/v1.11.0/docs/reference/api/oauth-token-introspection/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapioauth-token-introspection"><span class="">OAuth token introspection API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapioidc-client-management-li">
  <a href="/v/v1.11.0/docs/reference/api/oidc-client-management/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapioidc-client-management"><span class="">OpenID Connect client management API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapioidc-client-registration-li">
  <a href="/v/v1.11.0/docs/reference/api/oidc-client-registration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapioidc-client-registration"><span class="">OpenID Connect client registration API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiscim-api-li">
  <a href="/v/v1.11.0/docs/reference/api/scim-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiscim-api"><span class="">SCIM API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapiscope-policy-api-li">
  <a href="/v/v1.11.0/docs/reference/api/scope-policy-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapiscope-policy-api"><span class="">Scope Policy API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceapitoken-exchange-policy-api-li">
  <a href="/v/v1.11.0/docs/reference/api/token-exchange-policy-api/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceapitoken-exchange-policy-api"><span class="">Token exchange policy API</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docsreferenceconfiguration-li">
  <a href="/v/v1.11.0/docs/reference/configuration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfiguration"><span class="">Configuration</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationjwt-profiles-li">
  <a href="/v/v1.11.0/docs/reference/configuration/jwt-profiles/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationjwt-profiles"><span class="">JWT profiles support</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationsystem-scopes-li">
  <a href="/v/v1.11.0/docs/reference/configuration/system-scopes/" title="MitreID System Scopes" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationsystem-scopes"><span class="">System scopes</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationlifecycle-li">
  <a href="/v/v1.11.0/docs/reference/configuration/lifecycle/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationlifecycle"><span class="">Membership lifecycle</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationrcauth-li">
  <a href="/v/v1.11.0/docs/reference/configuration/rcauth/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationrcauth"><span class="">Integration with RCAuth</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationregistration-li">
  <a href="/v/v1.11.0/docs/reference/configuration/registration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationregistration"><span class="">Registration &amp; Enrollment</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationscim-response-li">
  <a href="/v/v1.11.0/docs/reference/configuration/scim-response/" title="Handling SCIM response" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationscim-response"><span class="">SCIM response</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationclient-registration-li">
  <a href="/v/v1.11.0/docs/reference/configuration/client-registration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationclient-registration"><span class="">Client registration</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationjwk-li">
  <a href="/v/v1.11.0/docs/reference/configuration/jwk/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationjwk"><span class="">JSON Web Keys (JWK)</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationlocal_authn-li">
  <a href="/v/v1.11.0/docs/reference/configuration/local_authn/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationlocal_authn"><span class="">Local authentication</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docsreferenceconfigurationexternal-authentication-li">
  <a href="/v/v1.11.0/docs/reference/configuration/external-authentication/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationexternal-authentication"><span class="">External authentication</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationexternal-authenticationoidc-li">
  <a href="/v/v1.11.0/docs/reference/configuration/external-authentication/oidc/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationexternal-authenticationoidc"><span class="">OpenID-Connect authentication</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationexternal-authenticationsaml-li">
  <a href="/v/v1.11.0/docs/reference/configuration/external-authentication/saml/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationexternal-authenticationsaml"><span class="">SAML authentication</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsreferenceconfigurationexternal-authenticationx509-li">
  <a href="/v/v1.11.0/docs/reference/configuration/external-authentication/x509/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsreferenceconfigurationexternal-authenticationx509"><span class="">X.509 authentication</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docstasks-li">
  <a href="/v/v1.11.0/docs/tasks/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasks"><span class="">Tasks</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docstasksadministration-li">
  <a href="/v/v1.11.0/docs/tasks/administration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksadministration"><span class="">IAM organization administration</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksadministrationuser-management-li">
  <a href="/v/v1.11.0/docs/tasks/administration/user-management/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksadministrationuser-management"><span class="">User management</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksadministrationclient-status-change-li">
  <a href="/v/v1.11.0/docs/tasks/administration/client-status-change/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksadministrationclient-status-change"><span class="">Disable or Enable a client</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksadministrationgroup-management-li">
  <a href="/v/v1.11.0/docs/tasks/administration/group-management/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksadministrationgroup-management"><span class="">Group Management</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksadministrationaup-management-li">
  <a href="/v/v1.11.0/docs/tasks/administration/aup-management/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksadministrationaup-management"><span class="">Acceptable Usage Policy (AUP) management</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docstasksdeployment-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeployment"><span class="">IAM service deployment</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentbackup_restore-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/backup_restore/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentbackup_restore"><span class="">Backup &amp; Restore</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentaudit-log-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/audit-log/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentaudit-log"><span class="">Audit log</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentupgrade-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/upgrade/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentupgrade"><span class="">Upgrade</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentha-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/ha/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentha"><span class="">Deploying IAM in HA</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentvoms-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/voms/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentvoms"><span class="">Deploying the IAM VOMS attribute authority</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksdeploymentvoms_importer-li">
  <a href="/v/v1.11.0/docs/tasks/deployment/voms_importer/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksdeploymentvoms_importer"><span class="">Importing VOMS information into IAM</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksclientapp-li">
  <a href="/v/v1.11.0/docs/tasks/clientapp/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksclientapp"><span class="">IAM Test Client application</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docstasksuser-li">
  <a href="/v/v1.11.0/docs/tasks/user/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuser"><span class="">User</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserjoining-a-collaboration-li">
  <a href="/v/v1.11.0/docs/tasks/user/joining-a-collaboration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserjoining-a-collaboration"><span class="">Joining an IAM-managed organization</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksusergetting-a-token-li">
  <a href="/v/v1.11.0/docs/tasks/user/getting-a-token/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksusergetting-a-token"><span class="">Obtaining an IAM access token from a CLI</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserresign-aup-li">
  <a href="/v/v1.11.0/docs/tasks/user/resign-aup/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserresign-aup"><span class="">Re-sign AUP</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserclient-registration-li">
  <a href="/v/v1.11.0/docs/tasks/user/client-registration/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserclient-registration"><span class="">Registering a client</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserchange-details-li">
  <a href="/v/v1.11.0/docs/tasks/user/change-details/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserchange-details"><span class="">Change account information</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserchange-password-li">
  <a href="/v/v1.11.0/docs/tasks/user/change-password/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserchange-password"><span class="">Changing the account password</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserjwt-authn-li">
  <a href="/v/v1.11.0/docs/tasks/user/jwt-authn/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserjwt-authn"><span class="">JWT client authentication</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserexternal-account-linking-li">
  <a href="/v/v1.11.0/docs/tasks/user/external-account-linking/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserexternal-account-linking"><span class="">Linking an external account</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserx509-linking-li">
  <a href="/v/v1.11.0/docs/tasks/user/x509-linking/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserx509-linking"><span class="">Linking an X.509 certificate</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksusermanage-active-tokens-li">
  <a href="/v/v1.11.0/docs/tasks/user/manage-active-tokens/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksusermanage-active-tokens"><span class="">Managing active tokens</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksusermanage-approved-sites-li">
  <a href="/v/v1.11.0/docs/tasks/user/manage-approved-sites/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksusermanage-approved-sites"><span class="">Managing approved sites</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksusermanage-ssh-keys-li">
  <a href="/v/v1.11.0/docs/tasks/user/manage-ssh-keys/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksusermanage-ssh-keys"><span class="">Managing SSH keys</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docstasksuserreset-password-li">
  <a href="/v/v1.11.0/docs/tasks/user/reset-password/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docstasksuserreset-password"><span class="">Reset an account password</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-vv1110docsdeveloper-guide-li">
  <a href="/v/v1.11.0/docs/developer-guide/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsdeveloper-guide"><span class="">Developer guide</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-vv1110docsdeveloper-guidespecs-li">
  <a href="/v/v1.11.0/docs/developer-guide/specs/" title="Specifications and useful resources" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-vv1110docsdeveloper-guidespecs"><span class="">Specifications</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/indigo-iam/iam-website/tree/v1.11.0/content/en/docs/reference/api/oauth-token-exchange/_index.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/indigo-iam/iam-website/edit/v1.11.0/content/en/docs/reference/api/oauth-token-exchange/_index.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/indigo-iam/iam-website/new/v1.11.0/content/en/docs/reference/api/oauth-token-exchange?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/indigo-iam/iam-website/issues/new?title=OAuth%20token%20exchange%20API" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/indigo-iam/iam/issues/new" class="td-page-meta--project td-page-meta__project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
  <a id="print" href="/v/v1.11.0/docs/reference/api/oauth-token-exchange/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#impersonation-vs-delegation">Impersonation vs delegation</a></li>
    <li><a href="#client-configuration-requirements">Client configuration requirements</a></li>
    <li><a href="#the-token-exchange-request">The token exchange request</a>
      <ul>
        <li><a href="#scopes-in-exchanged-tokens">Scopes in exchanged tokens</a></li>
        <li><a href="#token-exchange-example">Token Exchange example</a></li>
        <li><a href="#trust">Trust</a></li>
        <li><a href="#limitation-and-known-issues">Limitation and known issues</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
            

          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/v/v1.11.0/docs/">Documentation</a></li>
  <li class="breadcrumb-item">
    <a href="/v/v1.11.0/docs/reference/">Reference</a></li>
  <li class="breadcrumb-item">
    <a href="/v/v1.11.0/docs/reference/api/">APIs</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    OAuth token exchange API</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>OAuth token exchange API</h1>
  
	<header class="article-meta">
		
</header>
	<p>The current release of the INDIGO IAM implements part of the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange
OAuth
specification</a>.
The Token Exchange OAuth specification defines &ldquo;a lightweigth protocol that
enables clients to request and obtain security tokens from authorization
servers&rdquo;.</p>
<p>OAuth 2.0 was designed to solve the problem of a delegated access to resources
across services, mediated by an authorization server, as shown in the following
picture:</p>
<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
<img class="card-img-top" src="/v/v1.11.0/docs/reference/api/oauth-token-exchange/oauth-delegation-1_hud4af7d007d8029ff318e645dabdc0724_26464_500x500_fit_catmullrom_3.png" width="500" height="384">
<figcaption class="card-body px-0 pt-2 pb-0">
<p class="card-text">


OAuth delegation

</p>
</figcaption>
</figure>

<p>In the picture above we have the usual OAuth roles:</p>
<ul>
<li>The user (or <em>resource owner</em>, in OAuth terminology);</li>
<li>A resource server, ie. a service hosting user resources, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li>A client: this is an agent that has received a permission from the user to
act on his behalf on his resources hosted on a resource server;</li>
<li>An authorization server: a service that issues access token to clients after
having authenticated the user and obtained an authorization from the user
that the client is entitled to act on user&rsquo;s resources</li>
</ul>
<p>There are scenarios when a resource server, in order to satisfy a client
request, needs to access resources hosted by other downstream services on
behalf of the user, like in the following picture:</p>
<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
<img class="card-img-top" src="/v/v1.11.0/docs/reference/api/oauth-token-exchange/oauth-token-exchange-1_hu3c62e250261e787166319e6bf7993f61_35467_500x500_fit_catmullrom_3.png" width="500" height="242">
<figcaption class="card-body px-0 pt-2 pb-0">
<p class="card-text">


OAuth token exchange

</p>
</figcaption>
</figure>

<p>In OAuth, access tokens are bearer tokens, so the first resource server could
simply use the access token received from the client to interact, on behalf
of the user, with the downstream resource server.</p>
<p>There are, however, situations in which just using the received access token
against the downstream service is not possible, like for instance if the token
audience was scoped to be valid only on the first resource server.</p>
<p>Moreover, the resource server could need the ability to act on behalf of the
user for an unbounded amount of time (e.g., to implement long-running
computations), not limited by the validity of the received access token.</p>
<p>The token exchange specification was designed to provide a protocol in support
of these scenarios, where a client can exchange an access token received from
antoher client with a new token (or a set of tokens, as we will see) by
interacting with a trusted OAuth authorization server.</p>
<h2 id="impersonation-vs-delegation">Impersonation vs delegation</h2>
<p>As specified in the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange OAuth
specification</a>,
when a subject A impersonates B, A has all the rights of B and it is
indistinguishable from B. So, when A interacts within any other entity, A is B.</p>
<p>With delegation A still has its own identity, separate from B. So when A
interacts within another entity, it is explicit that A is representing B,
because B has delegated some of its rights to A.</p>
<p>More details about the difference from this two semantics can be found in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05#section-1.1">this section of the specification</a>.</p>
<p>The INDIGO IAM token exchange implementation currently supports only
impersonation semantics.</p>
<h2 id="client-configuration-requirements">Client configuration requirements</h2>
<p>In order to request a token exchange, a client must be configured with the
<code>urn:ietf:params:oauth:grant-type:token-exchange</code> grant type enabled. The token
exchange grant type is <strong>disabled</strong> by default for dynamically registered
clients, and can be enabled only by users with administrative privileges.</p>
<h2 id="the-token-exchange-request">The token exchange request</h2>
<p>A client who wants to exchange an access token with a new one (or a couple of
new tokens, in case a refresh token is requested), must send an authenticated
request to the IAM <code>/token</code> endpoint, specifying the following properties:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><code>urn:ietf:params:oauth:grant-type:token-exchange</code></td>
</tr>
<tr>
<td>subject_token</td>
<td>The subject access token that the client wants to exchange</td>
</tr>
<tr>
<td>scope</td>
<td>The set of scopes requested for the new access token</td>
</tr>
<tr>
<td>audience</td>
<td>Optional. A space-separated list of resource identifiers that will be used to limit the audience of the issued token</td>
</tr>
</tbody>
</table>
<h3 id="scopes-in-exchanged-tokens">Scopes in exchanged tokens</h3>
<p>A client, when requesting a token exchange, can request any of the scopes
enabled by its client configuration. IAM system scopes are however handled in a
special way. These scopes, in order to be &ldquo;exchanged&rdquo; across clients, need to
be</p>
<ul>
<li>enabled for the client requesting the token exchange</li>
<li>linked to the subject token presented for the token exchange</li>
</ul>
<p>The list of system scopes currently defined in the IAM can be obtained by
registered users by issuing a request to the IAM system scopes API:</p>
<pre tabindex="0"><code>curl -H &#34;Authorization: Bearer ...&#34; https://iam.example/api/scopes
</code></pre><h3 id="token-exchange-example">Token Exchange example</h3>
<p>This section describes a token exchange flow.</p>
<p>We start with a normal OAuth flow where a client, <code>token-exchange-subject</code>,
requests an access token from the IAM using the resource owner password
credential flow. The <code>token-exchange-subject</code> client is configured to use HTTP
basic authentication against the IAM token endpoint, and in this example acts
on behalf of the <code>test</code> user. We use the resource owner password credentials
flow for convenience, but any other OAuth or OpenID connect flow that involves
a user identity would be fine (i.e., authorization code).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IAM_TOKEN_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io/token
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>token-exchange-subject
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -s -u <span style="color:#000">$SUBJECT_ID</span>:<span style="color:#000">$SUBJECT_SECRET</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$USERNAME</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$PASSWORD</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>password <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</span></span></code></pre></div><p>Note that the only scopes requested in this first request are <code>openid</code> and
<code>profile</code>, i.e. the scopes required to access user identity information. IAM
token endpoint returns a JSON containing an access token and other info:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJpc3MiOiJodHRwczpcL1wvaWFtLmxvY2FsLmlvXC8iLCJleHAiOjE0NzY5NTcxMDIsImlhdCI6MTQ3Njk1MzUwMiwianRpIjoiMjBiZThlNjYtNmNmOS00YzE0LWI4ZDEtZjJmZTc0NDk0YjAxIn0.kqAhZ2MNmBLYIA_-xW9356kD-ndqJ7jKUZRPb7ox_4iXbjcnV6oZYAHZzTH_uBTXA2WsVIJJ-Qicm5JQ0ydb2ewgECAmGkKfL3X4qnnRq2_GgZZof3zlM_rIz3QrDB3v1eIt42YeMdUgODUYGKeDwntT5a7wPDtxe-GM2uL5fik&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;id_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJhdWQiOiIzMmMzMTUyOS05YmM2LTQ1ZWQtYjU0YS0wNGEyNThiMDRmYmYiLCJraWQiOiJyc2ExIiwiaXNzIjoiaHR0cHM6XC9cL2lhbS5sb2NhbC5pb1wvIiwiZXhwIjoxNDc2OTU0MTAyLCJpYXQiOjE0NzY5NTM1MDIsImp0aSI6IjhhMzk1OTM5LTM1N2QtNGY5My04MmEzLTJkMTBkM2ZhMzgzZCJ9.DtNR-ob8kMIUMa2x6TW7krSYMt78tfr5fnTK4aeoIY-wmEWcjPRx1_vT6_lesjMr9w0B_OCALXfOoDBfbF7DhmV7vpbotirkMxvowFBzgppmtBTZNAzLc_Wiwr4IAiGydwjy_UbYrxx6qlWJAKRwzSbDDd3oDVpU-KM8gtLIEa8&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>We put this access token in an environment variable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> $ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>cat /tmp/response <span style="color:#000;font-weight:bold">|</span> jq -r .access_token<span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>We use this access token to access the <code>app</code> API, which only requires access to
user identity to grant access:</p>
<pre tabindex="0"><code>curl -H &#34;Authorization: Bearer $SUBJECT_TOKEN&#34; https://app.example.org/api
</code></pre><p>Suppose now that the <code>app</code> API needs, to properly answer the request from the
client, to interact with another downstream service, <a href="https://tasks.example.org">https://tasks.example.org</a>,
on behalf of the user. Unfortunately the set of scopes linked to the access
token received are not sufficient to do this, and so <code>app</code> decides to exchange
the token received with another one granting enough privileges.</p>
<p>In Token Exchange terms, here <code>app</code> is the <code>actor</code>, the subject identity linked
to the token is the <code>test</code> user, and the audience for the new token being
requested would be the <code>https://tasks.app.example.org/api</code> API.</p>
<p>So <code>app</code> would do a request like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>https://app.example.org/api
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AUDIENCE</span><span style="color:#ce5c00;font-weight:bold">=</span>https://tasks.example.org/api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -s -u <span style="color:#000">$ACTOR_ID</span>:<span style="color:#000">$ACTOR_SECRET</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:ietf:params:oauth:grant-type:token-exchange <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">audience</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$AUDIENCE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">subject_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$SUBJECT_TOKEN</span> <span style="color:#4e9a06">\ </span><span style="color:#8f5902;font-style:italic"># This token was received from the initial client </span>
</span></span><span style="display:flex;"><span>    -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</span></span></code></pre></div><p>Note that <code>app</code> requests an additional scope, <code>read-tasks</code>, to interact with
the downstream service.</p>
<p>Since <code>app</code> is a trusted client for token exchange, the IAM responds with the
following JSON:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJra...&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;issued_token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:ietf:params:oauth:token-type:jwt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>And <code>app</code> can use the newly issued access token to invoke services on
<a href="https://task-app.example.org/api">https://task-app.example.org/api</a> on behalf of user <code>test</code>:</p>
<pre tabindex="0"><code>$ curl -H &#34;Authorization: Bearer eyJra...&#34; http://tasks.example.org/api
</code></pre><h3 id="trust">Trust</h3>
<p>Clients that have the token exchange grant enabled are considered trusted
clients i.e., no explicit grant from the user is needed to grant access to
client scopes. For IAM system scopes, however, these can be &ldquo;exchanged&rdquo; only if
linked to the original subject token.</p>
<h3 id="limitation-and-known-issues">Limitation and known issues</h3>
<p>The current implementation of Token Exchange in Indigo IAM has the following limitations:</p>
<ul>
<li>Delegation is not yet supported: if <code>actor_token</code> or the <code>want_composite</code>
parameters are specified within the request, an error response is returned by
the authorization server;</li>
<li>The <code>resource</code> field is ignored.</li>
</ul>

  <div class="section-index">
    
    
    </div>
<div class="td-page-meta__lastmod">
  Last modified December 7, 2021: <a href="https://github.com/indigo-iam/iam-website/commit/22bd51e3bccaae6e2883c4c98761790c3d9dc3bc">Fix broken images (22bd51e)</a>
</div>
</div>

          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/indigo-iam/iam" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://indigo-iam.slack.com" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">INFN</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/v/v1.11.0/js/main.min.dc2c0119076a0df855e55a8044ce0de74b7b9033c20e853e22d7ec7e9bdde965.js" integrity="sha256-3CwBGQdqDfhV5VqARM4N50t7kDPCDoU&#43;Itfsfpvd6WU=" crossorigin="anonymous"></script>
<script defer src="/v/v1.11.0/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/v/v1.11.0/js/tabpane-persist.js'></script>

  </body>
</html>