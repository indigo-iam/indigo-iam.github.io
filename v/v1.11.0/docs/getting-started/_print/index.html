<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/v/v1.11.0/docs/getting-started/">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/v/v1.11.0/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/v1.11.0/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/v1.11.0/favicons/android-192x192.png" sizes="192x192">

<title>Getting Started | INDIGO IAM</title>
<meta name="description" content="A quick howto on how to deploy IAM
">
<meta property="og:title" content="Getting Started" />
<meta property="og:description" content="A quick howto on how to deploy IAM
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/v1.11.0/docs/getting-started/" />

<meta itemprop="name" content="Getting Started">
<meta itemprop="description" content="A quick howto on how to deploy IAM
"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Getting Started"/>
<meta name="twitter:description" content="A quick howto on how to deploy IAM
"/>




<link rel="preload" href="/v/v1.11.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" as="style">
<link href="/v/v1.11.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/v/v1.11.0/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">INDIGO IAM</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/v/v1.11.0/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/v/v1.11.0/blog/"><span>Blog</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Releases</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.11.0">v1.11.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.2">v1.10.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.1">v1.10.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.0">v1.10.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.9.0">v1.9.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.4">v1.8.4</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.3">v1.8.3</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.2">v1.8.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.1">v1.8.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.0">v1.8.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.2">v1.7.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.1">v1.7.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/docs/v/current/">older releases</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/v/v1.11.0/offline-search-index.58f2c6da1d17f00a9998a65e9692640e.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/v/v1.11.0/docs/getting-started/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Getting Started</h1>
<div class="lead">A quick howto on how to deploy IAM</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-fc6236dfeced575346afab985c274cf6">NGINX configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-35c1b78df94e37b0c6b6685e8bdf38f1">Database configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-c3b64a508ec118f9b76138f613e9ea55">JSON Web Keys configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-8c741cbaae2d27334f02af82eefdd613">Deployment with Docker</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-15a25685d0805dee99efe788f6a68856">Deployment with packages</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-0fbad79c516bfe14f345bc8ffa80c959">Basic IAM setup</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>This section provides insight on how to deploy and configure an IAM service
instance.</p>
<p>IAM is a <a href="https://spring.io/projects/spring-boot">spring boot application</a> designed to run behind an <a href="https://www.nginx.com/">NGINX</a>
reverse proxy, which is used for TLS termination and possibly load balancing.
The IAM service instances keep all state in a MariaDB/MySQL database, as shown
in the following picture:</p>
<p><img src="images/iam-deployment.png" alt="IAM deployment overview"></p>
<h2 id="prerequisites">Prerequisites</h2>
<p>At the bare minimum, to run a production instance of the instance of the IAM
you will need:</p>
<ul>
<li>An X.509 certificate, used for SSL termination at the NGINX reverse proxy;
you can get one for free from <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>;</li>
<li>An NGINX server configured to act as a reverse proxy for the IAM web
application; more details on this in the <a href="nginx">NGINX section</a>;</li>
<li>A MariaDB/MySQL database instance; more on this in the <a href="mariadb">database
configuration</a>
section;</li>
<li>A JSON keystore holding the keys used to sign JSON Web Tokens; more on this
in the <a href="jwk">JWK section</a>;</li>
</ul>
<p>You will also need to choose whether you want to deploy you service as a
<a href="docker">docker container</a> (recommended) or install from
<a href="packages">packages</a>.</p>
<p>And finally, you will have to setup a minimal IAM configuration and change the
administrator password for the newly configured IAM service; more on this
<a href="basic_setup">in the basic configuration section</a>.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc6236dfeced575346afab985c274cf6">1 - NGINX configuration</h1>
    
	<p>IAM relies on NGINX for TLS termination and load balancing.</p>
<p>The example configuration below provides the minimal configuration needed to
have NGINX working as a reverse proxy for the IAM web application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">server</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">listen</span> <span style="color:#0000cf;font-weight:bold">80</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">listen</span> <span style="color:#4e9a06">[::]:80</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">server_name</span> <span style="color:#4e9a06">_</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">301</span> <span style="color:#4e9a06">https://</span><span style="color:#000">$host$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">server</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">listen</span>        <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">ssl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">server_name</span>   <span style="color:#4e9a06">YOUR_HOSTNAME_HERE</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">access_log</span>   <span style="color:#4e9a06">/var/log/nginx/iam.access.log</span>  <span style="color:#4e9a06">combined</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">ssl</span> <span style="color:#000">on</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">ssl_protocols</span> <span style="color:#4e9a06">TLSv1</span> <span style="color:#4e9a06">TLSv1.1</span> <span style="color:#4e9a06">TLSv1.2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">ssl_certificate</span>      <span style="color:#4e9a06">/path/to/your/ssl/cert.pem</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">ssl_certificate_key</span>  <span style="color:#4e9a06">/path/to/your/ssl/key.pem</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">location</span> <span style="color:#4e9a06">/</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">proxy_pass</span>              <span style="color:#4e9a06">http://THE_IAM_APP_HOSTNAME_HERE:8080</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Real-IP</span> <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-For</span> <span style="color:#000">$proxy_add_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-Proto</span> <span style="color:#4e9a06">https</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">Host</span> <span style="color:#000">$http_host</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="x509-client-authentication">X.509 client authentication</h2>
<p>IAM supports X.509 client certificate authentication. To enable X.509 client
certificate authentication use a configuration similar to the
<a href="https://github.com/indigo-iam/iam/blob/master/docker/nginx/iam.conf">one</a> used
in the IAM development environment.</p>
<p>In particular, set the <code>ssl_verify_client=Optional</code> option and configure the <code>proxy_set_header</code>
directory as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Cert</span> <span style="color:#000">$ssl_client_cert</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-I-Dn</span> <span style="color:#000">$ssl_client_i_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-S-Dn</span> <span style="color:#000">$ssl_client_s_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Serial</span> <span style="color:#000">$ssl_client_serial</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-Start</span> <span style="color:#000">$ssl_client_v_start</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-End</span>   <span style="color:#000">$ssl_client_v_end</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Verify</span>  <span style="color:#000">$ssl_client_verify</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Protocol</span> <span style="color:#000">$ssl_protocol</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Server-Name</span> <span style="color:#000">$ssl_server_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-35c1b78df94e37b0c6b6685e8bdf38f1">2 - Database configuration</h1>
    
	<p>IAM keeps state in a MariaDB/MySQL database, and will need its own schema and a
user that has read/write/schema change privileges on such database.</p>
<p>IAM has been tested successfully against:</p>
<ul>
<li>MySQL v. 5.5.5</li>
<li>MariaDB v. 10.1.22</li>
</ul>
<p>For more instructions on how to create a database schema and a user with
administrator privileges on it, see the <a href="https://mariadb.com/kb/en/">MariaDB documentation</a>.</p>
<p>Assuming the organization that IAM will manage is called <code>test</code>, the following
commands can be used  to create a database and a user for the IAM application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">DATABASE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">CHARACTER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">SET</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">COLLATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1_swedish_ci</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">USER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;iam_test&#39;</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#4e9a06">&#39;%&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">identified</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">by</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;some_super_secure_password&#39;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">GRANT</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">ALL</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">PRIVILEGES</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">to</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;iam_test&#39;</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#4e9a06">&#39;%&#39;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You may want to restrict the set of hosts from which a mysql client can connect
to the database with the above credentials according to your deployment needs.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c3b64a508ec118f9b76138f613e9ea55">3 - JSON Web Keys configuration</h1>
    
	<p>JSON web keys are used by the IAM to sign and verify token signatures.</p>
<p>To generate a JSON web key for your IAM deployment, you can use the
<a href="https://github.com/mitreid-connect/json-web-key-generator">json-web-key-generator</a> tool provided by MitreID connect.</p>
<p>The following command clones the <code>json-web-key-generator</code> Git repository to a
local directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/mitreid-connect/json-web-key-generator
</span></span></code></pre></div><p>Build the code with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mvn package
</span></span></code></pre></div><p>Maven 3.6.x or greater supporting Java 11 is required.</p>
<p>You can then generate a key with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>java -jar target/json-web-key-generator-0.9-SNAPSHOT-jar-with-dependencies.jar <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -t RSA -s <span style="color:#0000cf;font-weight:bold">1024</span> -S -i rsa1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Full key:
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;keys&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;p&#34;</span>: <span style="color:#4e9a06">&#34;3oh7ex6zgdmJh5NBD0IplmBDDGC2ECu2A1vcp8e8DqE7OSSpAc1T9tTjJioCGqkNM51JK_MtgCJz1CiysVDOQQ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;kty&#34;</span>: <span style="color:#4e9a06">&#34;RSA&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;q&#34;</span>: <span style="color:#4e9a06">&#34;nRmBm5tQ2wmOtd1XUYDRH2qWai6eElt-1cvO5tnTdWZkFaAeaHQ3_xf_PFOjyAv5Y5rNLgf_Xbu9UCo_mSrDMQ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;d&#34;</span>: <span style="color:#4e9a06">&#34;BGHRhQP6ADqqSrM8_mI0YhjGStj1aW9rLi7wXQMJ122kegPxIT7dfP-5UScxykD_BrCCHQVPxdJl5wXy-giZnhaL9wtDkOXb8D8RCi1n02cs3Z1T23xONi_AG47QPBZjM5GcX-oOGCENByuEIdkU_Bn6vvqM3oyVlj5sio7tNAE&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;e&#34;</span>: <span style="color:#4e9a06">&#34;AQAB&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;kid&#34;</span>: <span style="color:#4e9a06">&#34;rsa1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;qi&#34;</span>: <span style="color:#4e9a06">&#34;RarXtTFCE3hk5ZanLWEapDnn7SLSxAvDcBTmG5SpCI9Eix7cfTigaK6N7OQIN0uGO1GJ-KVWL2v8dyI1jMoU6g&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;dp&#34;</span>: <span style="color:#4e9a06">&#34;MtBtieavzMXUzr2ETKyp_GmMxeXLjRO-IzQ1xaYpPhn5AQprATtWofVozQ0on9fcaN3QmJWV3T2Av4BvlWfDQQ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;dq&#34;</span>: <span style="color:#4e9a06">&#34;CWJ7rpsBooQYpV6al8DVPUY1xBQS10_l7MmnC31Zt3qtYelVx7GhoriBQ85PS2UDueKGfUh3BddwQLi1YeX_EQ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;n&#34;</span>: <span style="color:#4e9a06">&#34;iI_fuJq4z_9VQY5EH41sQWOAYUsjtxAFjRnAc1P5-GPOx3Izg9V7yKNmudLUt-jIkv6D5h-AzrhEV6DOdBRoiN4el1mCZ95jiJkjU2kpVOmutDysZkrn667zPd43w7E6IqHnahmMrVUjUyx6pie1SqJHLUXghz8Gle-1yi08_XE&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>Save the output of the above command (minus the <code>Full key:</code> initial text) in a
file, e.g. <code>keystore.jwks</code>.</p>
<p>See <a href="/v/v1.11.0/docs/reference/configuration/jwk/">JSON Web Keys (JWK)</a> reference page for more details about configuration of JSON web keys.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8c741cbaae2d27334f02af82eefdd613">4 - Deployment with Docker</h1>
    
	<p>The IAM service is provided on the following DockerHub repositories:</p>
<ul>
<li><a href="https://hub.docker.com/r/indigoiam/iam-login-service/">indigoiam/iam-login-service</a></li>
</ul>
<p>The docker image tag corresponding to this version of the documentation is:</p>


<div class="pageinfo pageinfo-primary">
<p>indigoiam/iam-login-service:v1.11.0</p>

</div>

<p>The IAM image has been tested to run properly with either Docker or Podman. The configuration for the
IAM service container is the same but the details to run the container slightly differ. Differences
are covered in the next sections. In both cases, it is <strong>highly</strong> recommended to enable SELinux for
increased security.</p>
<h2 id="configuring-the-iam-service">Configuring the IAM service</h2>
<p>Prepare an environment file that will contain the environment variables
settings for the IAM service container. See <a href="/v/v1.11.0/docs/reference/configuration/">the configuration
reference</a> for a description of the variables.</p>
<p>This environment file will be passed to the container with the <code>--env-file</code> option of the
container engine. You can choose whatever file path/name you want.</p>
<h2 id="running-the-container">Running the container</h2>
<h3 id="docker">Docker</h3>
<p>First create a Docker network for the IAM service with the command (the example uses
the network name <code>iam</code> but you are free to use another name as long as you use the same
one in the <code>run</code>command). It has to be done once (not at every restart of the container):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker network create iam
</span></span></code></pre></div><p>When using Docker the IAM service is run starting container with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --restart unless-stopped <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.11.0
</span></span></code></pre></div><p><em>Note: <code>--restart</code> is recommended if you want the IAM service to restart automatically
when the server running Docker is restarted.</em></p>
<p>Check the logs with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Adapt the container name to the value you provided to --name in previous command</span>
</span></span><span style="display:flex;"><span>$ docker logs -f iam-login-service
</span></span></code></pre></div><h3 id="podman">Podman</h3>
<p>When using Podman, the <code>docker</code> command must be replaced by <code>podman</code> with the following
differences in options:</p>
<ul>
<li>
<p><code>--restart</code> is silently ignored as start/stop of the container at boot time is controlled
with <code>systemd</code> (see Podman documentation, <a href="https://docs.podman.io/en/latest/markdown/podman-generate-systemd.1.html">here</a>).</p>
</li>
<li>
<p>You need to add option <code>Z</code> to third field of <code>-v</code> option so that the SELinux context
type is properly managed and the use of the volume by another container is prevented.</p>
</li>
<li>
<p>Ensure that the directories containing the environment file and the keystore are
labeled. It can be checked with <code>stat</code> command. If they are unlabeled use the following
command to fix it:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chcon -R -t default_t /path/to/directory
</span></span></code></pre></div></li>
</ul>
<p>The required commands to start the container then become:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ podman network create iam      <span style="color:#8f5902;font-style:italic"># First time only</span>
</span></span><span style="display:flex;"><span>$ podman run -d <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro,Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.11.0
</span></span><span style="display:flex;"><span>$ podman logs -f iam-login-service
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-15a25685d0805dee99efe788f6a68856">5 - Deployment with packages</h1>
    
	<p>IAM can be deployed from packages on the CentOS 7 platform.
Packages and repo files are hosted on the <a href="https://indigo-iam.github.io/repo">INDIGO IAM package repository</a>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    We no longer maintain packages for the Ubuntu platform.

</div>

<h2 id="centos-7">CENTOS 7</h2>
<ol>
<li>Install the INDIGO IAM release key:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo rpm --import https://indigo-iam.github.io/repo/gpgkeys/indigo-iam-release.pub.gpg
</span></span></code></pre></div><ol start="2">
<li>Install the repo files:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum-config-manager --add-repo https://indigo-iam.github.io/repo/repofiles/rhel/indigoiam-stable-el7.repo
</span></span></code></pre></div><ol start="3">
<li>Install packages:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum makecache
</span></span><span style="display:flex;"><span>$ sudo yum install -y iam-login-service
</span></span></code></pre></div><h2 id="iam-service-configuration">IAM service configuration</h2>
<p>The IAM service is configured via a configuration file named <code>iam-login-service</code>
which holds the settings for the environment variables that drive its
configuration (as described in the <a href="/v/v1.11.0/docs/reference/configuration/">configuration reference
section</a>).</p>
<p>The file is located in the following path:</p>
<pre tabindex="0"><code>/etc/sysconfig/iam-login-service
</code></pre><h2 id="run-the-service">Run the service</h2>
<p>The IAM login service is managed by <code>systemd</code>.</p>
<p>To enable the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl <span style="color:#204a87">enable</span> iam-login-service
</span></span></code></pre></div><p>To start the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl start iam-login-service
</span></span></code></pre></div><p>To access the service logs, use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo journalctl -fu iam-login-service
</span></span></code></pre></div><h3 id="deployment-tips">Deployment Tips</h3>
<p>In headless servers, running <code>haveged</code> daemon is recommended to generate more entropy.
Before running the IAM login service, check the available entropy with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /proc/sys/kernel/random/entropy_avail
</span></span></code></pre></div><p>If the obtained value is less than 1000, then <code>haveged</code> daemon is mandatory.</p>
<p>Install EPEL repository:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum install -y epel-release
</span></span></code></pre></div><p>Install Haveged:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum install -y haveged
</span></span></code></pre></div><p>Enable and run the <code>haveged</code> daemon with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl <span style="color:#204a87">enable</span> haveged
</span></span><span style="display:flex;"><span>$ sudo systemctl start haveged
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0fbad79c516bfe14f345bc8ffa80c959">6 - Basic IAM setup</h1>
    
	<p>Most configurable aspects of the IAM are configured via environment variables
and Spring profile directives. For a detailed reference of all the options, see
<a href="/v/v1.11.0/docs/reference/configuration/">the configuration reference</a>.</p>
<p>At the bare minimum you should enable the registration service to let users
register at your organisation (but you can leave it disabled and add users
manually to the organisation using the IAM dashboard if you prefer).</p>
<p>A minimal example configuration is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">IAM_JAVA_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span>-Dspring.profiles.active<span style="color:#ce5c00;font-weight:bold">=</span>prod,registration -Djava.security.egd<span style="color:#ce5c00;font-weight:bold">=</span>file:/dev/./urandom
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>iam.local.io
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_BASE_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_FORWARD_HEADERS_STRATEGY</span><span style="color:#ce5c00;font-weight:bold">=</span>native
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:/keystore.jwks
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>db
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_DB_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_DB_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_DB_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>***********
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_NOTIFICATION_FROM</span><span style="color:#ce5c00;font-weight:bold">=</span>iam@iam.local.io 
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_NOTIFICATION_ADMIN_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>iam-administrators@mail.example
</span></span><span style="display:flex;"><span><span style="color:#000">IAM_MAIL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>smtp.mail.example
</span></span></code></pre></div><p>and has the following meaning:</p>
<ul>
<li><code>IAM_JAVA_OPTS</code> is used to select active profiles (prod, registration) and
tell the JVM to use /dev/urandom as the random number generator;</li>
<li><code>IAM_HOST</code> is the host where the IAM will listen for request; this is the
hostname of the machine exposed to the internet;</li>
<li><code>IAM_BASE_URL</code> is the base URL where the IAM web application will live; the
value for this is typically <code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_ISSUER</code> is the OpenID-connect issuer for the tokens issued by the IAM;
we recommend using the same setting as <code>IAM_BASE_URL</code>, i.e.
<code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_FORWARD_HEADERS_STRATEGY</code> tells the IAM that whether it lives behind a reverse
proxy (i.e., NGINX); in production the value is typically <code>native</code>;</li>
<li><code>IAM_KEY_STORE_LOCATION</code> is the location of the JSON Web keystore generated
as explained <a href="/v/v1.11.0/docs/getting-started/jwk/">here</a>;</li>
<li><code>IAM_DB_*</code> are variables used to set the database endpoint and provide
database access credentials;</li>
<li><code>IAM_NOTIFICATION_FROM</code> sets the sender of administrative notification sent
by the IAM;</li>
<li><code>IAM_NOTIFICATION_ADMIN_ADDRESS</code> sets the email address that will receive
administrative notifications from the IAM;</li>
<li><code>IAM_MAIL_HOST</code> is the SMTP server that IAM will use to deliver
notifications.</li>
</ul>
<p>Deploying and starting the IAM service with the above configuration will give
you an empty service with just one user registered, the <code>admin</code> user.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>As a first thing you should login in the IAM with the following credentials:</p>
<ul>
<li>username: <code>admin</code></li>
<li>password: <code>password</code></li>
</ul>

</div>

<p>and change the password for the admin user, clicking on the <strong>Change password</strong>
button from the admin home page, as shown in the following picture:</p>
<p><img src="../images/admin-change-password.png" alt="Admin change password"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/indigo-iam/iam" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://indigo-iam.slack.com" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">INFN</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/v/v1.11.0/js/main.min.dc2c0119076a0df855e55a8044ce0de74b7b9033c20e853e22d7ec7e9bdde965.js" integrity="sha256-3CwBGQdqDfhV5VqARM4N50t7kDPCDoU&#43;Itfsfpvd6WU=" crossorigin="anonymous"></script>
<script defer src="/v/v1.11.0/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/v/v1.11.0/js/tabpane-persist.js'></script>

  </body>
</html>
