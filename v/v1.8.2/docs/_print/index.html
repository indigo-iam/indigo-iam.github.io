<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.86.0" /><link rel="canonical" type="text/html" href="/v/v1.8.2/docs/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/v/v1.8.2/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/v1.8.2/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/v1.8.2/favicons/android-192x192.png" sizes="192x192">

<title>Documentation | INDIGO IAM</title><meta property="og:title" content="Documentation" />
<meta property="og:description" content="The INDIGO Identity and Access Management (IAM) Service" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/v1.8.2/docs/" /><meta property="og:site_name" content="INDIGO IAM" />

<meta itemprop="name" content="Documentation">
<meta itemprop="description" content="The INDIGO Identity and Access Management (IAM) Service"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Documentation"/>
<meta name="twitter:description" content="The INDIGO Identity and Access Management (IAM) Service"/>







<link rel="preload" href="/v/v1.8.2/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" as="style">
<link href="/v/v1.8.2/scss/main.min.8c56a5db29a8a7bfd7c31c587d450fd15c23c45c8cd6e72142c8ed5b2ef43bd5.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/v/v1.8.2/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">INDIGO IAM</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/v/v1.8.2/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/v/v1.8.2/blog/" ><span>Blog</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/current">v1.8.2</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.1">v1.8.1</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.0">v1.8.0</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.2">v1.7.2</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.1">v1.7.1</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a>
	
	<a class="dropdown-item" href="https://indigo-iam.github.io/docs/v/current/">older releases</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v/v1.8.2/offline-search-index.973853a3644205ea0ad8aadf733bc062.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/v/v1.8.2/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Documentation</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6557438925ac398717df86f494c6abb8">Overview</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-17b09a9dc5200475d8a306f18e63a0f9">Getting Started</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-fc6236dfeced575346afab985c274cf6">NGINX configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.2: <a href="#pg-35c1b78df94e37b0c6b6685e8bdf38f1">Database configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.3: <a href="#pg-c3b64a508ec118f9b76138f613e9ea55">JSON Web Keys configuration</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.4: <a href="#pg-8c741cbaae2d27334f02af82eefdd613">Deployment with Docker</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.5: <a href="#pg-15a25685d0805dee99efe788f6a68856">Deployment with packages</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.6: <a href="#pg-0fbad79c516bfe14f345bc8ffa80c959">Basic IAM setup</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-b00a88a07ceb21b1a83e5822e0c86c1d">Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-6daa71035bbf2489d120742c0452575f">APIs</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1.1: <a href="#pg-4cf000496c71988d9434a973cf0e2217">AUP management API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.2: <a href="#pg-5fe1908b11e147d76a9f8cf472df9011">Proxy certificate API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.3: <a href="#pg-ebde40be0b2aed8de3ec5b48bcd047a5">Group requests API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.4: <a href="#pg-fe8b1ca6774e896cc484138f9e6eabb2">Health checks</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.5: <a href="#pg-7f5c1a9b140b9880ba6f9562e465ba3c">IAM account API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.6: <a href="#pg-c30171a2167f0f6388c6c9ca09e24275">IAM Token management API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.7: <a href="#pg-d7a16cf20db6b5db427da83d3a706289">OAuth token exchange API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.8: <a href="#pg-e7c3f1c0aafd5433deea6bb5120198f0">OAuth token introspection API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.9: <a href="#pg-2210df1e33e69aae2033d3ad614cb1ac">OpenID Connect client management API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.10: <a href="#pg-ebe7e4e7e9878df8afa56df0d05e4322">OpenID Connect client registration API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.11: <a href="#pg-33f82d3baa8becb8dd9398d40b988474">SCIM API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.12: <a href="#pg-43a4bb7d0656895dfb5d3195932b03df">Scope Policy API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.1.13: <a href="#pg-f53010d8ceeb59269840cbdb81da1bbb">Token exchange policy API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-546d6976fff9de02db89bd2588e84da3">Configuration</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.2.1: <a href="#pg-978b7edb20fd49ffb034f6d6573a9e60">JWT profiles support</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.2: <a href="#pg-371b1935a2a5c2cbff937a267fe80317">MitreID System Scopes</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.3: <a href="#pg-ee84b111d6aee6b44b8e068e0995e8c2">Membership lifecycle</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.4: <a href="#pg-5fd21a888f7bdca41388e3b3fa887277">Integration with RCAuth</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.5: <a href="#pg-2501923ff9f1258a5dc95b7435579a75">Registration &amp; Enrollment</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.6: <a href="#pg-63d7a6556648cdd8622cf2321f13a835">JSON Web Keys (JWK)</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.7: <a href="#pg-b153a1aec7140b2aa27a0ba03e8dc3fd">Local authentication</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.8: <a href="#pg-359104377f9341d4c326d45fb209b4c2">External authentication</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.2.8.1: <a href="#pg-ac3ba36ba3318b338bcbf439e1b79e60">OpenID-Connect authentication</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.8.2: <a href="#pg-af611b856fca4d6771e3e3ed962701b5">SAML authentication</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.2.8.3: <a href="#pg-86d359d1731c5e164863d1bbe93a7bcf">X.509 authentication</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-f8918f697450c2009b75913f9e9317a5">Tasks</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-18193143b4ee08bf7ab15851bbaded55">IAM organization administration</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1.1: <a href="#pg-f9feafc0e8f5414b97d15e7385f9f5be">User management</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.1.2: <a href="#pg-e54da204360bf0baa8af45da22015dee">Group Management</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.1.3: <a href="#pg-f03d307094fc23ef6cf17d7a8b313135">Acceptable Usage Policy (AUP) management</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>4.2: <a href="#pg-0d446af92e463090d9e1b94f286038c9">IAM service deployment</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.2.1: <a href="#pg-f9c47943a3e72ee39a36f76a84d7aef8">Backup &amp; Restore</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.2.2: <a href="#pg-20612c101bee3438f511834eec95ece8">Audit log</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.2.3: <a href="#pg-0f3983ccaecafb6944a18b6d8550a571">Upgrade</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.2.4: <a href="#pg-c5846d016af443a2f547d87bba4a3f62">Deploying IAM in HA</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.2.5: <a href="#pg-16b818f0193a0e55e0f1cffd093e8e01">Deploying the IAM VOMS attribute authority</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.2.6: <a href="#pg-cf4d164c71ad46c16dc1a41d06c2a98e">Importing VOMS information into IAM</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>4.3: <a href="#pg-43bda8bc26d1df36bc9eb8d9739f719e">IAM Test Client application</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4: <a href="#pg-dbcc046a6c208e0a089e20aecc2dbaec">User</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.4.1: <a href="#pg-fc4a8820c0610ad9186b42bb179cd4bf">Joining an IAM-managed organization</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.2: <a href="#pg-afefc91265853008615d0ff910cb6bb9">Obtaining an IAM access token from a CLI</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.3: <a href="#pg-9a8717b724b3cc965f31246cbdd60946">Registering a client</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.4: <a href="#pg-5f7a8f5e4030289ede0cce345878ff5f">Change account information</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.5: <a href="#pg-9425af354278fe0b0806e2532bbb465a">Changing the account password</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.6: <a href="#pg-606d8ee94cbe5ccb53556270df85092f">JWT client authentication</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.7: <a href="#pg-e361335b1cc62574d28cc081294326a2">Linking an external account</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.8: <a href="#pg-93f6e460a9484b5a1f15cf389f229f2c">Linking an X.509 certificate</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.9: <a href="#pg-725f368abb7a0345d6635f33b8848b53">Managing active tokens</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.10: <a href="#pg-56a163f5aefc17b464cd248874936cf9">Managing approved sites</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.11: <a href="#pg-c0adc169e351e3ffdad1a9ceff1b6c19">Managing SSH keys</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4.4.12: <a href="#pg-b4fb7a916a4b238a27bb4f7882cb6eb6">Reset an account password</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-a7c9e10a31abdecaec5a338462a220a8">Developer guide</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-69f27a09ffee79bd86aeda89b3a9f7db">Specifications and useful resources</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-63fc23311c2c31b8d70578804ff3e9bf">IAM as a service</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-9b5fde25ef80658078bd874ca68c417e">Privacy policy</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>6.2: <a href="#pg-452aae889b1b87431dde6278fe49d79f">Service Level Agreement</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>6.3: <a href="#pg-18e490e904e7b85f52606bd034f1ec81">Terms of service</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  

    </ul>


<div class="content">
      <p>for IAM v1.8.2</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6557438925ac398717df86f494c6abb8">1 - Overview</h1>
    <div class="lead">A brief overview of the INDIGO IAM service</div>
	<p>The INDIGO Identity and Access Management (IAM) Service provides a layer where
identities, enrollment, group membership and other attributes and authorization
policies on distributed resources can be managed in an homogeneous way,
supporting identity federations and other authentication mechanisms (X.509
certificates and social logins).</p>
<p>IAM implements the Virtual Organization (VO) concept, and is the developed by
the same team behind <a href="https://italiangrid.github.io/voms">VOMS</a>.</p>
<p>IAM is the AAI solution chosen to power the next generation <a href="https://wlcg.web.cern.ch/">WLCG</a>
Authentication and Authorization infrastructure.</p>
<h2 id="functions">Functions</h2>
<ul>
<li><strong>Flexible authentication</strong>: The IAM supports user authentication via local
username and password credentials as well as SAML Identity Federations,
OpenID Connect providers and X.509.</li>
<li><strong>Enrollment</strong>: The IAM provides VO enrollment and registration functionalities,
so that users can join groups/collaborations according to well-defined flows.</li>
<li><strong>Attribute and identity management</strong>: The IAM provides services to manage
group membership, attributes assignment and account linking functionality.</li>
<li><strong>User provisioning</strong>: the IAM provides endpoints to provision information
about users identities to other services, so that consistent local account
provisioning, for example, can be implemented.</li>
</ul>
<h2 id="integrations">Integrations</h2>
<p>The IAM service has been succesfully integrated with many off-the-shelf
components like Openstack, Kubernetes, Atlassian JIRA and Confluence, Grafana
and with key Grid computing middleware services (e.g., <a href="https://rucio.cern.ch/">RUCIO</a>,
<a href="https://fts.web.cern.ch/fts/">FTS</a>, <a href="https://www.dcache.org/">dCache</a>, <a href="https://italiangrid.github.io/storm">StoRM</a>, <a href="https://xrootd.slac.stanford.edu/index.html">XRootD</a>,
<a href="https://research.cs.wisc.edu/htcondor/">HTCondor</a>).</p>
<h2 id="service-access-options">Service access options</h2>
<h3 id="iam-as-a-service">IAM as a service</h3>
<p>INFN provides IAM as a service to partner research communities. In this
scenario, a dedicated IAM instance is deployed on the INFN infrastructure and
configured according to the community needs. INFN takes care of keeping the
service operational and up-to-date, while administrative control on the IAM
instance is granted to the community.</p>
<p>For more information on how to access IAM as a service, click
<a href="/v/v1.8.2/docs/iam-aas/">here</a>.</p>
<h3 id="on-premise-deployment">On-premise deployment</h3>
<p>IAM is an Apache-licensed identity solution, for which we provide a Docker
image on dockerhub and RPM packages.</p>
<p>IAM can be deployed on-premises following the advice in the <a href="/v/v1.8.2/docs/getting-started/">Deployment
guide</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-17b09a9dc5200475d8a306f18e63a0f9">2 - Getting Started</h1>
    <div class="lead">A quick howto on how to deploy IAM</div>
	<p>This section provides insight on how to deploy and configure an IAM service
instance.</p>
<p>IAM is a <a href="https://spring.io/projects/spring-boot">spring boot application</a> designed to run behind an <a href="https://www.nginx.com/">NGINX</a>
reverse proxy, which is used for TLS termination and possibly load balancing.
The IAM service instances keep all state in a MariaDB/MySQL database, as shown
in the following picture:</p>
<p><img src="images/iam-deployment.png" alt="IAM deployment overview"></p>
<h2 id="prerequisites">Prerequisites</h2>
<p>At the bare minimum, to run a production instance of the instance of the IAM
you will need:</p>
<ul>
<li>An X.509 certificate, used for SSL termination at the NGINX reverse proxy;
you can get one for free from <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>;</li>
<li>An NGINX server configured to act as a reverse proxy for the IAM web
application; more details on this in the <a href="nginx">NGINX section</a>;</li>
<li>A MariaDB/MySQL database instance; more on this in the <a href="mariadb">database
configuration</a>
section;</li>
<li>A JSON keystore holding the keys used to sign JSON Web Tokens; more on this
in the <a href="jwk">JWK section</a>;</li>
</ul>
<p>You will also need to choose whether you want to deploy you service as a
<a href="docker">docker container</a> (recommended) or install from
<a href="packages">packages</a>.</p>
<p>And finally, you will have to setup a minimal IAM configuration and change the
administrator password for the newly configured IAM service; more on this
<a href="basic_setup">in the basic configuration section</a>.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc6236dfeced575346afab985c274cf6">2.1 - NGINX configuration</h1>
    
	<p>IAM relies on NGINX for TLS termination and load balancing.</p>
<p>The example configuration below provides the minimal configuration needed to
have NGINX working as a reverse proxy for the IAM web application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#204a87;font-weight:bold">server</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">listen</span> <span style="color:#0000cf;font-weight:bold">80</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">listen</span> <span style="color:#4e9a06">[::]:80</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">server_name</span> <span style="color:#4e9a06">_</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">301</span> <span style="color:#4e9a06">https://</span><span style="color:#000">$host$request_uri</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">server</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">listen</span>        <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">ssl</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">server_name</span>   <span style="color:#4e9a06">YOUR_HOSTNAME_HERE</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">access_log</span>   <span style="color:#4e9a06">/var/log/nginx/iam.access.log</span>  <span style="color:#4e9a06">combined</span><span style="color:#000;font-weight:bold">;</span>

  <span style="color:#204a87;font-weight:bold">ssl</span> <span style="color:#000">on</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_protocols</span> <span style="color:#4e9a06">TLSv1</span> <span style="color:#4e9a06">TLSv1.1</span> <span style="color:#4e9a06">TLSv1.2</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_certificate</span>      <span style="color:#4e9a06">/path/to/your/ssl/cert.pem</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#204a87;font-weight:bold">ssl_certificate_key</span>  <span style="color:#4e9a06">/path/to/your/ssl/key.pem</span><span style="color:#000;font-weight:bold">;</span>

  <span style="color:#204a87;font-weight:bold">location</span> <span style="color:#4e9a06">/</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">proxy_pass</span>              <span style="color:#4e9a06">http://THE_IAM_APP_HOSTNAME_HERE:8080</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Real-IP</span> <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-For</span> <span style="color:#000">$proxy_add_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-Forwarded-Proto</span> <span style="color:#4e9a06">https</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">Host</span> <span style="color:#000">$http_host</span><span style="color:#000;font-weight:bold">;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="x509-client-authentication">X.509 client authentication</h2>
<p>IAM supports X.509 client certificate authentication. To enable X.509 client
certificate authentication use a configuration similar to the
<a href="https://github.com/indigo-iam/iam/blob/master/docker/nginx/iam.conf">one</a> used
in the IAM development environment.</p>
<p>In particular, set the <code>ssl_verify_client=Optional</code> option and configure the <code>proxy_set_header</code>
directory as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Cert</span> <span style="color:#000">$ssl_client_cert</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-I-Dn</span> <span style="color:#000">$ssl_client_i_dn</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-S-Dn</span> <span style="color:#000">$ssl_client_s_dn</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Serial</span> <span style="color:#000">$ssl_client_serial</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-Start</span> <span style="color:#000">$ssl_client_v_start</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-V-End</span>   <span style="color:#000">$ssl_client_v_end</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Client-Verify</span>  <span style="color:#000">$ssl_client_verify</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Protocol</span> <span style="color:#000">$ssl_protocol</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">proxy_set_header</span>        <span style="color:#4e9a06">X-SSL-Server-Name</span> <span style="color:#000">$ssl_server_name</span><span style="color:#000;font-weight:bold">;</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-35c1b78df94e37b0c6b6685e8bdf38f1">2.2 - Database configuration</h1>
    
	<p>IAM keeps state in a MariaDB/MySQL database, and will need its own schema and a
user that has read/write/schema change privileges on such database.</p>
<p>IAM has been tested successfully against:</p>
<ul>
<li>MySQL v. 5.5.5</li>
<li>MariaDB v. 10.1.22</li>
</ul>
<p>For more instructions on how to create a database schema and a user with
administrator privileges on it, see the <a href="https://mariadb.com/kb/en/">MariaDB documentation</a>.</p>
<p>Assuming the organization that IAM will manage is called <code>test</code>, the following
commands can be used  to create a database and a user for the IAM application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">DATABASE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">CHARACTER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">SET</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">COLLATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">latin1_swedish_ci</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">GRANT</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">ALL</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">PRIVILEGES</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam_test_db</span><span style="color:#000;font-weight:bold">.</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">to</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;iam_test&#39;</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#4e9a06">&#39;%&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">identified</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">by</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;some_super_secure_password&#39;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>You may want to restrict the set of hosts from which a mysql client can connect
to the database with the above credentials according to your deployment needs.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c3b64a508ec118f9b76138f613e9ea55">2.3 - JSON Web Keys configuration</h1>
    
	<p>JSON web keys are used by the IAM to sign and verify token signatures.</p>
<p>To generate a JSON web key for your IAM deployment, you can use the
<a href="https://github.com/mitreid-connect/json-web-key-generator">json-web-key-generator</a> tool provided by MitreID connect.</p>
<p>The following command clones the <code>json-web-key-generator</code> Git repository to a
local directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.com/mitreid-connect/json-web-key-generator
</code></pre></div><p>Build the code with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mvn package
</code></pre></div><p>Maven 3.6.x or greater supporting Java 11 is required.</p>
<p>You can then generate a key with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">java -jar target/json-web-key-generator-0.9-SNAPSHOT-jar-with-dependencies.jar <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t RSA -s <span style="color:#0000cf;font-weight:bold">1024</span> -S -i rsa1


Full key:
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;keys&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;p&#34;</span>: <span style="color:#4e9a06">&#34;3oh7ex6zgdmJh5NBD0IplmBDDGC2ECu2A1vcp8e8DqE7OSSpAc1T9tTjJioCGqkNM51JK_MtgCJz1CiysVDOQQ&#34;</span>,
      <span style="color:#4e9a06">&#34;kty&#34;</span>: <span style="color:#4e9a06">&#34;RSA&#34;</span>,
      <span style="color:#4e9a06">&#34;q&#34;</span>: <span style="color:#4e9a06">&#34;nRmBm5tQ2wmOtd1XUYDRH2qWai6eElt-1cvO5tnTdWZkFaAeaHQ3_xf_PFOjyAv5Y5rNLgf_Xbu9UCo_mSrDMQ&#34;</span>,
      <span style="color:#4e9a06">&#34;d&#34;</span>: <span style="color:#4e9a06">&#34;BGHRhQP6ADqqSrM8_mI0YhjGStj1aW9rLi7wXQMJ122kegPxIT7dfP-5UScxykD_BrCCHQVPxdJl5wXy-giZnhaL9wtDkOXb8D8RCi1n02cs3Z1T23xONi_AG47QPBZjM5GcX-oOGCENByuEIdkU_Bn6vvqM3oyVlj5sio7tNAE&#34;</span>,
      <span style="color:#4e9a06">&#34;e&#34;</span>: <span style="color:#4e9a06">&#34;AQAB&#34;</span>,
      <span style="color:#4e9a06">&#34;kid&#34;</span>: <span style="color:#4e9a06">&#34;rsa1&#34;</span>,
      <span style="color:#4e9a06">&#34;qi&#34;</span>: <span style="color:#4e9a06">&#34;RarXtTFCE3hk5ZanLWEapDnn7SLSxAvDcBTmG5SpCI9Eix7cfTigaK6N7OQIN0uGO1GJ-KVWL2v8dyI1jMoU6g&#34;</span>,
      <span style="color:#4e9a06">&#34;dp&#34;</span>: <span style="color:#4e9a06">&#34;MtBtieavzMXUzr2ETKyp_GmMxeXLjRO-IzQ1xaYpPhn5AQprATtWofVozQ0on9fcaN3QmJWV3T2Av4BvlWfDQQ&#34;</span>,
      <span style="color:#4e9a06">&#34;dq&#34;</span>: <span style="color:#4e9a06">&#34;CWJ7rpsBooQYpV6al8DVPUY1xBQS10_l7MmnC31Zt3qtYelVx7GhoriBQ85PS2UDueKGfUh3BddwQLi1YeX_EQ&#34;</span>,
      <span style="color:#4e9a06">&#34;n&#34;</span>: <span style="color:#4e9a06">&#34;iI_fuJq4z_9VQY5EH41sQWOAYUsjtxAFjRnAc1P5-GPOx3Izg9V7yKNmudLUt-jIkv6D5h-AzrhEV6DOdBRoiN4el1mCZ95jiJkjU2kpVOmutDysZkrn667zPd43w7E6IqHnahmMrVUjUyx6pie1SqJHLUXghz8Gle-1yi08_XE&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Save the output of the above command (minus the <code>Full key:</code> initial text) in a
file, e.g. <code>keystore.jwks</code>.</p>
<p>See <a href="/v/v1.8.2/docs/reference/configuration/jwk/">JSON Web Keys (JWK)</a> reference page for more details about configuration of JSON web keys.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8c741cbaae2d27334f02af82eefdd613">2.4 - Deployment with Docker</h1>
    
	<p>The IAM service is provided on the following DockerHub repositories:</p>
<ul>
<li><a href="https://hub.docker.com/r/indigoiam/iam-login-service/">indigoiam/iam-login-service</a></li>
</ul>
<p>The docker image tag corresponding to this version of the documentation is:</p>


<div class="pageinfo pageinfo-primary">
<p>indigoiam/iam-login-service:v1.8.2</p>

</div>

<p>The IAM image has been tested to run properly with either Docker or Podman. The configuration for the
IAM service container is the same but the details to run the container slightly differ. Differences
are covered in the next sections. In both cases, it is <strong>highly</strong> recommended to enable SELinux for
increased security.</p>
<h2 id="configuring-the-iam-service">Configuring the IAM service</h2>
<p>Prepare an environment file that will contain the environment variables
settings for the IAM service container. See <a href="/v/v1.8.2/docs/reference/configuration/">the configuration
reference</a> for a description of the variables.</p>
<p>This environment file will be passed to the container with the <code>--env-file</code> option of the
container engine. You can choose whatever file path/name you want.</p>
<h2 id="running-the-container">Running the container</h2>
<h3 id="docker">Docker</h3>
<p>First create a Docker network for the IAM service with the command (the example uses
the network name <code>iam</code> but you are free to use another name as long as you use the same
one in the <code>run</code>command). It has to be done once (not at every restart of the container):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker network create iam
</code></pre></div><p>When using Docker the IAM service is run starting container with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run -d <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --restart unless-stopped <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.8.2
</code></pre></div><p><em>Note: <code>--restart</code> is recommended if you want the IAM service to restart automatically
when the server running Docker is restarted.</em></p>
<p>Check the logs with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#8f5902;font-style:italic"># Adapt the container name to the value you provided to --name in previous command</span>
$ docker logs -f iam-login-service
</code></pre></div><h3 id="podman">Podman</h3>
<p>When using Podman, the <code>docker</code> command must be replaced by <code>podman</code> with the following
differences in options:</p>
<ul>
<li>
<p><code>--restart</code> is silently ignored as start/stop of the container at boot time is controlled
with <code>systemd</code> (see Podman documentation, <a href="https://docs.podman.io/en/latest/markdown/podman-generate-systemd.1.html">here</a>).</p>
</li>
<li>
<p>You need to add option <code>Z</code> to third field of <code>-v</code> option so that the SELinux context
type is properly managed and the use of the volume by another container is prevented.</p>
</li>
<li>
<p>Ensure that the directories containing the environment file and the keystore are
labeled. It can be checked with <code>stat</code> command. If they are unlabeled use the following
command to fix it:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ chcon -R -t default_t /path/to/directory
</code></pre></div></li>
</ul>
<p>The required commands to start the container then become:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ podman network create iam      <span style="color:#8f5902;font-style:italic"># First time only</span>
$ podman run -d <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro,Z <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.8.2
$ podman logs -f iam-login-service
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-15a25685d0805dee99efe788f6a68856">2.5 - Deployment with packages</h1>
    
	<p>IAM can be deployed from packages on the CentOS 7 platform.
Packages and repo files are hosted on the <a href="https://indigo-iam.github.io/repo">INDIGO IAM package repository</a>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    We no longer maintain packages for the Ubuntu platform.

</div>

<h2 id="centos-7">CENTOS 7</h2>
<ol>
<li>Install the INDIGO IAM release key:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo rpm --import https://indigo-iam.github.io/repo/gpgkeys/indigo-iam-release.pub.gpg
</code></pre></div><ol start="2">
<li>Install the repo files:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum-config-manager --add-repo https://indigo-iam.github.io/repo/repofiles/rhel/indigoiam-stable-el7.repo
</code></pre></div><ol start="3">
<li>Install packages:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum makecache
$ sudo yum install -y iam-login-service
</code></pre></div><h2 id="iam-service-configuration">IAM service configuration</h2>
<p>The IAM service is configured via a configuration file named <code>iam-login-service</code>
which holds the settings for the environment variables that drive its
configuration (as described in the <a href="/v/v1.8.2/docs/reference/configuration/">configuration reference
section</a>).</p>
<p>The file is located in the following path:</p>
<pre><code>/etc/sysconfig/iam-login-service
</code></pre><h2 id="run-the-service">Run the service</h2>
<p>The IAM login service is managed by <code>systemd</code>.</p>
<p>To enable the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl <span style="color:#204a87">enable</span> iam-login-service
</code></pre></div><p>To start the service use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl start iam-login-service
</code></pre></div><p>To access the service logs, use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo journalctl -fu iam-login-service
</code></pre></div><h3 id="deployment-tips">Deployment Tips</h3>
<p>In headless servers, running <code>haveged</code> daemon is recommended to generate more entropy.
Before running the IAM login service, check the available entropy with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cat /proc/sys/kernel/random/entropy_avail
</code></pre></div><p>If the obtained value is less than 1000, then <code>haveged</code> daemon is mandatory.</p>
<p>Install EPEL repository:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y epel-release
</code></pre></div><p>Install Haveged:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y haveged
</code></pre></div><p>Enable and run the <code>haveged</code> daemon with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl <span style="color:#204a87">enable</span> haveged
$ sudo systemctl start haveged
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0fbad79c516bfe14f345bc8ffa80c959">2.6 - Basic IAM setup</h1>
    
	<p>Most configurable aspects of the IAM are configured via environment variables
and Spring profile directives. For a detailed reference of all the options, see
<a href="/v/v1.8.2/docs/reference/configuration/">the configuration reference</a>.</p>
<p>At the bare minimum you should enable the registration service to let users
register at your organisation (but you can leave it disabled and add users
manually to the organisation using the IAM dashboard if you prefer).</p>
<p>A minimal example configuration is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">IAM_JAVA_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span>-Dspring.profiles.active<span style="color:#ce5c00;font-weight:bold">=</span>prod,registration -Djava.security.egd<span style="color:#ce5c00;font-weight:bold">=</span>file:/dev/./urandom
<span style="color:#000">IAM_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>iam.local.io
<span style="color:#000">IAM_BASE_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
<span style="color:#000">IAM_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io
<span style="color:#000">IAM_FORWARD_HEADERS_STRATEGY</span><span style="color:#ce5c00;font-weight:bold">=</span>native
<span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:/keystore.jwks
<span style="color:#000">IAM_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>db
<span style="color:#000">IAM_DB_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
<span style="color:#000">IAM_DB_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam
<span style="color:#000">IAM_DB_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>***********
<span style="color:#000">IAM_NOTIFICATION_FROM</span><span style="color:#ce5c00;font-weight:bold">=</span>iam@iam.local.io 
<span style="color:#000">IAM_NOTIFICATION_ADMIN_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>iam-administrators@mail.example
<span style="color:#000">IAM_MAIL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>smtp.mail.example
</code></pre></div><p>and has the following meaning:</p>
<ul>
<li><code>IAM_JAVA_OPTS</code> is used to select active profiles (prod, registration) and
tell the JVM to use /dev/urandom as the random number generator;</li>
<li><code>IAM_HOST</code> is the host where the IAM will listen for request; this is the
hostname of the machine exposed to the internet;</li>
<li><code>IAM_BASE_URL</code> is the base URL where the IAM web application will live; the
value for this is typically <code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_ISSUER</code> is the OpenID-connect issuer for the tokens issued by the IAM;
we recommend using the same setting as <code>IAM_BASE_URL</code>, i.e.
<code>https://${IAM_HOST}</code>;</li>
<li><code>IAM_FORWARD_HEADERS_STRATEGY</code> tells the IAM that whether it lives behind a reverse
proxy (i.e., NGINX); in production the value is typically <code>native</code>;</li>
<li><code>IAM_KEY_STORE_LOCATION</code> is the location of the JSON Web keystore generated
as explained <a href="/v/v1.8.2/docs/getting-started/jwk/">here</a>;</li>
<li><code>IAM_DB_*</code> are variables used to set the database endpoint and provide
database access credentials;</li>
<li><code>IAM_NOTIFICATION_FROM</code> sets the sender of administrative notification sent
by the IAM;</li>
<li><code>IAM_NOTIFICATION_ADMIN_ADDRESS</code> sets the email address that will receive
administrative notifications from the IAM;</li>
<li><code>IAM_MAIL_HOST</code> is the SMTP server that IAM will use to deliver
notifications.</li>
</ul>
<p>Deploying and starting the IAM service with the above configuration will give
you an empty service with just one user registered, the <code>admin</code> user.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>As a first thing you should login in the IAM with the following credentials:</p>
<ul>
<li>username: <code>admin</code></li>
<li>password: <code>password</code></li>
</ul>


</div>

<p>and change the password for the admin user, clicking on the <strong>Change password</strong>
button from the admin home page, as shown in the following picture:</p>
<p><img src="../images/admin-change-password.png" alt="Admin change password"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b00a88a07ceb21b1a83e5822e0c86c1d">3 - Reference</h1>
    <div class="lead">IAM API &amp; configuration reference documentation</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6daa71035bbf2489d120742c0452575f">3.1 - APIs</h1>
    <div class="lead">IAM APIs</div>
	<p>IAM provides a set of APIs that can be used for authentication, authorization
and IAM administration purposes.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4cf000496c71988d9434a973cf0e2217">3.1.1 - AUP management API</h1>
    
	<p>IAM provides a RESTful API that can be used to manage the IAM
Acceptable Usage Policy (AUP) configuration.</p>
<h3 id="get-iamaup">GET /iam/aup</h3>
<p>Returns a JSON representation of the Acceptable Usage Policy (AUP) for the
organization.</p>
<p><strong>Authentication required</strong>: no</p>
<h4 id="success-response">Success response</h4>
<p><strong>Condition</strong>: The AUP is defined for the organization</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content</strong>: A JSON representation of the AUP</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;text&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;This is my AUP text&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Note: <code>text</code> is returned for backward compatible calls.</p>
<h4 id="error-response">Error response</h4>
<p><strong>Condition</strong>: The AUP is not defined for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;AUP is not defined for this organization&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="post-iamaup">POST /iam/aup</h3>
<p>Creates the AUP for the organization</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the AUP to be created</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">not</span> <span style="color:#a40000">blank</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">128</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">integer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Data example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-1">Success response</h4>
<p><strong>Condition</strong>: The AUP is created for the organization</p>
<p><strong>Code</strong>: <code>201 CREATED</code></p>
<h4 id="error-responses">Error responses</h4>
<p><strong>Condition</strong>: The AUP already exists</p>
<p><strong>Code</strong>: <code>409 CONFLICT</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AUP already exists&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Missing or invalid fields in the AUP representation</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="patch-iamaup">PATCH /iam/aup</h3>
<p>Updates the AUP for the organization</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the AUP to be patched</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">url</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">not</span> <span style="color:#a40000">blank</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">128</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">integer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Data example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">365</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-2">Success response</h4>
<p><strong>Condition</strong>: The AUP is modified for the organization</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content example</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T19:51:39.083+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T19:53:49.557+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;signatureValidityInDays&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://somehost.example.org/aup&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="error-responses-1">Error responses</h4>
<p><strong>Condition</strong>: Missing or invalid fields in the AUP representation</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="delete-iamaup">DELETE /iam/aup</h3>
<p>Deletes the AUP for the organization.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: ROLE_ADMIN</p>
<h4 id="success-response-3">Success response</h4>
<p><strong>Condition</strong>: The AUP is defined for the organization</p>
<p><strong>Code</strong>: <code>204 NO CONTENT</code></p>
<h4 id="error-responses-2">Error responses</h4>
<p><strong>Condition</strong>: The AUP is not defined for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AUP is not defined for this organization&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5fe1908b11e147d76a9f8cf472df9011">3.1.2 - Proxy certificate API</h1>
    
	<p>IAM provides a RESTful API that can be used to download the X.509 proxy certificate previously uploaded in IAM dashboard by the user.<br>
This is a plain proxy obtained by running <code>voms-proxy-init</code> command.</p>
<p>The API has been added mainly for the integration of IAM with the <a href="http://rcauth.eu/">RCAuth.eu</a> online certificate authority. The X.509 proxy certificate can be uploaded using the <a href="/docs/reference/api/account-api/#proxy-certificate">IAM Account Proxy Certificate API</a>.</p>
<p>The <code>proxy:generate</code> OAuth scope is required to access this API.<br>
Note that this scope is restricted in the default IAM configuration,
i.e. can be assigned to clients only by IAM administrators.</p>
<h2 id="post-iamproxycert">POST <code>/iam/proxycert</code></h2>
<p>Returns a JSON representation of the proxy certificate of the user.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -s -X POST -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">BT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">client_id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_ID</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">client_secret</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_SECRET</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">lifetimeSecs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">PROXY_CERT_LIFETIME_SECS</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/proxycert
</code></pre></div><p>The user can request a specific lifetime of the proxy
that is less than or equal to the maximum lifetime of the proxy itself
and also limited by IAM configuration options <code>max-ac-lifetime-in-seconds</code>
(as shown in <a href="/docs/tasks/deployment/voms/#voms-aa-configuration">VOMS AA configuration</a>).</p>
<p>IAM response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CN=2050153474,CN=813462308,CN=John Doe jdoe@infn.it,O=Istituto Nazionale di Fisica Nucleare,C=IT,DC=tcs,DC=terena,DC=org&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CN=813462308,CN=John Doe jdoe@infn.it,O=Istituto Nazionale di Fisica Nucleare,C=IT,DC=tcs,DC=terena,DC=org&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;identity&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CN=John Doe jdoe@infn.it,O=Istituto Nazionale di Fisica Nucleare,C=IT,DC=tcs,DC=terena,DC=org&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;not_after&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;1663991299000&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;certificate_chain&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;-----BEGIN CERTIFICATE-----\nMI...lCU=\n-----END CERTIFICATE-----\n&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ebde40be0b2aed8de3ec5b48bcd047a5">3.1.3 - Group requests API</h1>
    
	<p>IAM Login Service provides a RESTful API to create and manage group membership requests.</p>
<h2 id="post-iamgroup_requests">POST /iam/group_requests</h2>
<p>Create a new group membership request.
The body of the request must contain a JSON with the group name and a motivation
of the submitted request.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response">Success response</h3>
<p><strong>Conditions</strong>:</p>
<ul>
<li>The user is authenticated;</li>
<li>the user is not already member of the requested group;</li>
<li>a request from the user for such group does not exist.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: A JSON representation of the new request.</p>
<h3 id="error-response">Error response</h3>
<p><strong>Condition</strong>: The user is not authenticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>: A JSON with the error description.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Condition</strong>: The request already exists.</p>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with the error description.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group membership request already exist for [test, Test-001]&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">POST</span> <span style="color:#000">/iam/group_requests</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>

<span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Test API&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011676</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamgroup_requests">GET /iam/group_requests</h2>
<p>Returns a paginated list of group requests.
The list can be filtered by username, group name or request status.
Users with administrative privileges can list all requests;
other users only the requests they submitted.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-1">Success response</h3>
<p><strong>Condition</strong>: The user is authenticated.</p>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: A JSON representation of the request list.</p>
<h3 id="error-response-1">Error response</h3>
<p><strong>Condition</strong>: The user is not autheticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-1">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">GET</span> <span style="color:#000">/iam/group_requests/?groupName=Test-001&amp;status=PENDING</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>

</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233012000</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;b28790d4-90d4-471f-8b85-79d5fd761b8c&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test_100&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamgroup_requestsuuid">GET /iam/group_requests/{uuid}</h2>
<p>Returns the details about a group request.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-2">Success response</h3>
<p><strong>Condition</strong>: The user is authenticated and can access the request
(privileged users can access all request, other users only the requests they submitted).</p>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the group membership request.</p>
<h3 id="error-response-2">Error response</h3>
<p><strong>Condition</strong>: The user is not authenticated.</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Condition</strong>: User is not authorized to access the group request.</p>
<p><strong>Code</strong>: <code>403 Forbidden</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a40000">Access is denied
</span></code></pre></div><p><strong>Condition</strong>: A request linked to the given id does not exist.</p>
<p><strong>Code</strong>: <code>400 Bad request</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [d5b652b2-4bb5-401a] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-2">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">GET</span> <span style="color:#000">/iam/group_requests/d5b652b2-4bb5-401a-bfb9-a795353798b3</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PENDING&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233012000</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="delete-iamgroup_requestsuuid">DELETE /iam/group_requests/{uuid}</h2>
<p>Deletes a group request.
Administrators can delete any request, users can only delete the <code>PENDING</code> requests
they previously submitted.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-3">Success response</h3>
<p><strong>Condition</strong>: A request linked to the given id exists.</p>
<p><strong>Code</strong>: <code>204 No Content</code></p>
<p><strong>Content</strong>: Empty body</p>
<h3 id="error-response-3">Error response</h3>
<p><strong>Condition</strong>: A request linked to the given id does not exist.</p>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [b28790d4-90d4-471f-8b85-79d5fd761b8c] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-3">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">DELETE</span> <span style="color:#000">/iam/group_requests/b28790d4-90d4-471f-8b85-79d5fd761b8c</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><h2 id="post-iamgroup_requestsuuidapprove">POST /iam/group_requests/{uuid}/approve</h2>
<p>Approves a group request.
Only administrators can approve requests.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-4">Success response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The user is authenticated and has administrative privileges;</li>
<li>the request is in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the updated group membership request.</p>
<h3 id="error-response-4">Error response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The request doesn&rsquo;t exist;</li>
<li>The request isn&rsquo;t in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [b28790d4-90d4-471f-8b85-79d5fd761b8c] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Invalid group request transition: APPROVED -&gt; APPROVED&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-4">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#000">POST</span> <span style="color:#000">/iam/group_requests/d5b652b2-4bb5-401a-bfb9-a795353798b3/approve</span> <span style="color:#204a87;font-weight:bold">HTTP</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1.1</span>
<span style="color:#000">Host</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">iam.local.io</span>
<span style="color:#000">Content-Type</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">application/json</span>
<span style="color:#000">Cache-Control</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">no-cache</span>
</code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;d5b652b2-4bb5-401a-bfb9-a795353798b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;APPROVED&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524233011000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524238898590</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="post-iamgroup_requestsuuidreject">POST /iam/group_requests/{uuid}/reject</h2>
<p>Rejects a group request.
A <code>motivation</code> parameter is required.
Only administrators can reject requests.</p>
<p><strong>Authentication required</strong>: true</p>
<h3 id="success-response-5">Success response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The user is authenticated and has administrative privileges;</li>
<li>the request is in <code>PENDING</code> status.</li>
</ul>
<p><strong>Code</strong>: <code>200 Ok</code></p>
<p><strong>Content</strong>: The JSON representation of the updated group membership request.</p>
<h3 id="error-response-5">Error response</h3>
<p><strong>Condition</strong>:</p>
<ul>
<li>The request doesn&rsquo;t exist;</li>
<li>The request isn&rsquo;t in <code>PENDING</code> status;</li>
<li>The motivation required request parameter is missing.</li>
</ul>
<p><strong>Code</strong>: <code>400 Bad Request</code></p>
<p><strong>Content</strong>: A JSON with an error message representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Invalid group request transition: APPROVED -&gt; REJECTED&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group request with UUID [d5b652b2-4bb5-401a-bfb9-a79535379b3] does not exist&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="example-5">Example</h4>
<p>Request:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a40000">POST /iam/group_requests/b28790d4-90d4-471f-8b85-79d5fd761b8c/reject?motivation=Test API HTTP/1.1
</span><span style="color:#a40000">Host: iam.local.io
</span><span style="color:#a40000">Content-Type: application/json
</span><span style="color:#a40000">Cache-Control: no-cache
</span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;b28790d4-90d4-471f-8b85-79d5fd761b8c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test_100&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;REJECTED&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;notes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;motivation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test API&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;groupName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test-001&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524237532000</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1524238811254</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fe8b1ca6774e896cc484138f9e6eabb2">3.1.4 - Health checks</h1>
    
	<p>The IAM Login Service exposes a set of health endpoints that can be used to
monitor the status of the service.</p>
<p>Health endpoints expose a different set of information depending on the user
privileges; requests from the <em>Actuator</em> user will see more details, while
anonymous requests typically receive only a summary of the health status.</p>
<p>The Actuator role has been introduced in IAM starting with version 1.8.0,
in order to access the following resources</p>
<ul>
<li><code>/actuator/health</code></li>
<li><code>/actuator/info</code></li>
</ul>
<p>without being an IAM user and it is useful for deployment purposes.<br>
The Actuator user credentials can be configured with the environment variables
<code>IAM_ACTUATOR_USER_USERNAME</code> and <code>IAM_ACTUATOR_USER_PASSWORD</code>,
as explained in <a href="../../configuration/#basic-service-configuration">Configuration</a>.</p>
<p>The health endpoints return:</p>
<ul>
<li>HTTP status code 200 if everything is ok;</li>
<li>HTTP status code 500 if any health check fails.</li>
</ul>
<h2 id="actuatorhealth"><code>/actuator/health</code></h2>
<p>This is a general application health check endpoint which composes disk space
and database health checks.</p>
<p>Examples.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/actuator/health | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;components&quot;: {
    &quot;db&quot;: {
      &quot;status&quot;: &quot;UP&quot;
    },
    &quot;diskSpace&quot;: {
      &quot;status&quot;: &quot;UP&quot;
    },
    &quot;ping&quot;: {
      &quot;status&quot;: &quot;UP&quot;
    }
  }
}
</code></pre><p>Sending basic authentication, the endpoint returns a response with more details:</p>
<pre><code class="language-console" data-lang="console">$ curl -s -u $IAM_ACTUATOR_USER_USERNAME:$IAM_ACTUATOR_USER_PASSWORD https://iam.local.io/actuator/health | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;components&quot;: {
    &quot;db&quot;: {
      &quot;status&quot;: &quot;UP&quot;,
      &quot;details&quot;: {
        &quot;database&quot;: &quot;H2&quot;,
        &quot;validationQuery&quot;: &quot;isValid()&quot;
      }
    },
    &quot;diskSpace&quot;: {
      &quot;status&quot;: &quot;UP&quot;,
      &quot;details&quot;: {
        &quot;total&quot;: 502468108288,
        &quot;free&quot;: 320953249792,
        &quot;threshold&quot;: 10485760,
        &quot;exists&quot;: true
      }
    },
    &quot;ping&quot;: {
      &quot;status&quot;: &quot;UP&quot;
    }
  }
}

</code></pre><h2 id="actuatorhealthmail"><code>/actuator/health/mail</code></h2>
<p>This endpoint monitors the connection to the SMTP server configured for the
IAM Notification Service.<br>
In order to enable the SMTP server check, set the environment variable
<code>IAM_HEALTH_MAIL_PROBE_ENABLED</code> to true.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/actuator/health/mail | jq
{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre><p>With an authenticated request, the SMTP server details are returned:</p>
<pre><code class="language-console" data-lang="console">$ curl -u $IAM_ACTUATOR_USER_USERNAME:$IAM_ACTUATOR_USER_PASSWORD https://iam.local.io/actuator/health/mail | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;details&quot;: {
    &quot;location&quot;: &quot;smtp.local.io:25&quot;
  }
}
</code></pre><h2 id="actuatorhealthexternalconnectivity"><code>/actuator/health/externalConnectivity</code></h2>
<p>This endpoint checks service connectivity to the Internet. By default, the
endpoint triggers a check on the connectivity to Google.<br>
In order to enable the external connectivity check, set the environment variable
<code>IAM_HEALTH_EXTERNAL_CONNECTIVITY_PROBE_ENABLED</code> to true.</p>
<pre><code class="language-console" data-lang="console">$ curl -s https://iam.local.io/actuator/health/externalConnectivity | jq
{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre><p>With an authenticated request, the external service URL is shown in the details.</p>
<pre><code class="language-console" data-lang="console">$ curl -s -u $IAM_ACTUATOR_USER_USERNAME:$IAM_ACTUATOR_USER_PASSWORD https://iam.local.io/actuator/health/externalConnectivity | jq
{
  &quot;status&quot;: &quot;UP&quot;,
  &quot;details&quot;: {
    &quot;endpoint&quot;: &quot;https://www.google.it&quot;
  }
}
</code></pre>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7f5c1a9b140b9880ba6f9562e465ba3c">3.1.5 - IAM account API</h1>
    
	<p>IAM provides a RESTful API that can be used to manage users, group membership, clients, etc.</p>
<p>IAM implements the following endpoints:</p>
<ul>
<li><code>/iam/account/{id}/attributes</code>, providing access to user attributes</li>
<li><code>/iam/account/{id}/authorities</code>, providing access to user authorities/roles</li>
<li><code>/iam/account/me/clients</code>, providing access to clients owned by the user</li>
<li><code>/iam/account/find/{option}</code>, searching users by username/label/e-mail/group/certificate subject</li>
<li><code>/iam/account/{id}/groups/{groupId}</code>, providing access to user groups</li>
<li><code>/iam/account/{id}/managed-groups</code>, providing access to groups to which a user is manager</li>
<li><code>/iam/group/{groupId}/group-managers</code>, listing managers of a certain group</li>
<li><code>/iam/account/{id}/labels</code>, providing access to user account labels</li>
<li><code>/iam/account/{id}/endTime</code>, managing user membership end time</li>
<li><code>/iam/account/me/proxycert</code>, managing user proxy certificate</li>
<li><code>/iam/account/search</code>, listing user accounts</li>
<li><code>/iam/group/search</code>, listing all groups</li>
</ul>
<p>Authentication is required in all the endpoints and the access is based on IAM roles.
Remember that there are three roles in Indigo IAM: Amdin, User, Group Manager.</p>
<h2 id="user-attributes">User attributes</h2>
<h3 id="get-iamaccountidattributes">GET <code>/iam/account/{id}/attributes</code></h3>
<p>Retrieves user attributes. The {id} refers to the account identifier.</p>
<p>Requires that the Access Token contains the restricted System Scope <code>iam:admin.read</code>, or the token subject is the one represented by the {id}.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/attributes <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">[</span>
  <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#4e9a06">&#34;Nickname&#34;</span>,
    <span style="color:#4e9a06">&#34;value&#34;</span>: <span style="color:#4e9a06">&#34;Test&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><h3 id="put-iamaccountidattributes">PUT <code>/iam/account/{id}/attributes</code></h3>
<p>Adds attributes to the user account. It can be done directly through the IAM dashboard by clicking on &ldquo;Set attribute&rdquo; button in <em>Attributes</em> section of the user homepage.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X PUT -H <span style="color:#4e9a06">&#34;Accept: application/json&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -d @attribute.json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/attributes
</code></pre></div><p>where <code>attribute.json</code> is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
   <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Nickname&#34;</span><span style="color:#000;font-weight:bold">,</span>
   <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Test&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="delete-iamaccountidattributes">DELETE <code>/iam/account/{id}/attributes</code></h3>
<p>Deletes user attribute by adding the query parameter at the end of the endpoint.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X DELETE -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/attributes?name<span style="color:#ce5c00;font-weight:bold">=</span>Nickname
</code></pre></div><h2 id="user-roles">User roles</h2>
<h3 id="get-iamaccountidauthorities">GET <code>/iam/account/{id}/authorities</code></h3>
<p>Retrieves user roles.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/authorities <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;authorities&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;ROLE_GM:c617d586-54e6-411d-8e38-649677980001&#34;</span>,
    <span style="color:#4e9a06">&#34;ROLE_USER&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>The above example shows that the Test User is also a group manager (of group with <code>c617d586-54e6-411d-8e38-649677980001</code> id).</p>
<h3 id="post-iamaccountidauthorities">POST <code>/iam/account/{id}/authorities</code></h3>
<p>Adds an authority to the user.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -H <span style="color:#4e9a06">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -d <span style="color:#4e9a06">&#34;authority=ROLE_ADMIN&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/authorities
</code></pre></div><h3 id="delete-iamaccountidauthorities">DELETE <code>/iam/account/{id}/authorities</code></h3>
<p>Revokes user authority by specifying the query parameter.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X DELETE -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/authorities?authority<span style="color:#ce5c00;font-weight:bold">=</span>ROLE_ADMIN
</code></pre></div><h2 id="managed-clients">Managed clients</h2>
<h3 id="get-iamaccountmeclients">GET <code>/iam/account/me/clients</code></h3>
<p>Retrieves information about clients owned by the currently authenticated user.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/me/clients <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;totalResults&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;itemsPerPage&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;startIndex&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;Resources&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;client_id&#34;</span>: <span style="color:#4e9a06">&#34;client&#34;</span>,
      <span style="color:#4e9a06">&#34;client_name&#34;</span>: <span style="color:#4e9a06">&#34;Test Client&#34;</span>,
      <span style="color:#4e9a06">&#34;redirect_uris&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;https://iam.local.io/iam-test-client/openid_connect_login&#34;</span>,
        <span style="color:#4e9a06">&#34;http://localhost:9090/iam-test-client/openid_connect_login&#34;</span>
      <span style="color:#ce5c00;font-weight:bold">]</span>,
      <span style="color:#4e9a06">&#34;scope&#34;</span>: <span style="color:#4e9a06">&#34;address phone openid profile offline_access read-tasks attr write-tasks email read:/ write:/&#34;</span>,
      <span style="color:#4e9a06">&#34;created_at&#34;</span>: <span style="color:#0000cf;font-weight:bold">1658764288643</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h2 id="account-filtering">Account filtering</h2>
<h3 id="get-iamaccountfindoption">GET <code>/iam/account/find/{option}</code></h3>
<p>Filters user information by label, e-mail, username, certificate subject or group/notingroup.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>byusername</td>
<td>username</td>
<td>string</td>
</tr>
<tr>
<td>bylabel</td>
<td>name</td>
<td>string</td>
</tr>
<tr>
<td>byemail</td>
<td>email</td>
<td>string</td>
</tr>
<tr>
<td>bycertsubject</td>
<td>certificateSubject</td>
<td>URL-encoded</td>
</tr>
</tbody>
</table>
<p>Examples of the available options:</p>
<ul>
<li>
<p>byusername</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/byusername?username<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span> <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;totalResults&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;itemsPerPage&#34;</span>: 10,
  <span style="color:#4e9a06">&#34;startIndex&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;schemas&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>,
  <span style="color:#4e9a06">&#34;Resources&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span>,
      <span style="color:#4e9a06">&#34;meta&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;created&#34;</span>: <span style="color:#4e9a06">&#34;2022-07-26T13:48:35.442+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;lastModified&#34;</span>: <span style="color:#4e9a06">&#34;2022-07-26T13:48:35.442+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;location&#34;</span>: <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span>,
        <span style="color:#4e9a06">&#34;resourceType&#34;</span>: <span style="color:#4e9a06">&#34;User&#34;</span>
      ...
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div></li>
<li>
<p>bylabel</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/bylabel?name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
</code></pre></div></li>
<li>
<p>byemail</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/byemail?email<span style="color:#ce5c00;font-weight:bold">=</span>test.user@gmail.com
</code></pre></div></li>
<li>
<p>bycertsubject</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#000">$AT</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/bycertsubject?certificateSubject<span style="color:#ce5c00;font-weight:bold">=</span>CN%3dTest%20User%20test%40infn.it%2cO%3dIstituto%20Nazionale%20di%20Fisica%20Nucleare%2cC%3dIT%2cDC%3dtcs%2cDC%3dterena%2cDC<span style="color:#ce5c00;font-weight:bold">=</span>org
</code></pre></div></li>
<li>
<p>bygroup/{groupId}</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/bygroup/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1
</code></pre></div></li>
<li>
<p>notingroup/{groupId}</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/find/notingroup/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1
</code></pre></div></li>
</ul>
<h2 id="group-members">Group members</h2>
<h3 id="post-iamaccountidgroupsgroupid">POST <code>/iam/account/{id}/groups/{groupId}</code></h3>
<p>Adds user to a group. It can be done directly through the IAM dashboard as explained <a href="/v/v1.8.2/docs/tasks/administration/group-management/#managing-membership-for-a-group">here</a>.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -H <span style="color:#4e9a06">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/groups/c617d586-54e6-411d-8e38-649677980004
</code></pre></div><h3 id="delete-iamaccountidgroupsgroupid">DELETE <code>/iam/account/{id}/groups/{groupId}</code></h3>
<p>Removes user from a specific group.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X DELETE -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/groups/c617d586-54e6-411d-8e38-649677980004
</code></pre></div><h2 id="group-managers">Group managers</h2>
<h3 id="get-iamaccountidmanaged-groups">GET <code>/iam/account/{id}/managed-groups</code></h3>
<p>Lists the user&rsquo;s managed and not managed groups.</p>
<p>Requires that the Access Token contains the restricted System Scope <code>iam:admin.read</code>, or the token subject is the one represented by the {id}.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/managed-groups <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span>,
  <span style="color:#4e9a06">&#34;username&#34;</span>: <span style="color:#4e9a06">&#34;test&#34;</span>,
  <span style="color:#4e9a06">&#34;managedGroups&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#4e9a06">&#34;Test-001&#34;</span>,
      <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;c617d586-54e6-411d-8e38-649677980001&#34;</span>,
      <span style="color:#4e9a06">&#34;description&#34;</span>: null,
      <span style="color:#4e9a06">&#34;parent&#34;</span>: null
    <span style="color:#ce5c00;font-weight:bold">}</span>
  <span style="color:#ce5c00;font-weight:bold">]</span>,
  <span style="color:#4e9a06">&#34;unmanagedGroups&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    ...
  <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="post-iamaccountidmanaged-groupsgroupid">POST <code>/iam/account/{id}/managed-groups/{groupId}</code></h3>
<p>Gives a user represented by {id} <code>ROLE_GM</code> privileges of the group identified by {groupId}.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -H <span style="color:#4e9a06">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/managed-groups/c617d586-54e6-411d-8e38-649677980004
</code></pre></div><h3 id="delete-iamaccountidmanaged-groupsgroupid">DELETE <code>/iam/account/{id}/managed-groups/{groupId}</code></h3>
<p>Removes a group manager from a certain group.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X DELETE -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/managed-groups/c617d586-54e6-411d-8e38-649677980004
</code></pre></div><h3 id="get-iamgroupgroupidgroup-managers">GET <code>/iam/group/{groupId}/group-managers</code></h3>
<p>Shows the information of managers in a certain group.</p>
<p>Requires that the Access Token contains the restricted System Scope <code>iam:admin.read</code>, or <code>ROLE_GM</code> privileges of the group identified by {groupId}.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/group/c617d586-54e6-411d-8e38-649677980004/group-managers
<span style="color:#ce5c00;font-weight:bold">[</span>
  <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span>,
    <span style="color:#4e9a06">&#34;meta&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;created&#34;</span>: <span style="color:#4e9a06">&#34;2022-07-26T13:48:35.442+02:00&#34;</span>,
      <span style="color:#4e9a06">&#34;lastModified&#34;</span>: <span style="color:#4e9a06">&#34;2022-07-26T18:19:03.786+02:00&#34;</span>,
      <span style="color:#4e9a06">&#34;location&#34;</span>: <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span>,
      <span style="color:#4e9a06">&#34;resourceType&#34;</span>: <span style="color:#4e9a06">&#34;User&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;schemas&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span>,
      <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">]</span>,
    <span style="color:#4e9a06">&#34;userName&#34;</span>: <span style="color:#4e9a06">&#34;test&#34;</span>,
    <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;familyName&#34;</span>: <span style="color:#4e9a06">&#34;User&#34;</span>,
      <span style="color:#4e9a06">&#34;formatted&#34;</span>: <span style="color:#4e9a06">&#34;Test User&#34;</span>,
      <span style="color:#4e9a06">&#34;givenName&#34;</span>: <span style="color:#4e9a06">&#34;Test&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    ...
  <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><h2 id="account-labels">Account labels</h2>
<h3 id="get-iamaccountidlabels">GET <code>/iam/account/{id}/labels</code></h3>
<p>Shows the user account labels.</p>
<p>Requires that the Access Token contains the restricted System Scope <code>iam:admin.read</code>, or the token subject is the one represented by the {id}.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/labels
<span style="color:#ce5c00;font-weight:bold">[</span>
  <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;prefix&#34;</span>: <span style="color:#4e9a06">&#34;hr.cern&#34;</span>,
    <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#4e9a06">&#34;ignore&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><h3 id="put-iamaccountidlabels">PUT <code>/iam/account/{id}/labels</code></h3>
<p>Adds labels to user account.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X PUT -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -d @labels.json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/labels
</code></pre></div><p>where <code>labels.json</code> is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;prefix&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;hr.cern&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ignore&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="delete-iamaccountidlabels">DELETE <code>/iam/account/{id}/labels</code></h3>
<p>Deletes an account label by specifying the label name and the label prefix (if present).</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X DELETE -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/labels <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span>ignore -d <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hr.cern&#34;</span>
</code></pre></div><h2 id="user-account-expiration-time">User account expiration time</h2>
<h3 id="put-iamaccountidendtime">PUT <code>/iam/account/{id}/endTime</code></h3>
<p>Adds/changes the membership end time of the user. It can be done directly through the IAM dashboard
by clicking on &ldquo;Change membership end time&rdquo; button in the user homepage.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X PUT -d @endTime.json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/80e5fb8d-b7c8-451a-89ba-346ae278a66f/endTime
</code></pre></div><p>where <code>endTime.json</code> is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
   <span style="color:#204a87;font-weight:bold">&#34;endTime&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;2022-08-06T02:00:00.000+02:00&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="proxy-certificate">Proxy certificate</h2>
<h3 id="put-iamaccountmeproxycert">PUT <code>/iam/account/me/proxycert</code></h3>
<p>Adds user proxy certificate. It can be done directly through the IAM dashboard
by clicking on &ldquo;Add managed proxy certificate&rdquo; button
appearing on the user homepage after uploading the X.509 certificate.</p>
<p>When using curl commands, it requires the restricted System Scope <code>iam:admin.write</code> in the Access Token.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -i -X PUT -d @proxy.json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -H <span style="color:#4e9a06">&#34;Content-Type: application&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/me/proxycert
</code></pre></div><p>where <code>proxy.json</code> includes only the <em>certificate_chain</em> key:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;certificate_chain&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;-----BEGIN CERTIFICATE-----\nMIIFGT...FlCU=\n-----END CERTIFICATE-----&#34;</span><span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="list-accounts-and-groups">List accounts and groups</h2>
<h3 id="get-iamaccountsearch">GET <code>/iam/account/search</code></h3>
<p>Shows the list of IAM accounts.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/account/search
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;totalResults&#34;</span>: 254,
  <span style="color:#4e9a06">&#34;itemsPerPage&#34;</span>: 10,
  <span style="color:#4e9a06">&#34;startIndex&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;Resources&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;73f16d93-2441-4a50-88ff-85360d78c6b5&#34;</span>,
      <span style="color:#4e9a06">&#34;meta&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;created&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-21T17:20:14.034+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;lastModified&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-21T17:20:14.034+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;location&#34;</span>: <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/73f16d93-2441-4a50-88ff-85360d78c6b5&#34;</span>,
        <span style="color:#4e9a06">&#34;resourceType&#34;</span>: <span style="color:#4e9a06">&#34;User&#34;</span>
      <span style="color:#ce5c00;font-weight:bold">}</span>,
      <span style="color:#4e9a06">&#34;userName&#34;</span>: <span style="color:#4e9a06">&#34;admin&#34;</span>,
      <span style="color:#4e9a06">&#34;name&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;familyName&#34;</span>: <span style="color:#4e9a06">&#34;User&#34;</span>,
        <span style="color:#4e9a06">&#34;formatted&#34;</span>: <span style="color:#4e9a06">&#34;Admin User&#34;</span>,
        <span style="color:#4e9a06">&#34;givenName&#34;</span>: <span style="color:#4e9a06">&#34;Admin&#34;</span>
      <span style="color:#ce5c00;font-weight:bold">}</span>,
      <span style="color:#4e9a06">&#34;displayName&#34;</span>: <span style="color:#4e9a06">&#34;admin&#34;</span>,
      <span style="color:#4e9a06">&#34;active&#34;</span>: true,
      <span style="color:#4e9a06">&#34;emails&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#ce5c00;font-weight:bold">{</span>
          <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;work&#34;</span>,
          <span style="color:#4e9a06">&#34;value&#34;</span>: <span style="color:#4e9a06">&#34;1_admin@iam.test&#34;</span>,
          <span style="color:#4e9a06">&#34;primary&#34;</span>: <span style="color:#204a87">true</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
      <span style="color:#ce5c00;font-weight:bold">]</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    ...
</code></pre></div><h3 id="get-iamgroupsearch">GET <code>/iam/group/search</code></h3>
<p>Shows the list of IAM groups.</p>
<p>Access granted to all IAM users or <code>iam:admin.read</code> scope.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -s -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#4e9a06">${</span><span style="color:#000">AT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  http://localhost:8080/iam/group/search
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;totalResults&#34;</span>: 22,
  <span style="color:#4e9a06">&#34;itemsPerPage&#34;</span>: 10,
  <span style="color:#4e9a06">&#34;startIndex&#34;</span>: 1,
  <span style="color:#4e9a06">&#34;Resources&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
      <span style="color:#4e9a06">&#34;id&#34;</span>: <span style="color:#4e9a06">&#34;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>,
      <span style="color:#4e9a06">&#34;meta&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;created&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-21T17:20:15.478+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;lastModified&#34;</span>: <span style="color:#4e9a06">&#34;2022-09-21T17:20:15.478+02:00&#34;</span>,
        <span style="color:#4e9a06">&#34;location&#34;</span>: <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>,
        <span style="color:#4e9a06">&#34;resourceType&#34;</span>: <span style="color:#4e9a06">&#34;Group&#34;</span>
      <span style="color:#ce5c00;font-weight:bold">}</span>,
      <span style="color:#4e9a06">&#34;displayName&#34;</span>: <span style="color:#4e9a06">&#34;Analysis&#34;</span>,
      <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoGroup&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;parentGroup&#34;</span>: null,
        <span style="color:#4e9a06">&#34;description&#34;</span>: <span style="color:#4e9a06">&#34;The analysis group&#34;</span>,
        <span style="color:#4e9a06">&#34;labels&#34;</span>: null
      <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    ...
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c30171a2167f0f6388c6c9ca09e24275">3.1.6 - IAM Token management API</h1>
    
	<p>The IAM server has a RESTful API used to list and revoke active access and
refresh tokens.</p>
<p>Access to the API is limited to users with administrator privileges authenticated via a web session or
to access token containing predefined restricted System Scopes.<br>
All examples assume authorization via OAuth2 bearer token; e.g.</p>
<pre><code>GET /iam/api/access-tokens/13 HTTP/1.1
Host: example.com
Authorization: Bearer h480djs93hd8
</code></pre><p>These are the tokens REST API endpoints:</p>
<p><strong>Accessing tokens</strong>:</p>
<ul>
<li><a href="#get-iamapiaccess-tokens">GET /iam/api/access-tokens</a></li>
<li><a href="#get-iamapiaccess-tokensid">GET /iam/api/access-tokens/:id</a></li>
<li><a href="#get-iamapirefresh-tokens">GET /iam/api/refresh-tokens</a></li>
<li><a href="#get-iamapirefresh-tokensid">GET /iam/api/refresh-tokens/:id</a></li>
<li><a href="#delete-iamapiaccess-tokensid">DELETE /iam/api/access-tokens/:id</a></li>
<li><a href="#delete-iamapirefresh-tokensid">DELETE /iam/api/refresh-tokens/:id</a></li>
</ul>
<p><strong>Deleting tokens</strong>:</p>
<ul>
<li><a href="#get-iamapiaccess-tokens">GET /iam/api/access-tokens</a></li>
<li><a href="#get-iamapiaccess-tokensid">GET /iam/api/access-tokens/:id</a></li>
<li><a href="#get-iamapirefresh-tokens">GET /iam/api/refresh-tokens</a></li>
<li><a href="#get-iamapirefresh-tokensid">GET /iam/api/refresh-tokens/:id</a></li>
<li><a href="#delete-iamapiaccess-tokensid">DELETE /iam/api/access-tokens/:id</a></li>
<li><a href="#delete-iamapirefresh-tokensid">DELETE /iam/api/refresh-tokens/:id</a></li>
</ul>
<h2 id="get-iamapiaccess-tokens">GET /iam/api/access-tokens</h2>
<p>Retrieves the paginated list of all the active access tokens. Returns results in <em>application/json</em>.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>count</code><br/><strong>integer</strong></td>
<td>Specifies the desired maximum number of query results per page.</td>
</tr>
<tr>
<td style="text-align:center"><code>startIndex</code><br/><strong>integer</strong></td>
<td>The 1-based index of the first query result.</td>
</tr>
<tr>
<td style="text-align:center"><code>userId</code><br/><strong>string</strong></td>
<td>Filters by userName.</td>
</tr>
<tr>
<td style="text-align:center"><code>clientId</code><br/><strong>string</strong></td>
<td>Filters by clientId.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre><code>GET http://example.com:8080/iam/api/access-tokens
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MDEzMTQ1MjksImF1ZCI6WyJhOGFmNzUzYy1mMzI0LTRlNDAtYTE3Ny04N2RmYzA2MjQ5YjciXSwiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjgwODBcL29wZW5pZC1jb25uZWN0LXNlcnZlci13ZWJhcHBcLyIsImp0aSI6Ijg4ZjM4OGE4LTk1NzctNGQyMC1hZTZjLWMyMDMxOGQ1OWJjNiIsImlhdCI6MTQwMTMxMDkyOX0.HYnNxRvGRdKFykVChL-hdxszcFBvygkeUmc8_iv2Jl4MU-jPJVzMnTwKJbCMWBjeBp8hrb0Dgd9XbnHUDyXxwj8MDrWQEH3QnwYJGRW9JFWjHMGfKDQDFY6Ffl3OFERVbyoB2ObiGTUgbw4Nkl1L1ihuMpMAc5nKi0rk3QXcS1M&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;profile&#34;</span>
      <span style="color:#000;font-weight:bold">],</span>
      <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
          <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
        <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;idToken&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/access-tokens/5&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamapiaccess-tokensid">GET /iam/api/access-tokens/:id</h2>
<p>Retrieves all the information about the access token identified by <strong>id</strong> and returns results in <em>application/json</em>.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<pre><code>GET http://example.com:8080/iam/api/access-tokens/6
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MDEzMTQ1MjksImF1ZCI6WyJhOGFmNzUzYy1mMzI0LTRlNDAtYTE3Ny04N2RmYzA2MjQ5YjciXSwiaXNzIjoiaHR0cDpcL1wvbG9jYWxob3N0OjgwODBcL29wZW5pZC1jb25uZWN0LXNlcnZlci13ZWJhcHBcLyIsImp0aSI6Ijg4ZjM4OGE4LTk1NzctNGQyMC1hZTZjLWMyMDMxOGQ1OWJjNiIsImlhdCI6MTQwMTMxMDkyOX0.HYnNxRvGRdKFykVChL-hdxszcFBvygkeUmc8_iv2Jl4MU-jPJVzMnTwKJbCMWBjeBp8hrb0Dgd9XbnHUDyXxwj8MDrWQEH3QnwYJGRW9JFWjHMGfKDQDFY6Ffl3OFERVbyoB2ObiGTUgbw4Nkl1L1ihuMpMAc5nKi0rk3QXcS1M&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;profile&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;idToken&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/access-tokens/5&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamapirefresh-tokens">GET /iam/api/refresh-tokens</h2>
<p>Retrieves the paginated list of all the active refresh tokens. Returns results in <em>application/json</em>.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>count</code><br/><strong>integer</strong></td>
<td>Specifies the desired maximum number of query results per page.</td>
</tr>
<tr>
<td style="text-align:center"><code>startIndex</code><br/><strong>integer</strong></td>
<td>The 1-based index of the first query result.</td>
</tr>
<tr>
<td style="text-align:center"><code>userId</code><br/><strong>string</strong></td>
<td>Filters by userId.</td>
</tr>
<tr>
<td style="text-align:center"><code>clientId</code><br/><strong>string</strong></td>
<td>Filters by clientId.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre><code>GET http://example.com:8080/iam/api/refresh-tokens
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
  	 <span style="color:#000;font-weight:bold">{</span>
	  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1083</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJub25lIn0.eyJqdGkiOiIxMTdmMWRkOS1iOWViLTQ5MjctYThkMS1hYzQ4NjIwYWQzOWYifQ.&#34;</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
	    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#4e9a06">&#34;profile&#34;</span>
	  <span style="color:#000;font-weight:bold">],</span>
	  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
	  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
	      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
	    <span style="color:#000;font-weight:bold">],</span>
	    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
	  <span style="color:#000;font-weight:bold">},</span>
	  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
	    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
	  <span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-iamapirefresh-tokensid">GET /iam/api/refresh-tokens/:id</h2>
<p>Retrieves all the information about the refresh token identified by <strong>id</strong> and returns results in <em>application/json</em>.</p>
<p>Requires <code>iam:admin.read</code> scope.</p>
<pre><code>GET http://example.com:8080/iam/api/refresh-tokens/1083
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1083</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJhbGciOiJub25lIn0.eyJqdGkiOiIxMTdmMWRkOS1iOWViLTQ5MjctYThkMS1hYzQ4NjIwYWQzOWYifQ.&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;openid&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;phone&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;profile&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;expiration&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2014-05-28T18:02:09-0400&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;client&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;clientId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;iam-test-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;andrea.ceccanti@cnaf.infn.it&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/api/clients/2&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam-test.indigo-datacloud.eu/scim/Users/e1eb758b-b73c-4761-bfff-adc793da409c&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="delete-iamapiaccess-tokensid">DELETE /iam/api/access-tokens/:id</h2>
<p>Revoke the access token identified by <strong>id</strong>.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<pre><code>DELETE http://example.com:8080/iam/api/access-tokens/6
</code></pre><pre><code>204  AccessToken revoked
</code></pre><h2 id="delete-iamapirefresh-tokensid">DELETE /iam/api/refresh-tokens/:id</h2>
<p>Revoke the access token identified by <strong>id</strong>.</p>
<p>Requires <code>iam:admin.write</code> scope.</p>
<pre><code>DELETE http://example.com:8080/iam/api/refresh-tokens/1083
</code></pre><pre><code>204  RefreshToken revoked
</code></pre>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d7a16cf20db6b5db427da83d3a706289">3.1.7 - OAuth token exchange API</h1>
    
	<p>The current release of the INDIGO IAM implements part of the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange
OAuth
specification</a>.
The Token Exchange OAuth specification defines &ldquo;a lightweigth protocol that
enables clients to request and obtain security tokens from authorization
servers&rdquo;.</p>
<p>OAuth 2.0 was designed to solve the problem of a delegated access to resources
across services, mediated by an authorization server, as shown in the following
picture:</p>







<div class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
	<img class="card-img-top" src="/v/v1.8.2/docs/reference/api/oauth-token-exchange/oauth-delegation-1_hud4af7d007d8029ff318e645dabdc0724_26464_500x500_fit_catmullrom_3.png" width="500" height="384">
	
	<div class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
OAuth delegation
</p>
	</div>
	
</div>
<p>In the picture above we have the usual OAuth roles:</p>
<ul>
<li>The user (or <em>resource owner</em>, in OAuth terminology);</li>
<li>A resource server, ie. a service hosting user resources, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li>A client: this is an agent that has received a permission from the user to
act on his behalf on his resources hosted on a resource server;</li>
<li>An authorization server: a service that issues access token to clients after
having authenticated the user and obtained an authorization from the user
that the client is entitled to act on user&rsquo;s resources</li>
</ul>
<p>There are scenarios when a resource server, in order to satisfy a client
request, needs to access resources hosted by other downstream services on
behalf of the user, like in the following picture:</p>







<div class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
	<img class="card-img-top" src="/v/v1.8.2/docs/reference/api/oauth-token-exchange/oauth-token-exchange-1_hu3c62e250261e787166319e6bf7993f61_35467_500x500_fit_catmullrom_3.png" width="500" height="242">
	
	<div class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
OAuth token exchange
</p>
	</div>
	
</div>
<p>In OAuth, access tokens are bearer tokens, so the first resource server could
simply use the access token received from the client to interact, on behalf
of the user, with the downstream resource server.</p>
<p>There are, however, situations in which just using the received access token
against the downstream service is not possible, like for instance if the token
audience was scoped to be valid only on the first resource server.</p>
<p>Moreover, the resource server could need the ability to act on behalf of the
user for an unbounded amount of time (e.g., to implement long-running
computations), not limited by the validity of the received access token.</p>
<p>The token exchange specification was designed to provide a protocol in support
of these scenarios, where a client can exchange an access token received from
antoher client with a new token (or a set of tokens, as we will see) by
interacting with a trusted OAuth authorization server.</p>
<h2 id="impersonation-vs-delegation">Impersonation vs delegation</h2>
<p>As specified in the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange OAuth
specification</a>,
when a subject A impersonates B, A has all the rights of B and it is
indistinguishable from B. So, when A interacts within any other entity, A is B.</p>
<p>With delegation A still has its own identity, separate from B. So when A
interacts within another entity, it is explicit that A is representing B,
because B has delegated some of its rights to A.</p>
<p>More details about the difference from this two semantics can be found in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05#section-1.1">this section of the specification</a>.</p>
<p>The INDIGO IAM token exchange implementation currently supports only
impersonation semantics.</p>
<h2 id="client-configuration-requirements">Client configuration requirements</h2>
<p>In order to request a token exchange, a client must be configured with the
<code>urn:ietf:params:oauth:grant-type:token-exchange</code> grant type enabled. The token
exchange grant type is <strong>disabled</strong> by default for dynamically registered
clients, and can be enabled only by users with administrative privileges.</p>
<h2 id="the-token-exchange-request">The token exchange request</h2>
<p>A client who wants to exchange an access token with a new one (or a couple of
new tokens, in case a refresh token is requested), must send an authenticated
request to the IAM <code>/token</code> endpoint, specifying the following properties:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><code>urn:ietf:params:oauth:grant-type:token-exchange</code></td>
</tr>
<tr>
<td>subject_token</td>
<td>The subject access token that the client wants to exchange</td>
</tr>
<tr>
<td>scope</td>
<td>The set of scopes requested for the new access token</td>
</tr>
<tr>
<td>audience</td>
<td>Optional. A space-separated list of resource identifiers that will be used to limit the audience of the issued token</td>
</tr>
</tbody>
</table>
<h3 id="scopes-in-exchanged-tokens">Scopes in exchanged tokens</h3>
<p>A client, when requesting a token exchange, can request any of the scopes
enabled by its client configuration. IAM system scopes are however handled in a
special way. These scopes, in order to be &ldquo;exchanged&rdquo; across clients, need to
be</p>
<ul>
<li>enabled for the client requesting the token exchange</li>
<li>linked to the subject token presented for the token exchange</li>
</ul>
<p>The list of system scopes currently defined in the IAM can be obtained by
registered users by issuing a request to the IAM system scopes API:</p>
<pre><code>curl -H &quot;Authorization: Bearer ...&quot; https://iam.example/api/scopes
</code></pre><h3 id="token-exchange-example">Token Exchange example</h3>
<p>This section describes a token exchange flow.</p>
<p>We start with a normal OAuth flow where a client, <code>token-exchange-subject</code>,
requests an access token from the IAM using the resource owner password
credential flow. The <code>token-exchange-subject</code> client is configured to use HTTP
basic authentication against the IAM token endpoint, and in this example acts
on behalf of the <code>test</code> user. We use the resource owner password credentials
flow for convenience, but any other OAuth or OpenID connect flow that involves
a user identity would be fine (i.e., authorization code).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">export</span> <span style="color:#000">IAM_TOKEN_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io/token
$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>token-exchange-subject
$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
$ <span style="color:#204a87">export</span> <span style="color:#000">USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>...

$ curl -s -u <span style="color:#000">$SUBJECT_ID</span>:<span style="color:#000">$SUBJECT_SECRET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$USERNAME</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$PASSWORD</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>password <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</code></pre></div><p>Note that the only scopes requested in this first request are <code>openid</code> and
<code>profile</code>, i.e. the scopes required to access user identity information. IAM
token endpoint returns a JSON containing an access token and other info:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJpc3MiOiJodHRwczpcL1wvaWFtLmxvY2FsLmlvXC8iLCJleHAiOjE0NzY5NTcxMDIsImlhdCI6MTQ3Njk1MzUwMiwianRpIjoiMjBiZThlNjYtNmNmOS00YzE0LWI4ZDEtZjJmZTc0NDk0YjAxIn0.kqAhZ2MNmBLYIA_-xW9356kD-ndqJ7jKUZRPb7ox_4iXbjcnV6oZYAHZzTH_uBTXA2WsVIJJ-Qicm5JQ0ydb2ewgECAmGkKfL3X4qnnRq2_GgZZof3zlM_rIz3QrDB3v1eIt42YeMdUgODUYGKeDwntT5a7wPDtxe-GM2uL5fik&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;id_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJhdWQiOiIzMmMzMTUyOS05YmM2LTQ1ZWQtYjU0YS0wNGEyNThiMDRmYmYiLCJraWQiOiJyc2ExIiwiaXNzIjoiaHR0cHM6XC9cL2lhbS5sb2NhbC5pb1wvIiwiZXhwIjoxNDc2OTU0MTAyLCJpYXQiOjE0NzY5NTM1MDIsImp0aSI6IjhhMzk1OTM5LTM1N2QtNGY5My04MmEzLTJkMTBkM2ZhMzgzZCJ9.DtNR-ob8kMIUMa2x6TW7krSYMt78tfr5fnTK4aeoIY-wmEWcjPRx1_vT6_lesjMr9w0B_OCALXfOoDBfbF7DhmV7vpbotirkMxvowFBzgppmtBTZNAzLc_Wiwr4IAiGydwjy_UbYrxx6qlWJAKRwzSbDDd3oDVpU-KM8gtLIEa8&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>We put this access token in an environment variable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> $ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>cat /tmp/response <span style="color:#000;font-weight:bold">|</span> jq -r .access_token<span style="color:#204a87;font-weight:bold">)</span>
</code></pre></div><p>We use this access token to access the <code>app</code> API, which only requires access to
user identity to grant access:</p>
<pre><code>curl -H &quot;Authorization: Bearer $SUBJECT_TOKEN&quot; https://app.example.org/api
</code></pre><p>Suppose now that the <code>app</code> API needs, to properly answer the request from the
client, to interact with another downstream service, <a href="https://tasks.example.org">https://tasks.example.org</a>,
on behalf of the user. Unfortunately the set of scopes linked to the access
token received are not sufficient to do this, and so <code>app</code> decides to exchange
the token received with another one granting enough privileges.</p>
<p>In Token Exchange terms, here <code>app</code> is the <code>actor</code>, the subject identity linked
to the token is the <code>test</code> user, and the audience for the new token being
requested would be the <code>https://tasks.app.example.org/api</code> API.</p>
<p>So <code>app</code> would do a request like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>https://app.example.org/api
$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
$ <span style="color:#204a87">export</span> <span style="color:#000">AUDIENCE</span><span style="color:#ce5c00;font-weight:bold">=</span>https://tasks.example.org/api

$ curl -s -u <span style="color:#000">$ACTOR_ID</span>:<span style="color:#000">$ACTOR_SECRET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:ietf:params:oauth:grant-type:token-exchange <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">audience</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$AUDIENCE</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d <span style="color:#000">subject_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$SUBJECT_TOKEN</span> <span style="color:#4e9a06">\ </span><span style="color:#8f5902;font-style:italic"># This token was received from the initial client </span>
    -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq


</code></pre></div><p>Note that <code>app</code> requests an additional scope, <code>read-tasks</code>, to interact with
the downstream service.</p>
<p>Since <code>app</code> is a trusted client for token exchange, the IAM responds with the
following JSON:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJra...&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;issued_token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:ietf:params:oauth:token-type:jwt&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>And <code>app</code> can use the newly issued access token to invoke services on
<a href="https://task-app.example.org/api">https://task-app.example.org/api</a> on behalf of user <code>test</code>:</p>
<pre><code>$ curl -H &quot;Authorization: Bearer eyJra...&quot; http://tasks.example.org/api

</code></pre><h3 id="trust">Trust</h3>
<p>Clients that have the token exchange grant enabled are considered trusted
clients i.e., no explicit grant from the user is needed to grant access to
client scopes. For IAM system scopes, however, these can be &ldquo;exchanged&rdquo; only if
linked to the original subject token.</p>
<h3 id="limitation-and-known-issues">Limitation and known issues</h3>
<p>The current implementation of Token Exchange in Indigo IAM has the following limitations:</p>
<ul>
<li>Delegation is not yet supported: if <code>actor_token</code> or the <code>want_composite</code>
parameters are specified within the request, an error response is returned by
the authorization server;</li>
<li>The <code>resource</code> field is ignored.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e7c3f1c0aafd5433deea6bb5120198f0">3.1.8 - OAuth token introspection API</h1>
    
	<p>IAM, through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>,
supports the <a href="https://tools.ietf.org/html/rfc7662">OAuth token introspection API</a> API at
the <code>/introspect</code> endpoint.</p>
<p>The <code>/introspect</code> endpoint <strong>requires</strong> client authentication.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2210df1e33e69aae2033d3ad614cb1ac">3.1.9 - OpenID Connect client management API</h1>
    
	<p>IAM, through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>,
provides an OAuth/OpenID connect client management API at the <code>/api/clients</code>
endpoint.</p>
<p>Documentation for this API can be found on the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki/API">MitreID connect
wiki</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ebe7e4e7e9878df8afa56df0d05e4322">3.1.10 - OpenID Connect client registration API</h1>
    
	<p>Starting from version 1.8.0, IAM supports the <a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration
API</a> at the <code>/iam/api/client-registration</code> endpoint.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    Support to the dynamic client registration through the <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID OpenID Connect server implementation</a>
at the <code>/register</code> endpoint is deprecated.

</div>

<p>Client registration does not require authentication.</p>
<h2 id="example-registering-and-deleting-a-client-from-the-command-line">Example: registering and deleting a client from the command line</h2>
<p>With the following template JSON you can easily register a client in the IAM:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;redirect_uris&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;https://another.client.example/oidc&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;client_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;another-example-client&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;contacts&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;test@iam.test&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;token_endpoint_auth_method&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;client_secret_basic&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;address phone openid email profile offline_access&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;grant_types&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;refresh_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;authorization_code&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;response_types&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;code&#34;</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Save the above JSON into a file (after changing the relevant fields, like
contact, rediret_uris, etc&hellip;). We will use the <code>client-req.json</code> file name for
this example. You can then use <a href="https://httpie.org/">httpie</a> as  follows to generate the
client on the IAM</p>
<pre><code>http https://iam.local.io/iam/api/client-registration &lt; client-req.json &gt; client.json
</code></pre><p>If the command terminates correctly, you will have the client configuration
saved in the <code>client.json</code> file. You can use <a href="https://stedolan.github.io/jq/">jq</a> to display in a pretty
way its contents:</p>
<pre><code>$ jq . client.json
{
  &quot;client_id&quot;: &quot;9bef3e68-f329-4dbf-9c3e-45647c08dfd5&quot;,
  &quot;client_secret&quot;: &quot;ALMjVauX1tXtU2lZytbxfW7JrEx6-ZhZml8bZcEocYOf1enNdIQaWB0aDUmr-nilGjjrznzbWNNWdh8bP0neyUI&quot;,
  &quot;client_name&quot;: &quot;another-example-client&quot;,
  &quot;redirect_uris&quot;: [
    &quot;https://another.client.example/oidc&quot;
  ],
  &quot;contacts&quot;: [
    &quot;test@iam.test&quot;
  ],
  &quot;grant_types&quot;: [
    &quot;authorization_code&quot;,
    &quot;refresh_token&quot;
  ],
  &quot;response_types&quot;: [
    &quot;code&quot;
  ],
  &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;,
  &quot;scope&quot;: &quot;address phone openid profile offline_access email&quot;,
  &quot;reuse_refresh_token&quot;: true,
  &quot;dynamically_registered&quot;: true,
  &quot;clear_access_tokens_on_refresh&quot;: true,
  &quot;require_auth_time&quot;: false,
  &quot;registration_access_token&quot;: &quot;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJpc3MiOiJodHRwOlwvXC9sb2NhbGhvc3Q6ODA4MFwvIiwiYXVkIjoiOWJlZjNlNjgtZjMyOS00ZGJmLTljM2UtNDU2NDdjMDhkZmQ1IiwiaWF0IjoxNjQ5MzM4OTcxLCJqdGkiOiJmNTFlZWIzMS1kY2RkLTQ5MDctYThlZC1jZTViMGU3ODRiODAifQ.Ec5PCjaaIveIpMPhTcYvJfsnJc9Ag_n46ICcaDhh8GDXupKAARv_fx4oCQPgomSKAz4j1bVRgzrmQsswR8lKmWQZv5fG2BMaRdh9epENArUbTsaPqdUfoMsqo-rqeN-eOcl4I1NChnfCPdBi2rSg2M5y4o9DSqhtQUUnig3-n77X8QhN8ES2i2MFgLkwBkc88nvPFdtSpNHvKjIlaXx6YRA3F7kqv7LHNP5OKfnfXNAFPhKweRRTXamEu_oN3-u0TQbxkg8YdNo4CN8hfMYMKsaCigND765zxFeRXSgNkpfZdV3d-8K5aU6TQoIOR41_kylbOh6rt6TGD4IIosEn5w&quot;,
  &quot;registration_client_uri&quot;: &quot;https://iam.local.io/iam/api/client-registration/9bef3e68-f329-4dbf-9c3e-45647c08dfd5&quot;,
  &quot;created_at&quot;: 1649338971207
}
</code></pre><p>and also to extract information from it conveniently from the command line.
For example, you can extract the <code>client_id</code> and <code>registration_access_token</code>
with the following commands:</p>
<pre><code>$ export CID=$(jq -r .client_id client.json)
$ export RAT=$(jq -r .registration_access_token client.json)
</code></pre><p>and use them to delete the client:</p>
<pre><code>$ http DELETE https://iam.local.io/iam/api/client-registration/${CID} Authorization:&quot;Bearer ${RAT}&quot;
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: *
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Connection: keep-alive
Content-Language: en-US
Date: Thu, 07 Apr 2022 13:51:40 GMT
Expires: 0
Pragma: no-cache
Server: nginx/1.13.1
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
X-Application-Context: INDIGO IAM:mysql,google,registration,saml,mysql-test:8080
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
</code></pre>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-33f82d3baa8becb8dd9398d40b988474">3.1.11 - SCIM API</h1>
    
	<p>The IAM server provides a RESTful API, based on the <a href="http://www.simplecloud.info/">System for Cross-domain
Identity Management (SCIM) standard</a>, that
can be used to manage users, change their personal information, manage their
group membership, etc.</p>
<p>Access to the API is restricted to administrator users authenticated via web interface
or OAuth clients that have access to the <code>scim:read</code> (for read access) or <code>scim:write</code> (for write
access) OAuth scopes.
Note that these scopes are restricted in the default IAM configuration, i.e.
can be assigned to clients only by IAM administrators.</p>
<p>Examples below assume OAuth authorization via bearer token: e.g.</p>
<pre><code>GET /Users/2819c223-7f76-453a-919d-413861904646 HTTP/1.1
Host: example.com
Authorization: Bearer h480djs93hd8
</code></pre>
<p>The SCIM protocol specifies well known endpoints and HTTP methods for managing
Resources defined in the <a href="https://tools.ietf.org/html/rfc7643">SCIM core schema specification</a>.</p>
<h2 id="iam-scim-endpoints">IAM SCIM Endpoints</h2>
<p>IAM implements the following SCIM endpoints:</p>
<ul>
<li><code>/scim/Users</code>, providing access to user account resources;</li>
<li><code>/scim/Groups</code>, providing access to group resources;</li>
<li><code>/scim/Me</code>, providing access to the user account resource for the currently
authenticated user.</li>
</ul>
<p>For the <code>/scim/Users</code> and <code>/scim/Groups</code> endpoints the following methods are
implemented:</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>Retrieves a complete or partial Resource.</td>
</tr>
<tr>
<td>POST</td>
<td>Create new Resource or bulk modify Resources.</td>
</tr>
<tr>
<td>PUT</td>
<td>Replace completely a Resource.</td>
</tr>
<tr>
<td>PATCH</td>
<td>Modifies a Resource with a set of specified changes (partial update).</td>
</tr>
<tr>
<td>DELETE</td>
<td>Deletes a Resource.</td>
</tr>
</tbody>
</table>
<p>For the <code>/scim/Me</code> endpoint, only the <code>GET</code> and <code>PATCH</code> methods are
implemented.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>For scalability reasons, IAM no longer returns the <code>members</code> claim for the SCIM
Group resources, as the SCIM standard does not currently describe a way to
implement pagination on group members.</p>
<p>For this reason, IAM provides two additional resources:</p>
<ul>
<li>the <code>members</code> resource, which returns a paginated view of users belonging to
a given group;</li>
<li>the <code>sugroups</code> resource, which returns a paginated view of subgroups of a
given group.</li>
</ul>


</div>

<h2 id="pagination">Pagination</h2>
<p>IAM SCIM implementation supports <a href="https://datatracker.ietf.org/doc/html/rfc7644#section-3.4.2.4">pagination</a> on the
<code>/scim/Users</code>, <code>/scim/Groups</code> resources, as mandated by the standard, but also
on the non-standard <code>/scim/Groups/{id}/members</code> and
<code>/scim/Groups/{id}/subgroups</code> endpoints.</p>
<p>Pagination allows  to &ldquo;page through&rdquo; large numbers of resources. Pagination is
not session based so clients must never assume repeatable results.</p>
<p>The following table describes URL pagination parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>startIndex</td>
<td>The 1-based index of the first search result.</td>
<td>1</td>
</tr>
<tr>
<td>count</td>
<td>Non-negative Integer. Specifies the desired maximum number of search results per page; e.g., 10.</td>
<td>None.</td>
</tr>
</tbody>
</table>
<p>The following table describes the query response pagination attributes:</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>itemsPerPage</td>
<td>Non-negative Integer. Specifies the number of search results returned in a query response page; e.g., 10.</td>
</tr>
<tr>
<td>totalResults</td>
<td>Non-negative Integer. Specifies the total number of results matching the client query; e.g., 1000.</td>
</tr>
<tr>
<td>startIndex</td>
<td>The 1-based index of the first result in the current set of search results; e.g., 1.</td>
</tr>
</tbody>
</table>
<h2 id="the-iam-scim-resource-schemas">The IAM SCIM resource schemas</h2>
<p>SCIM provides <a href="https://tools.ietf.org/html/rfc7643">an extensible schema mechanism</a> that allows to
describe multiple resource types. Currently IAM supports two resource types:</p>
<ul>
<li>Users</li>
<li>Groups</li>
</ul>
<h3 id="user-resources">User resources</h3>
<p>The IAM SCIM user resource provides basic user information as mandated by the
SCIM user schema (e.g., username, group membership, email addresses) as well as
IAM specific information as defined by the <code>urn:indigo-dc:scim:schemas:IndigoUser</code>
schema.</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>oidcIds</td>
<td>A list of OpenID Connect accounts linked to the user account</td>
</tr>
<tr>
<td>samlIds</td>
<td>A list of SAML accounts linked to the user account</td>
</tr>
<tr>
<td>certificates</td>
<td>A list of X.509 certificates linked to the user account</td>
</tr>
<tr>
<td>endTime</td>
<td>The user membership end time</td>
</tr>
<tr>
<td>aupSignatureTime</td>
<td>The time when the organization AUP document was last signed</td>
</tr>
<tr>
<td>labels</td>
<td>A set of labels linked to the account</td>
</tr>
</tbody>
</table>
<h4 id="example">Example</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T11:42:22.463+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T17:37:58.838+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test@iam.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;groups&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Production&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;c617d586-54e6-411d-8e38-64967798fa8a&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Analysis&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;oidcIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://accounts.google.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;105440632287425289613&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:test-oidc-issuer&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test-user&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;sshKeys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;my-ssh-key&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAjeLbypc7mmllwLgeVTh85s42ctrt4NhIyoW2oyyMkfGA+7LxDCoui0ttXIl06ATA7vDnuMpuQpPtW6V+4K7Mb65mQOOcy+aooQhLSdxhRNxiYmcJ80SK2lded0HiJUPi8H0iVF5ZiYh3ZYargI38Q182nAgcqPIFEmCgJ+h74d/BpE8LgfoB2fGHznShPjECrrDqruwnzjVljVKVK1PRSyfxoDLKT+ha26IDVTp3BimXOA/Iq53U0EPYP4n8S8EZfdVCdvH0vjZqASD1kBVXuoi50A/ls748bO4dADPXVmahsF+AeJzV6cnah9/6thSLa04v+z0fJ4kD/1g12uP1 cecco@dot1x-179.cnaf.infn.it&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;fingerprint&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DIXYv4H+HoUUkH07cM0NCOKMVVRTl3ZLfGoWNCgN9v0=&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T14:53:54.130+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T14:53:54.130+02:00&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;samlIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea.ceccanti@example.org&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;attributeId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:oid:0.9.2342.19200300.100.1.3&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;78901@idptestbed&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;attributeId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:oid:1.3.6.1.4.1.5923.1.1.1.13&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;certificates&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subjectDn&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CN=Andrea Ceccanti,CN=657221,CN=aceccant,OU=Users,OU=Organic Units,DC=cern,DC=ch&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;issuerDn&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CN=CERN Grid Certification Authority,DC=cern,DC=ch&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;pemEncodedCertificate&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;-----BEGIN CERTIFICATE-----\nMIIIyjCCBrKgAwIBAgIKKVs4XgAAACyrkDANBgkqhkiG9w0BAQ0FADBWMRIwEAYK\nCZImiZPyLGQBGRYCY2gxFDASBgoJkiaJk/IsZAEZFgRjZXJuMSowKAYDVQQDEyFD\nRVJOIEdyaWQgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwHhcNMjAwNTA1MTIyNTMx\nWhcNMjEwNjA5MTIyNTMxWjCBkDESMBAGCgmSJomT8ixkARkWAmNoMRQwEgYKCZIm\niZPyLGQBGRYEY2VybjEWMBQGA1UECxMNT3JnYW5pYyBVbml0czEOMAwGA1UECxMF\nVXNlcnMxETAPBgNVBAMTCGFjZWNjYW50MQ8wDQYDVQQDEwY2NTcyMjExGDAWBgNV\nBAMTD0FuZHJlYSBDZWNjYW50aTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC\nggEBAKj1dA0ghFbopQFnq3GS/kMfF9DQ7gyqy1vr7rbX8b2MHhkxObS+3mHrDlDm\nrKfvHhf2jmX/qfb22QGiD//NYOqzFGrjdyR/tFJNIjpy32GUzQWwW57YWpKaQTFB\npU3UjZFLQQYd7fBdcbjnqvgdshEXxJfz8R74XS03w1qgVpBt27xnVXq2iwQTV9oo\nv8FvY3RiNeZUMqN7or6QuDQ779wfd8/TaKDWUCmHUihcYW2wJsOtAQO3pIpMo+zE\nf+W2vjq6l8b0LMLQh0wR094Rpl5Teu1eYgRRyKFRDHTP80XYpjDBy7YZttg3zmy5\n4vAZYJmD3KC1EN0KkUBiwLdLMI8CAwEAAaOCBF0wggRZMB0GA1UdDgQWBBQD4yJP\nZK7pptCVP+aRL6BF0nGzUDAfBgNVHSMEGDAWgBSloP1mWP253Xrhsp2fo9HlUBiU\n5zCCATgGA1UdHwSCAS8wggErMIIBJ6CCASOgggEfhk5odHRwOi8vY2FmaWxlcy5j\nZXJuLmNoL2NhZmlsZXMvY3JsL0NFUk4lMjBHcmlkJTIwQ2VydGlmaWNhdGlvbiUy\nMEF1dGhvcml0eS5jcmyGgcxsZGFwOi8vL0NOPUNFUk4lMjBHcmlkJTIwQ2VydGlm\naWNhdGlvbiUyMEF1dGhvcml0eSxDTj1DRVJOUEtJMDUsQ049Q0RQLENOPVB1Ymxp\nYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24s\nREM9Y2VybixEQz1jaD9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2Jq\nZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0aW9uUG9pbnQwggFiBggrBgEFBQcBAQSCAVQw\nggFQMGMGCCsGAQUFBzAChldodHRwOi8vY2FmaWxlcy5jZXJuLmNoL2NhZmlsZXMv\nY2VydGlmaWNhdGVzL0NFUk4lMjBHcmlkJTIwQ2VydGlmaWNhdGlvbiUyMEF1dGhv\ncml0eS5jcnQwgcIGCCsGAQUFBzAChoG1bGRhcDovLy9DTj1DRVJOJTIwR3JpZCUy\nMENlcnRpZmljYXRpb24lMjBBdXRob3JpdHksQ049QUlBLENOPVB1YmxpYyUyMEtl\neSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2Vy\nbixEQz1jaD9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNh\ndGlvbkF1dGhvcml0eTAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuY2Vybi5jaC9v\nY3NwMA4GA1UdDwEB/wQEAwIFoDA9BgkrBgEEAYI3FQcEMDAuBiYrBgEEAYI3FQiD\nvdAJgu2NDYbtiyuB3vU3hYDQYh6FiuNMgbWqBAIBZAIBEDApBgNVHSUEIjAgBgor\nBgEEAYI3CgMEBggrBgEFBQcDBAYIKwYBBQUHAwIwJwYDVR0gBCAwHjAOBgwrBgEE\nAWAKBAICAwEwDAYKKoZIhvdMBQICATA1BgkrBgEEAYI3FQoEKDAmMAwGCisGAQQB\ngjcKAwQwCgYIKwYBBQUHAwQwCgYIKwYBBQUHAwIwVQYDVR0RBE4wTKAsBgorBgEE\nAYI3FAIDoB4MHGFuZHJlYS5jZWNjYW50aUBjbmFmLmluZm4uaXSBHGFuZHJlYS5j\nZWNjYW50aUBjbmFmLmluZm4uaXQwRAYJKoZIhvcNAQkPBDcwNTAOBggqhkiG9w0D\nAgICAIAwDgYIKoZIhvcNAwQCAgCAMAcGBSsOAwIHMAoGCCqGSIb3DQMHMA0GCSqG\nSIb3DQEBDQUAA4ICAQBt1/UjP+mz2/7SnAacu4BiELdBAumD+HiO2RZR9BltqX8u\n1nDsOYnwBKvoSYFRWrVv19s0uHdlOGQkJV10Un6KpNES91LosT/EVcBn4EIDK+qH\ncSjJAWUWCeu0Vfqm5HD0adH7K210gvqVC6U/m+nCAcNqWcPiH84YwiFBDKVqzolO\nRqkGc7C1tvljeiskcXEDbY8QOPIJSbpsgPEihOAmz9mZ72MwQMbYc8x0f/2ucw9I\nIUwm/FYzGSVDL3XOmc3+wGsmb4dYSaSReBCpbtt0aHuNHGaRzYpHn65lbkN31kok\nqAUoWyjd2MHVfzPCc9kyTxACWI1NvkiQuetr/UHF3pDQsdJj51DkmApLn/RvSwq7\nS9tFpYcrAWYYpqWwH7rnvvWxQUZLgtrYc2PK7AUSq5AW3fMYqYyPPeHEb5Nn4LJ1\nTisVMJgXk+vx3FGLSIbry+qzY1mENjzKGHQnV+8OhZAcykTi1torMoC0dJZDZzWf\nnWPiBweoUDH8TgvfI8SqID6CI6CQnOqh8VXD9vQsRoeCwqNVnNHQUh2qUAVUMyuU\n5z/nWRhjsgqcCB1ERfWeI0xznj86o8GgaTMkXiZgGWDrdwqqm5S75tUWJ6BDJd/1\nJD7zeEY8Vl9sjqsUQIX2m5MPNkdW57SkpSbNFx55uiUNJmpUxOSxcuR+PIvSJw==\n-----END CERTIFICATE-----&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T17:37:58.838+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T17:37:58.838+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;hasProxyCertificate&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="openid-connect-accounts">OpenId Connect accounts</h4>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>issuer</td>
<td>The issuer string of the linked OpenID connect account</td>
</tr>
<tr>
<td>subject</td>
<td>The subject string of the linked OpenID connect account</td>
</tr>
</tbody>
</table>
<h4 id="saml-accounts">SAML accounts</h4>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>idpId</td>
<td>The entityId of the SAML IdP of the linked account</td>
</tr>
<tr>
<td>attributeId</td>
<td>The id of the attribute used for the linking</td>
</tr>
<tr>
<td>userId</td>
<td>The valute of the attribute used for the linked account</td>
</tr>
</tbody>
</table>
<h4 id="certificates">Certificates</h4>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary</td>
<td>Whether the certificate should be considered the primary certificate for the user</td>
</tr>
<tr>
<td>subjectDn</td>
<td>The certificate subject distinguished name</td>
</tr>
<tr>
<td>issuerDn</td>
<td>The certificate issuer distinguished name</td>
</tr>
<tr>
<td>pemEncodedCertificate</td>
<td>An optional pem encoded certificate for the user</td>
</tr>
<tr>
<td>display</td>
<td>A display name for the certificate</td>
</tr>
<tr>
<td>created</td>
<td>When the certificate was first linked to the account</td>
</tr>
<tr>
<td>lastModified</td>
<td>When the certificate was last modified</td>
</tr>
<tr>
<td>hasProxyCertificate</td>
<td>Whether a managed proxy certificate is stored in IAM for this cert</td>
</tr>
</tbody>
</table>
<h4 id="sshkeys">SshKeys</h4>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>display</td>
<td>A descriptive label linked to the key</td>
</tr>
<tr>
<td>primary</td>
<td>Whether the key should be considered the primary one for the user</td>
</tr>
<tr>
<td>value</td>
<td>The ssh key encoded value</td>
</tr>
<tr>
<td>fingerprint</td>
<td>The key fingerprint</td>
</tr>
<tr>
<td>created</td>
<td>When the key was first linked to the account</td>
</tr>
<tr>
<td>lastModified</td>
<td>When the key was last modified</td>
</tr>
</tbody>
</table>
<h3 id="group-resources">Group resources</h3>
<p>The IAM SCIM group resource provides basic group information as mandated by the
SCIM core group schema (e.g., group display name, username, group membership, email addresses) as well as
IAM specific information as defined by the <code>urn:indigo-dc:scim:schemas:IndigoGroup</code>
schema.</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>parentGroup</td>
<td>A reference to the parent group</td>
</tr>
<tr>
<td>description</td>
<td>A textual description linked to the group</td>
</tr>
<tr>
<td>labels</td>
<td>A set of labels linked to the group</td>
</tr>
</tbody>
</table>
<h4 id="example-1">Example</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;4dc76711-3b5d-4ed6-a73d-b8154faca9d6&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T18:17:58.407+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T18:17:58.407+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/4dc76711-3b5d-4ed6-a73d-b8154faca9d6&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:Group&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoGroup&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Analysis/subgroup&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoGroup&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;parentGroup&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Analysis&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;A subgroup of the Analysis group&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;temporary&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-scimme">GET <code>/scim/Me</code></h2>
<p>Retrieves information about the currently authenticated user.</p>
<pre><code>GET http://localhost:8080/scim/Me
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T11:42:22.463+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T14:53:54.130+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test User&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test&#34;</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test@iam.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;groups&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Production&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;c617d586-54e6-411d-8e38-64967798fa8a&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Analysis&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://iam.local.io/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;oidcIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://accounts.google.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;105440632287425289613&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:test-oidc-issuer&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test-user&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;sshKeys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;my-ssh-key&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAjeLbypc7mmllwLgeVTh85s42ctrt4NhIyoW2oyyMkfGA+7LxDCoui0ttXIl06ATA7vDnuMpuQpPtW6V+4K7Mb65mQOOcy+aooQhLSdxhRNxiYmcJ80SK2lded0HiJUPi8H0iVF5ZiYh3ZYargI38Q182nAgcqPIFEmCgJ+h74d/BpE8LgfoB2fGHznShPjECrrDqruwnzjVljVKVK1PRSyfxoDLKT+ha26IDVTp3BimXOA/Iq53U0EPYP4n8S8EZfdVCdvH0vjZqASD1kBVXuoi50A/ls748bO4dADPXVmahsF+AeJzV6cnah9/6thSLa04v+z0fJ4kD/1g12uP1 cecco@dot1x-179.cnaf.infn.it&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;fingerprint&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DIXYv4H+HoUUkH07cM0NCOKMVVRTl3ZLfGoWNCgN9v0=&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T14:53:54.130+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-24T14:53:54.130+02:00&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;samlIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea.ceccanti@example.org&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;attributeId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:oid:0.9.2342.19200300.100.1.3&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;78901@idptestbed&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;attributeId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:oid:1.3.6.1.4.1.5923.1.1.1.13&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>

</code></pre></div><h2 id="get-scimusersid">GET <code>/scim/Users/{id}</code></h2>
<p>Retrieves all the information about the user identified by <code>id</code> and returns results in application/json.</p>
<p>Requires <code>scim:read</code> scope.</p>
<pre><code>GET http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2cb10ac5-5b1a-47a0-8f60-48995999f18d&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-13T18:38:16.314+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-13T18:38:16.314+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul_mccartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;McCartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul McCartney&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul_mccartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul@beatles.uk&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="post-scimusers">POST <code>/scim/Users</code></h2>
<p>Creates a new user, using the info specified within the request body, sent as application/json.</p>
<p>Requires <code>scim:write</code> scope.</p>
<pre><code>POST http://localhost:8080/scim/Users/
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul_mccartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;McCartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul McCartney&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul@beatles.uk&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Successful Resource creation is indicated with a <code>201 Created</code> response code.
Upon successful creation, the response body contains the newly created User.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2cb10ac5-5b1a-47a0-8f60-48995999f18d&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-13T18:38:16.314+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-13T18:38:16.314+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/2cb10ac5-5b1a-47a0-8f60-48995999f18d&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul_mccartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;McCartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Paul McCartney&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul_mccartney&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;paul@beatles.uk&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-scimusers">GET <code>/scim/Users</code></h2>
<p>Requires <code>scim:read</code> scope.</p>
<p>SCIM defines a standard set of operations that can be used to filter, sort, and
paginate response results. The operations are specified by adding query
parameters to the Resource&rsquo;s endpoint.</p>
<p>The example below returns the first 10 users (implicit startIndex as 1):</p>
<pre><code>GET /scim/Users?count=10
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">250</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-14T12:22:46.376+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-14T12:22:46.376+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Users/80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span>
            <span style="color:#000;font-weight:bold">},</span>
            <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Test User&#34;</span>
            <span style="color:#000;font-weight:bold">},</span>
            <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test@iam.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;groups&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Production&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;c617d586-54e6-411d-8e38-64967798fa8a&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&#34;</span>
                <span style="color:#000;font-weight:bold">},</span>
                <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Analysis&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Groups/6a384bcd-d4b3-4b7f-a2fe-7d897ada0dd1&#34;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;oidcIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://accounts.google.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;105440632287425289613&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">],</span>
                <span style="color:#204a87;font-weight:bold">&#34;samlIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea.ceccanti@example.org&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">...</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The details of the returned users can be reduced/filtered by specifying the
needed attribute(s). The below example returns only the userName for all Users:</p>
<pre><code>GET http://localhost:8080/scim/Users?attributes=userName
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">250</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;73f16d93-2441-4a50-88ff-85360d78c6b5&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">...</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Multiple attributes are also supported:</p>
<pre><code>GET http://localhost:8080/scim/Users?count=2&amp;attributes=userName%2Cemails%2Curn%3Aindigo-dc%3Ascim%3Aschemas%3AIndigoUser
</code></pre>
<p>Request params:</p>
<ul>
<li><code>count=2</code></li>
<li><code>attributes=userName,emails,urn:indigo-dc:scim:schemas:IndigoUser</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">250</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test@iam.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;oidcIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://accounts.google.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;105440632287425289613&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">],</span>
                <span style="color:#204a87;font-weight:bold">&#34;samlIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;andrea.ceccanti@example.org&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;73f16d93-2441-4a50-88ff-85360d78c6b5&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin@iam.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
                    <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">],</span>
            <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;oidcIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;issuer&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://accounts.google.com&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;114132403455520317223&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">],</span>
                <span style="color:#204a87;font-weight:bold">&#34;samlIds&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;idpId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://idptestbed/idp/shibboleth&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;userId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ciccio.paglia@example.org&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>SCIM <strong>Filtering</strong> and <strong>sorting</strong> of results are currently not supported.</p>
<h2 id="put-scimusersid">PUT <code>/scim/Users/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>PUT performs a full update. Clients should retrieve the entire resource and
then PUT the desired modifications as the operation overwrites all previously
stored data. A successful PUT operation returns a 200 OK response code and the
entire resource within the response body.</p>
<p>Example of changing the userName from <code>john_lennon</code> to <code>j.lennon</code> and setting <code>active</code> as true:</p>
<pre><code>GET http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;john_lennon&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;John&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Lennon&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;John Lennon&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;lennon@email.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Retrieved the user&rsquo;s info, update userName as <code>&quot;userName&quot;: &quot;j.lennon&quot;</code> and add <code>&quot;active&quot;: true</code>:</p>
<pre><code>PUT http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:User&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;j.lennon&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;John&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;familyName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Lennon&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;formatted&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;John Lennon&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;emails&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;work&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;lennon@email.test&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The returned answer is:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/scim+json;charset=UTF-8
{
    &quot;id&quot;: &quot;e380b4e3-7b63-47c2-b156-3699be9ebcfe&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T15:42:56.275+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T15:42:56.445+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Users/e380b4e3-7b63-47c2-b156-3699be9ebcfe&quot;,
        &quot;resourceType&quot;: &quot;User&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:User&quot;,
        &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;
    ],
    &quot;userName&quot;: &quot;j.lennon&quot;,
    &quot;name&quot;: {
        &quot;givenName&quot;: &quot;John&quot;,
        &quot;familyName&quot;: &quot;Lennon&quot;,
        &quot;formatted&quot;: &quot;John Lennon&quot;
    },
    &quot;displayName&quot;: &quot;j.lennon&quot;,
    &quot;active&quot;: true,
    &quot;emails&quot;: [
        {
            &quot;type&quot;: &quot;work&quot;,
            &quot;value&quot;: &quot;lennon@email.test&quot;,
            &quot;primary&quot;: true
        }
    ]
}
</code></pre>
<h2 id="patch-scimusersid">PATCH <code>/scim/Users/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>PATCH enables consumers to send only the attributes requiring modification,
reducing network and processing overhead. Attributes may be deleted, replaced,
merged, or added in a single request. The body of a PATCH request MUST contain
a partial resource with the desired modifications. The server MUST return
either a 200 OK response code and the entire Resource within the response body,
or a 204 No Content response code and the appropriate response headers for a
successful PATCH request.</p>
<p>The following example shows how to replace the userName:</p>
<pre><code>PATCH http://localhost:8080/scim/Users/b6769dd1-3d7d-416d-be6d-020be23ba904
Body:
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;replace&quot;,
            &quot;value&quot;: {
                &quot;userName&quot;: &quot;john_lennon_jr&quot;,
            }
        }
    ]
}
</code></pre>
<p>The following example shows how to add an OpenID Connect account and a ssh key:</p>
<pre><code>PATCH http://localhost:8080/scim/Users/b6769dd1-3d7d-416d-be6d-020be23ba904
Body:
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;add&quot;,
            &quot;value&quot;: {
                &quot;urn:indigo-dc:scim:schemas:IndigoUser&quot;: {
                    &quot;oidcIds&quot;: [
                        {
                            &quot;issuer&quot;: &quot;test_issuer&quot;,
                            &quot;subject&quot;: &quot;test_subject&quot;
                        }
                    ],
                    &quot;sshKeys&quot;: [
                        {
                            &quot;display&quot;: &quot;Personal&quot;,
                            &quot;primary&quot;: true,
                            &quot;value&quot;: &quot;AAAAB3NzaC1yc2EAAAADAQABAAABAQC4tjz4mfMLvJsM8RXIgdRYPBhH//VXLXbeLbUsJpm5ARIQPY6Gu1befPA3jqKacvdcBrMsYGiMp/DOhpkAwWclSnzMdvYLbYWkrOPwBVrRh7lvFtXFLaQZ6do4uMZHb5zU2ViTFacrJ6zJ/GLltjk4nBea7Z4qHaQdWou3Fk/108oMQGx7jqW44m+TA+HYo6rEbVWbimWVXyyiKchO2LTLKUbK6GBSWJiItezwAWR3KKs3FXKRmbJDiKESh3mDccJidfkjzNLPyDf3JHI2b/C/mcvtJsoAtkIWuVll2BhBBiqkYt3tX2llZCYGtF7rZOYTsqhw+LPnsJtsX+W7e4iN&quot;
                        }
                    ]
                }
            }
        }
    ]
}
</code></pre>
<h2 id="delete-scimusersid">DELETE <code>/scim/Users/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>Clients request user removal via DELETE.</p>
<pre><code>DELETE /scim/Users/4380e98c-02f2-4d10-85ba-9fbbdb819ed8

HTTP/1.1 200 OK
</code></pre>
<p>Example: Client attempt to retrieve the previously deleted User:</p>
<pre><code>GET /scim/Users/4380e98c-02f2-4d10-85ba-9fbbdb819ed8
{
    &quot;status&quot;: &quot;404&quot;,
    &quot;detail&quot;: &quot;No user mapped to id '4380e98c-02f2-4d10-85ba-9fbbdb819ed8'&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:Error&quot;
    ]
}
</code></pre>
<h2 id="get-scimgroupsid">GET <code>/scim/Groups/{id}</code></h2>
<p>Retrieves information about the group identified by <code>id</code> and returns results in
application/json.</p>
<p>Requires <code>scim:read</code> scope.</p>
<pre><code>GET /scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;c617d586-54e6-411d-8e38-64967798fa8a&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-14T16:22:05.170+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2016-07-14T16:22:05.170+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-64967798fa8a&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;resourceType&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Group&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;urn:ietf:params:scim:schemas:core:2.0:Group&#34;</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;displayName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Production&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>To provide scalable management of group membership, IAM does no longer return
the <code>members</code> claim for the SCIM Group resources, as the SCIM standard does not
currently describe a way to implement pagination on group members.</p>
<p>See the <code>members</code> and <code>subgroups</code> sub-resources.</p>


</div>

<h2 id="get-scimgroupsidmembers">GET <code>/scim/Groups/{id}/members</code></h2>
<p>Returns a paginated list of user accounts, ordered by username, which are
members of the group identified by <code>id</code>. To know about more about pagination
parameters, see the <a href="#pagination">Pagination section</a>.</p>
<p>Requires <code>scim:read</code> scope.</p>
<pre><code>GET https://wlcg.cloud.cnaf.infn.it/scim/Groups/b86a9e99-9f0e-478f-999c-2046c764aa14/members?count=5
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">151</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Example User 1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;92287eed-80eb-4702-be59-a9e313d7b85e&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Users/92287eed-80eb-4702-be59-a9e313d7b85e&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Example User 2&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;bda5a5af-4067-4814-9b59-fd7265978cc4&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Users/bda5a5af-4067-4814-9b59-fd7265978cc4&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Example User 3&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;7489bf81-65db-4457-8ea6-6707d6405681&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Users/7489bf81-65db-4457-8ea6-6707d6405681&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Example User 4&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;90cc5097-d904-4290-97b9-08a2646326b3&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Users/90cc5097-d904-4290-97b9-08a2646326b3&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Example User 5&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;e83eec5a-e2e3-43c6-bb67-df8f5ec3e8d0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Users/e83eec5a-e2e3-43c6-bb67-df8f5ec3e8d0&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="get-scimgroupsidsubgroups">GET <code>/scim/Groups/{id}/subgroups</code></h2>
<p>Returns a paginated list of groups, ordered by name, which are direct sub-groups of the group
identified by <code>id</code>. To know about more about pagination parameters, see the
<a href="#pagination">Pagination section</a>.</p>
<p>Requires <code>scim:read</code> scope.</p>
<pre><code>GET https://wlcg.cloud.cnaf.infn.it/scim/Groups/b86a9e99-9f0e-478f-999c-2046c764aa14/subgroups?count=10
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;totalResults&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;itemsPerPage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;startIndex&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;schemas&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#34;urn:ietf:params:scim:api:messages:2.0:ListResponse&#34;</span>
  <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;Resources&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;wlcg/pilots&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;25084f30-1d71-4ab2-91e8-11148af16682&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Groups/25084f30-1d71-4ab2-91e8-11148af16682&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;wlcg/test&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;34bdcf9e-fc17-4a80-a4b7-19f7964439e6&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Groups/34bdcf9e-fc17-4a80-a4b7-19f7964439e6&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;wlcg/xfers&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;f356885a-9d06-4687-b5fe-57322430f111&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;$ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Groups/f356885a-9d06-4687-b5fe-57322430f111&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="post-scimgroups">POST <code>/scim/Groups</code></h2>
<p>Creates a new group, using the info specified within the request body, sent as application/json.</p>
<p>Requires <code>scim:write</code> scope.</p>
<pre><code>POST http://localhost:8080/scim/Groups/

{
    &quot;id&quot;: &quot;7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers&quot;
}
</code></pre>
<p>Successful Resource creation is indicated with a 201 (&ldquo;Created&rdquo;) response code. Upon successful creation, the response body contains the newly created User.</p>
<pre><code>{
    &quot;id&quot;: &quot;7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T16:24:50.941+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T16:24:50.941+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/7b427ebe-9058-479e-95b6-f3cebec91731&quot;,
        &quot;resourceType&quot;: &quot;Group&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers&quot;
}
</code></pre>
<h2 id="get-scimgroups">GET <code>/scim/Groups</code></h2>
<p>Requires <code>scim:read</code> scope.</p>
<p>The pagination seen for users can be applied also to groups:</p>
<p>Example: retrieve the 22nd group</p>
<pre><code>GET http://localhost:8080/scim/Groups?startIndex=22&amp;count=1

{
    &quot;totalResults&quot;: 22,
    &quot;itemsPerPage&quot;: 1,
    &quot;startIndex&quot;: 22,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:ListResponse&quot;
    ],
    &quot;Resources&quot;: [
        {
            &quot;id&quot;: &quot;c617d586-54e6-411d-8e38-649677980020&quot;,
            &quot;meta&quot;: {
                &quot;created&quot;: &quot;2016-07-14T16:33:20.135+02:00&quot;,
                &quot;lastModified&quot;: &quot;2016-07-14T16:33:20.135+02:00&quot;,
                &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/c617d586-54e6-411d-8e38-649677980020&quot;,
                &quot;resourceType&quot;: &quot;Group&quot;
            },
            &quot;schemas&quot;: [
                &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
            ],
            &quot;displayName&quot;: &quot;Test-020&quot;
        }
    ]
}
</code></pre>
<h2 id="put-scimgroupsid">PUT <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>PUT performs a full update. Clients should retrieve the entire resource and
then PUT the desired modifications as the operation overwrites all previously
stored data. A successful PUT operation returns a 200 OK response code and the
entire resource within the response body.</p>
<p>Example of replacing group with a different displayName:</p>
<pre><code>PUT http://localhost:8080/scim/Groups/891d042d-fc6e-4408-8a3a-ad9dfdf5db89
{
    &quot;id&quot;: &quot;891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers_updated&quot;
}

{
    &quot;id&quot;: &quot;891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
    &quot;meta&quot;: {
        &quot;created&quot;: &quot;2016-07-14T16:37:18.302+02:00&quot;,
        &quot;lastModified&quot;: &quot;2016-07-14T16:37:18.411+02:00&quot;,
        &quot;location&quot;: &quot;http://localhost:8080/scim/Groups/891d042d-fc6e-4408-8a3a-ad9dfdf5db89&quot;,
        &quot;resourceType&quot;: &quot;Group&quot;
    },
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:schemas:core:2.0:Group&quot;
    ],
    &quot;displayName&quot;: &quot;engineers_updated&quot;
}
</code></pre>
<h2 id="patch-scimgroupsid">PATCH <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>The following example shows how to add member to a group:</p>
<pre><code>PATCH http://localhost:8080/scim/Groups/4ca7fa98-0875-4eb3-a71f-0f88ce5632cf
{
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:PatchOp&quot;
    ],
    &quot;operations&quot;: [
        {
            &quot;op&quot;: &quot;add&quot;,
            &quot;path&quot;: &quot;members&quot;,
            &quot;value&quot;: [
                {
                    &quot;display&quot;: &quot;john_lennon&quot;,
                    &quot;value&quot;: &quot;e9c8cfca-7158-4a0d-9684-4abdede617cd&quot;,
                    &quot;$ref&quot;: &quot;http://localhost:8080/scim/Users/e9c8cfca-7158-4a0d-9684-4abdede617cd&quot;
                }
            ]
        }
    ]
}
</code></pre>
<h2 id="delete-scimgroupsid">DELETE <code>/scim/Groups/{id}</code></h2>
<p>Requires <code>scim:write</code> scope.</p>
<p>Clients request group removal via DELETE.</p>
<pre><code>DELETE /scim/Groups/5bae2407-08e3-4171-b180-4b4a0196e7b6

HTTP/1.1 200 OK
</code></pre>
<p>Example: Client attempt to retrieve the previously deleted User:</p>
<pre><code>GET /scim/Groups/5bae2407-08e3-4171-b180-4b4a0196e7b6
{
    &quot;status&quot;: &quot;404&quot;,
    &quot;detail&quot;: &quot;No group mapped to id '5bae2407-08e3-4171-b180-4b4a0196e7b6'&quot;,
    &quot;schemas&quot;: [
        &quot;urn:ietf:params:scim:api:messages:2.0:Error&quot;
    ]
}
</code></pre>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-43a4bb7d0656895dfb5d3195932b03df">3.1.12 - Scope Policy API</h1>
    
	<p>In OpenID Connect and OAuth, <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-3.3">scopes</a> are used to determine the
privileges granted to a client application for a given session. For example,
the <code>openid</code> and <code>profile</code> scopes are used to obtain access to identity
information about a user, but applications can define their own scopes to
implement domain-specific authorization (e.g., the WLCG <code>storage.read</code>  and
<code>storage.modify</code> scopes are examples of domain-specific OAuth scopes).</p>
<p>IAM implements two levels of access control on OAuth scopes:</p>
<ul>
<li>
<p>a client-level vetting, implemented through the <a href="https://github.com/mitreid-connect/">MitreID
connect</a> library, so that each registered client has a list
of allowed scopes. When a client requests a scope that is not allowed to get,
it gets an <code>invalid_scope</code> error.</p>
</li>
<li>
<p>an identity-related vetting, implemented through the concept of <strong>Scope
policies</strong>, that can be used to limit access to scopes based on user
identity.</p>
</li>
</ul>
<p>This behaviour is described in the following picture:</p>







<div class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
	<img class="card-img-top" src="/v/v1.8.2/docs/reference/api/scope-policy-api/scope-access-control_hu6e763215bf70a10084d1e80c7ceecc51_62387_500x0_resize_catmullrom_3.png" width="500" height="833">
	
	<div class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
</p>
	</div>
	
</div>
<h2 id="scope-policies">Scope policies</h2>
<p>IAM Scope policies provide a mechanism to control access to OAuth
scopes. A scope policy defines:</p>
<ul>
<li>
<p>a <code>rule</code>, which can be <code>PERMIT</code> or <code>DENY</code>, that determines the behaviour of
the policy. <code>PERMIT</code> policies are used to allow access to scopes, while
<code>DENY</code> policies are used to block access to scopes;</p>
</li>
<li>
<p>a scopes selector, i.e. a set of scopes for which the policy applies (and a
scope <code>matchingPolicy</code> used to determine the scope matching algorithm used);</p>
</li>
<li>
<p>an <code>account</code> or <code>group</code> selector, used to determine for which user account or
group of accounts the policy should apply.</p>
</li>
</ul>
<p>An example scope policy is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Default Permit ALL policy&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-10-08T13:52:20.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-10-08T13:52:20.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
  <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The policy above is a <code>PERMIT</code> policy that allows access to all the scopes to
any account, as clarified by the policy <code>description</code>.</p>
<p>In the policy, the <code>account</code> and <code>group</code> selector are not specified, which
means that the policy would apply to any user account. Also the <code>scopes</code>
selector is not specified, which means that the policy would apply to any
scope.</p>


<div class="alert alert-primary" role="alert">


    The policies that are not explicitly bound to an account or a group are called
<strong>default scope policies</strong>.

</div>

<p>The example policy above is enabled by the default IAM configuration, which in practice
limits the default scope vetting only to the client level.</p>
<p>Here&rsquo;s an another example, now showing two policies:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">[{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Deny access to compute.* scopes to normal users&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-12-18T15:11:04.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-12-18T15:11:04.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DENY&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;compute.create&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.read&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.cancel&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.modify&#34;</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Allow access to compute.* scopes to wlcg/pilot users&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-12-18T15:19:20.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2019-12-18T15:19:20.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;25084f30-1d71-4ab2-91e8-11148af16682&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;wlcg/pilots&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/scim/Groups/25084f30-1d71-4ab2-91e8-11148af16682&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;compute.create&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.read&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.cancel&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;compute.modify&#34;</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}]</span>
</code></pre></div><p>The first policy, as clarified in the description, would block access to the
<code>compute.create</code>, <code>compute.read</code>, <code>compute.cancel</code> and <code>compute.modify</code> scopes
to any authenticated user. The second policy would instead allow access to
<code>compute.*</code> scopes only to members of the <code>wlcg/pilot</code> group (again, as written
in the policy <code>description</code>).</p>
<p>The two policies can work together because the IAM policy engine evaluates the
policy in a specific order: account-level policies are applied first, then
group-level policies are applied and finally policies that are not bound to any
specific account or group are applied. This means that a policy defined to
apply at the account or group-level typically wins over a more general one, as
in the example above. Also, scopes being vetted are evaluated only once across
different levels. This means, for example, that a scope that was evaluated at
account-level will not be re-evaluated at group-level: the decision taken for
such scope is not reconsidered.</p>
<p>In more technical terms, the policy engine implements a deny-override policy
composition logic, which means that a deny policy which matches a request at a
given level wins over a permit policy at that same level. For example, if there
are two account-level policies that would apply for scope <code>s</code>, one which would
yield a <code>PERMIT</code> result, and one that would yield a <code>DENY</code>, the <code>DENY</code> will
win.</p>
<h3 id="scope-matching-algorithms">Scope matching algorithms</h3>
<p>IAM currently supports three scope matching algorithms:</p>
<ul>
<li>
<p><code>EQ</code>: which is the default, uses string equality when comparing requested
scopes to scopes allowed by the client configuration or by the scope
policies;</p>
</li>
<li>
<p><code>REGEXP</code>: which uses a regular expression evaluation when comparing
requested scopes to scopes allowed by the client configuration or scope
policies;</p>
</li>
<li>
<p><code>PATH</code>: which uses a WLCG-specific path-matching logic, described in more
detail below,  to compare requested scopes to scopes allowed by the client
configuration or by the scope policies.</p>
</li>
</ul>
<p><code>REGEXP</code> and <code>PATH</code> matching algorithms are configured by adding a
<code>scope.matchers</code> section to the IAM configuration, as shown in the following
fragment which defines the scope matching algorithm for <a href="https://github.com/WLCG-AuthZ-WG/common-jwt-profile/blob/master/profile.md#capability-based-authorization-scope">WLCG profile
scopes</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">matchers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.read</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.read</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.create</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.create</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.modify</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">storage.modify</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wlcg.groups</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">regexp</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">regexp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">^wlcg\.groups(?::((?:\/[a-zA-Z0-9][a-zA-Z0-9_.-]*)+))?$</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="path-scope-matching">PATH scope matching</h4>
<p>The <code>PATH</code> scope matching algorithm is used to implement a scope-matching logic
compliant with the <a href="https://github.com/WLCG-AuthZ-WG/common-jwt-profile/blob/master/profile.md#capability-based-authorization-scope">WLCG JWT profile rules for storage scope
matching</a>, which allow a scope to contain a parametric part
describing a path. Following the <a href="https://scitokens.org/technical_docs/Claims">Scitokens model</a>, permissions granted on a path
apply transitively to subpaths. To give an example:</p>
<pre><code>storage.read:/cms
</code></pre><p>will grant read access to the <code>/cms</code> directory and all its content and
subdirectories, but does not grant access to the <code>/atlas</code> directory.</p>
<p>Following the same logic, a client allowed to request <code>storage.read:/example</code>,
when <code>PATH</code> scope matching is configured as described above for the
<code>storage.read</code> parametric scope, will be allowed to request the
<code>storage.read:/example</code> but also any scope containing subpaths of <code>/example</code>,
e.g., <code>storage.read:/example/subdir/file</code>.</p>
<h4 id="regexp-scope-matching">REGEXP scope matching</h4>
<p>The <code>REGEXP</code> scope matching algorithms uses regular expression matching to
determine whether a scope is allowed for a given client or user.</p>
<p>Taking the parametric <code>wlcg.groups</code> scope described above:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wlcg.groups</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">regexp</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">regexp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">^wlcg\.groups(?::((?:\/[a-zA-Z0-9][a-zA-Z0-9_.-]*)+))?$</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>A client allowed to request the scope <code>wlcg.groups</code> will also be allowed for
the scope <code>wlcg.groups:/a/group</code> or any other group name matching the regexp.</p>
<h2 id="the-scope-policy-api">The Scope policy API</h2>
<p>The Scope Policy API is a REST API that allows to manage scope policies.
Access to the API is restricted to administrator users authenticated via web interface
or OAuth clients that have access to the <code>iam:admin.read</code> (for read access) or <code>iam:admin.write</code> (for write
access) OAuth scopes.</p>
<h3 id="get-iamscope_policies">GET /iam/scope_policies</h3>
<p>Returns a JSON representation of the Scope Policies defined for the
organization.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: <code>iam:admin.read</code> scope</p>
<p><strong>Command example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -i -H <span style="color:#4e9a06">&#34;Accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#000">$TOKEN</span><span style="color:#4e9a06">&#34;</span> -X GET https://example.com/iam/scope_policies/
</code></pre></div><h4 id="success-response">Success response</h4>
<p><strong>Condition</strong>: Being Authenticated and authorized</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content</strong>: An array of JSON representations for the scope policies defined in
the organization</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">[{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span>
<span style="color:#000;font-weight:bold">}]</span>
</code></pre></div><h4 id="error-responses">Error responses</h4>
<p><strong>Condition</strong>: User is not authenticated</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>OR</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;invalid_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid access token: &lt;Access Token&gt;&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>If an invalid token is provided or no token is provided.</p>
<h3 id="get-iamscope_policiesid">GET /iam/scope_policies/{id}</h3>
<p>Returns the JSON representation for the scope policy identified by <code>id</code>.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: <code>iam:admin.read</code> scope</p>
<p><strong>Command example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -i -H <span style="color:#4e9a06">&#34;Accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#000">$TOKEN</span><span style="color:#4e9a06">&#34;</span> -X GET https://example.com/iam/scope_policies/1
</code></pre></div><h4 id="success-response-1">Success response</h4>
<p><strong>Condition</strong>: Being Authenticated</p>
<p><strong>Code</strong>: <code>200 OK</code></p>
<p><strong>Content</strong>: The JSON representation for the scope policy</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2018-02-27T07:26:21.000+01:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">null</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="error-responses-1">Error responses</h4>
<p><strong>Condition</strong>: User is not authenticated</p>
<p><strong>Code</strong>: <code>401 Unauthorized</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>OR</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;invalid_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid access token: &lt;Access Token&gt;&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>If an invalid token is provided or no token is provided.</p>
<p><strong>Condition</strong>: The Scope Policy {id} is not defined for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;No scope policy found for id: {id}&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="put-iamscope_policiesid">PUT /iam/scope_policies/{id}</h3>
<p>Changes an existing Scope Policy.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: <code>iam:admin.write</code> scope</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the Scope Policy to be modified.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">positive</span> <span style="color:#a40000">integer</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">512</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">allowed</span> <span style="color:#a40000">values:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;DENY&#34;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">allowed</span> <span style="color:#a40000">values:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;REGEXP&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;PATH&#34;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">valid</span> <span style="color:#a40000">account</span> <span style="color:#a40000">selector</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">valid</span> <span style="color:#a40000">group</span> <span style="color:#a40000">selector</span> <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">list</span> <span style="color:#a40000">of</span> <span style="color:#a40000">scopes</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">minimum</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#a40000">and</span> <span style="color:#a40000">maximum</span> <span style="color:#0000cf;font-weight:bold">255</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-2">Success response</h4>
<p><strong>Condition</strong>: The Scope Policy is modified for the organization</p>
<p><strong>Code</strong>: <code>204 No Content</code></p>
<h4 id="error-responses-2">Error responses</h4>
<p><strong>Condition</strong>: Policy validation error</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid scope policy: rule cannot be empty&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>OR</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;invalid_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid access token: &lt;Access Token&gt;&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>If an invalid token is provided or no token is provided at all</p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;access_denied&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="post-iamscope_policies">POST /iam/scope_policies</h3>
<p>Creates a Scope Policy for the organization</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: <code>iam:admin.write</code> scope</p>
<p><strong>Data constraints</strong></p>
<p>Provide a representation of the Scope Policy to be created</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">optional</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">at</span> <span style="color:#a40000">most</span> <span style="color:#0000cf;font-weight:bold">512</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">allowed</span> <span style="color:#a40000">values:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;DENY&#34;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">text</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">allowed</span> <span style="color:#a40000">values:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;REGEXP&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;PATH&#34;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;account&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">valid</span> <span style="color:#a40000">account</span> <span style="color:#a40000">selector</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">valid</span> <span style="color:#a40000">group</span> <span style="color:#a40000">selector</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#a40000">a</span> <span style="color:#a40000">list</span> <span style="color:#a40000">of</span> <span style="color:#a40000">scopes</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">each</span> <span style="color:#a40000">scope</span> <span style="color:#a40000">string</span> <span style="color:#a40000">should</span> <span style="color:#a40000">be</span> <span style="color:#a40000">no</span> <span style="color:#a40000">longer</span> <span style="color:#a40000">than</span> <span style="color:#0000cf;font-weight:bold">255</span> <span style="color:#a40000">chars</span><span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Data example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Allow access to compute.* scopes to wlcg/pilot users&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;scopes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;compute.read&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;compute.modify&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;compute.create&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;compute.cancel&#34;</span><span style="color:#000;font-weight:bold">],</span>
  <span style="color:#204a87;font-weight:bold">&#34;matchingPolicy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;group&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
       <span style="color:#204a87;font-weight:bold">&#34;uuid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;25084f30-1d71-4ab2-91e8-11148af16682&#34;</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="success-response-3">Success response</h4>
<p><strong>Condition</strong>: The Scope Policy is created for the organization</p>
<p><strong>Code</strong>: <code>201 Created</code></p>
<h4 id="error-responses-3">Error responses</h4>
<p><strong>Condition</strong>: Policy validation error</p>
<p><strong>Code</strong>: <code>400 BAD REQUEST</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid scope policy: rule cannot be empty&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>OR</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;invalid_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid access token: &lt;Access Token&gt;&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>If an invalid token is provided or no token is provided at all</p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;access_denied&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="delete-iamscope_policiesid">DELETE /iam/scope_policies/{id}</h3>
<p>Deletes the Scope Policy for the organization.</p>
<p><strong>Authentication required</strong>: yes</p>
<p><strong>Authorization required</strong>: <code>iam:admin.write</code> scope</p>
<p><strong>Command example</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -i -H <span style="color:#4e9a06">&#34;Accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Authorization: Bearer </span><span style="color:#000">$TOKEN</span><span style="color:#4e9a06">&#34;</span> -X DELETE https://example.com/iam/scope_policies/<span style="color:#ce5c00;font-weight:bold">{</span>id<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Where {id} is the Scope Policy id number</p>
<h4 id="success-response-4">Success response</h4>
<p><strong>Condition</strong>: The Scope Policy is defined for the organization</p>
<p><strong>Code</strong>: <code>204 NO CONTENT</code></p>
<h4 id="error-responses-4">Error responses</h4>
<p><strong>Condition</strong>: The Scope Policy {id} is not defined or inexistent for the organization</p>
<p><strong>Code</strong>: <code>404 NOT FOUND</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;No scope policy found for id: 1&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>Or</strong></p>
<p><strong>Condition</strong>: Unauthenticated access</p>
<p><strong>Code</strong>: <code>401 UNAUTHORIZED</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;unauthorized&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Full authentication is required to access this resource&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><strong>OR</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;invalid_token&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;error_description&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Invalid access token: &lt;Access Token&gt;&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>If an invalid token is provided or no token is provided.</p>
<p><strong>Or</strong></p>
<p><strong>Condition</strong>: Authorization error</p>
<p><strong>Code</strong>: <code>403 FORBIDDEN</code></p>
<p><strong>Content</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;error&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Access is denied&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f53010d8ceeb59269840cbdb81da1bbb">3.1.13 - Token exchange policy API</h1>
    
	<p>The Token exchange policy API allows to define fine-grained policies to
control:</p>
<ul>
<li>which clients can be involved in a token exchange, and</li>
<li>which scopes can be exchanged.</li>
</ul>
<h2 id="token-exchange-policies">Token exchange policies</h2>
<p>By default IAM comes with a permissive default token exchange policy:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Allow all exchanges&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;originClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ANY&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;destinationClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ANY&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The policy above will allow exchanges among all clients that have the token
exchange grant type enabled.</p>
<p>As can be seen by the above example a token exchange policy specifies:</p>
<ul>
<li>a rule, which can be <code>PERMIT</code> or <code>DENY</code>, which determines the policy
behaviour</li>
<li>an origin client selector: this selector will match the client linked to the
access token presented during the token exchange; in this case, the selector
will match ANY client.</li>
<li>a destination client selector: this selector will match the destination
client, i.e. the client requesting the token exchange; in this case, the
selector will match ANY client.</li>
</ul>
<p>The policy above does not specify any scope policy, which basically means that
all scopes allowed by the origin and destination client configurations could be
exchanged among the clients.</p>
<p>Let&rsquo;s see a policy which limits the scopes exchanged:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Allow exchanges for openid and offline_access scopes for client token-exchange-actor&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:46:58.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:46:58.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;originClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ANY&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;destinationClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;BY_ID&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;token-exchange-actor&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;scopePolicies&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;offline_access&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The policy above allows all exchanges for the scopes openid and offline_access
between any origin client and the <code>token-exchange-actor</code> client. We see a new
type of client selector, which is used to target the policy to a specific
client selected by clientId.</p>
<p>We see that the policy provides a list of scope policies, which allow exchange
only for the <code>openid</code> and <code>offline_access</code> scopes.</p>
<h3 id="client-selectors">Client selectors</h3>
<p>IAM currently supports three client selector types:</p>
<ul>
<li><code>ANY</code>: which will match any client</li>
<li><code>BY_SCOPE</code>: which will match any client that is authorized to request a scope
passed as a parameter</li>
<li><code>BY_ID</code>: which will a client by clientId</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  <span style="color:#a40000">...</span>
    <span style="color:#4e9a06">&#34;originClient&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;BY_ID&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;origin-client&#34;</span>
    <span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">,</span>
    <span style="color:#4e9a06">&#34;destinationClient&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;BY_SCOPE&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;storage.write:/&#34;</span>
    <span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">,</span>
  <span style="color:#a40000">...</span>
</code></pre></div><p>For example, the policy fragment above would apply to any token exchange
started by a client allowed to request the <code>storage.write:/</code> scope when
exchanging a token issued to <code>origin-client</code>.</p>
<h3 id="token-exchange-scope-policies">Token exchange scope policies</h3>
<p>Token exchange scope policies (not to be confused with <a href="/v/v1.8.2/docs/reference/api/scope-policy-api/#scope-policies">Scope
policies</a>) define which scopes are authorized or blocked in a
token exchange policy. When scope policies are not defined in an exchange
policy, the meaning is that all scopes allowed by the origin and destination
client configurations are allowed for an exchange.</p>
<p>A scope policy defines:</p>
<ul>
<li>a <code>rule</code>, which can be <code>PERMIT</code> or <code>DENY</code></li>
<li>a <code>type</code>, where allowed values are <code>EQ</code>, <code>REGEXP</code>, <code>PATH</code> which identifies the matching algorithm used to match the exchanged scope</li>
<li>a <code>matchParam</code>, which specifies the scope to be matched</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">    <span style="color:#4e9a06">&#34;scopePolicies&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;REGEXP&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;compute.*&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DENY&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;REGEXP&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;storage.*&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>The two scope policies above combined will allow any exchange of scopes that
would match the regular expression <code>compute.*</code> and will block exchanges of
scopes matching regular expression <code>storage.*</code>.
Important scope policy evaulation rules:</p>
<ul>
<li>
<p>Token exchange scope policies are applied to all the scopes requested in a
token exchange, i.e. a policy allowing each requested scope must be present
for the token exchange to succeed.</p>
</li>
<li>
<p>When multiple scope policies apply to a given scope, <code>DENY</code> policies win.</p>
</li>
<li>
<p>When scope policies are defined, a <code>PERMIT</code> policy should always be included,
otherwise any exchange would be blocked. If that is the intended behaviour,
simply use a <code>DENY</code> token exchange policy.</p>
</li>
<li>
<p>When a requested scope is not authorized, either due to a <code>DENY</code> scope policy
or a missing <code>PERMIT</code> policy, the exchange fails with an <code>invalid_scope</code>
error.</p>
</li>
<li>
<p>Defining scope policies in a <code>DENY</code> token exchange policy is redundant (the
evaluation would block at client level) and would not make sense.</p>
</li>
</ul>
<h2 id="token-exchange-policy-ranking">Token exchange policy ranking</h2>
<p>The engine that evaluates token exchange policies implements a policy ranking
algorithm to determine which policy should be applied for an exchange. As with
<a href="/v/v1.8.2/docs/reference/api/scope-policy-api/#scope-policies">scope policies</a>, the ranking algorithm is based on how
specific the policies are for the input origin and destination clients in a
token exchange.</p>
<p>As we have seen, origin and destination clients can be matched in three ways:</p>
<ul>
<li>using the <code>ANY</code> selector, i.e. matching any client</li>
<li>using the <code>BY_SCOPE</code> selector, i.e., matching any client that can request a
given scope</li>
<li>using the <code>BY_ID</code> selector, i.e. matching clients by <code>clientId</code></li>
</ul>
<p>We link a <em>rank</em>, which is an integer value, to each of the selector to
represent the selector specificity. The rank of the selectors are given in the
following table:</p>
<table>
<thead>
<tr>
<th><strong>Client selector</strong></th>
<th><strong>Rank</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANY</code></td>
<td>0</td>
</tr>
<tr>
<td><code>BY_SCOPE</code></td>
<td>1</td>
</tr>
<tr>
<td><code>BY_ID</code></td>
<td>2</td>
</tr>
</tbody>
</table>
<p>The rank of a policy <code>P</code> is computed as the sum of rank of the origin and
destination client selectors:</p>
<pre><code>rank(P) = rank(origin) + rank(destination)
</code></pre><p>At the same rank, DENY policies will win.
Let&rsquo;s assume we have two exchange policies defined:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">[</span>
  <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;All all exchanges just for the openid scope&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;originClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ANY&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;destinationClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ANY&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;scopePolicies&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000;font-weight:bold">{</span>
          <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;EQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
          <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
      <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">},</span>
  <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Allow any exchange among clients A and B&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;creationTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;lastUpdateTime&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-05T14:38:52.000+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;rule&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PERMIT&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;originClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;BY_ID&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;A&#34;</span>
      <span style="color:#000;font-weight:bold">},</span>
      <span style="color:#204a87;font-weight:bold">&#34;destinationClient&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;BY_ID&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;matchParam&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;B&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>Also let&rsquo;s assume client <code>B</code> requests a token exchange for scopes <code>openid storage.read:/</code> presenting an access token issued to client <code>A</code>.</p>
<p>IAM would cycle through the exchange policies and select the ones that would
apply to the exchange, in this case both policy <code>2</code> and <code>3</code>.</p>
<p>Then IAM would rank the policy according to the specificity of the client
selectors, which would be</p>
<pre><code>rank(p_2)=0
rank(p_3)=4
</code></pre><p>so policy <code>3</code> would be selected, which would allow the exchange.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-546d6976fff9de02db89bd2588e84da3">3.2 - Configuration</h1>
    <div class="lead">IAM service configuration reference</div>
	<p>Most IAM configurable aspects are configured via environment variables and
Spring profile directives.</p>
<h2 id="spring-profiles">Spring profiles</h2>
<p>Spring profiles are used to enable/disable group of IAM functionalities.
Currently the following profiles are defined:</p>
<table>
<thead>
<tr>
<th>Profile name</th>
<th>Active by default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>prod</td>
<td>no</td>
<td>This is the profile you should enable when using IAM</td>
</tr>
<tr>
<td>h2-test</td>
<td>yes</td>
<td>Enables h2 in-memory database, useful for development and testing</td>
</tr>
<tr>
<td>mysql-test</td>
<td>no</td>
<td>Like h2-test, but used to develop against a MySQL database</td>
</tr>
<tr>
<td>oidc</td>
<td>no</td>
<td>Enables Google authentication</td>
</tr>
<tr>
<td>saml</td>
<td>no</td>
<td>Enables SAML authentication</td>
</tr>
<tr>
<td>registration</td>
<td>yes</td>
<td>Enables user registration and reset password functionalities</td>
</tr>
</tbody>
</table>
<p>Profiles are enabled by setting the <code>spring.profiles.active</code> Java system
property when starting the IAM service. This can be done, using the official
IAM docker image, by setting the IAM_JAVA_OPTS environment variable as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">IAM_JAVA_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;-Dspring.profiles.active=prod,oidc,saml&#34;</span>
</code></pre></div><h2 id="overriding-default-configuration-templates">Overriding default configuration templates</h2>
<p>Fine-grained control over configuration can be obtained following the rules for
spring boot <a href="https://docs.spring.io/spring-boot/docs/1.3.8.RELEASE/reference/html/boot-features-external-config.html">externalized configuration</a>.
This basically means defining one or more YAML files to override the default
configuration files embedded in the IAM Web Archive (war) package for the Spring profiles
activated for your instance.  The files must be placed in the IAM configuration
directory, which depends on how you deployed IAM:</p>
<table>
<thead>
<tr>
<th>Deployment type</th>
<th>Configuration directory</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker</td>
<td><code>/indigo-iam/config/</code></td>
</tr>
<tr>
<td>Package (RPM)</td>
<td><code>/etc/indigo-iam/config</code></td>
</tr>
</tbody>
</table>
<p><strong>IMPORTANT</strong>: the default configuration should solve most use cases, override
default configuration <strong>only if you know what you are doing</strong>, and for those
scenarios not served by the default templates.</p>
<h2 id="basic-service-configuration">Basic service configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The IAM service will list for requests on this host</span>
<span style="color:#000">IAM_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>localhost

<span style="color:#8f5902;font-style:italic"># The IAM service webapp will bind on this port</span>
<span style="color:#000">IAM_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8080</span>

<span style="color:#8f5902;font-style:italic"># The IAM web application base URL</span>
<span style="color:#000">IAM_BASE_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">IAM_HOST</span><span style="color:#4e9a06">}</span>:8080

<span style="color:#8f5902;font-style:italic"># The OpenID Connect issuer configured for this IAM instance.</span>
<span style="color:#8f5902;font-style:italic"># This must be equal to IAM_BASE_URL</span>
<span style="color:#000">IAM_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">IAM_HOST</span><span style="color:#4e9a06">}</span>:8080

<span style="color:#8f5902;font-style:italic"># The path to the JSON keystore that holds the keys IAM will use to sign and</span>
<span style="color:#8f5902;font-style:italic"># verify token signatures</span>
<span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># HTTP caching header setting public key lifetime (in seconds).</span>
<span style="color:#8f5902;font-style:italic"># The recommended lifetime according to the WLCG profile* is 6 hours</span>
<span style="color:#000">IAM_JWK_CACHE_LIFETIME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">21600</span>

<span style="color:#8f5902;font-style:italic"># IAM will look for trust anchors in this directory. These trust anchors are</span>
<span style="color:#8f5902;font-style:italic"># needed for TLS operations where the IAM acts as a client (i.e., to</span>
<span style="color:#8f5902;font-style:italic"># authenticate to remote SAML Identity providers)</span>
<span style="color:#000">IAM_X509_TRUST_ANCHORS_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/grid-security/certificates

<span style="color:#8f5902;font-style:italic"># How frequently (in seconds) should trust anchors be refreshed</span>
<span style="color:#000">IAM_X509_TRUST_ANCHORS_REFRESH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">14400</span>

<span style="color:#8f5902;font-style:italic"># Use forwarded headers from reverse proxy. Set this to native when deploying the</span>
<span style="color:#8f5902;font-style:italic"># service behind a reverse proxy</span>
<span style="color:#000">IAM_FORWARD_HEADERS_STRATEGY</span><span style="color:#ce5c00;font-weight:bold">=</span>none

<span style="color:#8f5902;font-style:italic">## Tomcat embedded container settings</span>

<span style="color:#8f5902;font-style:italic"># Enables the tomcat access log</span>
<span style="color:#000">IAM_TOMCAT_ACCESS_LOG_ENABLED</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Directory where the tomcat access log will be written (when enabled)</span>
<span style="color:#000">IAM_TOMCAT_ACCESS_LOG_DIRECTORY</span><span style="color:#ce5c00;font-weight:bold">=</span>/tmp

<span style="color:#8f5902;font-style:italic">## Actuator endpoint settings</span>

<span style="color:#8f5902;font-style:italic"># Sets the username of the user allowed to have privileged access to actuator</span>
<span style="color:#8f5902;font-style:italic"># endpoints</span>
<span style="color:#000">IAM_ACTUATOR_USER_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>user

<span style="color:#8f5902;font-style:italic"># Sets the password of the user allowed to have privileged access to actuator</span>
<span style="color:#8f5902;font-style:italic"># endpoints</span>
<span style="color:#000">IAM_ACTUATOR_USER_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>secret

<span style="color:#8f5902;font-style:italic">## Local resources configuration</span>

<span style="color:#8f5902;font-style:italic"># Enables the serving of resources from the local file system </span>
<span style="color:#000">IAM_LOCAL_RESOURCES_ENABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Sets the directory that contains the local resources that should be exposed</span>
<span style="color:#000">IAM_LOCAL_RESOURCES_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:/indigo-iam/local-resources
</code></pre></div><p>(*) More information <a href="https://github.com/WLCG-AuthZ-WG/common-jwt-profile/blob/master/profile.md#token-validation">here</a>.</p>
<h2 id="organization-configuration">Organization configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The name of the organization managed by this IAM instance</span>
<span style="color:#000">IAM_ORGANISATION_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo-dc

<span style="color:#8f5902;font-style:italic"># URL of logo image used in the IAM dashboard (by default the INDIGO-Datacloud</span>
<span style="color:#8f5902;font-style:italic"># project logo image is used)</span>
<span style="color:#000">IAM_LOGO_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>resources/images/indigo-logo.png

<span style="color:#8f5902;font-style:italic"># Size of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_DIMENSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span>

<span style="color:#8f5902;font-style:italic"># Height of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_HEIGTH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">150</span>

<span style="color:#8f5902;font-style:italic"># Width of the logo image (in pixels)</span>
<span style="color:#000">IAM_LOGO_WIDTH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span>

<span style="color:#8f5902;font-style:italic"># String displayed into the brower top bar when accessing the IAM dashboard</span>
<span style="color:#000">IAM_TOPBAR_TITLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;INDIGO IAM for </span><span style="color:#4e9a06">${</span><span style="color:#000">IAM_ORGANISATION_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</code></pre></div><h2 id="access-token-contents-configuration">Access token contents configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">## Token content settings </span>

<span style="color:#8f5902;font-style:italic"># Include authentication claims in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Includes the scope in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_SCOPE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Includes the nbf claim in issued access tokens</span>
<span style="color:#000">IAM_ACCESS_TOKEN_INCLUDE_NBF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>
</code></pre></div><h2 id="database-configuration">Database configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The host where the MariaDB/MySQL daemon is running</span>
<span style="color:#000">IAM_DB_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The database port</span>
<span style="color:#000">IAM_DB_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3306</span>

<span style="color:#8f5902;font-style:italic"># The database name</span>
<span style="color:#000">IAM_DB_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam

<span style="color:#8f5902;font-style:italic"># The database username</span>
<span style="color:#000">IAM_DB_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>iam

<span style="color:#8f5902;font-style:italic"># The database password </span>
<span style="color:#000">IAM_DB_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">pwd</span>

<span style="color:#8f5902;font-style:italic">## Database connection pool options</span>

<span style="color:#8f5902;font-style:italic"># Maximum number of active connections to the database</span>
<span style="color:#000">IAM_DB_MAX_ACTIVE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">50</span>

<span style="color:#8f5902;font-style:italic"># Maximum number of idle connections in the pool </span>
<span style="color:#000">IAM_DB_MAX_IDLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5</span>

<span style="color:#8f5902;font-style:italic"># Initial size of the database connection pool</span>
<span style="color:#000">IAM_DB_INITIAL_SIZE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8</span>

<span style="color:#8f5902;font-style:italic"># Should idle connections in the pool be tested?</span>
<span style="color:#000">IAM_DB_TEST_WHILE_IDLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>

<span style="color:#8f5902;font-style:italic"># Should connections in the pool be tested when borrowed?</span>
<span style="color:#000">IAM_DB_TEST_ON_BORROW</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>

<span style="color:#8f5902;font-style:italic"># Which SQL query should be used to test connections?</span>
<span style="color:#000">IAM_DB_VALIDATION_QUERY</span><span style="color:#ce5c00;font-weight:bold">=</span>SELECT <span style="color:#0000cf;font-weight:bold">1</span>

<span style="color:#8f5902;font-style:italic"># Time between database connection pool eviction runs (in msec)</span>
<span style="color:#000">IAM_DB_TIME_BETWEEN_EVICTION_RUNS_MILLIS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5000</span>

<span style="color:#8f5902;font-style:italic"># The minimum amount of time a connection may be idle in the pool</span>
<span style="color:#8f5902;font-style:italic"># before it is considered for eviction (in msec)</span>
<span style="color:#000">IAM_DB_MIN_EVICTABLE_IDLE_TIME_MILLIS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">60000</span>
</code></pre></div><h2 id="test-client-configuration">Test Client configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Public identifier for client application</span>
<span style="color:#000">IAM_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>client

<span style="color:#8f5902;font-style:italic"># Client application&#39;s own password</span>
<span style="color:#000">IAM_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>secret

<span style="color:#8f5902;font-style:italic"># Default scopes allowed to the client application (optional)</span>
<span style="color:#000">IAM_CLIENT_SCOPES</span><span style="color:#ce5c00;font-weight:bold">=</span>openid profile email

<span style="color:#8f5902;font-style:italic"># Use forwarded headers from reverse proxy. Set this to native when deploying the</span>
<span style="color:#8f5902;font-style:italic"># service behind a reverse proxy</span>
<span style="color:#000">IAM_CLIENT_FORWARD_HEADERS_STRATEGY</span><span style="color:#ce5c00;font-weight:bold">=</span>none
</code></pre></div><h2 id="redis-configuration">Redis configuration</h2>
<p>Starting with version 1.8.0, IAM supports storing HTTP session
information in an external <a href="https://redis.io/">redis</a> server.</p>
<p>This can be useful when <a href="../../../docs/tasks/deployment/ha">deploying multiple replicas of the IAM
service</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">## Redis server settings</span>

<span style="color:#8f5902;font-style:italic"># Redis server hostname</span>
<span style="color:#000">IAM_SPRING_REDIS_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>localhost

<span style="color:#8f5902;font-style:italic"># Redis server port</span>
<span style="color:#000">IAM_SPRING_REDIS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">6397</span>

<span style="color:#8f5902;font-style:italic"># Redis server password.</span>
<span style="color:#8f5902;font-style:italic"># Leave it empty in case the server does not require any password</span>
<span style="color:#000">IAM_SPRING_REDIS_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>secret

<span style="color:#8f5902;font-style:italic"># Duration of an HTTP session</span>
<span style="color:#000">IAM_SESSION_TIMEOUT_SECS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1800</span>

<span style="color:#8f5902;font-style:italic"># Set to &#39;redis&#39; in order to handle HTTP session</span>
<span style="color:#8f5902;font-style:italic"># with an external Redis service</span>
<span style="color:#000">IAM_SPRING_SESSION_STORE_TYPE</span><span style="color:#ce5c00;font-weight:bold">=</span>none

<span style="color:#8f5902;font-style:italic"># If set to &#39;true&#39; the status of the Redis service</span>
<span style="color:#8f5902;font-style:italic"># will appear in the IAM Health check endpoint</span>
<span style="color:#000">IAM_HEALTH_REDIS_PROBE_ENABLED</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>
</code></pre></div><h2 id="local-authentication-settings">Local authentication settings</h2>
<p>It allows a user to log in with local credentials (username/password).<br>
For more information, see the <a href="local_authn/">Local Authentication section</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Set to &#39;hidden&#39; if you want to hide the local login form</span>
<span style="color:#000">IAM_LOCAL_AUTHN_LOGIN_PAGE_VISIBILITY</span><span style="color:#ce5c00;font-weight:bold">=</span>visible
<span style="color:#8f5902;font-style:italic"># Enables local login form to all users.</span>
<span style="color:#8f5902;font-style:italic"># It can be restricted, changing the value to &#39;vo-admins&#39; or &#39;none&#39;</span>
<span style="color:#000">IAM_LOCAL_AUTHN_ENABLED_FOR</span><span style="color:#ce5c00;font-weight:bold">=</span>all
</code></pre></div><h2 id="google-authentication-settings">Google authentication settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The Google OAuth client id</span>
<span style="color:#000">IAM_GOOGLE_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The OAuth client secret</span>
<span style="color:#000">IAM_GOOGLE_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>
</code></pre></div><p>For more information and examples, see the <a href="/v/v1.8.2/docs/reference/configuration/external-authentication/oidc/">OpenID Connect
Authentication section</a>.</p>
<h2 id="saml-authentication-settings">SAML authentication settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># The SAML entity ID for this IAM instance</span>
<span style="color:#000">IAM_SAML_ENTITY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># Text shown in the SAML login button on the IAM login page</span>
<span style="color:#000">IAM_SAML_LOGIN_BUTTON_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>Sign in with SAML

<span style="color:#8f5902;font-style:italic">## SAML keystore settings</span>

<span style="color:#8f5902;font-style:italic"># The keystore holding certificates and keys used for SAML crypto</span>
<span style="color:#000">IAM_SAML_KEYSTORE</span><span style="color:#ce5c00;font-weight:bold">=</span> 

<span style="color:#8f5902;font-style:italic"># The SAML keystore password</span>
<span style="color:#000">IAM_SAML_KEYSTORE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The identifier of the key that should be used to sign requests/assertions</span>
<span style="color:#000">IAM_SAML_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The password of the SAML key that will be used to sign requests/assertions</span>
<span style="color:#000">IAM_SAML_KEY_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## Metadata settings</span>

<span style="color:#8f5902;font-style:italic"># a URL pointing to the SAML federation or IdP metadata</span>
<span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># Metadata refresh period (in seconds)</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">600</span>

<span style="color:#8f5902;font-style:italic"># Should signature validity checks be enforced on metadata?</span>
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Trust only IdPs that have SIRTFI compliance</span>
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_SIRTFI</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># Comma-separated IDP entity ID whitelist. When empty</span>
<span style="color:#8f5902;font-style:italic"># all IdPs included in the metadata are whitelisted</span>
<span style="color:#000">IAM_SAML_IDP_ENTITY_ID_WHITELIST</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## Assertion validity settings</span>

<span style="color:#8f5902;font-style:italic"># Maxixum allowed assertion time (in seconds)</span>
<span style="color:#000">IAM_SAML_MAX_ASSERTION_TIME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3000</span>

<span style="color:#8f5902;font-style:italic"># Maximum authentication age (in seconds)</span>
<span style="color:#000">IAM_SAML_MAX_AUTHENTICATION_AGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">86400</span>

<span style="color:#8f5902;font-style:italic">## Other settings</span>

<span style="color:#8f5902;font-style:italic"># List of attribute aliases that are looked up in assertion to identify the </span>
<span style="color:#8f5902;font-style:italic"># user authenticated with SAML</span>
<span style="color:#000">IAM_SAML_ID_RESOLVERS</span><span style="color:#ce5c00;font-weight:bold">=</span>eduPersonUniqueId,eduPersonTargetedId,eduPersonPrincipalName
</code></pre></div><p>For more information and examples, see the <a href="/v/v1.8.2/docs/reference/configuration/external-authentication/saml/">SAML Authentication
section</a>.</p>
<h2 id="notification-service-settings">Notification service settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">## SMTP mail server settings </span>

<span style="color:#8f5902;font-style:italic"># SMTP server hostname </span>
<span style="color:#000">IAM_MAIL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>localhost

<span style="color:#8f5902;font-style:italic"># SMTP server port </span>
<span style="color:#000">IAM_MAIL_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">25</span>

<span style="color:#8f5902;font-style:italic"># SMTP server username</span>
<span style="color:#000">IAM_MAIL_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># SMTP server password</span>
<span style="color:#000">IAM_MAIL_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic">## IAM notification settings</span>

<span style="color:#8f5902;font-style:italic"># Should the notification server be disabled?</span>
<span style="color:#8f5902;font-style:italic"># When set to true, notifications are not sent to the mail server (but</span>
<span style="color:#8f5902;font-style:italic"># printed to the logs)</span>
<span style="color:#000">IAM_NOTIFICATION_DISABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span>

<span style="color:#8f5902;font-style:italic"># The email address used as the sender in IAM email notifications</span>
<span style="color:#000">IAM_NOTIFICATION_FROM</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo@localhost

<span style="color:#8f5902;font-style:italic"># The email address used as the recipient in IAM email notifications</span>
<span style="color:#000">IAM_NOTIFICATION_ADMIN_ADDRESS</span><span style="color:#ce5c00;font-weight:bold">=</span>indigo-alerts@localhost

<span style="color:#8f5902;font-style:italic"># Notification policy for account requests. The default value is notify-address</span>
<span style="color:#8f5902;font-style:italic"># meaning that notifications just arrive to the email address</span>
<span style="color:#8f5902;font-style:italic"># specified above. Set to notify-admins if you want to notify</span>
<span style="color:#8f5902;font-style:italic"># all IAM admins or to notify-address-and-admins to combine the two behaviors</span>
<span style="color:#000">IAM_NOTIFICATION_ADMIN_NOTIFICATION_POLICY</span><span style="color:#ce5c00;font-weight:bold">=</span>notify-address

<span style="color:#8f5902;font-style:italic"># Notification policy for group requests. Default value notifies both</span>
<span style="color:#8f5902;font-style:italic"># admins and group managers. Set to notify-gms if you want to notify only group managers</span>
<span style="color:#000">IAM_NOTIFICATION_GROUP_MANAGER_NOTIFICATION_POLICY</span><span style="color:#ce5c00;font-weight:bold">=</span>notify-gms-and-admins

<span style="color:#8f5902;font-style:italic"># Time interval, in milliseconds, between two consecutive runs of IAM notification </span>
<span style="color:#8f5902;font-style:italic"># dispatch task </span>
<span style="color:#000">IAM_NOTIFICATION_TASK_DELAY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30000</span>

<span style="color:#8f5902;font-style:italic"># Retention of delivered messages, in days</span>
<span style="color:#000">IAM_NOTIFICATION_CLEANUP_AGE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">30</span>
</code></pre></div><h2 id="account-linking-settings">Account linking settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Should account linking be disabled? When set to true users cannot</span>
<span style="color:#8f5902;font-style:italic"># link external accounts (Google, SAML) to their local IAM account</span>
<span style="color:#000">IAM_ACCOUNT_LINKING_DISABLE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> 
</code></pre></div><h2 id="privacy-policy-settings">Privacy policy settings</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># An URL pointing to a privacy policy document which applies</span>
<span style="color:#8f5902;font-style:italic"># to this IAM instance. When left blank, no privacy policy link </span>
<span style="color:#8f5902;font-style:italic"># is displayed in the login page</span>
<span style="color:#000">IAM_PRIVACY_POLICY_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>

<span style="color:#8f5902;font-style:italic"># The text displayed in the login page for the privacy policy URL specified</span>
<span style="color:#8f5902;font-style:italic"># above</span>
<span style="color:#000">IAM_PRIVACY_POLICY_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span>Privacy policy
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-978b7edb20fd49ffb034f6d6573a9e60">3.2.1 - JWT profiles support</h1>
    
	<p>Starting with version 1.6.0, IAM introduces support for JWT <em>profiles</em>.</p>
<p>A JWT profile is a named set of rules that defines which information is
included in access tokens, id tokens,  userinfo and introspection responses
issued by IAM in an OAuth/OIDC message exchanges.</p>
<p>IAM allows to define a default profile that is used for all clients that are
not explicitly bound to one. This allows to use the same profile across
all clients in an organization.</p>
<p>It&rsquo;s also possible to define the profile to be used at client level, using
scopes, i.e. adding among the scope allowed for the client the name of the
profile the client should use. The scope, in this context, does not identify a
set of permissions but an encoding of authentication/authorization informations
in tokens and responses issued by IAM.</p>
<p>This mechanism enables integration of the same IAM instance with resources
relying on different profiles.</p>
<p>IAM currently supports three JWT profiles:</p>
<ul>
<li>the <code>iam</code> profile</li>
<li>the <code>wlcg</code> WLCG profile</li>
<li>the <code>aarc</code> profile</li>
</ul>
<h2 id="setting-the-default-profile">Setting the default profile</h2>
<p>The IAM JWT default profile is set using the <code>IAM_JWT_DEFAULT_PROFILE</code>
environment variable, e.g.:</p>
<pre><code>IAM_JWT_DEFAULT_PROFILE=iam
</code></pre><p>The default profile will be used for all clients that do not explicitly and
correctly request the use of a profile using scopes.</p>
<h2 id="using-scopes-to-select-the-jwt-profile-for-a-client">Using scopes to select the JWT profile for a client</h2>
<p>To select the profile used by a client, include one of the following scopes
in the list of scopes authorized for a client:</p>
<ul>
<li><code>iam</code>, for the IAM profile</li>
<li><code>wlcg</code>, for the WLCG profile</li>
<li><code>aarc</code> profile, for the AARC profile</li>
</ul>
<p>Clients should only link to one profile. When multiple profiles are linked to a
client, IAM falls back to the default profile configured for the IAM instance.</p>
<h2 id="using-system-scopes-to-control-profile-selection">Using system scopes to control profile selection</h2>
<p>MitreID <strong>System Scopes</strong> can be used to control access to profile selection.</p>
<p>The scopes <code>iam</code>, <code>wlcg</code> and <code>aarc</code> used to select the JWT profile are not available in IAM
by default; an administrator has to add all of them manually, as described in the
in <a href="/v/v1.8.2/docs/reference/configuration/system-scopes/">System Scopes documentation</a>.</p>
<h2 id="supported-jwt-profiles">Supported JWT profiles</h2>
<h3 id="the-iam-profile">The IAM profile</h3>
<p>This is the default profile for IAM.</p>
<p>With this profile:</p>
<ul>
<li>
<p>groups are encoded in the <code>groups</code> claim; all the groups the user is member
of are included in the groups claim;</p>
</li>
<li>
<p>authentication information (username, email, groups) is not by default
included in access tokens; this behaviour can be changed by setting the
<code>IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO=true</code> environment variable;</p>
</li>
<li>
<p>scope information is not by default included in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_SCOPE=true</code>
environment variable;</p>
</li>
<li>
<p>the <code>nbf</code> (not before) claim is not set in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_NBF=true</code>
environment variable;</p>
</li>
</ul>
<p>This profile is assigned to clients using the <code>iam</code>  scope.</p>
<h3 id="the-wlcg-profile">The WLCG profile</h3>
<p>This profile implements the <a href="https://zenodo.org/record/3460258">Common JWT Token profile</a>.</p>
<p>In particular:</p>
<ul>
<li>the <code>scope</code> claim is always included in access tokens;</li>
<li>groups are not included by default in access and ID tokens;</li>
</ul>
<p>This profile is assigned to clients using the <code>wlcg</code> scope.</p>
<p>With this profile:</p>
<ul>
<li>
<p>groups are encoded in the <code>wlcg-groups</code> claim; all the non-optional groups the user is member
of are included in the wlcg-groups claim;</p>
</li>
<li>
<p>authentication information (username, email, groups) is not by default
included in access tokens; this behaviour can be changed by setting the
<code>IAM_ACCESS_TOKEN_INCLUDE_AUTHN_INFO=true</code> environment variable;</p>
</li>
<li>
<p>the <code>nbf</code> (not before) claim is not set in access tokens; this behaviour
can be changed by setting the <code>IAM_ACCESS_TOKEN_INCLUDE_NBF=true</code>
environment variable;</p>
</li>
</ul>
<h4 id="requesting-groups-with-the-wlcg-profile">Requesting groups with the WLCG profile</h4>
<p>When the WLCG profile is used, groups are not automatically included in access
tokens and ID tokens, but can be requested using the <code>wlcg.groups</code> scope
(which has to be added among the <a href="/v/v1.8.2/docs/reference/configuration/system-scopes/">System Scopes</a>),
following the rules described in the <a href="https://github.com/WLCG-AuthZ-WG/CommonJWTProfile/blob/master/profile.md#scope-based-group-selection">WLCG
profile</a>.</p>
<h4 id="optional-groups">Optional groups</h4>
<p>Optional groups are groups whose membership is only asserted in tokens on
explicit request coming from a user.</p>
<p>In order to configure a IAM group as an optional group,
add the <code>wlcg.optional-group</code> label to the group.</p>
<h3 id="the-aarc-profile">The AARC profile</h3>
<p>This profile encodes group membership information following the rules defined
by the <a href="https://aarc-project.eu/guidelines/aarc-g002/">AARC G002</a> profile document.</p>
<p>In particular:</p>
<ul>
<li>groups and organisation name are not included by default in access and ID tokens;</li>
<li>organisation name can be requested using the <code>eduperson_scoped_affiliation</code> scope and it&rsquo;s encoded in the <code>eduperson_scoped_affiliation</code> claim;</li>
<li>groups can be requested using the <code>eduperson_entitlement</code> scope and they&rsquo;re encoded as URN in the <code>eduperson_entitlement</code> claim;</li>
</ul>
<p>All the mapping rules are described in the <a href="https://docs.google.com/document/d/1b-Mlet3Lq7qKLEf1BnHJ4nL1fq-vMe7fzpXyrq2wp08/edit">White Paper for implementation mappings between SAML 2.0 and OpenID Connect in Research and Education</a>.</p>
<p>This profile is assigned to clients using the <code>aarc</code> scope.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-371b1935a2a5c2cbff937a267fe80317">3.2.2 - MitreID System Scopes</h1>
    
	<p>During the <a href="/v/v1.8.2/docs/tasks/user/client-registration/">client registration</a>, a user can assign any scope to the client,
but IAM will grant only the list of scopes available among the MitreID <strong>System Scopes</strong>.</p>
<p>In order to include a new scope into the System Scopes, an IAM administrator has to add it manually
from the <code>System Scopes</code> tab on the left side of the MitreID dashboard:</p>
<p><img src="system_scopes_mitre.png" alt="Mitre system scopes"></p>
<ul>
<li>if the box <code>default scope</code> is checked, the scope will be assigned to any newly regirested client,
even if it is not explicitly requested;</li>
<li>if the box <code>restricted</code> is checked, the scope will not be available to dynamically registered clients
and can only be assigned to clients by IAM administrators;</li>
<li>if no one box is checked, any dynamically registered client has to explicitly request for this scope
at the registration time, and it will be granted without intervention of IAM administrators.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ee84b111d6aee6b44b8e068e0995e8c2">3.2.3 - Membership lifecycle</h1>
    
	<p>Starting with version 1.6.0, IAM introduces support for basic account life
cycle management.</p>
<p>It&rsquo;s now possible to set an expiration time for IAM accounts. Once the account
expires, login for the account is disabled.</p>
<p>IAM can be configured to remove expired accounts after a configurable grace
period.</p>
<h2 id="account-end-time-settings">Account end time settings</h2>
<p>By default, accounts in IAM do not have an end time set, i.e. the lifetime is
unbounded.</p>
<p>A default account validity period (e.g., 12 months) can be configured and will
be set for users at registration time.</p>
<p>The relevant settings are managed  by placing <code>lifecycle</code> directives in a
<a href="/v/v1.8.2/docs/reference/configuration/#overriding-default-configuration-templates">custom configuration
file</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">lifecycle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">account</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># 0 means unbounded validity</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">account-lifetime-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># When true, the end time cannot be changed from IAM APIs and dashboard</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">read-only-end-time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">expired-account-policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Accounts will be suspended after 7 days since expiration</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">suspension-grace-period-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># When false, expired accounts are not removed</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">remove-expired-accounts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Accounts will be removed after 30 days since expiration</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># (if remove-expired-accounts is true)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">removal-grace-period-days</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">expired-accounts-task</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Internal cron schedule for the lifecycle task.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Default setting is every 5 mins</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cron-schedule</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">*/5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># To disable automatic account expiration set this to false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5fd21a888f7bdca41388e3b3fa887277">3.2.4 - Integration with RCAuth</h1>
    
	<p><a href="https://rcauth.eu">RCAuth.eu</a> has been integrated with IAM in order to provide on-demand X.509
certificates to users without a certificate.</p>
<p>RCAuth is basically an online Certificate Authority, which issues certificates
to end-entities based on a successful authentication to a Federated Identity Provider,
operated by an academic or research organization.</p>
<p>In particular, it extends the OAuth/OIDC specification to include the following endpoints:</p>
<ul>
<li>GetCert, to retrieve an X.509 end-entity certificate</li>
<li>GetProxy, to retrieve a <a href="https://datatracker.ietf.org/doc/html/rfc3820">RFC3820</a> Proxy Certificate chain</li>
</ul>
<p>on behalf of the authenticated user.</p>
<h2 id="iam-deployment">IAM deployment</h2>
<h3 id="configuration">Configuration</h3>
<p>The basic configuration required on your IAM deployment to enable the integration
of the service with RCAuth is</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Enable integration with RCAuth. Default to false</span>
<span style="color:#000">IAM_RCAUTH_ENABLED</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#8f5902;font-style:italic"># Select the hostname of your certificate authority, e.g. https://eir.nikhef.nl/oauth2</span>
<span style="color:#000">IAM_RCAUTH_ISSUER</span><span style="color:#ce5c00;font-weight:bold">=</span>
<span style="color:#8f5902;font-style:italic"># A label for the certificate authority (not mandatory)</span>
<span style="color:#000">IAM_RCAUTH_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span>RCAuth.eu online CA
<span style="color:#8f5902;font-style:italic"># Id of IAM client registered on RCAuth</span>
<span style="color:#000">IAM_RCAUTH_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>
<span style="color:#8f5902;font-style:italic"># Secret of IAM client registered on RCAuth</span>
<span style="color:#000">IAM_RCAUTH_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>
</code></pre></div><h3 id="client-registration">Client registration</h3>
<p>An INDIGO IAM OAuth client has to be registered on the RCAuth service that will issue an
X.509/proxy certificate.</p>
<p>For instance, in case of the demo RCAuth hosted at <code>https://eir.nikhef.nl</code>,
one has to follow the next steps:</p>
<ul>
<li>
<p>go to the Client Registration Page <code>https://eir.nikhef.nl/oauth2/register</code> that will be
shown after a successful login with your institutional Identity Provider (e.g. the INFN AAI);</p>
</li>
<li>
<p>fill the form with the details of your client. Important fields are</p>
<ul>
<li>Callback URLs: <em>https://&lt;iam-hostname&gt;/rcauth/cb</em>;</li>
<li>Scopes: <em>openid</em>, <em>edu.uiuc.ncsa.myproxy.getcert</em>;</li>
</ul>
</li>
<li>
<p>after the request has been submitted, the service will generate a client ID and
secret that has to be set in the <code>IAM_RCAUTH_CLIENT_ID</code> and <code>IAM_RCAUTH_CLIENT_SECRET</code> environment
variables respectively;</p>
</li>
<li>
<p>wait for the manual approval of your client registration.</p>
</li>
</ul>
<h2 id="iam-user-interface">IAM user interface</h2>
<p>The RCAuth issued certificate is listed in the <strong>X.509 certificates</strong> tab
of the IAM homepage.</p>
<p>To add a new certificate click the <em>Request certificate</em> button.</p>
<p><img src="RCAuth-request-certificate.png" alt="Request certificate to RCAuth"></p>
<p>The user will be redirected to the RCAuth instance to authenticate and give consent
for the generation of an X.509 certificate, which will be accessible by IAM.<br>
Thus, IAM links the certificate to the user&rsquo;s dashboard, as shown in the example below.</p>
<p><img src="RCAuth-linked-certificate.png" alt="Linked certificate issued by RCAuth"></p>
<p>A long-lived plain proxy obtained by the linked X.509 certificate is automatically
stored into the IAM database.<br>
This is shown in the IAM dashboard when the &ldquo;<strong>Has managed proxy certificate</strong>&rdquo;
string is set to <em>true</em> (as in the image above).</p>
<p>The proxy certificate can be downloaded from IAM using the <a href="/docs/reference/api/proxycert-api/">Proxy certificate API</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2501923ff9f1258a5dc95b7435579a75">3.2.5 - Registration &amp; Enrollment</h1>
    
	<p>IAM implements a basic registration service that implements an
administrator-vetted registration flow, where users apply for membership in an
organization and administrators are asked to validate membership requests.</p>
<h2 id="requiring-external-authentication">Requiring external authentication</h2>
<p>Starting with version 1.6.0, IAM allows to request that users are authenticated
from a trusted identity provider (SAML or OIDC) in order to apply for
membership. It&rsquo;s also possible to control how information in authentication
tokens and assertions is mapped to IAM registration fields.</p>
<p>For example, see the following fragment that requires authentication with the
CERN SSO and defines how information from identity tokens issued by CERN SSO is
mapped to IAM membership information</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">registration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">require-external-authentication</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">oidc-issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://auth.cern.ch/auth/realms/cern</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">authentication-type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">oidc</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fields</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># When false, allows user to override what comes from the authentication information</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">given_name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">surname</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">family_name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">email</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">email</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">read-only</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">external-auth-attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">preferred_username</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="user-editable-fields">User editable fields</h2>
<p>Starting with version 1.6.0, IAM allows to limit which fields of the user profile are editable by users.</p>
<p>The default, backward-compatible settings that allow users to edit all their
profile fields are defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">user-profile</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">editable-fields</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">email</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">picture</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">surname</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>To prevent modifications to any of the fields remove the field name from
<code>editable-fields</code> list.</p>
<p>External configuration can be managed by placing directives as shown above in a
<a href="/v/v1.8.2/docs/reference/configuration/#overriding-default-configuration-templates">custom configuration
file</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-63d7a6556648cdd8622cf2321f13a835">3.2.6 - JSON Web Keys (JWK)</h1>
    
	<p>JSON Web Key (JWK) is a JSON data structure that represents a single public key or a set of
public keys. IAM uses private JWKs to sign tokens, and IAM clients use public JWKs to validate the tokens.
A <a href="/v/v1.8.2/docs/getting-started/jwk/">JWK Generator</a> can be used to generate new keys.</p>
<h3 id="keystore-location">Keystore Location</h3>
<p>JWKs are stored in a file that is called keystore. All the keys in this file will be
used for validating the tokens. Keystore location is set using the <code>IAM_KEY_STORE_LOCATION</code>
environment variable, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_KEY_STORE_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>file:///secrets/jwk/keystore.jwks
</code></pre></div><h3 id="default-key-id-kid">Default Key ID (kid)</h3>
<p>If there are multiple JWKs in the keystore, <code>IAM_JWK_DEFAULT_KEY</code> environment variable
can be set to choose the key that signs the tokens, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_JWK_DEFAULT_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>rsa2
</code></pre></div><p>If this variable is not set it will use the default value <code>rsa1</code>.</p>
<h3 id="default-jwe-keys">Default JWE Keys</h3>
<p>JSON Web Encryption (JWE) represents encrypted content using JSON-based data structures.
JWE allows to encrypt the JWT tokens so that only the intended recipient can decrypt
and see the content.</p>
<p>Default JWE decrypt key and encrypt key id can be set using the
<code>IAM_JWK_DEFAULT_JWE_DECRYPT_KEY_ID</code> and <code>IAM_JWK_DEFAULT_JWE_ENCRYPT_KEY_ID</code>
environment variables respectively, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_JWK_DEFAULT_JWE_DECRYPT_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>jwe-decrypt
<span style="color:#000">IAM_JWK_DEFAULT_JWE_ENCRYPT_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>jwe-encrypt
</code></pre></div><h3 id="default-algorithms">Default Algorithms</h3>
<p>Default alorithms used for signing and encrypting the key can be set using
<code>IAM_JWK_DEFAULT_JWS_ALGORITHM</code> and <code>IAM_JWT_DEFAULT_JWE_ALGORITHM</code> environment variables
respectively, default algorithms are like following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_JWK_DEFAULT_JWS_ALGORITHM</span><span style="color:#ce5c00;font-weight:bold">=</span>RS256
<span style="color:#000">IAM_JWT_DEFAULT_JWE_ALGORITHM</span><span style="color:#ce5c00;font-weight:bold">=</span>RSA_OAEP_256
</code></pre></div><h2 id="rotating-keys">Rotating Keys</h2>
<p>To change the JWKs without any interruption on the service, a rolling update can be done
using these configurations. Below is an example of a rolling update.</p>
<p>At the beginning there is one JWK in the keystore but it needs to be changed (e.g. regular
update or because of a security instance, etc.). For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;keys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;p&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;7IsuNM1T2G83isHFmV8zNUri2x3xLBBT3gbA5905owUTqzqHsj7QJw8GqnadNse9G3FRFLB-ShNq64yvr7hXPO35E5HSrRsWKxYgzdPKPdl-M5xc6O-QQlKmkmje_r82M5KGbDpV_uBjoQHPGMxME6MlFaYtCFSd_keKvzpkev8&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kty&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;RSA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;q&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6Q5OunfOfXqkvKdh-mUysuS5jJY4t18MAO9KLcH5wIH4iV2FmasEeqB0g0LSNrgitv9icGhQiRUVR8dqpATBgrhZiQlB1KneUdIe8W_QQQVhA_tqJgEuAb_kl8QDHvIyXAs8onYCSDtgSD6gw-qDivGpf7TzXZcosWrgSQDYi9k&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;d&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DUSnJ_OYFqBG9gDzcj20RLPJj-CT6kqH0nh4zQIRV9mB2XkVsWk0mlo4tauqBXT8lrTN5ACyaIhFMItDqkApJeBtvyMf3E8G3tBEQnwEa8HABcCd54ZzC94t-U-pazXvoqpNxEfu6qCFFdV7u-0OgDmYbTT6_c4jDQ9jTZozuzxoh_qv6iOijBJ62yJLf4kvIOB-ghYwig6Cz1OLSgh_Y8EIO-6wk-aSZWXS7l7xnM7_8BBOzKxVG73YfPQi-9fPVnee8Cijd3RU5_uUw4yh5I87wYZzPzN3gK6Pazf6BZ-9vs1SboEyeVtd3TiOB2aBOyS4Ntohj6eljsfXEHYN4Q&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;e&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AQAB&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rsa1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;qi&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;oMPC-4NyoDZge2bOL5SHaSNKyrcnpC1XKctcxN64lRql5zETC30Nuq0zJWwFQQfVgkS8fiMRV1NEMy98EbTAj8k63PBfp5jywIx5atQFjZ101tYEsxHG4bfAuTxIwUFALS3KLIHyGAlTognRZ3UWNX0FHwH2AJUS0LJdbCuHqGA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;fn0Kj1fA3zrRw5RMuvAKbRQHbU58mah9gHuyCgrleEQNuYGJ8IngOxKw6NSWyyVR_WvCBMNANRJfGWhYxilYFQ_YIlvXAZQ7bXzeu9HmEt7LuoOBt1nrlVunESGdJTJQpJFU6mjjdXC-NenGuab9g365JPOAnzTIa6IMEqgB9Tc&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dq&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;134JQdXBsriSVnYW3GZySIPBJcNJUhSqjrqzxjeT7XLAEpPNEtfU3mY7FZvVsA722mqt5O4veXFrKeG0M1DKdUpsT4-ltTQUg2dcgTY4Q8bre7ke32E73xZGEiaGFDkyY3VobXfciFmOn355PG49j14AsjroxGMel14RYK9Ni5E&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;n&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;11flaUmrserMifKmz8ONBbWWfCRAFjerniHvW1kIXP62hVI8xDWipojhLo7Ai-tV0jA4WSyodlfaA1NRXzZbbAC8pOOpPGkwLBHyOhcB4zpwTykvz5Ype3Mex20XIdBAc0DR4i8d9ZEpnIBqmPcmwP0gANmX82RZd3gZKxQ-umfDXZdNJqy2g1kawRjIP_CpznYzX8MY1OCfjZYXXsZvVeC2v0pRRre9tJEilCZEBY42jJyf6bY2cZhu2KTIpIx1_8Y2JB6AAAdnPsEgNRxMe0g5ShCmDvc93m9GsLZSy4Nm0pOWWVbx7-JK6-QWBdaiG_fAT_2OOndDL-hL1Ry3Jw&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><ul>
<li>
<p>Firstly, new JWK should be added to the keystore using the file in the <code>IAM_KEY_STORE_LOCATION</code>.
The <code>IAM_JWK_DEFAULT_KEY</code> should still be left as the key id of the old key. This way all the
clients can cache the new public key. Before the next step, waiting as long as the agreed policy for
key caching for the infrastructure would be enough to make sure every client cached the new
key.</p>
<p>So new keystore in the example would be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;keys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;p&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;7IsuNM1T2G83isHFmV8zNUri2x3xLBBT3gbA5905owUTqzqHsj7QJw8GqnadNse9G3FRFLB-ShNq64yvr7hXPO35E5HSrRsWKxYgzdPKPdl-M5xc6O-QQlKmkmje_r82M5KGbDpV_uBjoQHPGMxME6MlFaYtCFSd_keKvzpkev8&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kty&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;RSA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;q&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;6Q5OunfOfXqkvKdh-mUysuS5jJY4t18MAO9KLcH5wIH4iV2FmasEeqB0g0LSNrgitv9icGhQiRUVR8dqpATBgrhZiQlB1KneUdIe8W_QQQVhA_tqJgEuAb_kl8QDHvIyXAs8onYCSDtgSD6gw-qDivGpf7TzXZcosWrgSQDYi9k&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;d&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;DUSnJ_OYFqBG9gDzcj20RLPJj-CT6kqH0nh4zQIRV9mB2XkVsWk0mlo4tauqBXT8lrTN5ACyaIhFMItDqkApJeBtvyMf3E8G3tBEQnwEa8HABcCd54ZzC94t-U-pazXvoqpNxEfu6qCFFdV7u-0OgDmYbTT6_c4jDQ9jTZozuzxoh_qv6iOijBJ62yJLf4kvIOB-ghYwig6Cz1OLSgh_Y8EIO-6wk-aSZWXS7l7xnM7_8BBOzKxVG73YfPQi-9fPVnee8Cijd3RU5_uUw4yh5I87wYZzPzN3gK6Pazf6BZ-9vs1SboEyeVtd3TiOB2aBOyS4Ntohj6eljsfXEHYN4Q&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;e&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AQAB&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rsa1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;qi&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;oMPC-4NyoDZge2bOL5SHaSNKyrcnpC1XKctcxN64lRql5zETC30Nuq0zJWwFQQfVgkS8fiMRV1NEMy98EbTAj8k63PBfp5jywIx5atQFjZ101tYEsxHG4bfAuTxIwUFALS3KLIHyGAlTognRZ3UWNX0FHwH2AJUS0LJdbCuHqGA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;fn0Kj1fA3zrRw5RMuvAKbRQHbU58mah9gHuyCgrleEQNuYGJ8IngOxKw6NSWyyVR_WvCBMNANRJfGWhYxilYFQ_YIlvXAZQ7bXzeu9HmEt7LuoOBt1nrlVunESGdJTJQpJFU6mjjdXC-NenGuab9g365JPOAnzTIa6IMEqgB9Tc&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dq&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;134JQdXBsriSVnYW3GZySIPBJcNJUhSqjrqzxjeT7XLAEpPNEtfU3mY7FZvVsA722mqt5O4veXFrKeG0M1DKdUpsT4-ltTQUg2dcgTY4Q8bre7ke32E73xZGEiaGFDkyY3VobXfciFmOn355PG49j14AsjroxGMel14RYK9Ni5E&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;n&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;11flaUmrserMifKmz8ONBbWWfCRAFjerniHvW1kIXP62hVI8xDWipojhLo7Ai-tV0jA4WSyodlfaA1NRXzZbbAC8pOOpPGkwLBHyOhcB4zpwTykvz5Ype3Mex20XIdBAc0DR4i8d9ZEpnIBqmPcmwP0gANmX82RZd3gZKxQ-umfDXZdNJqy2g1kawRjIP_CpznYzX8MY1OCfjZYXXsZvVeC2v0pRRre9tJEilCZEBY42jJyf6bY2cZhu2KTIpIx1_8Y2JB6AAAdnPsEgNRxMe0g5ShCmDvc93m9GsLZSy4Nm0pOWWVbx7-JK6-QWBdaiG_fAT_2OOndDL-hL1Ry3Jw&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;p&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;04huYoKFVGrsAaJ2djo8YUnmdbz4_Dt5a3A1r32dZhcY6gJYLtQmLzzSt1m7Z3p8UsZ8eerDBYFQYWlMIDhmsNCeKw5kE6LuSi1JGE3boveKcIpBrI5oxIduZUTr8QBltcKuklzR_Nra-JIrR_Nkgd6nA7C7VPC3MDSmQpbAyx8&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kty&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;RSA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;q&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;0wOm2SerufATV0ZWKOZmAgWlQ9qPATVn-FuZsEKMw4LOjlYba63iuHPWhcvgEJEgqP4DKrCn49HI95eDbYpoCpfYDCBNN8K7Q_k3P8T7a_FN-xNc9OtG80lNiFb93CSwJndGhsXoaLjGFcTpIC9RnPzi_tC3OSvdHaXgymkwEyU&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;d&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;F02mbTRlQ9J5DKkCfCgkkE_KLOmAr5VTkh2fhOZwsZ78_CNlK1NBr1a0tNpdZbn0Rt31oKLHKhfw6DcV2koso3IZVJynHHvlX3DPI8f6csXLJZGKhG7Zh6X-WnibD65h9nZo8QUd_uRdEfx6aqxPNzVKxeAX6lh7pkvkSRB7zoX_H5Vf7pn9fWXzLDB1BQacFRtdqnEpiLur-Z1CcjC68DcRGrl-EqA37ZohnVPD7T7Lw14V_nfz5rrQZGqLImCOy5Daz4ZuRBXaiR47fkWfyy7PSLnwIAHIe24328zDygNSYohw84iY0440xlAutU8wSWhrMpn4PWB_fWKiFnbiCQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;e&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AQAB&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rsa2&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;qi&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CnkIYAjTvJ7FS0uQgzTDtdMhi87s5r2wbGjg82HUWyRDsb7Xadf85K0aqgc5UKiM-ZHA-uc9PMDyxxnxAz4MrxVr12Gx2SS_dPFoPYVnr2jE9nQLWDUqitES1NMozhTsngmfVfgux9Rr4-rJFHP10jU9hjh9ELyv4BGoopFaFYU&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PKRMIOmSF5Vfe0h79YDUdn-dFfvK1WSndmmAuoKkcPQGLG_nn-Up3Tjun6mV1CCFK6XDYaAvsJBV3tc0_7ermNz1uxoxDoATGCjLX7BSWvHkOkcodLOOzWiV-Wo8yaZ3ghgBu-voNzj2tXQR_FqGYcTW1HQCAGPR4Hv3ffeB5bk&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dq&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;T0fM9UPJane_3IeJsZ4270WNvTuthQe6w34u9SFb380SrDm_3aocR68GB4j861yLh9K__9cVjSvxtMyRTaO1yV0ZiBzOxkd8smI9FtF8oSatZMr2nvKS2q9M2Q_OG1sRb7JapiJPWqEpk15DNJtyr2f4JULnxCwtzIjZN1NkA50&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;n&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rlx3cmO8jN3q32ndXusuoWb7MrMXgEcsJVQiU_BhgNpYEJyyA5QBmH01y04_itbCvBzGHll8y768Zv76ohgcOOW_XtdlPyF1-GgBxVg-Ro-tj5zdP4znFXfNRn6ZGY60lvCFfh3XX-eQp7EZQbHI-wRask991d2-56PzorrJWHiYLza-C87MG-i2hxyQUs5vsdl92J1pqm8_4mjRZhARBQWGXlB-80TdsG3Tl5MliaHdWNJWQ_f43TfG0OfbiCtFITIoHMESL4IO9AxygnYznPXWIoWMsXpsEKUcOgzNqhngQWe9rvJKG5Cy0O0Y0-IJexTEuF68CZpwGra75cCoew&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>In this example <code>IAM_JWK_DEFAULT_KEY=rsa1</code> is kept unchanged.</p>
</li>
<li>
<p>Secondly, after the new key is cached by all of the clients, the signing key should be changed as the
new key via the <code>IAM_JWK_DEFAULT_KEY</code> variable. The old key should still be kept in
the keystore, otherwise all the current tokens would stop working. Before removing it from the
key store, waiting as long the longest allowed token lifetime would be enough for the old tokens to expire
and the clients will be left with only tokens that are signed with new key.</p>
<p>So in the example default key should be set as <code>IAM_JWK_DEFAULT_KEY=rsa2</code>.</p>
</li>
<li>
<p>As the last step, old key can be removed from the keystore. So only the tokens that were signed with the new
key will be valid after this.</p>
<p>So the keystore would be like following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;keys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#204a87;font-weight:bold">&#34;p&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;04huYoKFVGrsAaJ2djo8YUnmdbz4_Dt5a3A1r32dZhcY6gJYLtQmLzzSt1m7Z3p8UsZ8eerDBYFQYWlMIDhmsNCeKw5kE6LuSi1JGE3boveKcIpBrI5oxIduZUTr8QBltcKuklzR_Nra-JIrR_Nkgd6nA7C7VPC3MDSmQpbAyx8&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kty&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;RSA&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;q&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;0wOm2SerufATV0ZWKOZmAgWlQ9qPATVn-FuZsEKMw4LOjlYba63iuHPWhcvgEJEgqP4DKrCn49HI95eDbYpoCpfYDCBNN8K7Q_k3P8T7a_FN-xNc9OtG80lNiFb93CSwJndGhsXoaLjGFcTpIC9RnPzi_tC3OSvdHaXgymkwEyU&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;d&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;F02mbTRlQ9J5DKkCfCgkkE_KLOmAr5VTkh2fhOZwsZ78_CNlK1NBr1a0tNpdZbn0Rt31oKLHKhfw6DcV2koso3IZVJynHHvlX3DPI8f6csXLJZGKhG7Zh6X-WnibD65h9nZo8QUd_uRdEfx6aqxPNzVKxeAX6lh7pkvkSRB7zoX_H5Vf7pn9fWXzLDB1BQacFRtdqnEpiLur-Z1CcjC68DcRGrl-EqA37ZohnVPD7T7Lw14V_nfz5rrQZGqLImCOy5Daz4ZuRBXaiR47fkWfyy7PSLnwIAHIe24328zDygNSYohw84iY0440xlAutU8wSWhrMpn4PWB_fWKiFnbiCQ&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;e&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;AQAB&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;kid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rsa2&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;qi&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;CnkIYAjTvJ7FS0uQgzTDtdMhi87s5r2wbGjg82HUWyRDsb7Xadf85K0aqgc5UKiM-ZHA-uc9PMDyxxnxAz4MrxVr12Gx2SS_dPFoPYVnr2jE9nQLWDUqitES1NMozhTsngmfVfgux9Rr4-rJFHP10jU9hjh9ELyv4BGoopFaFYU&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;PKRMIOmSF5Vfe0h79YDUdn-dFfvK1WSndmmAuoKkcPQGLG_nn-Up3Tjun6mV1CCFK6XDYaAvsJBV3tc0_7ermNz1uxoxDoATGCjLX7BSWvHkOkcodLOOzWiV-Wo8yaZ3ghgBu-voNzj2tXQR_FqGYcTW1HQCAGPR4Hv3ffeB5bk&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;dq&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;T0fM9UPJane_3IeJsZ4270WNvTuthQe6w34u9SFb380SrDm_3aocR68GB4j861yLh9K__9cVjSvxtMyRTaO1yV0ZiBzOxkd8smI9FtF8oSatZMr2nvKS2q9M2Q_OG1sRb7JapiJPWqEpk15DNJtyr2f4JULnxCwtzIjZN1NkA50&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#204a87;font-weight:bold">&#34;n&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;rlx3cmO8jN3q32ndXusuoWb7MrMXgEcsJVQiU_BhgNpYEJyyA5QBmH01y04_itbCvBzGHll8y768Zv76ohgcOOW_XtdlPyF1-GgBxVg-Ro-tj5zdP4znFXfNRn6ZGY60lvCFfh3XX-eQp7EZQbHI-wRask991d2-56PzorrJWHiYLza-C87MG-i2hxyQUs5vsdl92J1pqm8_4mjRZhARBQWGXlB-80TdsG3Tl5MliaHdWNJWQ_f43TfG0OfbiCtFITIoHMESL4IO9AxygnYznPXWIoWMsXpsEKUcOgzNqhngQWe9rvJKG5Cy0O0Y0-IJexTEuF68CZpwGra75cCoew&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
  <span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></li>
</ul>
<p>With this update method, the service is not interrupted for any user and the key is replaced with a new one.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b153a1aec7140b2aa27a0ba03e8dc3fd">3.2.7 - Local authentication</h1>
    
	<p>IAM has the ability to limit or disable
authentication with local IAM credentials, so that external, brokered
authentication is required.</p>
<p>It&rsquo;s possible to hide the local login form from the IAM login page and also to
control for which users local authentication is enabled (all users,
VO administrators, no users).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">iam</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">local-authn</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># possible values for enabled-for: all, vo-admins, none</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">enabled-for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vo-admins </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># possible values: hidden, hidden-with-link, visible</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">login-page-visibility</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hidden </span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>In alternative, one can configure the local authentication settings using environment variables as
described in the <a href="../#local-authentication-settings">Configuration</a> section.</p>
<p>When the local authentication (username/password) fields are hidden on the login page, it is possible
to display them by adding the query string <code>?sll=y</code> to the login page URL. It may be useful, for
example, to access the <code>admin</code> account if only username/password authentication has been configured
for it and if <code>enable-for</code> has been set to <code>vo-admins</code>.</p>
<p>Note that hiding local authentication on the login page without restricting the category of users
able to use it doesn&rsquo;t really provide additional security.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-359104377f9341d4c326d45fb209b4c2">3.2.8 - External authentication</h1>
    
	<p>IAM supports brokered authentication via standard OpenID-Connect and SAML
protocols as well as X.509 authentication.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ac3ba36ba3318b338bcbf439e1b79e60">3.2.8.1 - OpenID-Connect authentication</h1>
    
	<p>IAM supports brokered OpenID Connect authentication to external identity
providers (e.g., Google).</p>
<p>When brokered OpenID Connect authentication is turned on a IAM instance, users
can log into the service delegating authentication to one of the supported
OpenID Connect providers (OP).</p>
<p>To enable brokered OpenID Connect authentication on your IAM instance you have to:</p>
<ol>
<li>Obtain client credentials and other configuration details for each of the
external OpenID Connect providers;</li>
<li>Provide the OIDC configuration file defining the configuration of the supported OPs;</li>
<li>Enable the <code>oidc</code> profile.</li>
</ol>
<h2 id="obtain-op-configuration-and-client-credentials">Obtain OP configuration and client credentials</h2>
<p>In order to act as a relying party (RP) for an external OpenID Connect provider (OP), IAM
will need at least:</p>
<ul>
<li>client credentials (a clientId and clientSecret);</li>
<li>an <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig">OpenID Connect provider discovery endpoint URL</a>;</li>
</ul>
<p>As an example, see the the <a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google identity platform OpenID Connect
guide</a> for help on this.</p>
<h2 id="provide-the-oidc-configuration">Provide the OIDC configuration</h2>
<h3 id="google-configuration">Google configuration</h3>
<p>If Google is the only OpenID Connect provider you want to support, the configuration
embedded in the IAM war file already provides what you need, and you just need to:</p>
<ul>
<li>
<p>Enable the <code>oidc</code> profile;</p>
</li>
<li>
<p>Pass the google client credentials to IAM via the following environment
variables:</p>
<ul>
<li><code>IAM_GOOGLE_CLIENT_ID</code></li>
<li><code>IAM_GOOGLE_CLIENT_SECRET</code></li>
</ul>
</li>
</ul>
<h3 id="multiple-providers-configuration">Multiple providers configuration</h3>
<p>To configure multiple providers, or to override the default configuration, you must
provide an <code>application-oidc.yaml</code> configuration file and make it available to IAM.</p>
<p>Trusted OPs are configured for IAM via the <code>application-oidc.yaml</code> configuration file.</p>
<p>This is a Spring Boot configuration file that is activated when the <code>oidc</code> profile is turned on.</p>
<p>The default configuration file, embedded in the IAM war file, supports the
configuration of a single provider, Google, for backward compatibility, and looks
like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">oidc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">providers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://accounts.google.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openid,profile,email,address,phone</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">btn-social btn-google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fa-icon</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>This configuration allows to configure support for Google by:</p>
<ul>
<li>activating the <code>oidc</code> profile;</li>
<li>Setting the <code>IAM_GOOGLE_CLIENT_ID</code> and <code>IAM_GOOGLE_CLIENT_SECRET</code> environment
variables to provide the Google client credentials;</li>
</ul>
<p>To enable multiple providers, you need to override the default oidc configuration.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">oidc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">providers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://accounts.google.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_GOOGLE_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openid,profile,email,address,phone</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">btn-social btn-google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fa-icon</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">google</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">egi-checkin</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">issuer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_ISSUER}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">client</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_ID}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_SECRET}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">redirectUris</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${iam.baseUrl}/openid_connect_login</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">scope</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_CHECKIN_CLIENT_SCOPE:openid,profile,email}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loginButton</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">text</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EGI CheckIn</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Sign in with EGI CheckIn</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://egi.eu/wp-content/uploads/2016/05/cropped-logo_site-1-300x300.png</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">medium</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>The example configuration above shows how to configure support for Google and
the <code>EGI CheckIn</code> provider, with a custom button configuration for the CheckIn
provider.</p>
<p>See the <a href="/v/v1.8.2/docs/reference/configuration/#overriding-default-configuration-templates">configuration reference</a> for instructions on how to override
the default IAM configuration.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-af611b856fca4d6771e3e3ed962701b5">3.2.8.2 - SAML authentication</h1>
    
	<p>IAM supports brokered SAML authentication. When SAML authentication is turned
on for an IAM instance, users can log into the service using the home Identity
Provider (IdP) credentials.</p>
<p>To enable SAML authentication for your IAM instance you have to:</p>
<ul>
<li>Choose an <code>entityId</code> for your IAM instance; see the <a href="https://wiki.shibboleth.net/confluence/display/CONCEPT/EntityNaming">Shibboleth
docs</a> for guidance on this</li>
<li>Generate a self-signed certificate for your IAM instance that will be used
for SAML cryptographic operations and include it in a Java keystore;</li>
<li>Obtain SAML metadata from your IdP or identity federation;</li>
<li>If the metadata is signed, import the certificate that must be used to verify
the signature in the Java keystore generated above;</li>
<li>Enable the <code>saml</code> profile for the IAM and configure SAML support via the
appropriate environment variables.</li>
</ul>
<h2 id="generate-a-self-signed-certificate">Generate a Self-signed certificate</h2>
<p>To generate a self-signed certificate that lasts 5 years use the following
openssl command:</p>
<pre><code class="language-console" data-lang="console">openssl req -newkey rsa:2048 -nodes -x509 -days 1825  -keyout self-signed.key.pem \
  -out self-signed.cert.pem
</code></pre><p>The above command will generate a private key and the corresponding certificate
in PEM format. You will be asked to provide a subject for the certificate being
generated.</p>
<p>To import this certificate in a Java keystore we need in in p12 format. Use the
following commands to convert the certificate in p12 format and import it in a
Java keystore:</p>
<pre><code class="language-console" data-lang="console">openssl pkcs12 -export -inkey self-signed.key.pem \
    -name self-signed \
    -in self-signed.cert.pem \
    -out self-signed.p12

keytool -importkeystore -destkeystore self-signed.jks \
    -srckeystore self-signed.p12 \
    -srcstoretype PKCS12
</code></pre><p>During the above process you will be asked to provide a p12 export password and
a keystore password. <strong>Use the same password</strong>, at least 6 characters long,
otherwise it will not work for the java keystore.</p>
<p>You can list the contents of the keystore with the following command:</p>
<pre><code class="language-console" data-lang="console">keytool -list -keystore self-signed.jks
</code></pre><h2 id="obtain-saml-metadata-for-your-idp-or-identity-federation">Obtain SAML metadata for your IdP or identity federation</h2>
<p>You IdP or identity federation will have a SAML metadata document describing,
in SAML terms, which authentication flows are enabled and providing access to
cryptographic material and other information that make the federated
authentication schemes work reliably and securely. For more information on SAML
metadata, see <a href="https://wiki.shibboleth.net/confluence/display/CONCEPT/Metadata">the Shibboleth metadata documentation</a>.</p>
<h3 id="signed-metadata-advice">Signed metadata advice</h3>
<p>Typically identity federations sign the SAML metadata for security reasons, and
provide a certificate (and linked public key) that can be used to verify
signatures on the metadata at a well-known location (e.g., the federation
website).</p>
<p>To support metadata signature verification you will need to import this
certificate in the Java keystore created above.</p>
<p>Certificates are typically published in PEM format, while to import a
certificate in a Java keystore you will need it in DER format.</p>
<p>The following commands show how to import a PEM certificate into a Java
keystore:</p>
<pre><code class="language-console" data-lang="console">openssl x509 -outform der -in idem_signer_2019.pem -out idem_signer_2019.der
keytool -import -alias idem_signer_2019 -keystore self-signed.jks -file idem_signer_2019.der
</code></pre><h3 id="metadata-configuration">Metadata configuration</h3>
<p>The IdP or federation metadata to be trusted can be specified with the
<code>IAM_SAML_IDP_METADATA</code> environment variable, which contains an URL pointing to
the metadata.</p>
<p>If the metadata is signed, you can enforce signature validation with the
<code>IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</code> variable.</p>
<p>Metadata needs to be periodically refreshed to learn about new entities in the
federation or updated key material. The metadata refresh interval can be
specified with the <code>IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</code>
environment variable, which defines a refresh period in seconds (a reasonable
value is typically refresh metadata every hour).</p>
<p>An example metadata configuration could be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>http://www.garr.it/idem-metadata/idem-metadata-sha256.xml
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3600</span>
</code></pre></div><h2 id="iam-saml-attribute-requirements">IAM SAML attribute requirements</h2>
<p>IAM requires that the IdP used for authentication releases a persistent
identifier attribute that can be used to link the external identity to local
IAM accounts. If the IdP does not release persistent identifier attributes, it
<strong>cannot</strong> be integrated with the IAM.</p>
<p>The attribute used to link the external SAML account is configurable. In the
default configuration, IAM uses the following attributes (in the given order):</p>
<ol>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonUniqueId">EduPersonUniqueId</a></li>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonTargetedID">EduPersonTargetedId</a></li>
<li><a href="http://software.internet2.edu/eduperson/internet2-mace-dir-eduperson-201602.html#eduPersonPrincipalName">EduPersonPrincipalName</a></li>
</ol>
<p>The order of these can be changed with the <code>IAM_SAML_ID_RESOLVERS</code> environment variable,
which accepts a list of aliases for the attributes to be searched.</p>
<p>The following tables maps attribute names to the aliases currently supported:</p>
<table>
<thead>
<tr>
<th>SAML attribute</th>
<th>Alias</th>
</tr>
</thead>
<tbody>
<tr>
<td>EduPersonUniqueId</td>
<td>eduPersonUniqueId</td>
</tr>
<tr>
<td>EduPersonTargetedId</td>
<td>eduPersonTargetedId</td>
</tr>
<tr>
<td>EduPersonPrincipalName</td>
<td>eduPersonPrincipalName</td>
</tr>
<tr>
<td>EduPersonOrcid</td>
<td>eduPersonOrcid</td>
</tr>
<tr>
<td>spidCode</td>
<td>spidCode</td>
</tr>
</tbody>
</table>
<p>The default value for IAM_SAML_ID_RESOLVERS is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_ID_RESOLVERS</span><span style="color:#ce5c00;font-weight:bold">=</span>eduPersonUniqueId,eduPersonTargetedId,eduPersonPrincipalName
</code></pre></div><h2 id="checking-saml-assertion-and-authentication-freshness">Checking SAML assertion and authentication freshness</h2>
<p>IAM provides the ability to set a maximum age for SAML assertion and
authentication statements received from IdPs.</p>
<p>The <code>IAM_SAML_MAX_ASSERTION_TIME</code> allows to define an upper bound (in seconds)
on the SAML assertion lifetime, so that assertions that exceed such limit are
considered invalid.</p>
<p>The <code>IAM_SAML_MAX_AUTHENTICATION_AGE</code> allows to define an upper bound (in
seconds) on the authentication age linked to SAML authentication statements, so
that users are forced to reauthenticate when this limit is exceeded.</p>
<h2 id="limiting-authentication-only-to-selected-idps">Limiting authentication only to selected IdPs</h2>
<p>IAM provides the ability to define constraints on which IdPs will be allowed
for authentication. This is useful when you want to limit which IdPs in a large
federation (e.g., <a href="https://edugain.org/">EduGAIN</a>) will be trusted for authentication.</p>
<p>Currently three types of IdPs limiting are supported:</p>
<ul>
<li>entity id whitelist</li>
<li>SIRTFI compliance</li>
<li>Research and Scholarship compliance</li>
</ul>
<h3 id="limiting-by-entity-id">Limiting by entity id</h3>
<p>The <code>IAM_SAML_IDP_ENTITY_ID_WHITELIST</code> environment variable can be used to
define a comma-separated whitelist of IdPs entity IDs that will be trusted for
authentication.</p>
<p>The following example limits trusted IdPs to the INFN IdP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_IDP_ENTITY_ID_WHITELIST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://idp.infn.it/saml2/idp/metadata.php&#34;</span>
</code></pre></div><h3 id="limiting-by-sirtfi-compliance">Limiting by SIRTFI compliance</h3>
<p>To limit authentication only to IdPs that are <a href="https://refeds.org/sirtfi">SIRFTI</a>-compliant, set
the the <code>IAM_SAML_METADATA_REQUIRE_SIRTFI</code> environment variable to true.</p>
<h2 id="joining-a-saml-federation">Joining a SAML federation</h2>
<p>An Indigo IAM instance can join a SAML federation as a service provider (SP).
To join a feaderation you need to follow the following steps:</p>
<ul>
<li>Configure the <code>saml</code> profile in IAM</li>
<li>Register the Indigo IAM instance into the federation, following the federation
instructions (generally involves connecting to a registration portal to
declare the SP)</li>
<li>Wait for the federation metadata to be updated at the federation IdPs. This
typically involves a 12h delay.</li>
<li>Check if login in IAM works successfully through the federation: note that it
will not work before the federation IdPs have updated their metadata. If the
error persists after the delay, contact your federation or IdP support.</li>
</ul>
<p>When registering the Indigo IAM SP, there are a few critical parameters to supply:</p>
<ul>
<li>Assertion Consumer Service (ACS), consisting of 3 parameters:
<ul>
<li>Binding: must be <code>HTTP Post</code></li>
<li>URL: it is the instance URL + <code>/saml/SSO</code>, e.g. <code>https://iam.example.com/saml/SSO</code></li>
<li>Index: should be set to 0</li>
</ul>
</li>
<li>X509 SAML certificate: the generated <code>self-signed</code> certificate</li>
</ul>
<p>Other, generally optional, parameters include the requested attribute. It is a good
practice to declare as mandatory one of the attribute listed in
<code>IAM_SAML_ID_RESOLVERS</code>.</p>
<h2 id="customizing-saml-login-button-text">Customizing SAML login button text</h2>
<p>You can customize the SAML login button text shown in the IAM login page with
the <code>IAM_SAML_LOGIN_BUTTON_TEXT</code> environment variable.</p>
<h2 id="minimal-saml-configuration-example">Minimal SAML configuration example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env"><span style="color:#000">IAM_SAML_ENTITY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:example:iam-saml-example
<span style="color:#000">IAM_SAML_KEYSTORE</span><span style="color:#ce5c00;font-weight:bold">=</span>file:///self-signed.jks
<span style="color:#000">IAM_SAML_KEYSTORE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx
<span style="color:#000">IAM_SAML_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>self-signed
<span style="color:#000">IAM_SAML_KEY_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx
<span style="color:#000">IAM_SAML_IDP_METADATA</span><span style="color:#ce5c00;font-weight:bold">=</span>http://www.garr.it/idem-metadata/idem-metadata-sha256.xml
<span style="color:#000">IAM_SAML_METADATA_REQUIRE_VALID_SIGNATURE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#000">IAM_SAML_METADATA_LOOKUP_SERVICE_REFRESH_PERIOD_SEC</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3600</span>
<span style="color:#000">IAM_SAML_LOGIN_BUTTON_TEXT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Sign in with IDEM&#34;</span>
</code></pre></div><h2 id="custom-saml-configuration">Custom SAML configuration</h2>
<p>The configuration based on environment variables relies on a <a href="https://raw.githubusercontent.com/indigo-iam/iam/v1.8.2/iam-login-service/src/main/resources/application-saml.yml">configuration
template</a> that fits most use cases embedded in the IAM war
file.</p>
<p>To have full control on the SAML configuration, provide a custom
<code>application-saml.yml</code> file in the IAM configuration directory.</p>
<p>See the <a href="/v/v1.8.2/docs/reference/configuration/">configuration reference</a> for more SAML metadata options and
instructions on how to override the default IAM configuration.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-86d359d1731c5e164863d1bbe93a7bcf">3.2.8.3 - X.509 authentication</h1>
    
	<p>X509 authentication in IAM doesn&rsquo;t require any specific configuration in IAM itself.
It is enabled as soon as the proper options have been set in the Nginx configuration.</p>
<p>For the X509 authentication to work, it is critical that the user certificate CA
is known to Nginx. If it is not part of the CAs configured in <code>/etc/ssl</code>, you may need
to add the following line to your Nginx configuration:</p>
<pre><code>ssl_client_certificate  CA_certificates_file;
</code></pre><p>where <code>CA_certificates_file</code> is the path to a file containing the certificates (in PEM
format) of the CAs that must be accepted by Nginx.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f8918f697450c2009b75913f9e9317a5">4 - Tasks</h1>
    <div class="lead">Common administration &amp; usage tasks</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-18193143b4ee08bf7ab15851bbaded55">4.1 - IAM organization administration</h1>
    <div class="lead">IAM administration tasks &amp; useful information</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f9feafc0e8f5414b97d15e7385f9f5be">4.1.1 - User management</h1>
    
	<p>IAM provides tools to manage users in an organization.
All the actions described below require administrator privileges.</p>
<h2 id="creating-a-user-account">Creating a user account</h2>
<p>A new user account in the organization can be created from the &ldquo;Users&rdquo;
management panel by clicking on the &ldquo;Add user&rdquo; button at the bottom of the
page:</p>
<p><img src="../images/add-user.png" alt="Add user"></p>
<p>A dialog is shown that allows to set basic user information:</p>
<p><img src="../images/add-user-2.png" alt="Add user 2"></p>
<h2 id="deleting-a-user-account">Deleting a user account</h2>
<p>User accounts can be deleted from the &ldquo;Users management&rdquo; section of the
dashboard by clicking on the delete button for the users that should be
deleted:</p>
<p><img src="../images/delete-users.png" alt="Delete user"></p>
<h2 id="disabling-a-user-account">Disabling a user account</h2>
<p>User accounts can be disabled from the user home page by clicking on the
&ldquo;Disable user&rdquo; button. Disabled users are not allowed to login in the IAM and,
as such, cannot authenticate at any services that rely on the IAM for
authentication and authorization.</p>
<p><img src="../images/disable-user.png" alt="Disable user"></p>
<h2 id="managing-user-account-privileges">Managing user account privileges</h2>
<p>Administrator privileges can be assigned to a user from the user home page by
clickin on the &ldquo;Assign administrator privileges&rdquo; button:</p>
<p><img src="../images/assign-admin-privileges.png" alt="Assign admin privileges"></p>
<h2 id="managing-external-user-account-identities">Managing external user account identities</h2>
<p>Administrators can manually add and remove external accounts and certificates
for a local user account from the user home page:</p>
<p><img src="../images/manage-credentials.png" alt="Manage credentials"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e54da204360bf0baa8af45da22015dee">4.1.2 - Group Management</h1>
    
	<p>IAM provides a group management system, that can be used by IAM Administrators
and Group Managers to create groups, remove existing ones and manage membership in the group.</p>
<p>Groups can be organized in a hierarchical structure, with the following constraints:</p>
<ul>
<li>a group can have only a parent group;</li>
<li>a group can have many childrens.</li>
</ul>
<h2 id="manage-groups-as-iam-admin">Manage groups as IAM Admin</h2>
<p>The simplest way to manage groups is using the IAM dashboard.</p>
<h3 id="creating-a-group">Creating a group</h3>
<p>From the home page, open the <em>Groups</em> section and click the <em>Add Root Group</em> button:</p>
<p><img src="../images/IAM-groups-01.png" alt="INDIGO IAM Add Group button"></p>
<p>To create a group, specify a group name.</p>
<p><img src="../images/IAM-groups-02.png" alt="INDIGO IAM Root group creation"></p>
<p>A new children group can be created from the parent group details page,
clicking on the <em>Add a subgroup</em> button of the <em>Subgroups</em> upper tab.</p>
<p><img src="../images/IAM-groups-04.png" alt="INDIGO IAM Add Subgroup button"></p>
<h3 id="deleting-a-group">Deleting a group</h3>
<p>From the groups list page, click on the corresponding <em>X</em> button.
A confirmation window will be opened, so you can confirm or abort the
the delete operation.</p>
<p><img src="../images/IAM-groups-05.png" alt="INDIGO IAM Group removal"></p>
<p><strong>Only empty groups can be removed. If you try to remove a group
with a child group or with user members, the operation is aborted.</strong></p>
<h3 id="managing-membership-for-a-group">Managing membership for a group</h3>
<p>To add a user to a group open the user details page.
In the <em>Groups</em> section, click on the <em>Add to group</em> button:</p>
<p><img src="../images/IAM-groups-06.png" alt="INDIGO IAM Add group to user button"></p>
<p>Choose one or more groups and confirm the operation:</p>
<p><img src="../images/IAM-groups-07.png" alt="INDIGO IAM Add group membership"></p>
<p>Starting with version 1.7.0, when a user is added as member of the children group <code>A/B</code>, IAM
takes care of adding them also to the parent group <code>A</code> that
they are not already a members of.  In previous versions this had to be done
manually by the IAM administrator. Following the same rationale, when a user is
removed from the parent group <code>A</code>, it is also automatically removed from any children groups
(e.g. <code>A/B</code>) they are members of.</p>
<p>To remove a user from a group, click the <em>Remove</em> button.</p>
<p>Members can also be removed from the group details page, clicking on the corresponding <em>X</em> button
as shown in the following screenshot:</p>
<p><img src="../images/IAM-groups-08.png" alt="INDIGO IAM Members list"></p>
<h3 id="assign-group-manager-privileges">Assign Group Manager privileges</h3>
<p>Group Managers are IAM users with privileges that allow to manage groups.</p>
<p>In order to assign Group Manager privileges to a user, you can select the group,
click on the <em>Managers</em> tab and then on <em>Assign group manager</em>.
A popup window will appear to search for IAM users: after selecting the
corresponding user that wants to became Group Manager, click on <em>Add group manager</em>.</p>
<p><img src="../images/IAM-groups-09.png" alt="INDIGO IAM Members list"></p>
<h2 id="manage-groups-as-group-manager">Manage groups as Group Manager</h2>
<p>Starting from IAM version 1.8.1, when a user is a Group Manager a left tab <em>Managed groups</em>
that lists the groups they are group managers of appears in the homepage.</p>
<p><img src="../images/IAM-groups-10.png" alt="INDIGO IAM Managed groups tab"></p>
<p>Once the Group Manager clicks on a group, what they can see in the upper tabs is</p>
<ul>
<li>detailed view of group information (<em>Group information</em>)</li>
<li>list of children groups, if any (<em>Subgroups</em>)</li>
<li>list of Group Managers (<em>Managers</em>)</li>
<li>list of group members, if any (<em>Members</em>)</li>
</ul>
<p><img src="../images/IAM-groups-11.png" alt="INDIGO IAM groups view from GM"></p>
<p>The Group Manager has also the possibility to click on group members, where a limited
view of user information (including name, surname, uuid, username, email, status, created, updated,
end time and labels) is shown.</p>
<p><img src="../images/IAM-groups-12.png" alt="INDIGO IAM member view from GM"></p>
<h3 id="group-manager-actions">Group Manager actions</h3>
<p>A Group Manager in IAM does not have the same privileges as the IAM Admin in managing groups.</p>
<p>What they can do, beside being allowed to browse into the group details, is</p>
<ul>
<li>approve/reject membership requests</li>
<li>delete users from their managed groups.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f03d307094fc23ef6cf17d7a8b313135">4.1.3 - Acceptable Usage Policy (AUP) management</h1>
    
	<p>Starting with version 1.2.0, IAM supports defining an <strong>Acceptable Usage Policy
Document (AUP)</strong> for a managed organization. The AUP is presented to applicants
at registration time or periodically.</p>
<h2 id="managing-the-aup">Managing the AUP</h2>
<p>The AUP can be managed from the &ldquo;AUP&rdquo; section in the IAM dashboard, or via the
<a href="/v/v1.8.2/docs/reference/api/aup-api/">AUP management API</a>.</p>
<p>Administrator privileges are required.</p>
<h3 id="creating-the-aup">Creating the AUP</h3>
<p>By default, the AUP is not defined for an organization, i.e. it must be
explicitly defined by an IAM administrator.</p>
<p>The AUP can be created by clicking on the &ldquo;Create AUP&rdquo; button in the AUP
management page (that can be reached clicking the &ldquo;AUP&rdquo; link in the organization
Management navigation bar):</p>
<p><img src="../images/aup0.png" alt="AUP management 0"></p>
<p>A dialog is shown:</p>
<p><img src="../images/aup1.png" alt="AUP management 1"></p>
<p>where the administrator can enter the AUP URL and define how frequently the
AUP should be accepted by users.</p>
<p>If the AUP signature validity is set to 0, a signature on the AUP will be
requested only once (either at registration time or at the first IAM login
after the AUP creation). A zero value means basically that the AUP signature
does not expire.</p>
<p>A positive value in the AUP signature validity means, on the other hand, that
the signature will expire after that number of days. As an example, an
administrator that wants the AUP to signed each year by users should put 365 in
the &ldquo;AUP signature validity&rdquo; field.</p>
<h3 id="editing-and-deleting-the-aup">Editing and deleting the AUP</h3>
<p>The AUP can be edited and deleted from the AUP management page:</p>
<p><img src="../images/aup2.png" alt="AUP management 2"></p>
<p>Since version 1.6.0, the AUP has been converted from text to a URL.
If you have just upgraded to 1.6.0 and you have already defined a text AUP,
you should see the following red message below your AUP:</p>
<p><img src="../images/aup1b.png" alt="AUP management 1b"></p>
<p>By clicking on &ldquo;Edit AUP&rdquo;, admins are prompted to insert a valid URL.</p>
<p><img src="../images/aup5.png" alt="AUP management 5"></p>
<p>As shown in the picture above, editing the AUP will not trigger an AUP signature request.</p>
<h3 id="request-a-signature-from-users">Request a signature from users</h3>
<p>If you want to request a signature from users for the updated AUP,
use the &ldquo;Request AUP signature&rdquo; button in the AUP management page.</p>
<p>A dialog is shown:</p>
<p><img src="../images/aup6.png" alt="AUP management 6"></p>
<p>Confirm by clicking on &ldquo;Request AUP signature&rdquo; and the acceptance of the AUP
will be requested from ALL users at their next login.</p>
<h2 id="signing-the-aup">Signing the AUP</h2>
<p>Once defined the AUP text is shown to users for acceptance either
at registration time:</p>
<img src="../images/aup3.png" width="500">
<p>or at the first login after the AUP creation:</p>
<img src="../images/aup4.png" width="500">

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d446af92e463090d9e1b94f286038c9">4.2 - IAM service deployment</h1>
    <div class="lead">IAM service deployment tasks &amp; information</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f9c47943a3e72ee39a36f76a84d7aef8">4.2.1 - Backup &amp; Restore</h1>
    
	<h2 id="backup">Backup</h2>
<p>The IAM data that needs to saved by a backup is:</p>
<ul>
<li>database data;</li>
<li>service configuration, typically maintained in an environment file: <code>/etc/sysconfig/iam-login-service</code> on CentOS, <code>/etc/default/iam-login-service</code> on Ubuntuu;</li>
<li>the keystore used to sign JWT tokens: <code>/var/lib/indigo/iam-login-service/keystore.jks</code>;</li>
<li>the SAML keystore, used when SAML authentication is enabled: <code>/var/lib/indigo/iam/iam-login-service/example.ks</code>.</li>
</ul>
<p>The above locations apply when installing from packages on CentOS or Ubuntu.</p>
<p>An example of backup script is given below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">timestamp</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">`</span>date +<span style="color:#4e9a06">&#39;%Y-%m-%d_%H%M%S&#39;</span><span style="color:#4e9a06">`</span>

<span style="color:#000">MYSQL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mydbhost&#34;</span>
<span style="color:#000">MYSQL_USER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginserviceuser&#34;</span>
<span style="color:#000">MYSQL_PWD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicepassword&#34;</span>
<span style="color:#000">MYSQL_DBNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicedb&#34;</span>

<span style="color:#000">MYSQL_DUMP_OPTS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;-u </span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_USER</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> -p</span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_PWD</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> --host </span><span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_HOST</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>

<span style="color:#000">dumpfile</span><span style="color:#ce5c00;font-weight:bold">=</span>iam_dump.sql

mysqldump <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DUMP_OPTS</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DBNAME</span><span style="color:#4e9a06">}</span> &gt; <span style="color:#4e9a06">${</span><span style="color:#000">dumpfile</span><span style="color:#4e9a06">}</span>

tar czf iam_backup.tar.gz <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  <span style="color:#4e9a06">${</span><span style="color:#000">dumpfile</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /etc/sysconfig/iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /var/lib/indigo/iam-login-service/keystore.jks <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  /var/lib/indigo/iam/iam-login-service/example.ks
</code></pre></div><p>The keystore paths can be customized, so adapt the backup script according your configuration.</p>
<p>If you are deploying IAM with Docker and use a volume to provide configuration
to the service, backup the contents of such volume.</p>
<h2 id="restore">Restore</h2>
<p>From the backup, import the database data from the SQL dump:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;mydbhost&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_USER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginserviceuser&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_PWD</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicepassword&#34;</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">MYSQL_DBNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;iamloginservicedb&#34;</span>

$ mysql --host <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_HOST</span><span style="color:#4e9a06">}</span> -u <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_USER</span><span style="color:#4e9a06">}</span> -p<span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_PWD</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">${</span><span style="color:#000">MYSQL_DBNAME</span><span style="color:#4e9a06">}</span> &lt; iam_backup/iam_dump.sql
</code></pre></div><h3 id="deployment-from-packages">Deployment from packages</h3>
<p>To restore the IAM service from scratch, install the package.</p>
<p>On CentOS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y iam-login-service
</code></pre></div><p>Restore the environment file.</p>
<p>On CentOS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/etc/sysconfig/iam-login-service /etc/sysconfig/iam-login-service
</code></pre></div><p>On Ubuntu:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/etc/default/iam-login-service /etc/default/iam-login-service
</code></pre></div><p>Copy the keystores in the correct path, according to your configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo cp iam_backup/var/lib/indigo/iam-login-service/keystore.jks /var/lib/indigo/iam-login-service/keystore.jks
$ sudo cp iam_backup/var/lib/indigo/iam/iam-login-service/example.ks /var/lib/indigo/iam/iam-login-service/example.ks
</code></pre></div><p>Ensure the keystores have the right ownership:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo chown -R iam:iam /var/lib/indigo/iam-login-service
</code></pre></div><p>Start the IAM Login Service daemon:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo systemctl start iam-login-service
</code></pre></div><h3 id="deployment-with-docker">Deployment with Docker</h3>
<p>Copy the files from the backup to the volume location:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cp iam_backup/iam-login-service/env /path/to/iam-login-service/env
$ cp iam_backup/keystore.jks /path/to/keystore.jks
</code></pre></div><p>Start the container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:latest
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20612c101bee3438f511834eec95ece8">4.2.2 - Audit log</h1>
    
	<p>IAM Login Service traces interesting, security related events with an audit log.</p>
<p>Audit log messages are marked with the tag <code>AUDIT</code> in the Java class name
field.</p>
<p>An example of audit log message is the following:</p>
<pre><code class="language-console" data-lang="console">2017-09-11 09:58:14.560  INFO 13 --- [o-8080-exec-311] AUDIT : {&quot;@type&quot;:&quot;IamAuthenticationSuccessEvent&quot;,&quot;timestamp&quot;:1505116694560,&quot;category&quot;:&quot;AUTHENTICATION&quot;,&quot;principal&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e&quot;,&quot;message&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e authenticated succesfully&quot;,&quot;sourceEvent&quot;:{&quot;principal&quot;:&quot;794fb313-6e93-4d02-9d0a-4ed773ee2c5e&quot;,&quot;type&quot;:&quot;InteractiveAuthenticationSuccessEvent&quot;},&quot;source&quot;:&quot;UsernamePasswordAuthenticationToken&quot;}
</code></pre><p>The IAM login service writes logs to standard output in the default
configuration. When deployed from packages, all logs are collected by the
system journal.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0f3983ccaecafb6944a18b6d8550a571">4.2.3 - Upgrade</h1>
    
	<p>This section provides instructions to upgrade the IAM service to the latest
available version.</p>
<h3 id="deployment-from-packages">Deployment from packages</h3>
<p>Stop the service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ systemctl stop iam-login-service
</code></pre></div><p>Update the package:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ yum update -y iam-login-service
</code></pre></div><p>Restart the service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ systemctl start iam-login-service
</code></pre></div><h3 id="deployment-with-docker">Deployment with Docker</h3>
<p>Stop and remove the running container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker stop iam-login-service
$ docker rm iam-login-service
</code></pre></div><p>Pull the latest image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker pull indigoiam/iam-login-service:latest
</code></pre></div><p>Restart the container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:latest
</code></pre></div><p>Otherwise, you can specify the exact tag version. For example, if the latest
tag is <code>v1.1.0-latest</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name iam-login-service <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --net<span style="color:#ce5c00;font-weight:bold">=</span>iam -p 8080:8080 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --env-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/iam-login-service/env <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -v /path/to/keystore.jks:/keystore.jks:ro <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  indigoiam/iam-login-service:v1.1.0-latest
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c5846d016af443a2f547d87bba4a3f62">4.2.4 - Deploying IAM in HA</h1>
    <div class="lead">Instructions on how to deploy the IAM service in High Availability on k8s</div>
	<p>Starting from version 1.8.0, the IAM service can be deployed in High Availability mode.<br>
It relies on <a href="https://redis.io/">redis</a> as external component used for storing the
log-in sessions, which has to be deployed as well.</p>
<p>Here is an example on how to deploy three IAM replicas on a <a href="https://kubernetes.io/">kubernetes</a> cluster.</p>
<h3 id="iam-deployment-in-ha">IAM Deployment in HA</h3>
<p>An example of three replicas of the IAM service deployment on k8s is the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam-login-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">tier</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">login-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">tier</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">login-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">podAntiAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span><span style="color:#f8f8f8;text-decoration:underline">                </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tier</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">In</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                    </span>- <span style="color:#000">login-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kubernetes.io/hostname</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">json-keystore-secret-vol</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">secretName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">json-keystore-secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam-login-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">indigoiam/iam-login-service:v1.8.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1044</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">iam-debug</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">volumeMounts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">json-keystore-secret-vol</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">mountPath</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/secrets/json-keystore</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">readOnly</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">readinessProbe</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">httpGet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/actuator/health</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">initialDelaySeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">90</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">timeoutSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">requests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500m</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">limits</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">2Gi</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">IAM_BASE_URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://iam.example</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">IAM_ISSUER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://iam.example/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">envFrom</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">configMapRef</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">login-service-env</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">secretRef</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">db-secret-env</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Here a <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">configMap</a> for the <code>login-service-env</code> file is used.<br>
You can set there the <a href="../../../reference/configuration/#redis-configuration">Configuration properties</a>
used to enable Redis. The minimal ones required, for a password less Redis service are</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">IAM_SPRING_SESSION_STORE_TYPE</span><span style="color:#ce5c00;font-weight:bold">=</span>redis
<span style="color:#000">IAM_SPRING_REDIS_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>redis.example
</code></pre></div><h3 id="redis-service-deployment">Redis service Deployment</h3>
<p>A basic example of the Redis deployment on k8s (without replicas)
based on the <code>redis</code> <a href="https://hub.docker.com/_/redis">docker image</a> is the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis:6</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">requests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;512Mi&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">limits</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;512Mi&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">6379</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-16b818f0193a0e55e0f1cffd093e8e01">4.2.5 - Deploying the IAM VOMS attribute authority</h1>
    <div class="lead">Instructions on how to deploy and configure the IAM VOMS attribute authority micro-service</div>
	<h2 id="the-iam-voms-attribute-authority">The IAM VOMS attribute authority</h2>
<p>The IAM <a href="https://github.com/indigo-iam/iam/tree/master/iam-voms-aa">VOMS attribute authority</a> (AA) provide backward-compatible
<a href="http://italiangrid.github.io/voms/">VOMS</a> support for a Virtual Organization managed with IAM.</p>
<h3 id="deployment-architecture">Deployment architecture</h3>
<p><img src="../img/iam-voms-aa.png" alt="VOMS AA deployment"></p>
<p>The VOMS attribute authority can access the IAM database and encode IAM groups
and other attributes in a standard VOMS attribute certificate. This means in
practice that IAM can act both as an OAuth/OpenID Connect authorization server
and as a VOMS server for a given organization. TLS termination and client VOMS
atttribute certificate parsing and validation is delegated to <a href="https://github.com/indigo-iam/openresty-voms">OpenResty
VOMS</a>, which can de deployed as a sidecar service that just protects the
VOMS AA or also in front of the IAM backend application. The two scenarios are
depicted above.</p>
<p>In order to deploy a VOMS attribute authority, you can use the following docker
images:</p>
<ul>
<li><code>indigoiam/openresty-voms</code>, for the OpenResty VOMS service</li>
<li><code>indigoiam/voms-aa:v1.8.2</code>, for the VOMS AA service</li>
</ul>
<p>Deployment from packages is not currently supported for the VOMS attribute
authority.</p>
<h4 id="openresty-voms-configuration">OpenResty VOMS configuration</h4>
<p>OpenResty VOMS requires:</p>
<ul>
<li>IGTF trust anchors properly configured; see the <a href="https://github.com/indigo-iam/egi-trust-anchors-container/">EGI trust anchors
container</a> container</li>
<li>the <code>vomsdir</code> folder, with the VOMS LSC configuration generated starting from
the VOMS attribute authority X.509 credential</li>
</ul>
<h5 id="voms-lsc-configuration">VOMS LSC configuration</h5>
<p>Let&rsquo;s assume that the IAM VOMS AA will answer on <code>voms.local.io</code> for the VO
<code>example.vo</code>, to generate the LSC you need to get the subject and issuer of the
VOMS AA X.509 credential and put them in a file named as the fully qualified
domain name of the VOMS attribute authority with the <code>.lsc</code> extension.</p>
<p>The following command does exactly that (<code>X509_VOMS_DIR</code> can be set to any
directory where you have writing privileges):</p>
<pre><code class="language-console" data-lang="console">&gt; mkdir -p ${X509_VOMS_DIR}/example.vo
&gt; openssl x509 -in voms_local_io.cert.pem -noout -subject -issuer -nameopt compat | \
  gsed -e 's/^subject=//' -e 's/^issuer=//' &gt; \
  ${X509_VOMS_DIR}/example.vo/voms.local.io.lsc
</code></pre><p>For an example nginx configuration, see the <a href="https://github.com/indigo-iam/voms-aa/blob/master/compose/assets/openresty-voms/conf.d/voms.local.io.conf">VOMS AA docker compose
file</a>.</p>
<h4 id="voms-aa-configuration">VOMS AA configuration</h4>
<p>The VOMS AA is a spring boot application that shares the persistence
layer implementation with IAM, and as such can inspect the IAM database.</p>
<p>An example configuration for the VOMS AA service is given below, with comments
to explain the meaning of the parameters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">server</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.0.0.0</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># bind on all IP addresses</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># listen on port 8080</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">use-forward-headers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># assume you&#39;re behind a reverse proxy</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># change the default http header size limit to accomodate VOMS information passed</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># down by the ngx-voms server</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">max-http-header-size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">16000</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spring</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">main</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">banner-mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;off&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">jpa</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">open-in-view</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">## Database connection parameters</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">datasource</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">dataSourceClassName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">com.mysql.jdbc.jdbc2.optional.MysqlDataSource</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">jdbc:mysql://${IAM_DB_HOST}:${IAM_DB_PORT:3306}/${IAM_DB_NAME}?useLegacyDatetimeCode=false&amp;serverTimezone=UTC&amp;useSSL=false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_DB_USERNAME}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${IAM_DB_PASSWORD}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">flyway</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">voms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">tls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS AA certificate</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">certificate-path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/certs/hostcert.pem</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS AA certificate key</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">private-key-path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/certs/hostkey.pem</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Where to look for X.509 trust anchors</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">trust-anchors-dir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/grid-security/certificates</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># How often should trust anchors (and CRLs) be refreshed</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The default value is 86400</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">trust-anchors-refresh-interval-secs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">14400</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">aa</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS attribute authority host</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">voms.example</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS attribute authority port. Note that this is the port on</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># the reverse proxy, not the local service port</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">443</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS VO name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vo-name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${VOMS_AA_VO}</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Use FQAN legacy encoding, i.e.,</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># /voms/Role=NULL/Capability=NULL</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># instead of</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># /voms</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The default value is false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">use-legacy-fqan-encoding</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The VOMS proxy lifetime in seconds</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The default value is 12 hours</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">max-ac-lifetime-in-seconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">43200</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The optional group label</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The default value is wlcg.optional-group</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># This option specify the label to be assigned for custom VOMS roles.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># E.g.: &#34;pilot&#34; is a subgroup of the &#34;vo-name&#34; IAM group. If it is made</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># &#34;optional group&#34; in IAM via the dedicated button, users belonging to</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># it can request the &#34;pilot&#34; VOMS role.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">optional-group-label</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">voms.role</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>For an example configuration, see the <a href="https://github.com/indigo-iam/voms-aa/blob/master/compose/docker-compose.yml">VOMS AA docker compose
file</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cf4d164c71ad46c16dc1a41d06c2a98e">4.2.6 - Importing VOMS information into IAM</h1>
    
	<h2 id="the-voms-importer-script">The VOMS importer script</h2>
<p>For VOs that already use VOMS to manage their organization, a script is
available to synchronize one-way their VOMS instance with their IAM instance.</p>
<p>The VOMS information that is synchronized includes:</p>
<ul>
<li>VOMS Groups</li>
<li>VOMS Roles</li>
<li>VOMS Users
<ul>
<li>Personal information</li>
<li>X.509 certificates</li>
<li>Group and role membership</li>
<li>Generic attributes</li>
</ul>
</li>
</ul>
<p>The script needs admininistrative privileges on both VOMS and IAM, represented
respectively by a VOMS proxy and an IAM access token.</p>
<p>A typical run is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#204a87">export</span> <span style="color:#000">REQUESTS_CA_BUNDLE</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/grid-security/certificates
<span style="color:#204a87">export</span> <span style="color:#000">BEARER_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span>...
<span style="color:#204a87">export</span> <span style="color:#000">X509_USER_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span>...
python vomsimporter.py --vo test.vo --voms-host vgrid02.cnaf.infn.it --iam-host iam-dev.cloud.cnaf.infn.it
</code></pre></div><p>The script can be run with many different options. <code>python vomsimporter.py --help</code> gives all the details.</p>
<p>The script is currently deployed only for LHC VOs and includes some CERN
specificities, but it is general enough that can be easily adapted to other
situations.</p>
<h2 id="migration-of-groups-and-roles">Migration of groups and roles</h2>
<p>Both IAM and VOMS support the concepts of <em>group</em> and <em>role</em>.</p>
<p>Groups are very similar in both contexts. They differ slightly in the
representation: a VOMS group has the form <code>/&lt;group&gt;/&lt;subgroup&gt;/...</code>, whereas a
IAM group has the form <code>&lt;group&gt;/&lt;subgroup&gt;/...</code>, i.e. there is no leading <code>/</code>.</p>
<p>For example, the VOMS group <code>/atlas/production</code> becomes the IAM group
<code>atlas/production</code>.</p>
<p>Roles differ in a more profound way: whereas a VOMS role is a distinct entity
from a group, in IAM a role is simply a group with the specific labels
<code>wlcg.optional-group</code> and <code>voms.role</code>. An optional group is included in an OAuth
token or in a VOMS proxy only if requested.</p>
<p>For example, the VOMS group with role <code>/atlas/Role=VO-Admin</code> becomes the IAM
optional group <code>atlas/VO-Admin</code>.</p>
<p>Groups and roles are imported in IAM only if not already present there.</p>
<p>Groups and roles can be created directly in IAM without any corresponding group
or role in VOMS; those are not considered by the importer script.</p>
<h2 id="migration-of-users">Migration of users</h2>
<p>Only <strong>active</strong> VOMS users are migrated. <strong>A user suspended in VOMS, may not be
also suspended in IAM.</strong> Since IAM at CERN is also integrated with the CERN
Human Resource (HR) database, the HR check will ensure that users are
suspended/removed from the VO when experiment membership is no longer valid.</p>
<p>When creating a IAM account for a newly-discovered VOMS user, the importer
script generates a username of the form <code>voms.&lt;voms-id&gt;</code>. There is an option to
use the value of an attribute (e.g. <code>nickname</code>) from the user entry in VOMS, if
available.</p>
<p>The script by default removes a user from groups (including roles) where they do
not belong any more.</p>
<h3 id="cern-sso-automatic-linking">CERN SSO automatic linking</h3>
<p>The importer script can be configured to automatically link the imported account
to the CERN SSO identity in two ways:</p>
<ol>
<li>using the <code>nickname</code> VOMS account generic attribute</li>
<li>resolving the CERN username from the CERN LDAP</li>
</ol>
<h3 id="unique-email-address-for-users-in-iam">Unique email address for users in IAM</h3>
<p>VOMS allows different users to share an email address. IAM instead requires that
each user has a unique email address.</p>
<p>The import script implements an email override mechanism, that maps a VOMS user
id to another email address; however, a better approach would be to clean up the
VOMS database in order to avoid multiple accounts sharing email addresses.</p>
<h2 id="voms-importer-log">VOMS importer log</h2>
<p>The importer script produces an auditing log, detailing the actions applied to
groups, roles and users.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-43bda8bc26d1df36bc9eb8d9739f719e">4.3 - IAM Test Client application</h1>
    <div class="lead">OpenID Connect client application example</div>
	<p>IAM Test Client is a simple web application that demonstrates the use of the OpenID Connect client code and configuration.</p>
<p>It lives at <code>https://your-IAM-instance/iam-test-client</code>.</p>
<p><img src="images/test-client.png" alt="Test Client App"></p>
<p>Since Test Client uses OAuth Authorization Code Grant Type, after a successfull login you will be redirected to the consent page that the authorization server displays to confirm if the requested scopes can be shared with the client.</p>
<p><img src="images/consent-page.png" alt="Consent Page"></p>
<p>If you authorize, the following information will be shown:</p>
<p><img src="images/test-client-info.png" alt="App info"></p>
<p>In order to run the Test Client application you need to setup a minimal <a href="/v/v1.8.2/docs/reference/configuration/#test-client-configuration">configuration</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dbcc046a6c208e0a089e20aecc2dbaec">4.4 - User</h1>
    <div class="lead">Common user tasks</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-fc4a8820c0610ad9186b42bb179cd4bf">4.4.1 - Joining an IAM-managed organization</h1>
    
	<p>IAM provides a registration service that allows to have managed enrollment for
the organization under control. This mean that access to the organization is
only granted after explicit approval by a IAM administrator for the
organization.</p>
<h2 id="submitting-a-registration-request">Submitting a registration request</h2>
<p>Users can submit a registration request from the IAM login page in two ways:</p>
<ul>
<li>By clicking the <em>Register a new account</em> button:</li>
</ul>
<p><img src="../images/IAM-registration-1.png" alt="INDIGO IAM Registration button"></p>
<ul>
<li>By attempting a login with an external authentication provider such as Google
or a configured SAML IdP: in this case if the external authentication
succeeds and the authenticated user is not registered in the IAM the user is
taken to the registration form to confirm the registration requests.</li>
</ul>
<p><img src="../images/IAM-registration-2.png" alt="INDIGO IAM Registration form"></p>
<p>All the fields in the registration form are mandatory. The <em>notes</em> field can
used to include extra information targeted at IAM administrators to clarify the
reasons behind a registration request.</p>
<h2 id="confirming-a-registration-request">Confirming a registration request</h2>
<p>If the submission ends successfully, an email verification link is sent to the
user email address with a request to confirm his registration request.</p>
<p><img src="../images/IAM-registration-3.png" alt="INDIGO IAM Registration validation page"></p>
<p>Once the request is confirmed, IAM administrators are notified with an email.</p>
<h2 id="choosing-a-password">Choosing a password</h2>
<p>Once the submitteed request is approved by an IAM administrator, an email is
sent to the user with a reset password link. This URL points to page where the
user can choose a password for the IAM account.</p>
<p><img src="../images/IAM-registration-5.png" alt="INDIGO IAM Registration change password form"></p>
<p>Once the password is set, users can login to the IAM using the username chosen
at registration time and the password.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-afefc91265853008615d0ff910cb6bb9">4.4.2 - Obtaining an IAM access token from a CLI</h1>
    
	<p>A token can be obtained from a command-line interface (CLI) in two ways:</p>
<ul>
<li>using <code>oidc-agent</code></li>
<li>using scripts linked to this page, using the resource-owner password
credentials flow or the OAuth device flow</li>
</ul>
<p>In this section we recommend the installations of a set of tools that can help
in managing tokens.</p>
<h2 id="obtaining-a-token-using-oidc-agent">Obtaining a token using <code>oidc-agent</code></h2>
<p><a href="https://github.com/indigo-dc/oidc-agent">oidc-agent</a> is a useful tool to easily get and manage access
tokens for command-line applications.</p>
<h3 id="installing-oidc-agent">Installing oidc-agent</h3>
<p>See <a href="https://indigo-dc.gitbook.io/oidc-agent/installation/install">oidc-agent installation
instructions</a>.</p>
<h4 id="quick-centos7-installation-instructions">Quick CENTOS7 installation instructions</h4>
<p>This recipe shows how to quickly install <code>oidc-agent</code> on CENTOS 7.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yum -y install epel-release
$ yum -y install https://github.com/indigo-dc/oidc-agent/releases/download/v3.3.1/oidc-agent-3.3.1-1.el7.x86_64.rpm
</code></pre></div><h3 id="bootstrapping-oidc-agent">Bootstrapping oidc-agent</h3>
<p>The first thing to do is to start <code>oidc-agent</code>.
This can be done issuing the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">eval</span> <span style="color:#204a87;font-weight:bold">$(</span>oidc-agent<span style="color:#204a87;font-weight:bold">)</span>
Agent pid <span style="color:#0000cf;font-weight:bold">62088</span>
</code></pre></div><h3 id="registering-a-client">Registering a client</h3>
<p>In order to obtain a token out of IAM, a user needs a client registered.
<code>oidc-agent</code> can automate this step and store client credentials securely
on the user machine. This is a one-time operation, you do not need a new
client every time you need a token.</p>
<p>A new client can be registered using the <code>oidc-gen</code> command, as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ oidc-gen -w device wlcg
</code></pre></div><p>The <code>-w device</code> instructs <code>oidc-agent</code> to use the device code flow for the
authentication, which is the recommended way with IAM.</p>
<p>oidc-agent will display a list of different providers that can be used for
registration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>1<span style="color:#ce5c00;font-weight:bold">]</span> https://wlcg.cloud.cnaf.infn.it/
<span style="color:#ce5c00;font-weight:bold">[</span>2<span style="color:#ce5c00;font-weight:bold">]</span> https://iam-test.indigo-datacloud.eu/
...
<span style="color:#ce5c00;font-weight:bold">[</span>20<span style="color:#ce5c00;font-weight:bold">]</span> https://oidc.scc.kit.edu/auth/realms/kit/
</code></pre></div><p>Select one of the registered providers, or type a custom issuer (for IAM, the
last character of the issuer string is always a <code>/</code>, e.g.
<code>https://wlcg.cloud.cnaf.infn.it/</code>).</p>
<p>Then oidc-agent asks for the scopes, typing <code>max</code> (without quotes) allows to
get all the allowed scopes.</p>
<p>oidc-agent will register a new client and store the client credentials and a
refresh token locally in encrypted form (the agent will ask for a password from
the user).</p>
<p>As mentioned, <code>oidc-gen</code> is meant to be used only once, when you need a client registered.</p>
<h3 id="managing-oidc-agent-account-configurations">Managing oidc-agent account configurations</h3>
<p>To see the list of locally configured accounts use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; oidc-add -l

The following account configurations are usable:
DEEP-ac
XDC
atlas
...
cms-voms-importer
escape
escape-monitoring
iam-test
infn-cloud
wlcg
</code></pre></div><p>You can then load an account in the agent again with the oidc-add command, as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-add wlcg
</code></pre></div><p>Once you&rsquo;ve loaded the account, you can use <code>oidc-token</code> to get tokens for that account.</p>
<h3 id="getting-tokens-with-oidc-token">Getting tokens with <code>oidc-token</code></h3>
<p>Tokens can be obtained using the <code>oidc-token</code> command, as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token wlcg
</code></pre></div><p>This will request a token with all the scopes requested at client registration
time. To limit the scopes included in the token, the <code>-s</code> flag can be used, as
follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token -s storage.read:/ wlcg
</code></pre></div><p>The token audience can be limited using the <code>--aud</code> flag,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oidc-token --aud example.audience -s storage.read:/ wlcg
</code></pre></div><h3 id="accessing-oidc-agent-client-configuration">Accessing oidc-agent client configuration</h3>
<p>Often is useful to get details about the client configuration generated
by oidc-agent. This can be done with the <code>oidc-gen -p</code> command, that is
used to print a client configuration, as in the following example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">❯ oidc-gen -p wlcg
Enter decryption password <span style="color:#204a87;font-weight:bold">for</span> account config <span style="color:#4e9a06">&#39;wlcg&#39;</span>:******
<span style="color:#ce5c00;font-weight:bold">{</span>
	<span style="color:#4e9a06">&#34;name&#34;</span>:	<span style="color:#4e9a06">&#34;wlcg&#34;</span>,
	<span style="color:#4e9a06">&#34;client_name&#34;</span>:	<span style="color:#4e9a06">&#34;oidc-agent:wlcg&#34;</span>,
	<span style="color:#4e9a06">&#34;issuer_url&#34;</span>:	<span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/&#34;</span>,
	<span style="color:#4e9a06">&#34;device_authorization_endpoint&#34;</span>:	<span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/devicecode&#34;</span>,
	<span style="color:#4e9a06">&#34;daeSetByUser&#34;</span>:	0,
	<span style="color:#4e9a06">&#34;client_id&#34;</span>:	<span style="color:#4e9a06">&#34;*****&#34;</span>,
	<span style="color:#4e9a06">&#34;client_secret&#34;</span>:	<span style="color:#4e9a06">&#34;*****&#34;</span>,
	<span style="color:#4e9a06">&#34;refresh_token&#34;</span>:	<span style="color:#4e9a06">&#34;****.*****.&#34;</span>,
	<span style="color:#4e9a06">&#34;cert_path&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>,
	<span style="color:#4e9a06">&#34;scope&#34;</span>:	<span style="color:#4e9a06">&#34;storage.create:/ openid offline_access storage.read:/ eduperson_scoped_affiliation storage.modify:/ wlcg wlcg.groups eduperson_entitlement&#34;</span>,
	<span style="color:#4e9a06">&#34;audience&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>,
	<span style="color:#4e9a06">&#34;redirect_uris&#34;</span>:	<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;edu.kit.data.oidc-agent:/redirect&#34;</span>, <span style="color:#4e9a06">&#34;http://localhost:8080&#34;</span>, <span style="color:#4e9a06">&#34;http://localhost:47947&#34;</span>, <span style="color:#4e9a06">&#34;http://localhost:4242&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>,
	<span style="color:#4e9a06">&#34;username&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>,
	<span style="color:#4e9a06">&#34;password&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>,
	<span style="color:#4e9a06">&#34;client_id_issued_at&#34;</span>:	1600444894,
	<span style="color:#4e9a06">&#34;registration_access_token&#34;</span>:	<span style="color:#4e9a06">&#34;****&#34;</span>,
	<span style="color:#4e9a06">&#34;registration_client_uri&#34;</span>:	<span style="color:#4e9a06">&#34;https://wlcg.cloud.cnaf.infn.it/register/****&#34;</span>,
	<span style="color:#4e9a06">&#34;token_endpoint_auth_method&#34;</span>:	<span style="color:#4e9a06">&#34;client_secret_basic&#34;</span>,
	<span style="color:#4e9a06">&#34;grant_types&#34;</span>:	<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span>, <span style="color:#4e9a06">&#34;refresh_token&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>,
	<span style="color:#4e9a06">&#34;response_types&#34;</span>:	<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;token&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>,
	<span style="color:#4e9a06">&#34;application_type&#34;</span>:	<span style="color:#4e9a06">&#34;web&#34;</span>,
	<span style="color:#4e9a06">&#34;cert_path&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>,
	<span style="color:#4e9a06">&#34;audience&#34;</span>:	<span style="color:#4e9a06">&#34;&#34;</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h2 id="obtaining-a-token-with-the-password-flow">Obtaining a token with the password flow</h2>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-4.3">password flow</a> allows a user to get a token from the
IAM by using the IAM local credentials (i.e. the username/password credentials
setup at IAM registration time).</p>
<p>In order to use the password flow, a non-privileged user has to:</p>
<ol>
<li>register a client following the instructions given in [the client
registration][client-registration] section</li>
<li>Note down the <code>client_id</code> of the generated client and ask an IAM
administrator to enable the password flow for such client</li>
<li>Wait until the client as the password flow enabled</li>
<li>Use a script similar to the one given <a href="https://gist.github.com/andreaceccanti/7d863db5ce3f43c74123a2cea8b8f9ff">here</a> (or write
your own following the recommendations of the <a href="https://tools.ietf.org/html/rfc6749#section-4.3">RFC</a>) to
obtain a token out of the IAM</li>
</ol>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>While this approach is viable, it is <strong>deprecated</strong> since:</p>
<ul>
<li>it forces the user to request the activation of the password flow for the
client (it is disabled by default for dynamically registered clients)</li>
<li>it forces the user to authenticate with the local IAM credentials (external
authentication mechanisms such as Google or SAML cannot be used)</li>
<li>it exposes the user credentials to the client application</li>
</ul>
<p>The device code flow, described in the next section, does not have these
limitations and should be preferred over the password flow.</p>


</div>

<h2 id="obtaining-a-token-with-the-device-code-flow">Obtaining a token with the device code flow</h2>
<p>The <a href="https://tools.ietf.org/html/draft-ietf-oauth-device-flow-09">device code flow</a> allows a user to get a token
from the IAM from a CLI interface while using an external browser for the
authentication step. This is convenient since:</p>
<ul>
<li>it does not require any authorization from administrators (the device code
flow can be requested by the user at client registration time)</li>
<li>it allows the user to authenticate with any of the authentication mechanisms
supported by the IAM</li>
<li>it <strong>does not</strong> expose the user credentials to the client application</li>
</ul>
<p>For nitty and gritty details on how the flow works, see the
<a href="https://tools.ietf.org/html/draft-ietf-oauth-device-flow-09">RFC</a>.</p>
<p>After having registered a client with the device flow enabled (see <a href="/v/v1.8.2/docs/tasks/user/client-registration/">client
registration section</a>), the device code flow can be
used to obtain a token using a script like the one <a href="https://gist.github.com/andreaceccanti/5b69323b89ce08321e7b5236de503600">here</a>
which does the following:</p>
<ul>
<li>contacts the device flow endpoint to start a device flow authentication and
authorization</li>
<li>prints code information on the terminal</li>
<li>waits for user input to proceed and obtain the token(s)</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9a8717b724b3cc965f31246cbdd60946">4.4.3 - Registering a client</h1>
    
	<p>IAM exposes the OpenID Connect/OAuth dynamic client registration functionality
on its own dashboard (it has been migrated by <a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki">MitreID</a> dashboard).</p>
<p>In OAuth terminology, a client is an application or service that can interact
with an authorization server for authentication/authorization purposes.</p>
<p>A new client can be registered in the IAM in two ways:</p>
<ul>
<li>using the <a href="/v/v1.8.2/docs/reference/api/oidc-client-registration/">dynamic client registration API</a>;</li>
<li>via the IAM dashboard (which simply acts as a client to the API mentioned
above).</li>
</ul>
<h2 id="registering-a-client-using-the-dashboard">Registering a client using the dashboard</h2>
<p>Log into the service and click on the <em>My Clients</em> link on the left
navigation bar:</p>
<p><img src="../images/my_client-dashboard.png" alt="dashboard"></p>
<p>From the <em>My client</em> link, select <em>New client</em>:</p>
<p><img src="../images/new-client-reg-0.png" alt="client reg"></p>
<p>A form will open that enable you to configure your client:</p>
<p><img src="../images/new-client-reg-1.png" alt="client reg"></p>
<p>The minimum information you have to provide is:</p>
<ul>
<li><em>Client name</em>: choose a name for your client</li>
<li><em>Redirect URI(s)</em>: one or more redirect URIs for your client; these are
required if you choose to enable the authorization code flow;</li>
</ul>
<p><img src="../images/new-client-reg-2.png" alt="client reg"></p>
<p>Remember to select the <code>offline_access</code> scope from the <strong>Scopes</strong> tab if you
want to request refresh tokens for the client being created:</p>
<p><img src="../images/new-client-reg-3.png" alt="client reg"></p>
<p>You can then click the <strong>Save</strong> button at the bottom of the page:</p>
<p><img src="../images/new-client-reg-4.png" alt="client reg"></p>
<p>IAM will then generate client credentials for your client and other information
that will be displayed as follows:</p>
<p><img src="../images/new-client-reg-5.png" alt="client reg"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5f7a8f5e4030289ede0cce345878ff5f">4.4.4 - Change account information</h1>
    
	<p>Once logged in, you can change information in your account (if allowed by the
IAM configuration) by clicking the &ldquo;Edit Details&rdquo; from your home page:</p>
<p><img src="../images/change-details.png" alt="Change details"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9425af354278fe0b0806e2532bbb465a">4.4.5 - Changing the account password</h1>
    
	<p>Once logged in you can change your account password by clicking on the &ldquo;Change
password&rdquo; button in your home page:</p>
<p><img src="../images/change-password.png" alt="Change password"></p>
<p>Note that the &ldquo;Change password&rdquo; functionality is only useful if you remember
your IAM account password. In case you forgot it, logout from the IAM and
follow the instructions in the <a href="../reset-password">Reset account password</a>
section.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-606d8ee94cbe5ccb53556270df85092f">4.4.6 - JWT client authentication</h1>
    
	<p>IAM supports several methods to authenticate an OAuth2 client to the token endpoint.</p>
<p>The authentication via JWT assertion is defined in <a href="https://datatracker.ietf.org/doc/html/rfc7523#section-2.2">RFC7523</a>.
It can be used to request an access token when a client wishes to utilize an
existing trust relationship, expressed through the semantics of the JWT, without a direct user-approval step at the authorization server.
Client authentication using a JWT is nothing more than an alternative way for a client to authenticate to the token endpoint
and must be used in conjunction with some grant type to form a complete and meaningful protocol request,
for instance the <em>authorization code</em> flow (when a user has to approve the client in order to access to their resources),
the <em>client credential</em> flow (when a client is acting on its own behalf), etc.</p>
<h2 id="jwt-assertion-validation">JWT assertion validation</h2>
<p>The IAM Authorization Server validates the JWT assertion and issues an access token if
the following conditions are satisfied.</p>
<p><strong>JWT assertion header</strong></p>
<ul>
<li>the &ldquo;alg&rdquo; (algorithm) claim must be present to indicate the algorithm used to sign the token;</li>
<li>the &ldquo;kid&rdquo; (key ID) claim must be present in the asymmetrically signed assertions to identify the public key.</li>
</ul>
<p><strong>JWT assertion body</strong></p>
<ul>
<li>the &ldquo;iss&rdquo; (issuer) and &ldquo;sub&rdquo; (subject) claims must be equal to the <code>client_id</code>;</li>
<li>the &ldquo;aud&rdquo; (audience) claim must be equal to the token endpoint URL;</li>
<li>the &ldquo;exp&rdquo; (expiration) claim must be present to limit the JWT assertion lifetime;</li>
<li>the &ldquo;jti&rdquo; (JWT ID) claim must be present and provides a unique identifier for the token.</li>
</ul>
<h2 id="client-settings">Client settings</h2>
<p>You need to configure an OAuth2 client in IAM which is used to issue a JWT assertion and get an access token.</p>
<p>Follow the instruction on <a href="../client-registration">how to register a new client</a>, or edit an existing client
(click on the <em>My clients</em> link on the left navigation bar of the IAM dashboard and select the client name).
From the <em>Credentials</em> tab you can choose the authentication method to the token endpoint:</p>
<ul>
<li>client secret with symmetrically signed JWT assertion;</li>
<li>asymmetrically signed JWT assertion.</li>
</ul>
<h3 id="symmetrically-signed-jwt-assertion">Symmetrically signed JWT assertion</h3>
<p>This authentication mechanism is used when your JWT assertion is signed with a symmetric key.</p>
<p>To use this mechanism, select <em>Client secret with symmetrically signed JWT assertion</em>;
the <em>Client secret</em> generated by IAM must be used as symmetric key to sign your JWT assertion.</p>
<p><img src="../images/jwt-authn-symm.png" alt="Symmetrically signed JWT"></p>
<p>A symmetrically signed JWT assertion looks like</p>
<pre><code>## Header
{
  &quot;alg&quot;: &quot;HS256&quot;
}
## Payload
{
  &quot;sub&quot;: &quot;181f26f9-4562-4919-b718-759241485335&quot;,
  &quot;aud&quot;: &quot;https://iam.local.io/token&quot;,
  &quot;nbf&quot;: 1649162752,
  &quot;iss&quot;: &quot;181f26f9-4562-4919-b718-759241485335&quot;,
  &quot;exp&quot;: 1651754752,
  &quot;iat&quot;: 1649162752,
  &quot;jti&quot;: &quot;120240aa-e389-4a55-8384-f4d7a54c2633&quot;
}
</code></pre><h3 id="asymmetrically-signed-jwt-assertion">Asymmetrically signed JWT assertion</h3>
<p>This authentication mechanism is used when your JWT assertion is signed with a private key.</p>
<p>To use this mechanism, select <em>Asymmetrically signed JWT assertion</em> and then choose how IAM can get the public
key used to validate your JWT assertion.
Into the section <em>Public key set</em> below, choose between:</p>
<ul>
<li><em>By URI</em> and provide a valid <em>JSON Web Keyset URI</em> in the corresponding box,</li>
<li>or <em>By value</em> and provide a <em>JSON Web Keyset value</em> in the corresponding box.</li>
</ul>
<p><img src="../images/jwt-authn-asymm.png" alt="Asymmetrically signed JWT by value"></p>
<p>An asymmetrically signed JWT assertion looks like</p>
<pre><code>## Header
{
  &quot;alg&quot;: &quot;RS256&quot;,
  &quot;kid&quot;: &quot;rsa1&quot;
}
## Payload
{
  &quot;sub&quot;: &quot;bdb6ca15-be9c-470a-81dc-69d30dabb340&quot;,
  &quot;aud&quot;: &quot;https://iam.local.io/token&quot;,
  &quot;nbf&quot;: 1649162752,
  &quot;iss&quot;: &quot;bdb6ca15-be9c-470a-81dc-69d30dabb340&quot;,
  &quot;exp&quot;: 1651754752,
  &quot;iat&quot;: 1649162752,
  &quot;jti&quot;: &quot;f4392c1e-6d6a-423e-8e5e-5d114585f750&quot;
}
</code></pre><h2 id="getting-an-access-token">Getting an access token</h2>
<p>Here is an example of an HTTP POST request to the token endpoint where the client is authenticated
with JWT assertion and is authorized via the client credential OAuth2 flow.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -d <span style="color:#000">client_assertion</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">JWTA</span><span style="color:#4e9a06">}</span> -d <span style="color:#000">client_assertion_type</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:ietf:params:oauth:client-assertion-type:jwt-bearer -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>client_credentials https://iam.local.io/token <span style="color:#000;font-weight:bold">|</span> jq
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;access_token&#34;</span>: <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiY...&#34;</span>,
  <span style="color:#4e9a06">&#34;token_type&#34;</span>: <span style="color:#4e9a06">&#34;Bearer&#34;</span>,
  <span style="color:#4e9a06">&#34;expires_in&#34;</span>: 3599,
  <span style="color:#4e9a06">&#34;scope&#34;</span>: <span style="color:#4e9a06">&#34;storage.read:/ storage.create:/ storage.modify:/&#34;</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>If not explicitly requested in the payload, the scopes returned
in the access token are all the ones registered for your client.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e361335b1cc62574d28cc081294326a2">4.4.7 - Linking an external account</h1>
    
	<p>A user can link an external account from the IAM dashboard (i.e., the user must
be logged in the IAM service). The following sets of screenshots show the
process followed to link a Google account.</p>
<p><img src="../images/account-linking-google-1.png" alt="IAM link google account"></p>
<p>Clicking on the &ldquo;Link Google account&rdquo; opens a confirmation dialog:</p>
<p><img src="../images/account-linking-google-2.png" alt="IAM link google account"></p>
<p>When the user clicks on the <strong>Link</strong>, button is redirected to Google for
authentication:</p>
<p><img src="../images/account-linking-google-3.png" alt="IAM link google account"></p>
<p>After a succesfull authentication the user is redirected to the IAM page, and a
confirmation dialog shows that the account was linked succesfully:
<img src="../images/account-linking-google-4.png" alt="IAM link google account"></p>
<p>Now the user can logout from the IAM and login using the <strong>Sign in with
Google</strong> button.</p>
<p>A similar process is implemented for SAML external accounts.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-93f6e460a9484b5a1f15cf389f229f2c">4.4.8 - Linking an X.509 certificate</h1>
    
	<p>IAM provides the ability to link X.509 certificates to a user account. X.509
account linking works if:</p>
<ul>
<li>X.509 certificate authentication is enabled for the IAM instance in use; for
more information on this see the <a href="/v/v1.8.2/docs/getting-started/nginx/">Getting started guide</a></li>
<li>The certificate is correctly installed in the browser used to access the IAM;</li>
<li>The certificate is trusted by the IAM (i.e. is signed by a certificate
authority known and trusted by the IAM)</li>
</ul>
<h2 id="authenticating-with-an-x509-certificate">Authenticating with an X.509 certificate</h2>
<p>If a certificate is correctly configured in the browser, the browser will show
a dialog to select whether to authenticate with the certificate or not as in the
following screenshot:</p>
<p><img src="../images/account-link-x509-1.png" alt="INDIGO IAM Registration button"></p>
<p>Note that this happens when enstabilishing the connection to the IAM. If no
dialog is shown, either:</p>
<ul>
<li>there&rsquo;s no certificate in the browser that is trusted by the IAM (either the
certificate is expired or signed by a CA not trusted by the IAM)</li>
<li>a certificate was selected automatically by the browser when authenticating
to the IAM</li>
</ul>
<p>In case the certificate used for the authentication is linked to an
organization account, the IAM login page will display a &ldquo;Sign in with your
certificate&rdquo; button:</p>
<p><img src="../images/account-link-x509-5.png" alt="Login page with cert recognized"></p>
<h2 id="linking-a-certificate">Linking a certificate</h2>
<p>If a certificate was recognized but is not linked to any membership in the IAM,
the user will have to authenticate with other credentials (local username &amp;
password, or external authentication mechanisms (e.g. Google)).</p>
<p>After having logged in, the user can link a certificate by clickin on the
<strong>Link Certificate</strong> button:</p>
<p><img src="../images/account-link-x509-2.png" alt="INDIGO IAM Registration button"></p>
<p>Note that the <strong>Link certificate</strong> button will be shown in the page <strong>only if a
valid and trusted certificate was detected by the IAM during the TLS handshake</strong>.</p>
<p>Clicking the <strong>Link certificate</strong> button opens a dialog that shows information
about the certificate that should be linked to the account:</p>
<p><img src="../images/account-link-x509-3.png" alt="INDIGO IAM Registration button"></p>
<p>If the linking completes succesfully, the linked certificate information will
be shown in the X.509 certificates panel:</p>
<p><img src="../images/account-link-x509-4.png" alt="INDIGO IAM Registration button"></p>
<p>To check that the linking actually works, the user can logout from the IAM and
login again with the certificate.</p>
<h2 id="unlinking-a-certificate">Unlinking a certificate</h2>
<p>A user can unlink a certificate by clicking on the <strong>Unlink</strong> button shown in
the certificate panel (see the image above).</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-725f368abb7a0345d6635f33b8848b53">4.4.9 - Managing active tokens</h1>
    
	<p>You can see which access and refresh tokens bound to your identity are
currently active from the MitreID dashboard following the &ldquo;Manage Active
Tokens&rdquo; link:</p>
<p><img src="../images/manage-active-tokens.png" alt="Manage access tokens"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-56a163f5aefc17b464cd248874936cf9">4.4.10 - Managing approved sites</h1>
    
	<p>You can manage approved sites (i.e. sites and services that you approved when
authenticating at the IAM) from the MitreID dashboard following the &ldquo;Manage Approved Sites&rdquo; link:</p>
<p><img src="../images/manage-approved-sites.png" alt="Manage approved sites"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c0adc169e351e3ffdad1a9ceff1b6c19">4.4.11 - Managing SSH keys</h1>
    
	<p>Starting with version <code>v1.7.0</code>, IAM allows users to link SSH public keys to
their accounts.</p>
<p>SSH keys are then exposed to relying parties in two ways:</p>
<ul>
<li>through the IAM <a href="/v/v1.8.2/docs/reference/api/scim-api/">SCIM APIs</a>;</li>
<li>as a claim in the OpenID Connect <code>userinfo</code> endpoint response, if the token
has the <code>ssh-keys</code> scope.</li>
</ul>
<h2 id="managing-account-ssh-keys">Managing account SSH keys</h2>
<p>The IAM dashboard allows a user to link one or more SSH keys to their account,
as shown below:</p>
<p><img src="../images/ssh-keys-0.png" alt="ssh key management"></p>
<h2 id="accessing-account-ssh-keys-via-scim-apis">Accessing account SSH keys via SCIM APIs</h2>
<p>As clarified in the <a href="/v/v1.8.2/docs/reference/api/scim-api/">SCIM APIs documentation</a>, ssh keys are exposed
in the user information returned to authorized clients, as in the following
fragment:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;80e5fb8d-b7c8-451a-89ba-346ae278a66f&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#a40000">...</span>
  <span style="color:#204a87;font-weight:bold">&#34;userName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;test&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;urn:indigo-dc:scim:schemas:IndigoUser&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;sshKeys&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;my-key&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;primary&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;value&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ssh-rsa AAAAB...&#34;</span><span style="color:#000;font-weight:bold">,</span> 
        <span style="color:#204a87;font-weight:bold">&#34;fingerprint&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;M9vqQeuPrPI0wiaT6sftgfxu1/kowbb37fcLU2+R7yk=&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-25T15:18:45.978+02:00&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;lastModified&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2021-08-25T15:18:45.978+02:00&#34;</span>
      <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">],</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="accessing-account-ssh-keys-via-the-userinfo-endpoint">Accessing account SSH keys via the userinfo endpoint</h2>
<p>SSH keys linked to a user account are returned in the userinfo endpoint
response if the token used to access the endpoint has the <code>ssh-keys</code> scope, as
in the following example:</p>
<pre><code class="language-console" data-lang="console">❯ curl -s -L -H &quot;Authorization: Bearer ${AT}&quot; https://iam.local.io/userinfo | jq .
{
  &quot;sub&quot;: &quot;80e5fb8d-b7c8-451a-89ba-346ae278a66f&quot;,
  &quot;ssh_keys&quot;: [
    {
      &quot;fingerprint&quot;: &quot;M9vqQeuPrPI0wiaT6sftgfxu1/kowbb37fcLU2+R7yk=&quot;,
      &quot;value&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2E...&quot;
    }
  ]
}
</code></pre><p>Note that the <code>ssh-keys</code> scope is a <strong>restricted</strong> scope, i.e., it can be
assigned to client registered in IAM only by IAM administrators.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b4fb7a916a4b238a27bb4f7882cb6eb6">4.4.12 - Reset an account password</h1>
    
	<p>Users can reset their password from the IAM login page by clicking on the
<em>Forgot your password?</em> link, which opens a dialog where users can then enter
their email address, and if the entered email address is linked to a registered
user a reset password link will be sent to such email address.</p>
<p><img src="../images/IAM-forgot-password.png" alt="INDIGO IAM Forgot Password submission form"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a7c9e10a31abdecaec5a338462a220a8">5 - Developer guide</h1>
    <div class="lead">Build instructions and other information for IAM developers</div>
	<h2 id="iam-build-requirements">IAM build requirements</h2>
<p>The IAM is a Spring Boot Java application.</p>
<p>To build it, you will need:</p>
<ul>
<li>Java 8</li>
<li>Maven 3.3.x or greater</li>
<li>Git</li>
</ul>
<h2 id="checking-out-the-iam-code">Checking out the IAM code</h2>
<p>You can check out the IAM code as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  git clone https://github.com/indigo-iam/iam.git
</code></pre></div><h2 id="building-the-iam">Building the IAM</h2>
<p>You can build the IAM packages with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  mvn package
</code></pre></div><h2 id="setting-up-the-docker-based-development-environment">Setting up the docker-based development environment</h2>
<p>You will need:</p>
<ul>
<li>Docker 1.11.1 or greater</li>
<li>Docker compose 1.7 or greater</li>
</ul>
<p>You can start a development/testing environment with the following command:</p>
<pre><code>  docker-compose build
  docker-compose up
</code></pre><p>The docker-compose.yml file requires that you set some environment variables
for it to run properly, mainly to provide OAuth client credentials for external
authentication mechanisms (Google).</p>
<p>The setup also assumes that you have an entry in your DNS server (complex) or
/etc/hosts (simpler) that maps iam.local.io to the machine (or VM) where docker
is running, e.g.:</p>
<pre><code>$ cat /etc/hosts
...

192.168.99.100 iam.local.io
</code></pre><h2 id="how-to-run-tests-against-the-mysql-database">How to run tests against the mysql database</h2>
<p>IAM JUnit integration tests can (and should) be run against mysql database.</p>
<p>To do so, boostrap the database instance with docker-compose:</p>
<pre><code>docker-compose up db
</code></pre><p>And then run the tests with the following command:</p>
<pre><code>mvn -Dspring.profiles.active=mysql-test test
</code></pre><h2 id="building-docker-production-images">Building Docker production images</h2>
<p>To build the docker images for the iam-service and iam-test client,
use the following commands:</p>
<pre><code>sh iam-login-service/docker/build-prod-image.sh
sh iam-test-client/docker/build-prod-image.sh
</code></pre><p>These commands should run <strong>after</strong> war and jar archives have been built, i.e.
after a <code>mvn package</code>.</p>
<p>For more details on the image build scripts see the following folders:</p>
<ul>
<li><a href="https://github.com/indigo-iam/iam/tree/master/iam-login-service/docker">iam-login-service</a></li>
<li><a href="https://github.com/indigo-iam/iam/tree/master/iam-test-client/docker">iam-test-client</a></li>
</ul>
<h2 id="related-projects">Related projects</h2>
<p>This project builds upon the following projects/technologies:</p>
<ul>
<li><a href="http://projects.spring.io/spring-boot/">Spring Boot</a></li>
<li><a href="https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server">MitreID OpenID-Connect client and server libraries</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-69f27a09ffee79bd86aeda89b3a9f7db">5.1 - Specifications and useful resources</h1>
    <div class="lead">Specifications and useful resources for IAM development</div>
	<h2 id="oauth">OAuth</h2>
<ul>
<li><a href="https://tools.ietf.org/wg/oauth/">OAuth WG home</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6749">Main OAuth RFC</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6750">Bearer token usage</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6819">OAuth threat model</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-18">Security recommendations</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8414">Discovery/AuthZ server metadata</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8693">Token exchange</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8628">Device flow</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7009">Token revocation</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8707">OAuth resource indicators</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8252">OAuth for native apps</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8705">OAuth and MTLS</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7521">OAuth assertion framework</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7523">JWT profile for client &amp; authorizationg grants</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7662">Token introspection</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7591">Dynamic client registration</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7592">Dynamic client management</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9068">Profile for JWT access tokens</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8176">Authentication method reference values</a></li>
<li><a href="https://oauth.net/2.1/">OAuth 2.1</a></li>
</ul>
<h2 id="openid-connect">OpenID Connect</h2>
<ul>
<li><a href="https://openid.net/developers/specs/">OpenID Connect specifications home</a></li>
<li><a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect core</a></li>
<li><a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect discovery</a></li>
<li><a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect dynamic registration</a></li>
<li><a href="https://openid.net/specs/openid-connect-federation-1_0.html">OpenID Connect federation</a></li>
</ul>
<h2 id="json-web-tokens-jwts">JSON Web Tokens (JWTs)</h2>
<ul>
<li><a href="https://tools.ietf.org/wg/jose/">JOSE WG homme</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7519">JWT</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7520">Examples and use cases</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7518">JSON Web Algorithms</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7516">JSON Web Encryption</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7517">JSON Web Key</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7515">JSON Web Signature</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7638">JWT Thumbprint</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8725">JWT best current practices</a></li>
</ul>
<h2 id="aarc">AARC</h2>
<ul>
<li><a href="https://aarc-project.eu/architecture/">AARC Blueprint architecture</a></li>
<li><a href="https://aarc-project.eu/guidelines/">AARC guidelines</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-63fc23311c2c31b8d70578804ff3e9bf">6 - IAM as a service</h1>
    <div class="lead">INFN offers IAM-as-a-service to partner communities.</div>
	<p>INFN provides IAM as a service to partner research communities. In this
scenario, a dedicated IAM instance is deployed on the INFN infrastructure and
configured according to the community needs.</p>
<p>INFN takes care of keeping the service operational and up-to-date, while
administrative control on the IAM instance is granted to the community.</p>
<p>The following IAM deployments are examples of IAM deployed as a service for
partner communities:</p>
<ul>
<li>
<p><a href="https://dodas-iam.cloud.cnaf.infn.it">DODAS</a>: The Dynamic On-Demand Analysis
Service (DODAS) allows to instantiate on-demand container-based clusters.
Both HTCondor batch systems, and platforms for Big Data analysis based for
example on Spark or Hadoop, can be deployed on any cloud-based
infrastructures with almost zero effort.</p>
</li>
<li>
<p><a href="https://iam.extreme-datacloud.eu/">eXtreme Datacloud project</a>: The eXtreme
DataCloud project (XDC) project aims at developing scalable technologies for
federating storage resources and managing data in highly distributed
computing environments, as required by the most demanding, data intensive
research experiments in Europe and worldwide.</p>
</li>
</ul>
<h2 id="how-to-access-the-service">How to access the service</h2>
<p>To request the deployment of an IAM service instance for your community, write
to our <a href="mailto:iam-support@lists.infn.it">support list</a>.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9b5fde25ef80658078bd874ca68c417e">6.1 - Privacy policy</h1>
    
	<p>This privacy policy will explain how INFN uses the personal data collected from
users for the erogation of the INDIGO IAM service.</p>
<h2 id="what-data-do-we-collect">What data do we collect?</h2>
<p>The following  personal information is collected and managed by the IAM service:</p>
<ul>
<li>Personal identitifcation information (Name,email address,phone number,
affiliation)</li>
<li>Unique ID used to identify the user when authenticated through a SAML
identity provider (eduPersonPrincipalName or SAML persistent
ID/eduPersonTargetedID) or linked social login accounts (e.g., a Google
account)</li>
</ul>
<h2 id="how-do-we-collect-your-data">How do we collect your data?</h2>
<p>Data is collected when users register and authetnicate at the IAM service.</p>
<p>INFN could collect your data indirectly from the following sources:</p>
<ul>
<li>Trusted Identity Providers, e.g. your home institution IdP;</li>
<li>Social login providers, e.g. Google</li>
</ul>
<h2 id="how-we-will-use-your-data">How we will use your data?</h2>
<p>INFN collects your data in order to implement:</p>
<ul>
<li>User authentication and authorization at the service or at trusted services relying on IAM for authentication and authorization</li>
<li>Automated sending of email messages necessary for use of the service</li>
<li>Statistics and development of the service</li>
<li>Integration testing</li>
</ul>
<h2 id="how-do-we-store-your-data">How do we store your data?</h2>
<p>Personal data is stored until the user asks to be removed from the service by
interacting with the contact person for the service. Access logs are deleted
after 12 months.</p>
<h2 id="what-are-cookies">What are cookies?</h2>
<p>Cookies are text files placed on your computer to collect standard internet log
information and visitor behaviour information. When you visit the IAM service,
we may collect information from you automatically through cookies or similar
technology.</p>
<h2 id="how-do-we-use-cookies">How do we use cookies?</h2>
<p>The INFN IAM service uses cookies to:</p>
<ul>
<li>Keeping you signed in</li>
<li>Store user preferences</li>
</ul>
<h2 id="what-types-of-cookies-do-we-use-">What types of cookies do we use ?</h2>
<p>The INFN IAM service uses the following type of cookies:</p>
<ul>
<li>Functionality: INFN uses these cookies so that we recognize you on the
IAM service and remember previously selected preferences. Only first-party
cookies are used for this purpose;</li>
</ul>
<h2 id="how-to-manage-cookies">How to manage cookies?</h2>
<p>You can set your browser to not accept cookies, but the IAM service will not
work as a result of this choice</p>
<h2 id="changes-to-this-privacy-policy">Changes to this privacy policy</h2>
<p>INFN keeps this privacy policy under regular review and places any updates on
this web page. This privacy policy was last updated on 19 June 2019.</p>
<h2 id="how-to-contact-us">How to contact us</h2>
<p>Should you wish to report a complaint or if you feel that INFN has not
addressed your concerns in a satisfactory manner, use the following contact
info:</p>
<pre>
Davide Salomoni 

INFN-CNAF
Viale Berti Pichat 6/2
40127 Bologna  
Italy

davide.salomoni@cnaf.infn.it
</pre>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-452aae889b1b87431dde6278fe49d79f">6.2 - Service Level Agreement</h1>
    
	<p>The IAM service instances provided and operated by INFN may be subject to
specific SLAs to be defined with the collaborating organizations/projects.</p>
<p>If no specific SLA is defined, a standard SLA applies, namely the service is
operational 24x7, with the support granted on a best-effort basis from Monday
to Friday during INFN office hours.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-18e490e904e7b85f52606bd034f1ec81">6.3 - Terms of service</h1>
    
	<p>The IAM service instances provided and operated by INFN follow the rules for
the use of INFN IT services, namely:</p>
<ul>
<li><a href="https://web.infn.it/CCR/images/stories/upload_file/sicurezza_informatica/traduzione_30_may_FINAL_english.pdf">Regulation for the use of the INFN IT resources</a></li>
</ul>
<p>In addition, each of these IAM service instances has a specific Terms of
Service (ToS) agreement. Subject to these ToS, the IAM service instances are
meant to be used for authentication and authorization of users belonging to one
or more of the following categories:</p>
<ul>
<li>INFN users</li>
<li>Users belonging to organizations involved in projects, initiatives and experiments INFN collaborates with</li>
<li>Users belonging to other organizations, provided specific agreements and Service Level Agreements have been agreed upon</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/indigo-iam/iam">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://indigo-iam.slack.com">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2023 INFN All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/v/v1.8.2/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>




  </body>
</html>
