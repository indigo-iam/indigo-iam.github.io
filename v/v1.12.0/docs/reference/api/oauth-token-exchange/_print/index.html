<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/v/v1.12.0/docs/reference/api/oauth-token-exchange/">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/v/v1.12.0/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v/v1.12.0/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v/v1.12.0/favicons/android-192x192.png" sizes="192x192">

<title>OAuth token exchange API | INDIGO IAM</title>
<meta name="description" content="The INDIGO Identity and Access Management (IAM) Service">
<meta property="og:title" content="OAuth token exchange API" />
<meta property="og:description" content="The INDIGO Identity and Access Management (IAM) Service" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/v/v1.12.0/docs/reference/api/oauth-token-exchange/" />

<meta itemprop="name" content="OAuth token exchange API">
<meta itemprop="description" content="The INDIGO Identity and Access Management (IAM) Service"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="OAuth token exchange API"/>
<meta name="twitter:description" content="The INDIGO Identity and Access Management (IAM) Service"/>




<link rel="preload" href="/v/v1.12.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" as="style">
<link href="/v/v1.12.0/scss/main.min.8b15a284065632327b8c02a701e1c2297b5d1c084085e061cb33bbd46e6313e8.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/v/v1.12.0/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">INDIGO IAM</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/v/v1.12.0/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/v/v1.12.0/blog/"><span>Blog</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Releases</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.12.0">v1.12.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.11.0">v1.11.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.2">v1.10.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.1">v1.10.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.10.0">v1.10.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.9.0">v1.9.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.4">v1.8.4</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.3">v1.8.3</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.2">v1.8.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.1">v1.8.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.8.0">v1.8.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.2">v1.7.2</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.1">v1.7.1</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/v/v1.7.0">v1.7.0</a></li>
    <li><a class="dropdown-item" href="https://indigo-iam.github.io/docs/v/current/">older releases</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/v/v1.12.0/offline-search-index.881b5c1d875e0fb11b6e14b7b36ef740.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/v/v1.12.0/docs/reference/api/oauth-token-exchange/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">OAuth token exchange API</h1>





    <ul>
    
  
  
  
  

  

    </ul>


<div class="content">
      <p>The current release of the INDIGO IAM implements part of the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange
OAuth
specification</a>.
The Token Exchange OAuth specification defines &ldquo;a lightweigth protocol that
enables clients to request and obtain security tokens from authorization
servers&rdquo;.</p>
<p>OAuth 2.0 was designed to solve the problem of a delegated access to resources
across services, mediated by an authorization server, as shown in the following
picture:</p>
<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
<img class="card-img-top" src="/v/v1.12.0/docs/reference/api/oauth-token-exchange/oauth-delegation-1_hud4af7d007d8029ff318e645dabdc0724_26464_500x500_fit_catmullrom_3.png" width="500" height="384">
<figcaption class="card-body px-0 pt-2 pb-0">
<p class="card-text">


OAuth delegation

</p>
</figcaption>
</figure>

<p>In the picture above we have the usual OAuth roles:</p>
<ul>
<li>The user (or <em>resource owner</em>, in OAuth terminology);</li>
<li>A resource server, ie. a service hosting user resources, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li>A client: this is an agent that has received a permission from the user to
act on his behalf on his resources hosted on a resource server;</li>
<li>An authorization server: a service that issues access token to clients after
having authenticated the user and obtained an authorization from the user
that the client is entitled to act on user&rsquo;s resources</li>
</ul>
<p>There are scenarios when a resource server, in order to satisfy a client
request, needs to access resources hosted by other downstream services on
behalf of the user, like in the following picture:</p>
<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 510px">
<img class="card-img-top" src="/v/v1.12.0/docs/reference/api/oauth-token-exchange/oauth-token-exchange-1_hu3c62e250261e787166319e6bf7993f61_35467_500x500_fit_catmullrom_3.png" width="500" height="242">
<figcaption class="card-body px-0 pt-2 pb-0">
<p class="card-text">


OAuth token exchange

</p>
</figcaption>
</figure>

<p>In OAuth, access tokens are bearer tokens, so the first resource server could
simply use the access token received from the client to interact, on behalf
of the user, with the downstream resource server.</p>
<p>There are, however, situations in which just using the received access token
against the downstream service is not possible, like for instance if the token
audience was scoped to be valid only on the first resource server.</p>
<p>Moreover, the resource server could need the ability to act on behalf of the
user for an unbounded amount of time (e.g., to implement long-running
computations), not limited by the validity of the received access token.</p>
<p>The token exchange specification was designed to provide a protocol in support
of these scenarios, where a client can exchange an access token received from
antoher client with a new token (or a set of tokens, as we will see) by
interacting with a trusted OAuth authorization server.</p>
<h2 id="impersonation-vs-delegation">Impersonation vs delegation</h2>
<p>As specified in the <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05">Token Exchange OAuth
specification</a>,
when a subject A impersonates B, A has all the rights of B and it is
indistinguishable from B. So, when A interacts within any other entity, A is B.</p>
<p>With delegation A still has its own identity, separate from B. So when A
interacts within another entity, it is explicit that A is representing B,
because B has delegated some of its rights to A.</p>
<p>More details about the difference from this two semantics can be found in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-05#section-1.1">this section of the specification</a>.</p>
<p>The INDIGO IAM token exchange implementation currently supports only
impersonation semantics.</p>
<h2 id="client-configuration-requirements">Client configuration requirements</h2>
<p>In order to request a token exchange, a client must be configured with the
<code>urn:ietf:params:oauth:grant-type:token-exchange</code> grant type enabled. The token
exchange grant type is <strong>disabled</strong> by default for dynamically registered
clients, and can be enabled only by users with administrative privileges.</p>
<h2 id="the-token-exchange-request">The token exchange request</h2>
<p>A client who wants to exchange an access token with a new one (or a couple of
new tokens, in case a refresh token is requested), must send an authenticated
request to the IAM <code>/token</code> endpoint, specifying the following properties:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>grant_type</td>
<td><code>urn:ietf:params:oauth:grant-type:token-exchange</code></td>
</tr>
<tr>
<td>subject_token</td>
<td>The subject access token that the client wants to exchange</td>
</tr>
<tr>
<td>scope</td>
<td>The set of scopes requested for the new access token</td>
</tr>
<tr>
<td>audience</td>
<td>Optional. A space-separated list of resource identifiers that will be used to limit the audience of the issued token</td>
</tr>
</tbody>
</table>
<h3 id="scopes-in-exchanged-tokens">Scopes in exchanged tokens</h3>
<p>A client, when requesting a token exchange, can request any of the scopes
enabled by its client configuration. IAM system scopes are however handled in a
special way. These scopes, in order to be &ldquo;exchanged&rdquo; across clients, need to
be</p>
<ul>
<li>enabled for the client requesting the token exchange</li>
<li>linked to the subject token presented for the token exchange</li>
</ul>
<p>The list of system scopes currently defined in the IAM can be obtained by
registered users by issuing a request to the IAM system scopes API:</p>
<pre tabindex="0"><code>curl -H &#34;Authorization: Bearer ...&#34; https://iam.example/api/scopes
</code></pre><h3 id="token-exchange-example">Token Exchange example</h3>
<p>This section describes a token exchange flow.</p>
<p>We start with a normal OAuth flow where a client, <code>token-exchange-subject</code>,
requests an access token from the IAM using the resource owner password
credential flow. The <code>token-exchange-subject</code> client is configured to use HTTP
basic authentication against the IAM token endpoint, and in this example acts
on behalf of the <code>test</code> user. We use the resource owner password credentials
flow for convenience, but any other OAuth or OpenID connect flow that involves
a user identity would be fine (i.e., authorization code).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IAM_TOKEN_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span>https://iam.local.io/token
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>token-exchange-subject
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">test</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -s -u <span style="color:#000">$SUBJECT_ID</span>:<span style="color:#000">$SUBJECT_SECRET</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">username</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$USERNAME</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$PASSWORD</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>password <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</span></span></code></pre></div><p>Note that the only scopes requested in this first request are <code>openid</code> and
<code>profile</code>, i.e. the scopes required to access user identity information. IAM
token endpoint returns a JSON containing an access token and other info:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJpc3MiOiJodHRwczpcL1wvaWFtLmxvY2FsLmlvXC8iLCJleHAiOjE0NzY5NTcxMDIsImlhdCI6MTQ3Njk1MzUwMiwianRpIjoiMjBiZThlNjYtNmNmOS00YzE0LWI4ZDEtZjJmZTc0NDk0YjAxIn0.kqAhZ2MNmBLYIA_-xW9356kD-ndqJ7jKUZRPb7ox_4iXbjcnV6oZYAHZzTH_uBTXA2WsVIJJ-Qicm5JQ0ydb2ewgECAmGkKfL3X4qnnRq2_GgZZof3zlM_rIz3QrDB3v1eIt42YeMdUgODUYGKeDwntT5a7wPDtxe-GM2uL5fik&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;id_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhY2JjY2QwOC1kNzNkLTQxZjItODk3MS1iNjA4ZmNjNjYyNmQiLCJhdWQiOiIzMmMzMTUyOS05YmM2LTQ1ZWQtYjU0YS0wNGEyNThiMDRmYmYiLCJraWQiOiJyc2ExIiwiaXNzIjoiaHR0cHM6XC9cL2lhbS5sb2NhbC5pb1wvIiwiZXhwIjoxNDc2OTU0MTAyLCJpYXQiOjE0NzY5NTM1MDIsImp0aSI6IjhhMzk1OTM5LTM1N2QtNGY5My04MmEzLTJkMTBkM2ZhMzgzZCJ9.DtNR-ob8kMIUMa2x6TW7krSYMt78tfr5fnTK4aeoIY-wmEWcjPRx1_vT6_lesjMr9w0B_OCALXfOoDBfbF7DhmV7vpbotirkMxvowFBzgppmtBTZNAzLc_Wiwr4IAiGydwjy_UbYrxx6qlWJAKRwzSbDDd3oDVpU-KM8gtLIEa8&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>We put this access token in an environment variable:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> $ <span style="color:#204a87">export</span> <span style="color:#000">SUBJECT_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>cat /tmp/response <span style="color:#000;font-weight:bold">|</span> jq -r .access_token<span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>We use this access token to access the <code>app</code> API, which only requires access to
user identity to grant access:</p>
<pre tabindex="0"><code>curl -H &#34;Authorization: Bearer $SUBJECT_TOKEN&#34; https://app.example.org/api
</code></pre><p>Suppose now that the <code>app</code> API needs, to properly answer the request from the
client, to interact with another downstream service, <a href="https://tasks.example.org">https://tasks.example.org</a>,
on behalf of the user. Unfortunately the set of scopes linked to the access
token received are not sufficient to do this, and so <code>app</code> decides to exchange
the token received with another one granting enough privileges.</p>
<p>In Token Exchange terms, here <code>app</code> is the <code>actor</code>, the subject identity linked
to the token is the <code>test</code> user, and the audience for the new token being
requested would be the <code>https://tasks.app.example.org/api</code> API.</p>
<p>So <code>app</code> would do a request like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>https://app.example.org/api
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">ACTOR_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>...
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AUDIENCE</span><span style="color:#ce5c00;font-weight:bold">=</span>https://tasks.example.org/api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -s -u <span style="color:#000">$ACTOR_ID</span>:<span style="color:#000">$ACTOR_SECRET</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">grant_type</span><span style="color:#ce5c00;font-weight:bold">=</span>urn:ietf:params:oauth:grant-type:token-exchange <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">audience</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$AUDIENCE</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -d <span style="color:#000">subject_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$SUBJECT_TOKEN</span> <span style="color:#4e9a06">\ </span><span style="color:#8f5902;font-style:italic"># This token was received from the initial client </span>
</span></span><span style="display:flex;"><span>    -d <span style="color:#000">scope</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">$IAM_TOKEN_ENDPOINT</span> <span style="color:#000;font-weight:bold">|</span> tee /tmp/response <span style="color:#000;font-weight:bold">|</span> jq
</span></span></code></pre></div><p>Note that <code>app</code> requests an additional scope, <code>read-tasks</code>, to interact with
the downstream service.</p>
<p>Since <code>app</code> is a trusted client for token exchange, the IAM responds with the
following JSON:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;access_token&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;eyJra...&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Bearer&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;expires_in&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3599</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;openid profile read-tasks&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;issued_token_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;urn:ietf:params:oauth:token-type:jwt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>And <code>app</code> can use the newly issued access token to invoke services on
<a href="https://task-app.example.org/api">https://task-app.example.org/api</a> on behalf of user <code>test</code>:</p>
<pre tabindex="0"><code>$ curl -H &#34;Authorization: Bearer eyJra...&#34; http://tasks.example.org/api
</code></pre><h3 id="trust">Trust</h3>
<p>Clients that have the token exchange grant enabled are considered trusted
clients i.e., no explicit grant from the user is needed to grant access to
client scopes. For IAM system scopes, however, these can be &ldquo;exchanged&rdquo; only if
linked to the original subject token.</p>
<h3 id="limitation-and-known-issues">Limitation and known issues</h3>
<p>The current implementation of Token Exchange in Indigo IAM has the following limitations:</p>
<ul>
<li>Delegation is not yet supported: if <code>actor_token</code> or the <code>want_composite</code>
parameters are specified within the request, an error response is returned by
the authorization server;</li>
<li>The <code>resource</code> field is ignored.</li>
</ul>

</div>
</div>


  
  
  
  

  
  

  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/indigo-iam/iam" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://indigo-iam.slack.com" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">INFN</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/v/v1.12.0/js/main.min.dc2c0119076a0df855e55a8044ce0de74b7b9033c20e853e22d7ec7e9bdde965.js" integrity="sha256-3CwBGQdqDfhV5VqARM4N50t7kDPCDoU&#43;Itfsfpvd6WU=" crossorigin="anonymous"></script>
<script defer src="/v/v1.12.0/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js" integrity="sha256-c0eKfUgHaYrtfjVesj&#43;YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin="anonymous"></script>
<script src='/v/v1.12.0/js/tabpane-persist.js'></script>

  </body>
</html>
